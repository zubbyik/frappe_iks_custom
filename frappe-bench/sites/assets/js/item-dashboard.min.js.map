{"version":3,"file":"item-dashboard.min.js","sources":["../../../apps/erpnext/erpnext/stock/dashboard/item_dashboard.js"],"sourcesContent":["frappe.provide('erpnext.stock');\n\nerpnext.stock.ItemDashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.start = 0;\n\t\tif(!this.sort_by) {\n\t\t\tthis.sort_by = 'projected_qty';\n\t\t\tthis.sort_order = 'asc';\n\t\t}\n\n\t\tthis.content = $(frappe.render_template('item_dashboard')).appendTo(this.parent);\n\t\tthis.result = this.content.find('.result');\n\n\t\t// move\n\t\tthis.content.on('click', '.btn-move', function() {\n\t\t\terpnext.stock.move_item(unescape($(this).attr('data-item')), $(this).attr('data-warehouse'),\n\t\t\t\tnull, $(this).attr('data-actual_qty'), null, function() { me.refresh(); });\n\t\t});\n\n\t\tthis.content.on('click', '.btn-add', function() {\n\t\t\terpnext.stock.move_item(unescape($(this).attr('data-item')), null, $(this).attr('data-warehouse'),\n\t\t\t\t$(this).attr('data-actual_qty'), $(this).attr('data-rate'),\n\t\t\t\tfunction() { me.refresh(); });\n\t\t});\n\n\t\t// more\n\t\tthis.content.find('.btn-more').on('click', function() {\n\t\t\tme.start += 20;\n\t\t\tme.refresh();\n\t\t});\n\n\t},\n\trefresh: function() {\n\t\tif(this.before_refresh) {\n\t\t\tthis.before_refresh();\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.dashboard.item_dashboard.get_data',\n\t\t\targs: {\n\t\t\t\titem_code: this.item_code,\n\t\t\t\twarehouse: this.warehouse,\n\t\t\t\titem_group: this.item_group,\n\t\t\t\tstart: this.start,\n\t\t\t\tsort_by: this.sort_by,\n\t\t\t\tsort_order: this.sort_order,\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t},\n\trender: function(data) {\n\t\tif(this.start===0) {\n\t\t\tthis.max_count = 0;\n\t\t\tthis.result.empty();\n\t\t}\n\n\t\tvar context = this.get_item_dashboard_data(data, this.max_count, true);\n\t\tthis.max_count = this.max_count;\n\n\t\t// show more button\n\t\tif(data && data.length===21) {\n\t\t\tthis.content.find('.more').removeClass('hidden');\n\n\t\t\t// remove the last element\n\t\t\tdata.splice(-1);\n\t\t} else {\n\t\t\tthis.content.find('.more').addClass('hidden');\n\t\t}\n\n\t\t// If not any stock in any warehouses provide a message to end user\n\t\tif (context.data.length > 0) {\n\t\t\t$(frappe.render_template('item_dashboard_list', context)).appendTo(this.result);\n\t\t} else {\n\t\t\tvar message = __(\" Currently no stock available in any warehouse\")\n\t\t\t$(\"<span class='text-muted small'>\"+message+\"</span>\").appendTo(this.result);\n\t\t}\n\t},\n\tget_item_dashboard_data: function(data, max_count, show_item) {\n\t\tif(!max_count) max_count = 0;\n\t\tif(!data) data = [];\n\n\t\tdata.forEach(function(d) {\n\t\t\td.actual_or_pending = d.projected_qty + d.reserved_qty + d.reserved_qty_for_production + d.reserved_qty_for_sub_contract;\n\t\t\td.pending_qty = 0;\n\t\t\td.total_reserved = d.reserved_qty + d.reserved_qty_for_production + d.reserved_qty_for_sub_contract;\n\t\t\tif(d.actual_or_pending > d.actual_qty) {\n\t\t\t\td.pending_qty = d.actual_or_pending - d.actual_qty;\n\t\t\t}\n\n\t\t\tmax_count = Math.max(d.actual_or_pending, d.actual_qty,\n\t\t\t\td.total_reserved, max_count);\n\t\t});\n\n\t\tvar can_write = 0;\n\t\tif(frappe.boot.user.can_write.indexOf(\"Stock Entry\")>=0){\n\t\t\tcan_write = 1;\n\t\t}\n\n\t\treturn {\n\t\t\tdata: data,\n\t\t\tmax_count: max_count,\n\t\t\tcan_write:can_write,\n\t\t\tshow_item: show_item || false\n\t\t}\n\t}\n})\n\nerpnext.stock.move_item = function(item, source, target, actual_qty, rate, callback) {\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: target ? __('Add Item') : __('Move Item'),\n\t\tfields: [\n\t\t\t{fieldname: 'item_code', label: __('Item'),\n\t\t\t\tfieldtype: 'Link', options: 'Item', read_only: 1},\n\t\t\t{fieldname: 'source', label: __('Source Warehouse'),\n\t\t\t\tfieldtype: 'Link', options: 'Warehouse', read_only: 1},\n\t\t\t{fieldname: 'target', label: __('Target Warehouse'),\n\t\t\t\tfieldtype: 'Link', options: 'Warehouse', reqd: 1},\n\t\t\t{fieldname: 'qty', label: __('Quantity'), reqd: 1,\n\t\t\t\tfieldtype: 'Float', description: __('Available {0}', [actual_qty]) },\n\t\t\t{fieldname: 'rate', label: __('Rate'), fieldtype: 'Currency', hidden: 1 },\n\t\t],\n\t})\n\tdialog.show();\n\tdialog.get_field('item_code').set_input(item);\n\n\tif(source) {\n\t\tdialog.get_field('source').set_input(source);\n\t} else {\n\t\tdialog.get_field('source').df.hidden = 1;\n\t\tdialog.get_field('source').refresh();\n\t}\n\n\tif(rate) {\n\t\tdialog.get_field('rate').set_value(rate);\n\t\tdialog.get_field('rate').df.hidden = 0;\n\t\tdialog.get_field('rate').refresh();\n\t}\n\n\tif(target) {\n\t\tdialog.get_field('target').df.read_only = 1;\n\t\tdialog.get_field('target').value = target;\n\t\tdialog.get_field('target').refresh();\n\t}\n\n\tdialog.set_primary_action(__('Submit'), function() {\n\t\tvar values = dialog.get_values();\n\t\tif(!values) {\n\t\t\treturn;\n\t\t}\n\t\tif(source && values.qty > actual_qty) {\n\t\t\tfrappe.msgprint(__('Quantity must be less than or equal to {0}', [actual_qty]));\n\t\t\treturn;\n\t\t}\n\t\tif(values.source === values.target) {\n\t\t\tfrappe.msgprint(__('Source and target warehouse must be different'));\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.doctype.stock_entry.stock_entry_utils.make_stock_entry',\n\t\t\targs: values,\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.show_alert(__('Stock Entry {0} created',\n\t\t\t\t\t['<a href=\"#Form/Stock Entry/'+r.message.name+'\">' + r.message.name+ '</a>']));\n\t\t\t\tdialog.hide();\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t});\n\t});\n\n\t$('<p style=\"margin-left: 10px;\"><a class=\"link-open text-muted small\">'\n\t\t+ __(\"Add more items or open full form\") + '</a></p>')\n\t\t.appendTo(dialog.body)\n\t\t.find('.link-open')\n\t\t.on('click', function() {\n\t\t\tfrappe.model.with_doctype('Stock Entry', function() {\n\t\t\t\tvar doc = frappe.model.get_new_doc('Stock Entry');\n\t\t\t\tdoc.from_warehouse = dialog.get_value('source');\n\t\t\t\tdoc.to_warehouse = dialog.get_value('target');\n\t\t\t\tvar row = frappe.model.add_child(doc, 'items');\n\t\t\t\trow.item_code = dialog.get_value('item_code');\n\t\t\t\trow.f_warehouse = dialog.get_value('target');\n\t\t\t\trow.t_warehouse = dialog.get_value('target');\n\t\t\t\trow.qty = dialog.get_value('qty');\n\t\t\t\trow.conversion_factor = 1;\n\t\t\t\trow.transfer_qty = dialog.get_value('qty');\n\t\t\t\trow.basic_rate = dialog.get_value('rate');\n\t\t\t\tfrappe.set_route('Form', doc.doctype, doc.name);\n\t\t\t})\n\t\t});\n}"],"names":["frappe","provide","erpnext","stock","ItemDashboard","Class","extend","init","opts","$","this","make","me","start","sort_by","sort_order","content","render_template","appendTo","parent","result","find","on","move_item","unescape","attr","refresh","before_refresh","call","method","args","item_code","warehouse","item_group","callback","r","render","message","data","max_count","empty","context","get_item_dashboard_data","length","removeClass","splice","addClass","__","show_item","forEach","d","actual_or_pending","projected_qty","reserved_qty","reserved_qty_for_production","reserved_qty_for_sub_contract","pending_qty","total_reserved","actual_qty","Math","max","can_write","boot","user","indexOf","item","source","target","rate","dialog","ui","Dialog","title","fields","fieldname","label","fieldtype","options","read_only","reqd","description","hidden","show","get_field","set_input","df","set_value","value","set_primary_action","values","get_values","qty","msgprint","freeze","show_alert","name","hide","body","model","with_doctype","doc","get_new_doc","from_warehouse","get_value","to_warehouse","row","add_child","f_warehouse","t_warehouse","conversion_factor","transfer_qty","basic_rate","set_route","doctype"],"mappings":"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"}