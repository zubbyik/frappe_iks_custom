{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/erpnext/erpnext/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// add toolbar icon\n$(document).bind('toolbar_setup', function() {\n\tfrappe.app.name = \"ERPNext\";\n\n\tfrappe.help_feedback_link = '<p><a class=\"text-muted\" \\\n\t\thref=\"https://discuss.erpnext.com\">Feedback</a></p>'\n\n\n\t$('.navbar-home').html('<img class=\"erpnext-icon\" src=\"'+\n\t\t\tfrappe.urllib.get_base_url()+'/assets/erpnext/images/erp-icon.svg\" />');\n\n\t$('[data-link=\"docs\"]').attr(\"href\", \"https://erpnext.com/docs\")\n\t$('[data-link=\"issues\"]').attr(\"href\", \"https://github.com/frappe/erpnext/issues\")\n\n\n\t// default documentation goes to erpnext\n\t// $('[data-link-type=\"documentation\"]').attr('data-path', '/erpnext/manual/index');\n\n\t// additional help links for erpnext\n\tvar $help_menu = $('.dropdown-help ul .documentation-links');\n\t$('<li><a data-link-type=\"forum\" href=\"https://erpnext.com/docs/user/manual\" \\\n\t\ttarget=\"_blank\">'+__('Documentation')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a data-link-type=\"forum\" href=\"https://discuss.erpnext.com\" \\\n\t\ttarget=\"_blank\">'+__('User Forum')+'</a></li>').insertBefore($help_menu);\n\t$('<li><a href=\"https://github.com/frappe/erpnext/issues\" \\\n\t\ttarget=\"_blank\">'+__('Report an Issue')+'</a></li>').insertBefore($help_menu);\n\n});\n\n\n\n// doctypes created via tree\n$.extend(frappe.create_routes, {\n\t\"Customer Group\": \"Tree/Customer Group\",\n\t\"Territory\": \"Tree/Territory\",\n\t\"Item Group\": \"Tree/Item Group\",\n\t\"Sales Person\": \"Tree/Sales Person\",\n\t\"Account\": \"Tree/Account\",\n\t\"Cost Center\": \"Tree/Cost Center\"\n});\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Selling\"\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_no: function() {\n\t\tvar grid_row = cur_frm.open_grid_row();\n\t\tif(!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status()!==\"Write\") return;\n\n\t\tvar $btn = $('<button class=\"btn btn-sm btn-default\">'+__(\"Add Serial No\")+'</button>')\n\t\t\t.appendTo($(\"<div>\")\n\t\t\t\t.css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t\t\t.appendTo(grid_row.grid_form.fields_dict.serial_no.$wrapper));\n\n\t\t$btn.on(\"click\", function() {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Add Serial No\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\t\"fieldname\": \"serial_no\",\n\t\t\t\t\t\t\"options\": \"Serial No\",\n\t\t\t\t\t\t\"label\": __(\"Serial No\"),\n\t\t\t\t\t\t\"get_query\": function () {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\titem_code:grid_row.doc.item_code,\n\t\t\t\t\t\t\t\t\twarehouse:cur_frm.doc.is_return ? null : grid_row.doc.warehouse\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"fieldtype\": \"Button\",\n\t\t\t\t\t\t\"fieldname\": \"add\",\n\t\t\t\t\t\t\"label\": __(\"Add\")\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\td.get_input(\"add\").on(\"click\", function() {\n\t\t\t\tvar serial_no = d.get_value(\"serial_no\");\n\t\t\t\tif(serial_no) {\n\t\t\t\t\tvar val = (grid_row.doc.serial_no || \"\").split(\"\\n\").concat([serial_no]).join(\"\\n\");\n\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.set_model_value(val.trim());\n\t\t\t\t}\n\t\t\t\td.hide();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\td.show();\n\t\t});\n\t}\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.removeClass('hidden');\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\tcopy_parent_value_in_all_row: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrm.script_manager.trigger(item_field, row.doctype, row.name)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name,\n\t\t\t\t\t\t\topts.original_item_field, d.item_code);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 0,\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 0,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Qty')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Currency',\n\t\t\t\t\tfieldname:\"rate\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 0,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Rate')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"];\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tif(opts.get_query_filters) {\n\t\topts.get_query = function() {\n\t\t\treturn {filters: opts.get_query_filters};\n\t\t}\n\t}\n\tvar _map = function() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t'args': opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tif(opts.source_doctype) {\n\t\tvar d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif(values.length === 0){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\topts.setters = args;\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\t} else if(opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif(doc && doc.item_name && doc.item_name !== value) {\n\t\treturn value? value + ': ' + doc.item_name: doc.item_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif(doc && doc.employee_name && doc.employee_name !== value) {\n\t\treturn value? value + ': ' + doc.employee_name: doc.employee_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t}\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif(!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\tif(!args) {\n\t\tif(frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer,\n\t\t\t\tparty_type: \"Customer\",\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if(frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (args) {\n\t\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\t}\n\t}\n\tif(!args || !args.party) return;\n\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif(r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif(callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif(frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif(prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif(frm.updating_party_details) return;\n\n\tif(!address_field) {\n\t\tif(frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if(frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif(!display_field) display_field = \"address_display\";\n\tif(frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t\terpnext.utils.set_taxes(frm, address_field, display_field, is_your_company_address);\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes = function(frm, address_field, display_field, is_your_company_address) {\n\tif(frappe.meta.get_docfield(frm.doc.doctype, \"taxes\") && !is_your_company_address) {\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Lead/Customer/Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead, address_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!erpnext.utils.validate_mandatory(frm, \"Posting/Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, address_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif(r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.get_contact_details = function(frm) {\n\tif(frm.updating_party_details) return;\n\n\tif(frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: {contact: frm.doc.contact_person },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message)\n\t\t\t\t\tfrm.set_value(r.message);\n\t\t\t}\n\t\t})\n\t}\n}\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif(!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.msgprint(__(\"Please enter {0} first\", [label]));\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback){\n\tif (frm.doc.company) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(r.message){\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif(callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: me.frm.doc.posting_date,\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\"\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\t\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text()\n\t},\n\n\tselect_text: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\t$(this).select();\n\t\t})\n\t},\n\n\tset_payment_primary_action: function(){\n\t\tvar me = this;\n\t\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t},\n\n\tmake_multimode_payment: function(){\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.change_amount > 0){\n\t\t\tme.payment_val = me.doc.outstanding_amount\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif(this.frm.doc.payments.length){\n\t\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row()\n\t\tthis.payment_val = 0.0\n\t\tif(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount()\n\t\t}else if(flt(this.selected_mode.val()) > 0){\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\t\n\tbind_keyboard_event: function(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t})\n\t\t\n\t\t$(this.$body).find('.write_off_amount').change(function(){\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t})\n\t\t\n\t\t$(this.$body).find('.change_amount').change(function(){\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t})\n\t},\n\n\thighlight_selected_row: function(){\n\t\tvar me = this;\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\",{'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode')\n\t\tselected_row.addClass('selected-payment-mode')\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\t\n\tbind_numeric_keys_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.delete-btn').click(function(){\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\t\n\tbind_amount_change_event: function(){\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function(){\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_payment_amount()\n\t\t})\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e){\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t})\n\t},\n\n\twrite_off_amount: function(write_off_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false)\n\t\tthis.show_amounts()\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount()\n\t\tthis.show_amounts()\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif(in_list(['change_amount', 'write_off_amount'], this.idx)){\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif(me.idx == 'change_amount'){\n\t\t\t\tme.change_amount(value)\n\t\t\t} else{\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value)\n\t\t\t}\n\t\t}else{\n\t\t\tthis.update_payment_amount()\n\t\t}\n\t},\n\n\tupdate_payment_amount: function(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\tif(cint(me.idx) == cint(data.idx)){\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2)\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency))\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency))\n\t\tthis.update_invoice();\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {},\n\tapply_pricing_rule_on_item: function(item){\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tif (item.parenttype === \"Sales Order\" && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif(item.margin_type == \"Percentage\"){\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem.rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif(item.discount_percentage){\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t\titem.rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t}\n\t},\n\n\tcalculate_taxes_and_totals: function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function(){\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tfrappe.throw(repl('%(conversion_rate_label)s' +\n\t\t\t\t\t__(' is mandatory. Maybe Currency Exchange record is not created for ') +\n\t\t\t\t'%(from_currency)s' + __(\" to \") + '%(to_currency)s', {\n\t\t\t\t\t\"conversion_rate_label\": conversion_rate_label,\n\t\t\t\t\t\"from_currency\": this.frm.doc.currency,\n\t\t\t\t\t\"to_currency\": company_currency\n\t\t\t\t}));\n\t\t\t}\n\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\ttax.item_wise_tax_detail = {};\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\ttax.tax_fraction_for_current_item = me.get_current_tax_fraction(tax, item_tax_map);\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t});\n\n\t\t\tif(cumulated_tax_fraction && !me.discount_amount_applied) {\n\t\t\t\titem.net_amount = flt(item.amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax) {\n\t\t\tcurrent_tax_fraction *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t}\n\t\treturn current_tax_fraction;\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"total\", \"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t}\n\n\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tthis.frm.doc.rounding_adjustment = flt(flt(this.frm.doc.rounding_adjustment) + diff,\n\t\t\t\t\t\tprecision(\"rounding_adjustment\"));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif(this.frm.doc.is_return || this.frm.doc.docstatus > 0) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(this.frm.doc.doctype == \"Sales Invoice\") {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount){\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)){\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tdata.base_amount = flt(total_amount_to_pay, precision(\"base_amount\"));\n\t\t\t\t\tdata.amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\"));\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t}else if(me.frm.doc.paid_amount){\n\t\t\t\t\tdata.amount = 0.0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function(){\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\"));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.doc.paid_amount = flt(paid_amount, precision(\"paid_amount\"));\n\t\tthis.frm.doc.base_paid_amount = flt(base_paid_amount, precision(\"base_paid_amount\"));\n\t},\n\n\tcalculate_change_amount: function(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(this.frm.doc.doctype == \"Sales Invoice\"\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total +\n\t\t\t\t\tthis.frm.doc.write_off_amount, precision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total + this.frm.doc.base_write_off_amount,\n\t\t\t\t\tprecision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function(){\n\t\tif(this.frm.doc.paid_amount > this.frm.doc.grand_total){\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.grand_total - this.frm.doc.paid_amount\n\t\t\t\t+ this.frm.doc.change_amount, precision(\"write_off_amount\"));\n\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\t\t}else{\n\t\t\tthis.frm.doc.paid_amount = 0.0;\n\t\t}\n\t\tthis.calculate_outstanding_amount(false);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\n\tsetup: function() {\n\t\tthis._super();\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\n\t\t});\n\n\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tvar me = this;\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\n\tis_return: function() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t},\n\n\tsetup_quality_inspection: function() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\t\tvar me = this;\n\t\tvar inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tvar quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tvar d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_payment_request: function() {\n\t\tvar me = this;\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\n\tonload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t}\n\t},\n\n\trefresh: function() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tthis.frm.fields_dict[\"scan_barcode\"] && this.frm.fields_dict[\"scan_barcode\"].set_value(\"\");\n\t\tthis.frm.fields_dict[\"scan_barcode\"] && this.frm.fields_dict[\"scan_barcode\"].set_new_description(\"\");\n\t},\n\n\tscan_barcode: function() {\n\t\tlet scan_barcode_field = this.frm.fields_dict[\"scan_barcode\"];\n\n\t\tlet show_description = function(idx, exist = null) {\n\t\t\tif (exist) {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Qty increased by 1', [idx]));\n\t\t\t} else {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Item added', [idx]));\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc.scan_barcode) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_serial_or_batch_or_barcode_number\",\n\t\t\t\targs: { search_value: this.frm.doc.scan_barcode }\n\t\t\t}).then(r => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data) {\n\t\t\t\t\tscan_barcode_field.set_new_description(__('Cannot find Item with this barcode'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cur_grid = this.frm.fields_dict.items.grid;\n\n\t\t\t\tlet row_to_modify = null;\n\t\t\t\tconst existing_item_row = this.frm.doc.items.find(d => d.item_code === data.item_code);\n\t\t\t\tconst blank_item_row = this.frm.doc.items.find(d => !d.item_code);\n\n\t\t\t\tif (existing_item_row) {\n\t\t\t\t\trow_to_modify = existing_item_row;\n\t\t\t\t} else if (blank_item_row) {\n\t\t\t\t\trow_to_modify = blank_item_row;\n\t\t\t\t}\n\n\t\t\t\tif (!row_to_modify) {\n\t\t\t\t\t// add new row\n\t\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc, cur_grid.doctype, 'items');\n\t\t\t\t}\n\n\t\t\t\tshow_description(row_to_modify.idx, row_to_modify.item_code);\n\n\t\t\t\tthis.frm.from_barcode = true;\n\t\t\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, {\n\t\t\t\t\titem_code: data.item_code,\n\t\t\t\t\tqty: (row_to_modify.qty || 0) + 1\n\t\t\t\t});\n\n\t\t\t\t['serial_no', 'batch_no', 'barcode'].forEach(field => {\n\t\t\t\t\tif (data[field] && frappe.meta.has_field(row_to_modify.doctype, field)) {\n\t\t\t\t\t\tfrappe.model.set_value(row_to_modify.doctype,\n\t\t\t\t\t\t\trow_to_modify.name, field, data[field]);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscan_barcode_field.set_value('');\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t},\n\n\tapply_default_taxes: function() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges,\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_sms: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& this.frm.doctype != \"Purchase Invoice\") {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t},\n\n\tsend_sms: function() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t},\n\n\tbarcode: function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.barcode==\"\" || d.barcode==null) {\n\t\t\t// barcode cleared, remove item\n\t\t\td.item_code = \"\";\n\t\t}\n\n\t\tthis.frm.from_barcode = true;\n\t\tthis.item_code(doc, cdt, cdn);\n\t},\n\n\titem_code: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\t// clear barcode if setting item (else barcode will take priority)\n\t\tif(!this.frm.from_barcode) {\n\t\t\titem.barcode = null;\n\t\t}\n\n\t\tthis.frm.from_barcode = false;\n\t\tif(item.item_code || item.barcode || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\ttransaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tuom : item.uom,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn),\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true)\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tserial_no: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar valid_serial_nos = [];\n\n\t\t\t\t// Replacing all occurences of comma with carriage return\n\t\t\t\tvar serial_nos = item.serial_no.trim().replace(/,/g, '\\n');\n\n\t\t\t\tserial_nos = serial_nos.trim().split('\\n');\n\n\t\t\t\t// Trim each string and push unique string to new list\n\t\t\t\tfor (var x=0; x<=serial_nos.length - 1; x++) {\n\t\t\t\t\tif (serial_nos[x].trim() != \"\" && valid_serial_nos.indexOf(serial_nos[x].trim()) == -1) {\n\t\t\t\t\t\tvalid_serial_nos.push(serial_nos[x].trim());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add the new list to the serial no. field in grid with each in new line\n\t\t\t\titem.serial_no = valid_serial_nos.join('\\n');\n\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif(!doc.is_return && cint(user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\n\tcompany: function() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_terms && me.frm.doc.doctype != \"Purchase Invoice\" && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\")) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.frm.doc.posting_date) var date = this.frm.doc.posting_date;\n\t\telse var date = this.frm.doc.transaction_date;\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)){\n\t\t\terpnext.utils.get_shipping_address(this.frm, function(){\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t})\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t},\n\n\ttransaction_date: function() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t},\n\n\tposting_date: function() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdue_date: function() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = \"Please clear the \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = \"selected Payment Terms Template\";\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = \"Payment Schedule Table\";\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tbill_date: function() {\n\t\tthis.posting_date();\n\t},\n\n\trecalculate_terms: function() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\n\tget_company_currency: function() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t},\n\n\tcontact_person: function() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t},\n\n\tcurrency: function() {\n\t\t/* manqala 19/09/2016: let the translation date be whichever of the transaction_date or posting_date is available */\n\t\tvar transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\t\t/* end manqala */\n\t\tvar me = this;\n\t\tthis.set_dynamic_labels();\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !this.frm.doc.ignore_pricing_rule) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.conversion_rate();\n\t\t}\n\t},\n\n\tconversion_rate: function() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.set_actual_charges_based_on_currency();\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t},\n\n\tshipping_rule: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t\telse {\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tset_actual_charges_based_on_currency: function() {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.tax_amount) / flt(me.frm.doc.conversion_rate));\n\t\t\t}\n\t\t});\n\t},\n\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t},\n\n\tprice_list_currency: function() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  && !this.frm.doc.ignore_pricing_rule) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t},\n\n\tplc_conversion_rate: function() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t},\n\n\tuom: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\tchild: item,\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.conversion_factor(me.frm.doc, cdt, cdn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(doc.doctype != 'Material Request' && frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\t\t\tthis.calculate_net_weight();\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t}\n\t},\n\n\ttoggle_conversion_factor: function(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t},\n\n\tqty: function(doc, cdt, cdn) {\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\n\t\tthis.apply_pricing_rule(frappe.get_doc(cdt, cdn), true);\n\t},\n\n\tservice_stop_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tservice_start_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tcalculate_net_weight: function(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t},\n\n\tset_dynamic_labels: function() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tchange_form_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t},\n\n\tchange_grid_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_net_rate\", \"base_price_list_rate\", \"base_amount\", \"base_net_amount\"],\n\t\t\tcompany_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\"rate\", \"net_rate\", \"price_list_rate\", \"amount\", \"net_amount\"],\n\t\t\tthis.frm.doc.currency, \"items\");\n\n\t\tif(this.frm.fields_dict[\"operations\"]) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"scrap_items\"]) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"advances\"]) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\n\t\t// set labels\n\t\tvar $wrapper = $(this.frm.wrapper);\n\t},\n\n\trecalculate: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\trecalculate_values: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tcalculate_charges: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tignore_pricing_rule: function() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code) {\n\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\"pricing_rule\": d.pricing_rule\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t},\n\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t_get_args: function(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : ''\n\t\t};\n\t},\n\n\t_get_item_list: function(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rule\": d.pricing_rule,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"discount_percentage\": d.discount_percentage || 0.0,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\"]), d.doctype){\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t},\n\n\t_set_values_for_item_list: function(children) {\n\t\tvar me = this;\n\t\tvar price_list_rate_changed = false;\n\t\tfor(var i=0, l=children.length; i<l; i++) {\n\t\t\tvar d = children[i];\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rule\");\n\t\t\tfor(var k in d) {\n\t\t\t\tvar v = d[k];\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\n\t\t\t\t\tif(k==\"price_list_rate\") {\n\t\t\t\t\t\tif(flt(v) != flt(d.price_list_rate)) price_list_rate_changed = true;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, v);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rule) {\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\n\t\t\t}\n\t\t}\n\n\t\tif(!price_list_rate_changed) me.calculate_taxes_and_totals();\n\t},\n\n\tapply_price_list: function(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t},\n\n\tvalidate_company_and_party: function() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t},\n\n\tget_terms: function() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tis_recurring: function() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t},\n\n\tfrom_date: function() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t},\n\n\tset_gross_profit: function(item) {\n\t\tif (this.frm.doc.doctype == \"Sales Order\" && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t},\n\n\tsetup_item_selector: function() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t},\n\n\tget_advances: function() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tmake_payment_entry: function() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t},\n\n\tget_method_for_payment: function(){\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t},\n\n\tset_query_for_batch: function(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tpayment_terms_template: function() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tpayment_term: function(doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tblanket_order: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tset_warehouse: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.set_warehouse) {\n\t\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(me.frm.doctype + \" Item\", item.name, \"warehouse\", me.frm.doc.set_warehouse);\n\t\t\t});\n\t\t}\n\t}\n});\n\nerpnext.show_serial_batch_selector = function(frm, d, callback, on_close, show_dialog) {\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: d.warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});","frappe.provide('frappe.help.help_links');\n\nconst docsUrl = 'https://erpnext.com/docs/';\n\nfrappe.help.help_links['Form/Rename Tool'] = [\n\t{ label: 'Bulk Rename', url: docsUrl + 'user/manual/en/setting-up/data/bulk-rename' },\n]\n\n//Setup\n\nfrappe.help.help_links['List/User'] = [\n\t{ label: 'New User', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/adding-users' },\n\t{ label: 'Rename User', url: docsUrl + 'user/manual/en/setting-up/articles/rename-user' },\n]\n\nfrappe.help.help_links['permission-manager'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n\t{ label: 'Managing Perm Level in Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/articles/managing-perm-level' },\n\t{ label: 'User Permissions', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/user-permissions' },\n\t{ label: 'Sharing', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/sharing' },\n\t{ label: 'Password', url: docsUrl + 'user/manual/en/setting-up/articles/change-password' },\n]\n\nfrappe.help.help_links['Form/System Settings'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/system-settings' },\n]\n\nfrappe.help.help_links['data-import-tool'] = [\n\t{ label: 'Importing and Exporting Data', url: docsUrl + 'user/manual/en/setting-up/data/data-import-tool' },\n\t{ label: 'Overwriting Data from Data Import Tool', url: docsUrl + 'user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool' },\n]\n\nfrappe.help.help_links['module_setup'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n]\n\nfrappe.help.help_links['Form/Naming Series'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/naming-series' },\n\t{ label: 'Setting the Current Value for Naming Series', url: docsUrl + 'user/manual/en/setting-up/articles/naming-series-current-value' },\n]\n\nfrappe.help.help_links['Form/Global Defaults'] = [\n\t{ label: 'Global Settings', url: docsUrl + 'user/manual/en/setting-up/settings/global-defaults' },\n]\n\nfrappe.help.help_links['Form/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\nfrappe.help.help_links['List/Letter Head'] = [\n\t{ label: 'Letter Head', url: docsUrl + 'user/manual/en/setting-up/print/letter-head' },\n]\n\nfrappe.help.help_links['List/Address Template'] = [\n\t{ label: 'Address Template', url: docsUrl + 'user/manual/en/setting-up/print/address-template' },\n]\n\nfrappe.help.help_links['List/Terms and Conditions'] = [\n\t{ label: 'Terms and Conditions', url: docsUrl + 'user/manual/en/setting-up/print/terms-and-conditions' },\n]\n\nfrappe.help.help_links['List/Cheque Print Template'] = [\n\t{ label: 'Cheque Print Template', url: docsUrl + 'user/manual/en/setting-up/print/cheque-print-template' },\n]\n\nfrappe.help.help_links['List/Email Account'] = [\n\t{ label: 'Email Account', url: docsUrl + 'user/manual/en/setting-up/email/email-account' },\n]\n\nfrappe.help.help_links['List/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['Form/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['List/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Auto Email Report'] = [\n\t{ label: 'Auto Email Reports', url: docsUrl + 'user/manual/en/setting-up/email/email-reports' },\n]\n\nfrappe.help.help_links['Form/Print Settings'] = [\n\t{ label: 'Print Settings', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['print-format-builder'] = [\n\t{ label: 'Print Format Builder', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\n//setup-integrations\n\nfrappe.help.help_links['Form/PayPal Settings'] = [\n\t{ label: 'PayPal Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/paypal-integration' },\n]\n\nfrappe.help.help_links['Form/Razorpay Settings'] = [\n\t{ label: 'Razorpay Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/razorpay-integration' },\n]\n\nfrappe.help.help_links['Form/Dropbox Settings'] = [\n\t{ label: 'Dropbox Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/dropbox-backup' },\n]\n\nfrappe.help.help_links['Form/LDAP Settings'] = [\n\t{ label: 'LDAP Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/ldap-integration' },\n]\n\nfrappe.help.help_links['Form/Stripe Settings'] = [\n\t{ label: 'Stripe Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/stripe-integration' },\n]\n\n//Sales\n\nfrappe.help.help_links['Form/Quotation'] = [\n\t{ label: 'Quotation', url: docsUrl + 'user/manual/en/selling/quotation' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['List/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['Form/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['List/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['Form/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n]\n\nfrappe.help.help_links['Form/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Drop Shipping', url: docsUrl + 'user/manual/en/selling/articles/drop-shipping' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Close Sales Order', url: docsUrl + 'user/manual/en/selling/articles/close-sales-order' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['Form/Product Bundle'] = [\n\t{ label: 'Product Bundle', url: docsUrl + 'user/manual/en/selling/setup/product-bundle' },\n]\n\nfrappe.help.help_links['Form/Selling Settings'] = [\n\t{ label: 'Selling Settings', url: docsUrl + 'user/manual/en/selling/setup/selling-settings' },\n]\n\n//Buying\n\nfrappe.help.help_links['List/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Request for Quotation'] = [\n\t{ label: 'Request for Quotation', url: docsUrl + 'user/manual/en/buying/request-for-quotation' },\n\t{ label: 'RFQ Video', url: docsUrl + 'user/videos/learn/request-for-quotation.html' },\n]\n\nfrappe.help.help_links['Form/Supplier Quotation'] = [\n\t{ label: 'Supplier Quotation', url: docsUrl + 'user/manual/en/buying/supplier-quotation' },\n]\n\nfrappe.help.help_links['Form/Buying Settings'] = [\n\t{ label: 'Buying Settings', url: docsUrl + 'user/manual/en/buying/setup/buying-settings' },\n]\n\nfrappe.help.help_links['List/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['Form/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Item UoM', url: docsUrl + 'user/manual/en/buying/articles/purchasing-in-different-unit' },\n\t{ label: 'Supplier Item Code', url: docsUrl + 'user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Purchase Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'POS Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Price List'] = [\n\t{ label: 'Price List', url: docsUrl + 'user/manual/en/setting-up/price-lists' },\n]\n\nfrappe.help.help_links['List/Authorization Rule'] = [\n\t{ label: 'Authorization Rule', url: docsUrl + 'user/manual/en/setting-up/authorization-rule' },\n]\n\nfrappe.help.help_links['Form/SMS Settings'] = [\n\t{ label: 'SMS Settings', url: docsUrl + 'user/manual/en/setting-up/sms-setting' },\n]\n\nfrappe.help.help_links['List/Stock Reconciliation'] = [\n\t{ label: 'Stock Reconciliation', url: docsUrl + 'user/manual/en/setting-up/stock-reconciliation-for-non-serialized-item' },\n]\n\nfrappe.help.help_links['Tree/Territory'] = [\n\t{ label: 'Territory', url: docsUrl + 'user/manual/en/setting-up/territory' },\n]\n\nfrappe.help.help_links['Form/Dropbox Backup'] = [\n\t{ label: 'Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/third-party-backups' },\n\t{ label: 'Setting Up Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/articles/setting-up-dropbox-backups' },\n]\n\nfrappe.help.help_links['List/Workflow'] = [\n\t{ label: 'Workflow', url: docsUrl + 'user/manual/en/setting-up/workflows' },\n]\n\nfrappe.help.help_links['List/Company'] = [\n\t{ label: 'Company', url: docsUrl + 'user/manual/en/setting-up/company-setup' },\n\t{ label: 'Managing Multiple Companies', url: docsUrl + 'user/manual/en/setting-up/articles/managing-multiple-companies' },\n\t{ label: 'Delete All Related Transactions for a Company', url: docsUrl + 'user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions' },\n]\n\n//Accounts\n\nfrappe.help.help_links['modules/Accounts'] = [\n\t{ label: 'Introduction to Accounts', url: docsUrl + 'user/manual/en/accounts/' },\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts.html' },\n\t{ label: 'Multi Currency Accounting', url: docsUrl + 'user/manual/en/accounts/multi-currency-accounting' },\n]\n\nfrappe.help.help_links['Tree/Account'] = [\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts' },\n\t{ label: 'Managing Tree Mastes', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['Form/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['pos'] = [\n\t{ label: 'Point of Sale Invoice', url: docsUrl + 'user/manual/en/accounts/point-of-sale-pos-invoice' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'Point of Sale Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Purchase Invoice'] = [\n\t{ label: 'Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/purchase-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Recurring Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Journal Entry'] = [\n\t{ label: 'Journal Entry', url: docsUrl + 'user/manual/en/accounts/journal-entry' },\n\t{ label: 'Advance Payment Entry', url: docsUrl + 'user/manual/en/accounts/advance-payment-entry' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n]\n\nfrappe.help.help_links['List/Payment Entry'] = [\n\t{ label: 'Payment Entry', url: docsUrl + 'user/manual/en/accounts/payment-entry' },\n]\n\nfrappe.help.help_links['List/Payment Request'] = [\n\t{ label: 'Payment Request', url: docsUrl + 'user/manual/en/accounts/payment-request' },\n]\n\nfrappe.help.help_links['List/Asset'] = [\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['List/Asset Category'] = [\n\t{ label: 'Asset Category', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['Tree/Cost Center'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\nfrappe.help.help_links['List/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['Form/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['List/Purchase Receipt'] = [\n\t{ label: 'Purchase Receipt', url: docsUrl + 'user/manual/en/stock/purchase-receipt' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n]\n\nfrappe.help.help_links['List/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n]\n\nfrappe.help.help_links['Form/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Installation Note'] = [\n\t{ label: 'Installation Note', url: docsUrl + 'user/manual/en/stock/installation-note' },\n]\n\n\nfrappe.help.help_links['Tree'] = [\n\t{ label: 'Managing Tree Structure Masters', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['List/Budget'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\n//Stock\n\nfrappe.help.help_links['List/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n\t{ label: 'Stock Entry Types', url: docsUrl + 'user/manual/en/stock/articles/stock-entry-purpose' },\n\t{ label: 'Repack Entry', url: docsUrl + 'user/manual/en/stock/articles/repack-entry' },\n\t{ label: 'Opening Stock', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n]\n\nfrappe.help.help_links['Tree/Warehouse'] = [\n\t{ label: 'Warehouse', url: docsUrl + 'user/manual/en/stock/warehouse' },\n]\n\nfrappe.help.help_links['List/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Batch'] = [\n\t{ label: 'Batch', url: docsUrl + 'user/manual/en/stock/batch' },\n]\n\nfrappe.help.help_links['Form/Packing Slip'] = [\n\t{ label: 'Packing Slip', url: docsUrl + 'user/manual/en/stock/tools/packing-slip' },\n]\n\nfrappe.help.help_links['Form/Quality Inspection'] = [\n\t{ label: 'Quality Inspection', url: docsUrl + 'user/manual/en/stock/tools/quality-inspection' },\n]\n\nfrappe.help.help_links['Form/Landed Cost Voucher'] = [\n\t{ label: 'Landed Cost Voucher', url: docsUrl + 'user/manual/en/stock/tools/landed-cost-voucher' },\n]\n\nfrappe.help.help_links['Tree/Item Group'] = [\n\t{ label: 'Item Group', url: docsUrl + 'user/manual/en/stock/setup/item-group' },\n]\n\nfrappe.help.help_links['Form/Item Attribute'] = [\n\t{ label: 'Item Attribute', url: docsUrl + 'user/manual/en/stock/setup/item-attribute' },\n]\n\nfrappe.help.help_links['Form/UOM'] = [\n\t{ label: 'Fractions in UOM', url: docsUrl + 'user/manual/en/stock/articles/managing-fractions-in-uom' },\n]\n\nfrappe.help.help_links['Form/Stock Reconciliation'] = [\n\t{ label: 'Opening Stock Entry', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n]\n\n//CRM\n\nfrappe.help.help_links['Form/Lead'] = [\n\t{ label: 'Lead', url: docsUrl + 'user/manual/en/CRM/lead' },\n]\n\nfrappe.help.help_links['Form/Opportunity'] = [\n\t{ label: 'Opportunity', url: docsUrl + 'user/manual/en/CRM/opportunity' },\n]\n\nfrappe.help.help_links['Form/Address'] = [\n\t{ label: 'Address', url: docsUrl + 'user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Contact'] = [\n\t{ label: 'Contact', url: docsUrl + 'user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Newsletter'] = [\n\t{ label: 'Newsletter', url: docsUrl + 'user/manual/en/CRM/newsletter' },\n]\n\nfrappe.help.help_links['Form/Campaign'] = [\n\t{ label: 'Campaign', url: docsUrl + 'user/manual/en/CRM/setup/campaign' },\n]\n\nfrappe.help.help_links['Tree/Sales Person'] = [\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/CRM/setup/sales-person' },\n]\n\nfrappe.help.help_links['Form/Sales Person'] = [\n\t{ label: 'Sales Person Target', url: docsUrl + 'user/manual/en/selling/setup/sales-person-target-allocation' },\n]\n\n//Support\n\nfrappe.help.help_links['List/Feedback Trigger'] = [\n\t{ label: 'Feedback Trigger', url: docsUrl + 'user/manual/en/setting-up/feedback/setting-up-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\n//Manufacturing\n\nfrappe.help.help_links['Form/BOM'] = [\n\t{ label: 'Bill of Material', url: docsUrl + 'user/manual/en/manufacturing/bill-of-materials' },\n\t{ label: 'Nested BOM Structure', url: docsUrl + 'user/manual/en/manufacturing/articles/nested-bom-structure' },\n]\n\nfrappe.help.help_links['Form/Work Order'] = [\n\t{ label: 'Work Order', url: docsUrl + 'user/manual/en/manufacturing/work-order' },\n]\n\nfrappe.help.help_links['Form/Workstation'] = [\n\t{ label: 'Workstation', url: docsUrl + 'user/manual/en/manufacturing/workstation' },\n]\n\nfrappe.help.help_links['Form/Operation'] = [\n\t{ label: 'Operation', url: docsUrl + 'user/manual/en/manufacturing/operation' },\n]\n\nfrappe.help.help_links['Form/BOM Update Tool'] = [\n\t{ label: 'BOM Update Tool', url: docsUrl + 'user/manual/en/manufacturing/tools/bom-update-tool' },\n]\n\n//Customize\n\nfrappe.help.help_links['Form/Customize Form'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n\t{ label: 'Customize Field', url: docsUrl + 'user/manual/en/customize-erpnext/customize-form' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n","frappe.provide('erpnext.hub');\n\nfrappe.views.MarketplaceFactory = class MarketplaceFactory extends frappe.views.Factory {\n\tshow() {\n\t\tis_marketplace_disabled()\n\t\t\t.then(disabled => {\n\t\t\t\tif (disabled) {\n\t\t\t\t\tfrappe.show_not_found('Marketplace');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (frappe.pages.marketplace) {\n\t\t\t\t\tfrappe.container.change_to('marketplace');\n\t\t\t\t\terpnext.hub.marketplace.refresh();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make('marketplace');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tmake(page_name) {\n\t\tconst assets = [\n\t\t\t'/assets/js/marketplace.min.js'\n\t\t];\n\n\t\tfrappe.require(assets, () => {\n\t\t\terpnext.hub.marketplace = new erpnext.hub.Marketplace({\n\t\t\t\tparent: this.make_page(true, page_name)\n\t\t\t});\n\t\t});\n\t}\n};\n\nfunction is_marketplace_disabled() {\n\treturn frappe.call({\n\t\tmethod: \"erpnext.hub_node.doctype.marketplace_settings.marketplace_settings.is_marketplace_enabled\"\n\t}).then(r => r.message)\n}\n\n$(document).on('toolbar_setup', () => {\n\t$('#toolbar-user .navbar-reload').after(`\n\t\t<li>\n\t\t\t<a class=\"marketplace-link\" href=\"#marketplace/home\">${__('Marketplace')}\n\t\t</li>\n\t`);\n\n\tis_marketplace_disabled()\n\t\t.then(disabled => {\n\t\t\tif (disabled) {\n\t\t\t\t$('#toolbar-user .marketplace-link').hide();\n\t\t\t}\n\t\t});\n});\n","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (mandatory.length) {\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __('Missing Values Required'),\n\t\t\t\tmessage: __('Following fields have missing values:') + '<br><br><ul><li>' + mandatory.join('<li>') + '</ul>',\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\treturn {};\n\t\t}\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})"],"names":["frappe","provide","$","document","bind","app","name","help_feedback_link","html","urllib","get_base_url","attr","$help_menu","__","insertBefore","extend","create_routes","Customer Group","Territory","Item Group","Sales Person","Account","Cost Center","breadcrumbs","preferred","Supplier Group","Sales Partner","Brand","erpnext","get_currency","company","cur_frm","doc","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","const","currency_list","docs","filter","d","doctype","map","unshift","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_no","grid_row","open_grid_row","grid_form","serial_no","get_status","appendTo","css","margin-bottom","margin-top","$wrapper","on","ui","Dialog","title","fields","fieldtype","fieldname","options","label","get_query","filters","item_code","warehouse","is_return","get_input","get_value","val","split","concat","join","set_model_value","trim","hide","show","utils","set_party_dashboard_indicators","frm","__onload","dashboard_info","company_wise_info","forEach","info","add_indicator_for_multicompany","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","loyalty_points","stats_area","removeClass","stats_area_row","addClass","color","indicator","get_party_name","party_type","Customer","Supplier","Employee","Member","copy_value_in_all_rows","dt","dn","table_fieldname","cl","i","refresh_field","get_terms","tc_name","callback","call","method","args","template_name","r","make_bank_account","docname","freeze","doclist","model","sync","message","set_route","make_subscription","make_pricing_rule","first_row_is_empty","child_table","isArray","remove_empty_first_row","child_table_name","rows","this","splice","get_tree_options","option","let","unscrub_option","unscrub","user_permission","defaults","get_user_permissions","perm","c","sort","value","index","self","indexOf","get_tree_default","includes","get_default","copy_parent_value_in_all_row","parent_fieldname","select_alternate_items","opts","warehouse_field","item_field","data","dialog","cannot_add_rows","in_place_edit","get_data","hidden","in_list_view","read_only","default","onchange","on_grid_fields_dict","actual_qty","e","query","primary_action","get_values","alternate_item","row","child_doctype","qty","required_qty","script_manager","trigger","then","original_item_field","child_docname","primary_action_label","condition","alternative_items","df","push","grid","refresh","update_child_items","trans_items","parent_doctype","parent_doctype_name","reload_doc","rate","map_current_doc","get_query_filters","_map","items","items_doctype","meta","get_docfield","link_fieldname","get_meta","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","exc","dirty","form","MultiSelectDialog","target","date_field","undefined","setters","action","selections","values","link_formatters","item_name","employee_name","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","item","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","company_address_query","is_your_company_address","supplier_filter","lead_filter","not_a_group_filter","is_group","employee","cstr","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","me","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","reqd","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","get_party_details","party","price_list","selling_price_list","bill_date","buying_price_list","posting_date","transaction_date","validate_mandatory","supplier_tds","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","add_child","get_address_display","address_field","display_field","address_dict","set_taxes","billing_address","shipping_address","shipping_address_name","get_contact_details","trigger_on","get_shipping_address","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","show_general_ledger","group_by","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","find","click","select","set_primary_action","amount","submit_invoice","empty","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","conversion_rate","precision","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","update_paid_amount","change","write_off_amount","selected_row","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","apply_pricing_rule_on_item","effective_item_rate","price_list_rate","parenttype","blanket_order_rate","margin_type","rate_with_margin","margin_rate_or_amount","base_rate_with_margin","discount_percentage","discount_amount","calculate_taxes_and_totals","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","calculate_total_advance","calculate_commission","calculate_contribution","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","from_currency","to_currency","round_floats_in","net_rate","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","f","tax","item_wise_tax_detail","tax_fields","charge_type","apply_discount_on","cscript","validate_taxes_and_charges","validate_inclusive_tax","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","tax_fraction_for_current_item","get_current_tax_fraction","grand_total_fraction_for_current_item","current_tax_fraction","tax_rate","_get_tax_rate","row_id","add_deduct_tax","account_head","total_qty","total","base_total","net_total","base_net_total","base_amount","base_net_amount","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","set_cumulative_total","grand_total","row_idx","JSON","parse","actual","set_item_wise_tax","tax_detail","key","item_wise_tax_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","Math","abs","pow","tax_count","base_grand_total","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","base_discount_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","calculate_paid_amount","party_account_currency","total_amount_to_pay","total_amount_for_payment","redeem_loyalty_points","loyalty_amount","set_default_payment","calculate_change_amount","base_paid_amount","payment_status","is_pos","base_change_amount","payment_types","TransactionController","_super","flags","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","tax_table","set_dynamic_labels","via_discount_percentage","items_add","set_warehouse","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","get_user_default","amended_from","return_against","setup_quality_inspection","inspection_type","get_route_options_for_new_doc","reference_type","reference_name","description","item_serial_no","batch_no","make_payment_request","payment_request_type","recipient_id","contact_email","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","setup_sms","set_new_description","scan_barcode","scan_barcode_field","search_value","exist","cur_grid","row_to_modify","existing_item_row","blank_item_row","from_barcode","field","taxes_and_charges_field","taxes_and_charges","master_doctype","tax_template","status","page","add_menu_item","send_sms","barcode","update_stock","show_batch_dialog","validate_company_and_party","child","price_list_currency","plc_conversion_rate","order_type","is_subcontracted","ignore_pricing_rule","project","conversion_factor","weight_uom","uom","stock_uom","pos_profile","cost_center","toggle_conversion_factor","k","show_serial_batch_selector","grid_rows","remove","valid_serial_nos","serial_nos","replace","x","user_defaults","set_qty_in_transactions_based_on_serial_no_input","validate","set_pricing","company_doc","default_letter_head","letter_head","default_terms","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","get_exchange_rate","exchange_rate","in_apply_price_list","set_actual_charges_based_on_currency","apply_price_list","shipping_rule","fail","dont_fetch_price_list_rate","fields_map","toggle_enable","service_stop_date","start_date","Date","service_start_date","end_date","service_end_date","stop_date","total_net_weight","toggle_reqd","price_list_name","change_form_labels","change_grid_labels","set_currency_labels","item_grid","fname","set_column_disp","wrapper","recalculate","recalculate_values","calculate_charges","item_list","pricing_rule","_set_values_for_item_list","_get_args","_get_item_list","customer_group","territory","supplier_group","campaign","sales_partner","append_item","item_group","brand","parent","children","price_list_rate_changed","l","existing_pricing_rule","reset_plc_conversion","always","valid","master_name","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","make_payment_via_journal_entry","terms_template","blanket_order","on_close","require","SerialNoBatchSelector","warehouse_details","ItemSelector","Class","init","item_query","add_items_button","render_items","setTimeout","focus","results","timeout_id","clearTimeout","added","show_alert","add_new_row","timeout","txt","as_dict","get_filters","link_search","image","abbr","get_abbr","get_palette","docsUrl","is_marketplace_disabled","help","help_links","url","agriculture","TernaryPlot","[object Object]","assign","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","append","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","soil_type","polygon","get_coords","fill","get_color","transform","offset","exec_once","rect","font-size","ref","x_blip","y_blip","sin","blip","circle","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","get_attributes_fields","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","$input","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_form_if_not_list","error","open_doc","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","async","prototype","toString","msgprint_dialog","CustomerQuickEntryForm","collapsible","views","MarketplaceFactory","Factory","disabled","show_not_found","pages","marketplace","container","change_to","hub","make","page_name","Marketplace","make_page","after"],"mappings":"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"}