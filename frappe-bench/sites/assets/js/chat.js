!function(){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var fuse=createCommonjsModule(function(e,t){var a;a=function(){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.i=function(e){return e},a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=8)}([function(e,t,a){e.exports=function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,a){var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();var n=a(5),o=a(7),s=a(4),i=function(){function e(t,a){var r=a.location,n=void 0===r?0:r,o=a.distance,i=void 0===o?100:o,p=a.threshold,c=void 0===p?.6:p,l=a.maxPatternLength,f=void 0===l?32:l,d=a.isCaseSensitive,u=void 0!==d&&d,h=a.tokenSeparator,m=void 0===h?/ +/g:h,_=a.findAllMatches,g=void 0!==_&&_,v=a.minMatchCharLength,b=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:n,distance:i,threshold:c,maxPatternLength:f,isCaseSensitive:u,tokenSeparator:m,findAllMatches:g,minMatchCharLength:b},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=f&&(this.patternAlphabet=s(this.pattern))}return r(e,[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,a=t.maxPatternLength,r=t.tokenSeparator;if(this.pattern.length>a)return n(e,this.pattern,r);var s=this.options,i=s.location,p=s.distance,c=s.threshold,l=s.findAllMatches,f=s.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:i,distance:p,threshold:c,findAllMatches:l,minMatchCharLength:f})}}]),e}();e.exports=i},function(e,t,a){var r=a(0);e.exports=function(e,t){return function e(t,a,n){if(a){var o=a.indexOf("."),s=a,i=null;-1!==o&&(s=a.slice(0,o),i=a.slice(o+1));var p=t[s];if(null!=p)if(i||"string"!=typeof p&&"number"!=typeof p)if(r(p))for(var c=0,l=p.length;c<l;c+=1)e(p[c],i,n);else i&&e(p,i,n);else n.push(p.toString())}else n.push(t);return n}(e,t,[])}},function(e,t,a){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=[],r=-1,n=-1,o=0,s=e.length;o<s;o+=1){var i=e[o];i&&-1===r?r=o:i||-1===r||((n=o-1)-r+1>=t&&a.push([r,n]),r=-1)}return e[o-1]&&o-r>=t&&a.push([r,o-1]),a}},function(e,t,a){e.exports=function(e){for(var t={},a=e.length,r=0;r<a;r+=1)t[e.charAt(r)]=0;for(var n=0;n<a;n+=1)t[e.charAt(n)]|=1<<a-n-1;return t}},function(e,t,a){var r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,n=new RegExp(t.replace(r,"\\$&").replace(a,"|")),o=e.match(n),s=!!o,i=[];if(s)for(var p=0,c=o.length;p<c;p+=1){var l=o[p];i.push([e.indexOf(l),l.length-1])}return{score:s?.5:1,isMatch:s,matchedIndices:i}}},function(e,t,a){e.exports=function(e,t){var a=t.errors,r=void 0===a?0:a,n=t.currentLocation,o=void 0===n?0:n,s=t.expectedLocation,i=void 0===s?0:s,p=t.distance,c=void 0===p?100:p,l=r/e.length,f=Math.abs(i-o);return c?l+f/c:f?1:l}},function(e,t,a){var r=a(6),n=a(3);e.exports=function(e,t,a,o){for(var s=o.location,i=void 0===s?0:s,p=o.distance,c=void 0===p?100:p,l=o.threshold,f=void 0===l?.6:l,d=o.findAllMatches,u=void 0!==d&&d,h=o.minMatchCharLength,m=void 0===h?1:h,_=i,g=e.length,v=f,b=e.indexOf(t,_),y=t.length,w=[],k=0;k<g;k+=1)w[k]=0;if(-1!==b){var C=r(t,{errors:0,currentLocation:b,expectedLocation:_,distance:c});if(v=Math.min(C,v),-1!==(b=e.lastIndexOf(t,_+y))){var x=r(t,{errors:0,currentLocation:b,expectedLocation:_,distance:c});v=Math.min(x,v)}}b=-1;for(var S=[],$=1,O=y+g,T=1<<y-1,E=0;E<y;E+=1){for(var P=0,L=O;P<L;){r(t,{errors:E,currentLocation:_+L,expectedLocation:_,distance:c})<=v?P=L:O=L,L=Math.floor((O-P)/2+P)}O=L;var A=Math.max(1,_-L+1),j=u?g:Math.min(_+L,g)+y,M=Array(j+2);M[j+1]=(1<<E)-1;for(var R=j;R>=A;R-=1){var N=R-1,I=a[e.charAt(N)];if(I&&(w[N]=1),M[R]=(M[R+1]<<1|1)&I,0!==E&&(M[R]|=(S[R+1]|S[R])<<1|1|S[R+1]),M[R]&T&&($=r(t,{errors:E,currentLocation:N,expectedLocation:_,distance:c}))<=v){if(v=$,(b=N)<=_)break;A=Math.max(1,2*_-b)}}if(r(t,{errors:E+1,currentLocation:_,expectedLocation:_,distance:c})>v)break;S=M}return{isMatch:b>=0,score:0===$?.001:$,matchedIndices:n(w,m)}}},function(e,t,a){var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();var n=a(1),o=a(2),s=a(0),i=function(){function e(t,a){var r=a.location,n=void 0===r?0:r,s=a.distance,i=void 0===s?100:s,p=a.threshold,c=void 0===p?.6:p,l=a.maxPatternLength,f=void 0===l?32:l,d=a.caseSensitive,u=void 0!==d&&d,h=a.tokenSeparator,m=void 0===h?/ +/g:h,_=a.findAllMatches,g=void 0!==_&&_,v=a.minMatchCharLength,b=void 0===v?1:v,y=a.id,w=void 0===y?null:y,k=a.keys,C=void 0===k?[]:k,x=a.shouldSort,S=void 0===x||x,$=a.getFn,O=void 0===$?o:$,T=a.sortFn,E=void 0===T?function(e,t){return e.score-t.score}:T,P=a.tokenize,L=void 0!==P&&P,A=a.matchAllTokens,j=void 0!==A&&A,M=a.includeMatches,R=void 0!==M&&M,N=a.includeScore,I=void 0!==N&&N,z=a.verbose,F=void 0!==z&&z;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:n,distance:i,threshold:c,maxPatternLength:f,isCaseSensitive:u,tokenSeparator:m,findAllMatches:g,minMatchCharLength:b,id:w,keys:C,includeMatches:R,includeScore:I,shouldSort:S,getFn:O,sortFn:E,verbose:F,tokenize:L,matchAllTokens:j},this.setCollection(t)}return r(e,[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){this._log('---------\nSearch pattern: "'+e+'"');var t=this._prepareSearchers(e),a=t.tokenSearchers,r=t.fullSearcher,n=this._search(a,r),o=n.weights,s=n.results;return this._computeScore(o,s),this.options.shouldSort&&this._sort(s),this._format(s)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var a=e.split(this.options.tokenSeparator),r=0,o=a.length;r<o;r+=1)t.push(new n(a[r],this.options));return{tokenSearchers:t,fullSearcher:new n(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],a=this.list,r={},n=[];if("string"==typeof a[0]){for(var o=0,s=a.length;o<s;o+=1)this._analyze({key:"",value:a[o],record:o,index:o},{resultMap:r,results:n,tokenSearchers:e,fullSearcher:t});return{weights:null,results:n}}for(var i={},p=0,c=a.length;p<c;p+=1)for(var l=a[p],f=0,d=this.options.keys.length;f<d;f+=1){var u=this.options.keys[f];if("string"!=typeof u){if(i[u.name]={weight:1-u.weight||1},u.weight<=0||u.weight>1)throw new Error("Key weight has to be > 0 and <= 1");u=u.name}else i[u]={weight:1};this._analyze({key:u,value:this.options.getFn(l,u),record:l,index:p},{resultMap:r,results:n,tokenSearchers:e,fullSearcher:t})}return{weights:i,results:n}}},{key:"_analyze",value:function(e,t){var a=e.key,r=e.arrayIndex,n=void 0===r?-1:r,o=e.value,i=e.record,p=e.index,c=t.tokenSearchers,l=void 0===c?[]:c,f=t.fullSearcher,d=void 0===f?[]:f,u=t.resultMap,h=void 0===u?{}:u,m=t.results,_=void 0===m?[]:m;if(null!=o){var g=!1,v=-1,b=0;if("string"==typeof o){this._log("\nKey: "+(""===a?"-":a));var y=d.search(o);if(this._log('Full text: "'+o+'", score: '+y.score),this.options.tokenize){for(var w=o.split(this.options.tokenSeparator),k=[],C=0;C<l.length;C+=1){var x=l[C];this._log('\nPattern: "'+x.pattern+'"');for(var S=!1,$=0;$<w.length;$+=1){var O=w[$],T=x.search(O),E={};T.isMatch?(E[O]=T.score,g=!0,S=!0,k.push(T.score)):(E[O]=1,this.options.matchAllTokens||k.push(1)),this._log('Token: "'+O+'", score: '+E[O])}S&&(b+=1)}v=k[0];for(var P=k.length,L=1;L<P;L+=1)v+=k[L];v/=P,this._log("Token score average:",v)}var A=y.score;v>-1&&(A=(A+v)/2),this._log("Score average:",A);var j=!this.options.tokenize||!this.options.matchAllTokens||b>=l.length;if(this._log("\nCheck Matches: "+j),(g||y.isMatch)&&j){var M=h[p];M?M.output.push({key:a,arrayIndex:n,value:o,score:A,matchedIndices:y.matchedIndices}):(h[p]={item:i,output:[{key:a,arrayIndex:n,value:o,score:A,matchedIndices:y.matchedIndices}]},_.push(h[p]))}}else if(s(o))for(var R=0,N=o.length;R<N;R+=1)this._analyze({key:a,arrayIndex:R,value:o[R],record:i,index:p},{resultMap:h,results:_,tokenSearchers:l,fullSearcher:d})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var a=0,r=t.length;a<r;a+=1){for(var n=t[a].output,o=n.length,s=0,i=1,p=0;p<o;p+=1){var c=e?e[n[p].key].weight:1,l=(1===c?n[p].score:n[p].score||.001)*c;1!==c?i=Math.min(i,l):(n[p].nScore=l,s+=l)}t[a].score=1===i?s/o:i,this._log(t[a])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];this._log("\n\nOutput:\n\n",JSON.stringify(e));var a=[];this.options.includeMatches&&a.push(function(e,t){var a=e.output;t.matches=[];for(var r=0,n=a.length;r<n;r+=1){var o=a[r];if(0!==o.matchedIndices.length){var s={indices:o.matchedIndices,value:o.value};o.key&&(s.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(s.arrayIndex=o.arrayIndex),t.matches.push(s)}}}),this.options.includeScore&&a.push(function(e,t){t.score=e.score});for(var r=0,n=e.length;r<n;r+=1){var o=e[r];if(this.options.id&&(o.item=this.options.getFn(o.item,this.options.id)[0]),a.length){for(var s={item:o.item},i=0,p=a.length;i<p;i+=1)a[i](o,s);t.push(s)}else t.push(o.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}]),e}();e.exports=i}])},e.exports=a()}),Fuse=unwrapExports(fuse),hyper_min=createCommonjsModule(function(e){!function(){function t(e,t){for(var a in t)e[a]=t[a];return e}function a(e){!e.__d&&(e.__d=!0)&&1==E.push(e)&&T(r)}function r(){var e,t=E;for(E=[];e=t.pop();)e.__d&&y(e)}function n(e,t,a){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&o(e,t.nodeName):a||e._componentConstructor===t.nodeName}function o(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function s(e){var a=t({},e.attributes);a.children=e.children;var r=e.nodeName.defaultProps;if(void 0!==r)for(var n in r)void 0===a[n]&&(a[n]=r[n]);return a}function i(e){var t=e.parentNode;t&&t.removeChild(e)}function p(e,t,a,r,n){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)a&&a(null),r&&r(e);else if("class"!==t||n)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof a||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof a)for(var o in a)o in r||(e.style[o]="");for(var o in r)e.style[o]="number"==typeof r[o]&&!1===O.test(o)?r[o]+"px":r[o]}}else if("html"===t)r&&(e.innerHTML=r);else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?a||e.addEventListener(t,c,s):e.removeEventListener(t,c,s),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!n&&t in e)(function(e,t,a){try{e[t]=a}catch(e){}})(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var i=n&&t!==(t=t.replace(/^xlink\:?/,""));null==r||!1===r?i?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(i?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function c(e){return this.__l[e.type](e)}function l(){for(var e;e=P.pop();)e.on_mounted&&e.on_mounted()}function f(e,t,a,r,n,o){L++||(A=null!=n&&void 0!==n.ownerSVGElement,j=null!=e&&!("__hyperattr_"in e));var s=d(e,t,a,r,o);return n&&s.parentNode!==n&&n.appendChild(s),--L||(j=!1,o||l()),s}function d(e,t,a,r,n){var s=e,i=A;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||n)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),h(e,!0))),s.__hyperattr_=!0,s;var p=t.nodeName;if("function"==typeof p)return w(e,t,a,r);if(A="svg"===p||"foreignObject"!==p&&A,p+="",(!e||!o(e,p))&&(s=function(e,t){var a=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return a.__n=e,a}(p,A),e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),h(e,!0)}var c=s.firstChild,l=s.__hyperattr_,f=t.children;if(null==l){l=s.__hyperattr_={};for(var d=s.attributes,m=d.length;m--;)l[d[m].name]=d[m].value}return!j&&f&&1===f.length&&"string"==typeof f[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=f[0]&&(c.nodeValue=f[0]):(f&&f.length||null!=c)&&u(s,f,a,r,j||null!=l.html),_(s,t.attributes,l),A=i,s}function u(e,t,a,r,o){var s,p,c,l,f,u=e.childNodes,m=[],_={},g=0,v=0,b=u.length,y=0,w=t?t.length:0;if(0!==b)for(var k=0;k<b;k++){var C=u[k],x=C.__hyperattr_;null!=(S=w&&x?C._component?C._component.__k:x.key:null)?(g++,_[S]=C):(x||(void 0!==C.splitText?!o||C.nodeValue.trim():o))&&(m[y++]=C)}if(0!==w)for(k=0;k<w;k++){var S;if(f=null,null!=(S=(l=t[k]).key))g&&void 0!==_[S]&&(f=_[S],_[S]=void 0,g--);else if(!f&&v<y)for(s=v;s<y;s++)if(void 0!==m[s]&&n(p=m[s],l,o)){f=p,m[s]=void 0,s===y-1&&y--,s===v&&v++;break}f=d(f,l,a,r),c=u[k],f&&f!==e&&f!==c&&(null==c?e.appendChild(f):f===c.nextSibling?i(c):e.insertBefore(f,c))}if(g)for(var k in _)void 0!==_[k]&&h(_[k],!1);for(;v<=y;)void 0!==(f=m[y--])&&h(f,!1)}function h(e,t){var a=e._component;a?k(a):(null!=e.__hyperattr_&&e.__hyperattr_.ref&&e.__hyperattr_.ref(null),!1!==t&&null!=e.__hyperattr_||i(e),m(e))}function m(e){for(e=e.lastChild;e;){var t=e.previousSibling;h(e,!0),e=t}}function _(e,t,a){var r;for(r in a)t&&null!=t[r]||null==a[r]||p(e,r,a[r],a[r]=void 0,A);for(r in t)"children"===r||"innerHTML"===r||r in a&&t[r]===("value"===r||"checked"===r?e[r]:a[r])||p(e,r,a[r],a[r]=t[r],A)}function g(e,t,a){var r,n=M[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,a),C.call(r,t,a)):((r=new C(t,a)).constructor=e,r.render=v),n)for(var o=n.length;o--;)if(n[o].constructor===e){r.__b=n[o].__b,n.splice(o,1);break}return r}function v(e,t,a){return this.constructor(e,a)}function b(e,t,r,n,o){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||o?e.on_mount&&e.on_mount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,n),n&&n!==e.context&&(e.__c||(e.__c=e.context),e.context=n),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==r&&(1!==r&&!1===x.syncComponentUpdates&&e.base?a(e):y(e,1,o)),e.__r&&e.__r(e))}function y(e,a,r,n){if(!e.__x){var o,i,p,c=e.props,d=e.state,u=e.context,m=e.__p||c,_=e.__s||d,v=e.__c||u,w=e.base,C=e.__b,S=w||C,$=e._component,O=!1;if(w&&(e.props=m,e.state=_,e.context=v,2!==a&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,d,u)?O=!0:e.componentWillUpdate&&e.componentWillUpdate(c,d,u),e.props=c,e.state=d,e.context=u),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!O){o=e.render(c,d,u),e.getChildContext&&(u=t(t({},u),e.getChildContext()));var T,E,A=o&&o.nodeName;if("function"==typeof A){var j=s(o);(i=$)&&i.constructor===A&&j.key==i.__k?b(i,j,1,u,!1):(T=i,e._component=i=g(A,j,u),i.__b=i.__b||C,i.__u=e,b(i,j,0,u,!1),y(i,1,r,!0)),E=i.base}else p=S,(T=$)&&(p=e._component=null),(S||1===a)&&(p&&(p._component=null),E=f(p,o,u,r||!w,S&&S.parentNode,!0));if(S&&E!==S&&i!==$){var M=S.parentNode;M&&E!==M&&(M.replaceChild(E,S),T||(S._component=null,h(S,!1)))}if(T&&k(T),e.base=E,E&&!n){for(var R=e,N=e;N=N.__u;)(R=N).base=E;E._component=R,E._componentConstructor=R.constructor}}if(!w||r?P.unshift(e):O||(e.on_updated&&e.on_updated(m,_,v),x.afterUpdate&&x.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);L||n||l()}}function w(e,t,a,r){for(var n=e&&e._component,o=n,i=e,p=n&&e._componentConstructor===t.nodeName,c=p,l=s(t);n&&!c&&(n=n.__u);)c=n.constructor===t.nodeName;return n&&c&&(!r||n._component)?(b(n,l,3,a,r),e=n.base):(o&&!p&&(k(o),e=i=null),n=g(t.nodeName,l,a),e&&!n.__b&&(n.__b=e,i=null),b(n,l,1,a,r),e=n.base,i&&e!==i&&(i._component=null,h(i,!1))),e}function k(e){var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var a=e._component;a?k(a):t&&(t.__hyperattr_&&t.__hyperattr_.ref&&t.__hyperattr_.ref(null),e.__b=t,i(t),function(e){var t=e.constructor.name;(M[t]||(M[t]=[])).push(e)}(e),m(t)),e.__r&&e.__r(null)}function C(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}var x={},S=[],$=[],O=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,T="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,E=[],P=[],L=0,A=!1,j=!1,M={};t(C.prototype,{set_state:function(e,r){var n=this.state;this.__s||(this.__s=t({},n)),t(n,"function"==typeof e?e(n,this.props):e),r&&(this.__h=this.__h||[]).push(r),a(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),y(this,2)},render:function(){}});var R={h:function(e,t){var a,r,n,o,s=arguments,i=$;for(o=arguments.length;o-- >2;)S.push(s[o]);for(t&&null!=t.children&&(S.length||S.push(t.children),delete t.children);S.length;)if((r=S.pop())&&void 0!==r.pop)for(o=r.length;o--;)S.push(r[o]);else"boolean"==typeof r&&(r=null),(n="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r+="":"string"!=typeof r&&(n=!1)),n&&a?i[i.length-1]+=r:i===$?i=[r]:i.push(r),a=n;var p=new function(){};return p.nodeName=e,p.children=i,p.attributes=null==t?void 0:t,p.key=null==t?void 0:t.key,p},Component:C,render:function(e,t,a){return f(a,e,{},!1,t,!1)}};e.exports=R}()});frappe.socketio={open_tasks:{},open_docs:[],emit_queue:[],init:function(port){void 0===port&&(port=3e3),frappe.boot.disable_async||frappe.socketio.socket||("https:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port),{secure:!0}):"http:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port)):"file:"==window.location.protocol&&(frappe.socketio.socket=io.connect(window.localStorage.server)),frappe.socketio.socket?(frappe.socketio.socket.on("msgprint",function(e){frappe.msgprint(e)}),frappe.socketio.socket.on("eval_js",function(message){eval(message)}),frappe.socketio.socket.on("progress",function(e){e.progress&&(e.percent=flt(e.progress[0])/e.progress[1]*100),e.percent&&(100==e.percent?frappe.hide_progress():frappe.show_progress(e.title||__("Progress"),e.percent,100,e.description))}),frappe.socketio.setup_listeners(),frappe.socketio.setup_reconnect(),frappe.socketio.uploader=new frappe.socketio.SocketIOUploader,$(document).on("form-load form-rename",function(e,t){if(!t.is_new()){for(var a=0,r=frappe.socketio.open_docs.length;a<r;a++){var n=frappe.socketio.open_docs[a];if(t.doctype==n.doctype&&t.docname==n.name)return!1}frappe.socketio.doc_subscribe(t.doctype,t.docname)}}),$(document).on("form-refresh",function(e,t){t.is_new()||frappe.socketio.doc_open(t.doctype,t.docname)}),$(document).on("form-unload",function(e,t){t.is_new()||frappe.socketio.doc_close(t.doctype,t.docname)}),window.onbeforeunload=function(){cur_frm&&!cur_frm.is_new()&&cur_frm.doc&&frappe.socketio.doc_close(cur_frm.doctype,cur_frm.docname)}):console.log("Unable to connect to "+frappe.socketio.get_host(port)))},get_host:function(e){void 0===e&&(e=3e3);var t=window.location.origin;if(window.dev_server){var a=t.split(":");e=frappe.boot.socketio_port||e.toString()||"3000",a.length>2&&(t=a[0]+":"+a[1]),t=t+":"+e}return t},subscribe:function(e,t){frappe.socketio.socket.emit("task_subscribe",e),frappe.socketio.socket.emit("progress_subscribe",e),frappe.socketio.open_tasks[e]=t},task_subscribe:function(e){frappe.socketio.socket.emit("task_subscribe",e)},task_unsubscribe:function(e){frappe.socketio.socket.emit("task_unsubscribe",e)},doc_subscribe:function(e,t){frappe.flags.doc_subscribe?console.log("throttled"):(frappe.flags.doc_subscribe=!0,setTimeout(function(){frappe.flags.doc_subscribe=!1},1e3),frappe.socketio.socket.emit("doc_subscribe",e,t),frappe.socketio.open_docs.push({doctype:e,docname:t}))},doc_unsubscribe:function(e,t){frappe.socketio.socket.emit("doc_unsubscribe",e,t),frappe.socketio.open_docs=$.filter(frappe.socketio.open_docs,function(a){return a.doctype===e&&a.name===t?null:a})},doc_open:function(e,t){(!frappe.socketio.last_doc||frappe.socketio.last_doc[0]!=e&&frappe.socketio.last_doc[0]!=t)&&frappe.socketio.socket.emit("doc_open",e,t),frappe.socketio.last_doc=[e,t]},doc_close:function(e,t){frappe.socketio.socket.emit("doc_close",e,t)},setup_listeners:function(){frappe.socketio.socket.on("task_status_change",function(e){frappe.socketio.process_response(e,e.status.toLowerCase())}),frappe.socketio.socket.on("task_progress",function(e){frappe.socketio.process_response(e,"progress")})},setup_reconnect:function(){frappe.socketio.socket.on("connect",function(){setTimeout(function(){$.each(frappe.socketio.open_tasks,function(e,t){frappe.socketio.subscribe(e,t)}),$.each(frappe.socketio.open_docs,function(e){locals[e.doctype]&&locals[e.doctype][e.name]&&frappe.socketio.doc_subscribe(e.doctype,e.name)}),cur_frm&&cur_frm.doc&&frappe.socketio.doc_open(cur_frm.doc.doctype,cur_frm.doc.name)},5e3)})},process_response:function(e,t){if(e){var a=frappe.socketio.open_tasks[e.task_id];a[t]&&a[t](e),"success"===t&&a.callback&&a.callback(e),frappe.request.cleanup(a,e),a.always&&a.always(e),e.status_code&&e.status_code>400&&a.error&&a.error(e)}}},frappe.provide("frappe.realtime"),frappe.realtime.on=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.on(e,t)},frappe.realtime.off=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.off(e,t)},frappe.realtime.publish=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.emit(e,t)},frappe.socketio.SocketIOUploader=class{constructor(){var e=this;frappe.socketio.socket.on("upload-request-slice",function(t){var a=t.currentSlice*e.chunk_size,r=e.file.slice(a,a+Math.min(e.chunk_size,e.file.size-a));e.on_progress&&e.on_progress(a/e.file.size*100),e.reader.readAsArrayBuffer(r),e.started=!0,e.keep_alive()}),frappe.socketio.socket.on("upload-end",function(t){e.reader=null,e.file=null,"/public"===t.file_url.substr(0,7)&&(t.file_url=t.file_url.substr(7)),e.callback(t)}),frappe.socketio.socket.on("upload-error",function(t){e.disconnect(!1),frappe.msgprint({title:__("Upload Failed"),message:t.error,indicator:"red"})}),frappe.socketio.socket.on("disconnect",function(){e.disconnect()})}start(e){var t=this;void 0===e&&(e={});var a=e.file;void 0===a&&(a=null);var r=e.is_private;void 0===r&&(r=0);var n=e.filename;void 0===n&&(n="");var o=e.callback;void 0===o&&(o=null);var s=e.on_progress;void 0===s&&(s=null);var i=e.chunk_size;void 0===i&&(i=24576);var p=e.fallback;if(void 0===p&&(p=null),this.reader&&frappe.throw(__("File Upload in Progress. Please try again in a few moments.")),!frappe.boot.sysdefaults.use_socketio_to_upload_file||!frappe.socketio.socket.connected)return p?p():frappe.throw(__("Socketio is not connected. Cannot upload"));this.reader=new FileReader,this.file=a,this.chunk_size=i,this.callback=o,this.on_progress=s,this.fallback=p,this.started=!1,this.reader.onload=function(){frappe.socketio.socket.emit("upload-accept-slice",{is_private:r,name:n,type:t.file.type,size:t.file.size,data:t.reader.result}),t.keep_alive()};var c=a.slice(0,this.chunk_size);this.reader.readAsArrayBuffer(c)}keep_alive(){var e=this;this.next_check&&clearTimeout(this.next_check),this.next_check=setTimeout(function(){e.started||(e.fallback?e.fallback():e.disconnect()),e.disconnect()},3e3)}disconnect(e){void 0===e&&(e=!0),this.reader&&(this.reader=null,this.file=null,frappe.hide_progress(),e&&frappe.msgprint({title:__("File Upload"),message:__("File Upload Disconnected. Please try again."),indicator:"red"}))}},function(e){var t=/xyz/.test(function(){})?/\b_super\b/:/.*/;function a(){}a.extend=function(e){var r=this.prototype,n=Object.create(r);for(var o in e)n[o]="function"==typeof e[o]&&"function"==typeof r[o]&&t.test(e[o])?function(e,t){return function(){var a=this._super;this._super=r[e];var n=t.apply(this,arguments);return this._super=a,n}}(o,e[o]):e[o];var s="function"==typeof n.init?n.hasOwnProperty("init")?n.init:function(){r.init.apply(this,arguments)}:function(){};return s.prototype=n,n.constructor=s,s.extend=a.extend,s},e.Class=a}(commonjsGlobal),frappe.provide("frappe.ui.form"),frappe.ui.form.Layout=Class.extend({init:function(e){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,e)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message text-muted small hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var e=[{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}];return e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},show_message:function(e){e?("<"!==e.substr(0,1)&&(e="<div>"+e+"</div>"),$(e).appendTo(this.message.removeClass("hidden"))):this.message.empty().addClass("hidden")},render:function(e){var t=this,a=e||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(a,function(e,a){switch(a.fieldtype){case"Fold":t.make_page(a);break;case"Section Break":t.make_section(a);break;case"Column Break":t.make_column(a);break;default:t.make_field(a)}})},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"}),this.fields.unshift({fieldtype:"Section Break",fieldname:"_form_dashboard",label:__("Dashboard"),cssClass:"form-dashboard",collapsible:1})},replace_field:function(e,t,a){if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){var r=this.init_field(t,a);this.fields_dict[e].$wrapper.remove(),this.fields_list.splice(this.fields_dict[e],1,r),this.fields_dict[e]=r,this.frm&&(r.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[e],1,r),this.section.fields_dict[e]=r,this.refresh_fields([t])}},make_field:function(e,t,a){!this.section&&this.make_section(),!this.column&&this.make_column();var r=this.init_field(e,a);this.fields_list.push(r),this.fields_dict[e.fieldname]=r,this.frm&&(r.perm=this.frm.perm),this.section.fields_list.push(r),this.section.fields_dict[e.fieldname]=r},init_field:function(e,t){void 0===t&&(t=!1);var a=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:t});return a.layout=this,a},make_page:function(e){var t=this,a=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=a.find(".btn-fold").on("click",function(){var e=$(this).parent().next();e.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),e.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),e.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(e){this.section=new frappe.ui.form.Section(this,e),e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(e){this.column=new frappe.ui.form.Column(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)},refresh:function(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse()},refresh_sections:function(){var e=0;this.wrapper.find(".form-section:not(.hide-control)").each(function(){var t=$(this).removeClass("empty-section").removeClass("visible-section").removeClass("shaded-section");t.find(".frappe-control:not(.hide-control)").length||t.hasClass("form-dashboard")?(t.addClass("visible-section"),e%2&&t.addClass("shaded-section"),e++):t.addClass("empty-section")})},refresh_fields:function(e){var t=e.map(function(e){if(e.fieldname)return e.fieldname});this.fields_list.map(function(e){t.includes(e.df.fieldname)&&(e.refresh(),e.df.default&&e.set_input(e.df.default))})},add_fields:function(e){this.render(e),this.refresh_fields(e)},refresh_section_collapse:function(){if(this.doc)for(var e=0;e<this.sections.length;e++){var t=this.sections[e],a=t.df;if(a&&a.collapsible){var r=!0;a.collapsible_depends_on&&(r=!this.evaluate_depends_on_value(a.collapsible_depends_on)),r&&t.has_missing_mandatory()&&(r=!1),"_form_dashboard"===a.fieldname&&(r="yes"===localStorage.getItem("collapseFormDashboard")),t.collapse(r)}}},attach_doc_and_docfields:function(e){for(var t=this,a=0,r=this.fields_list.length;a<r;a++){var n=this.fields_list[a];t.doc&&(n.doc=t.doc,n.doctype=t.doc.doctype,n.docname=t.doc.name,n.df=frappe.meta.get_docfield(t.doc.doctype,n.df.fieldname,t.frm?t.frm.doc.name:t.doc.name)||n.df,t.frm&&(n.perm=t.frm.perm)),e&&n.df&&n.refresh&&n.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})},setup_tabbing:function(){var e=this;this.wrapper.on("keydown",function(t){if(9==t.which){var a=$(t.target),r=a.attr("data-doctype"),n=a.attr("data-fieldname");if(r)return e.handle_tab(r,n,t.shiftKey)}})},handle_tab:function(e,t,a){var r=null,n=null,o=this.fields_list,s=!1;if(e!=this.doctype){if(!(r=this.get_open_grid_row())||!r.layout)return;o=r.layout.fields_list}for(var i=0,p=o.length;i<p;i++){if(o[i].df.fieldname==t){if(a){n?this.set_focus(n):$(this.primary_button).focus();break}if(i<p-1&&(s=this.focus_on_next_field(i,o)),s)break}this.is_visible(o[i])&&(n=o[i])}return s||(r?r.doc.idx==r.grid.grid_rows.length?r.toggle_view(!1,function(){r.grid.frm.layout.handle_tab(r.grid.df.parent,r.grid.df.fieldname)}):r.grid.grid_rows[r.doc.idx].toggle_view(!0):$(this.primary_button).focus()),!1},focus_on_next_field:function(e,t){for(var a=e+1,r=t.length;a<r;a++){var n=t[a];if(this.is_visible(n)){if("Table"===n.df.fieldtype)return n.grid.grid_rows&&n.grid.grid_rows.length||n.grid.add_new_row(),n.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,n.df.fieldtype))return this.set_focus(n),!0}}},is_visible:function(e){return"Write"===e.disp_status&&e.$wrapper&&e.$wrapper.is(":visible")},set_focus:function(e){"Table"==e.df.fieldtype?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var e=!1;for(var t in this.fields_list){(r=this.fields_list[t]).dependencies_clear=!0,r.df.depends_on&&(e=!0)}if(e){for(var a=this.fields_list.length-1;a>=0;a--){var r;(r=this.fields_list[a]).guardian_has_value=!0,r.df.depends_on&&(r.guardian_has_value=this.evaluate_depends_on_value(r.df.depends_on),r.guardian_has_value?r.df.hidden_due_to_dependency&&(r.df.hidden_due_to_dependency=!1,r.refresh()):r.df.hidden_due_to_dependency||(r.df.hidden_due_to_dependency=!0,r.refresh()))}this.refresh_section_count()}},evaluate_depends_on_value:function(expression){var out=null,doc=this.doc;if(!doc&&this.get_values)var doc=this.get_values(!0);if(doc){var parent=this.frm?this.frm.doc:null;if("boolean"==typeof expression)out=expression;else if("function"==typeof expression)out=expression(doc);else if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5)),parent&&parent.istable&&expression.includes("is_submittable")&&(out=!0)}catch(e){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==expression.substr(0,3)&&this.frm)out=this.frm.script_manager.trigger(expression.substr(3),this.doctype,this.docname);else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}}}),frappe.ui.form.Section=Class.extend({init:function(e,t){this.layout=e,this.df=t||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.df.collapsible&&"_form_dashboard"!==this.df.fieldname&&this.collapse(!0),this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper)),this.wrapper=$('<div class="row form-section">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var e=this;this.df.collapsible?(this.head=$('<div class="section-head"><a class="h6 uppercase">'+__(this.df.label)+'</a><span class="octicon octicon-chevron-down collapse-indicator"></span></div>').appendTo(this.wrapper),this.collapse_link=this.head.on("click",function(){e.collapse()}),this.indicator=this.head.find(".collapse-indicator")):$('<div class="col-sm-12"><h6 class="form-section-heading uppercase">'+__(this.df.label)+"</h6></div>").appendTo(this.wrapper)},refresh:function(){if(this.df){var e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),this.wrapper.toggleClass("hide-control",!!e)}},collapse:function(e){this.head&&this.body&&(void 0===e&&(e=!this.body.hasClass("hide")),"_form_dashboard"===this.df.fieldname&&localStorage.setItem("collapseFormDashboard",e?"yes":"no"),this.body.toggleClass("hide",e),this.head.toggleClass("collapsed",e),this.indicator.toggleClass("octicon-chevron-down",e),this.indicator.toggleClass("octicon-chevron-up",!e),this.fields_list.forEach(function(e){"Signature"==e.df.fieldtype&&e.refresh()}))},has_missing_mandatory:function(){for(var e=!1,t=0,a=this.fields_list.length;t<a;t++){var r=this.fields_list[t].df;if(r.reqd&&null==this.layout.doc[r.fieldname]){e=!0;break}}return e}}),frappe.ui.form.Column=Class.extend({init:function(e,t){t||(t={}),this.df=t,this.section=e,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",function(){return!1}),this.df.label&&$('<label class="control-label">'+__(this.df.label)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var e=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+e)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(e){$.extend(this,e),this.dirty=!1,this._super(),$.each(this.fields||[],function(e,t){!t.fieldname&&t.label&&(t.fieldname=t.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)},make:function(){var e=this,t=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,function(e,a){if(a.df.default){var r=a.df.default;"Today"==r&&"Date"==a.df.fieldtype&&(r=frappe.datetime.get_today()),a.set_input(r),t.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change",function(){e.dirty=!0,frappe.run_serially([function(){return frappe.timeout(.1)},function(){return t.refresh_dependency()}])}))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,function(e,t){if(!in_list(["Date","Datetime","Time","Check"],t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})},catch_enter_as_submit:function(){var e=this;$(this.body).find('input[type="text"], input[type="password"]').keypress(function(t){13==t.which&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})},get_input:function(e){var t=this.fields_dict[e];return $(t.txt?t.txt:t.input)},get_field:function(e){return this.fields_dict[e]},get_values:function(e){var t={},a=[];for(var r in this.fields_dict){var n=this.fields_dict[r];if(n.get_value){var o=n.get_value();n.df.reqd&&is_null(o)&&a.push(__(n.df.label)),is_null(o)||(t[n.df.fieldname]=o)}}return a.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+a.join("<li>")+"</ul>",indicator:"orange"}),null):t},get_value:function(e){var t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)},set_value:function(e,t){var a=this;return new Promise(function(r){var n=a.fields_dict[e];n?n.set_value(t).then(function(){n.set_input(t),a.refresh_dependency(),r()}):r()})},set_input:function(e,t){return this.set_value(e,t)},set_values:function(e){for(var t in e)this.fields_dict[t]&&this.set_value(t,e[t])},clear:function(){for(var e in this.fields_dict){var t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}},set_df_property:function(e,t,a){var r=this.get_field(e);r.df[t]=a,r.refresh()}}),frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(e){return document.getElementById(e)},get_unique_id:function(){var e="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,e},set_unique_id:function(e){var t=$(e);if(t.attr("id"))return t.attr("id");var a="unique-"+frappe.dom.id_count;return t.attr("id",a),frappe.dom.id_count++,a},eval:function(e){if(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}},remove_script_and_style:function(e){var t=["script","style","noscript","title","meta","base","head"];if(!new RegExp(t.map(function(e){return"<"+e+">.*<\\/"+e+">"}).join("|")).test(e))return e;var a=document.createElement("div");a.innerHTML=e;var r=!1;t.forEach(function(e){var t=a.getElementsByTagName(e);for(o=t.length;o--;)r=!0,t[o].parentNode.removeChild(t[o])});for(var n=a.getElementsByTagName("link"),o=n.length;o--;)"stylesheet"==n[o].getAttribute("rel")&&(r=!0,n[o].parentNode.removeChild(n[o]));return r?a.innerHTML:e},is_element_in_viewport:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0},set_style:function(e,t){if(e){var a=document.createElement("style");if(a.type="text/css",t){var r=document.getElementById(t);r&&r.parentNode.removeChild(r),a.id=t}return a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(a),a}},add:function(e,t,a,r,n,o){e&&e.substr&&(e=frappe.dom.by_id(e));var s=document.createElement(t);return e&&e.appendChild(s),a&&("img"==t.toLowerCase()?s.src=a:s.className=a),r&&frappe.dom.css(s,r),n&&(s.innerHTML=n),o&&(s.onclick=o),s},css:function(e,t){return e&&t&&$.extend(e.style,t),e},activate:function(e,t,a,r){void 0===r&&(r="active"),e.find("."+a+"."+r).removeClass(r),t.addClass(r)},freeze:function(e,t){if($("#freeze").length)$("#freeze").addClass("in");else{var a=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body_div");a.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:e||""})),setTimeout(function(){a.addClass("in")},1)}t&&$("#freeze").addClass(t),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],a=0,r=e.rangeCount;a<r;++a)t.push(e.getRangeAt(a));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var a=0,r=e.length;a<r;++a)t.addRange(e[a])}else document.selection&&e.select&&e.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images:function(e){$(e).find("img").on("error",function(e){$(e.currentTarget).addClass("no-image")})},scroll_to_bottom:function(e){var t=$(e);t.scrollTop(t[0].scrollHeight)},file_to_base64:function(e){return new Promise(function(t){var a=new FileReader;a.onload=function(){t(a.result)},a.readAsDataURL(e)})},pixel_to_inches:function(e){var t=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');t.appendTo(document.body);var a=e/document.getElementById("dpi").offsetWidth;return t.remove(),a}},frappe.ellipsis=function(e,t){return t||(t=20),(e=cstr(e)).length>t&&(e=e.substr(0,t)+"..."),e},frappe.run_serially=function(e){var t=Promise.resolve();return e.forEach(function(e){e&&(t=t.then?t.then(e):Promise.resolve())}),t},frappe.load_image=function(e,t,a,r){void 0===r&&(r=function(){});var n=new Image;n.onload=function(){t(this)},n.onerror=a,r(n),n.src=e},frappe.timeout=function(e){return new Promise(function(t){setTimeout(function(){return t()},1e3*e)})},frappe.scrub=function(e){return e.replace(/ /g,"_").toLowerCase()},frappe.get_modal=function(e,t){return $('<div class="modal fade" style="overflow: auto;" tabindex="-1">\n\t\t<div class="modal-dialog">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div class="modal-header">\n\t                <div class="row">\n\t                    <div class="col-xs-7">\n\t\t\t\t\t\t\t<span class="indicator hidden"></span>\n\t                        <h4 class="modal-title" style="font-weight: bold;">'+e+'</h4>\n\t                    </div>\n\t                    <div class="col-xs-5">\n\t                        <div class="text-right buttons">\n\t            \t\t\t\t<button type="button" class="btn btn-default btn-sm btn-modal-close"\n\t                                data-dismiss="modal">\n\t\t\t\t\t\t\t\t\t<i class="octicon octicon-x visible-xs" style="padding: 1px 0px;"></i>\n\t\t\t\t\t\t\t\t\t<span class="hidden-xs">'+__("Close")+'</span></button>\n\t            \t\t\t\t<button type="button" class="btn btn-primary btn-sm hide">\n\t                                '+__("Confirm")+'</button>\n\t                        </div>\n\t                    </div>\n\t                </div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body ui-front">'+t+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>")},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})}),$(window).on("offline",function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})}),function(e){e.fn.add_options=function(t){for(var a=0,r=t.length;a<r;a++){var n=t[a];if(is_null(n))var o=null,s=null;else{var i=is_null(n.value),p=is_null(n.label);if(i&&p)o=n,s=__(n);else o=i?"":n.value,s=p?__(o):__(n.label)}e("<option>").html(cstr(s)).attr("value",o).appendTo(this)}return this.selectedIndex=0,e(this)},e.fn.set_working=function(){this.prop("disabled",!0)},e.fn.done_working=function(){this.prop("disabled",!1)}}(jQuery),function(e){function t(t){e(t).keydown(function(e){if(9==e.which)return function(e,t){if(e.focus(),"number"==typeof e.selectionStart){var a=e.value,r=e.selectionStart;e.value=a.slice(0,r)+t+a.slice(e.selectionEnd),e.selectionEnd=e.selectionStart=r+t.length}else if(void 0!==document.selection){var n=document.selection.createRange();n.text=t,n.collapse(!1),n.select()}}(this,"\t"),!1}),e(t).keypress(function(e){if(9==e.which)return!1})}e.fn.allowTabs=function(){return this.jquery&&this.each(function(){if(1==this.nodeType){var e=this.nodeName.toLowerCase();("textarea"==e||"input"==e&&"text"==this.type)&&t(this)}}),this}}(jQuery),frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this.make()}make(){this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size&&$(this.wrapper).addClass("modal-lg"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),super.make(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.get_close_btn().html(this.secondary_action_label||this.action.secondary.label);var e=this;this.$wrapper.on("hide.bs.modal",function(){e.display=!1,e.secondary_action&&e.secondary_action(),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===e&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),e.onhide&&e.onhide(),e.on_hide&&e.on_hide()}).on("shown.bs.modal",function(){e.display=!0,window.cur_dialog=e,frappe.ui.open_dialogs.push(e),e.focus_on_first_input(),e.on_page_show&&e.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown")}).on("scroll",function(){var e=$("input:focus");e.length&&["Date","Datetime","Time"].includes(e.attr("data-fieldtype"))&&e.blur()})}get_primary_btn(){return this.$wrapper.find(".modal-header .btn-primary")}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}set_primary_action(e,t){this.has_primary_action=!0;var a=this;return this.get_primary_btn().removeClass("hide").html(e).click(function(){a.primary_action_fulfilled=!0;var e=a.get_values();e&&t&&t.apply(a,[e])})}set_secondary_action(e){this.get_close_btn().on("click",e)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}},frappe._.get_data_uri=function(e){var t=$(e),a=t.width(),r=t.height(),n=$("<canvas/>");return n[0].width=a,n[0].height=r,n[0].getContext("2d").drawImage(t[0],0,0,a,r),n[0].toDataURL("image/png")},frappe.ui.Capture=class{constructor(e){void 0===e&&(e={}),this.options=frappe.ui.Capture.OPTIONS,this.set_options(e)}set_options(e){return this.options=Object.assign({},frappe.ui.Capture.OPTIONS,e),this}render(){var e=this;return navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){e.dialog=new frappe.ui.Dialog({title:e.options.title,animate:e.options.animate,action:{secondary:{label:"<b>&times</b>"}}});var a=$(frappe.ui.Capture.TEMPLATE),r=a.find("video")[0];r.srcObject=t,r.play(),$(e.dialog.body).html(a),a.find(".fc-btf").hide(),a.find(".fc-bcp").click(function(){var e=frappe._.get_data_uri(r);a.find(".fc-p").attr("src",e),a.find(".fc-s").hide(),a.find(".fc-p").show(),a.find(".fc-btu").hide(),a.find(".fc-btf").show()}),a.find(".fc-br").click(function(){a.find(".fc-p").hide(),a.find(".fc-s").show(),a.find(".fc-btf").hide(),a.find(".fc-btu").show()}),a.find(".fc-bs").click(function(){var t=frappe._.get_data_uri(r);e.hide(),e.callback&&e.callback(t)})})}show(){var e=this;this.render().then(function(){e.dialog.show()}).catch(function(t){if(e.options.error){var a='<span class="indicator red"/> '+frappe.ui.Capture.ERR_MESSAGE;frappe.show_alert(a,3)}throw t})}hide(){this.dialog&&this.dialog.hide()}submit(e){this.callback=e}},frappe.ui.Capture.OPTIONS={title:__("Camera"),animate:!1,error:!1},frappe.ui.Capture.ERR_MESSAGE=__("Unable to load camera."),frappe.ui.Capture.TEMPLATE='\n<div class="frappe-capture">\n\t<div class="panel panel-default">\n\t\t<img class="fc-p img-responsive"/>\n\t\t<div class="fc-s  embed-responsive embed-responsive-16by9">\n\t\t\t<video class="embed-responsive-item">'+frappe.ui.Capture.ERR_MESSAGE+'</video>\n\t\t</div>\n\t</div>\n\t<div>\n\t\t<div class="fc-btf">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-left">\n\t\t\t\t\t\t<button class="btn btn-default fc-br">\n\t\t\t\t\t\t\t<small>'+__("Retake")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-primary fc-bs">\n\t\t\t\t\t\t\t<small>'+__("Submit")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="fc-btu">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-default fc-bcp">\n\t\t\t\t\t\t\t<small>'+__("Take Photo")+"</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n",frappe.user_info=function(e){if(e||(e=frappe.session.user),"bot"===e.toLowerCase())return{fullname:__("Bot"),image:"/assets/frappe/images/ui/bot.png",abbr:"B"};if(frappe.boot.user_info&&frappe.boot.user_info[e])t=frappe.boot.user_info[e];else var t={fullname:frappe.utils.capitalize(e.split("@")[0])||"Unknown"};return t.abbr=frappe.get_abbr(t.fullname),t.color=frappe.get_palette(t.fullname),t},frappe.ui.set_user_background=function(e,t,a){if(t||(t="#page-desktop"),a||(a="Fill Screen"),e){window.cordova&&-1===e.indexOf("http")&&(e=frappe.base_url+e);var r=repl('background: url("%(src)s") center center;',{src:e})}else r="background-color: #4B4C9D;";frappe.dom.set_style(repl("%(selector)s { \t\t%(background)s \t\tbackground-attachment: fixed; \t\t%(style)s \t}",{selector:t,background:r,style:"Fill Screen"===a?"background-size: cover;":""}))},frappe.provide("frappe.user"),$.extend(frappe.user,{name:"Guest",full_name:function(e){return e===frappe.session.user?__("You"):frappe.user_info(e).fullname},image:function(e){return frappe.user_info(e).image},abbr:function(e){return frappe.user_info(e).abbr},has_role:function(e){for(var t in"string"==typeof e&&(e=[e]),e)if(-1!=(frappe.boot?frappe.boot.user.roles:["Guest"]).indexOf(e[t]))return!0},get_desktop_items:function(){return $.map(frappe.boot.desktop_icons,function(e){var t=e.module_name,a=frappe.modules[t]&&frappe.modules[t].type;if(-1===frappe.boot.user.allow_modules.indexOf(t))return null;var r=null;return"module"===a?(-1!=frappe.boot.user.allow_modules.indexOf(t)||frappe.modules[t].is_help)&&(r=t):"page"===a?-1!=frappe.boot.allowed_pages.indexOf(frappe.modules[t].link)&&(r=t):"list"===a?frappe.model.can_read(frappe.modules[t]._doctype)&&(r=t):"view"===a?r=t:"setup"===a?(frappe.user.has_role("System Manager")||frappe.user.has_role("Administrator"))&&(r=t):r=t,r})},is_module:function(e){for(var t=frappe.get_desktop_icons(),a=0;a<t.length;a++)if(e===t[a].module_name)return!0;return!1},is_report_manager:function(){return frappe.user.has_role(["Administrator","System Manager","Report Manager"])},get_formatted_email:function(e){var t=frappe.user.full_name(e);if(t){var a="";return-1!==t.search(/[\[\]\\()<>@,:;".]/)&&(a='"'),repl("%(quote)s%(fullname)s%(quote)s <%(email)s>",{fullname:t,email:e,quote:a})}return e},get_emails:function(){return Object.keys(frappe.boot.user_info).map(function(e){return frappe.boot.user_info[e].email})},toString:function(){return this.name}}),frappe.session_alive=!0,$(document).bind("mousemove",function(){!1===frappe.session_alive&&$(document).trigger("session_alive"),frappe.session_alive=!0,frappe.session_alive_timeout&&clearTimeout(frappe.session_alive_timeout),frappe.session_alive_timeout=setTimeout("frappe.session_alive=false;",3e4)}),frappe.Error=Error,frappe.TypeError=TypeError,frappe.ValueError=Error,frappe.ImportError=Error,frappe.provide("frappe.datetime"),frappe.datetime.datetime=class{constructor(e,t){if(void 0===t&&(t=null),void 0===typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.moment=e?moment(e,t):moment()}format(e){return void 0===e&&(e=null),this.moment.format(e)}},frappe.datetime.range=class{constructor(e,t){if(void 0===typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.start=e,this.end=t}contains(e){return e.moment.isBetween(this.start.moment,this.end.moment)}},frappe.datetime.now=function(){return new frappe.datetime.datetime},frappe.datetime.equal=function(e,t,a){return e=e.moment,t=t.moment,e.isSame(t,a)},frappe.datetime.compare=function(e,t){return e=e.moment,t=t.moment,e.isBefore(t)?1:t.isBefore(e)?-1:0},frappe.quick_edit=function(e,t,a){return new Promise(function(r){frappe.model.with_doctype(e,function(){frappe.db.get_doc(e,t).then(function(n){var o=frappe.get_meta(e).fields.filter(function(e){return e.reqd||e.bold&&!e.read_only});o.map(function(e){"content"==e.fieldname&&"File"==n.type&&(e.read_only=1)});var s=new frappe.ui.Dialog({title:__("Edit "+e+" ("+t+")"),fields:o,action:{primary:{label:__("Save"),onsubmit:function(o){frappe.call("frappe.client.save",{doc:Object.assign({},{doctype:e,docname:t},n,o)}).then(function(e){a&&a(e.message),r(e.message)}),s.hide()}},secondary:{label:__("Discard")}}});s.set_values(n);var i=$(s.body);i.append("\n\t\t\t\t\t<div class=\"qe-fp\" style=\"padding-top: '15px'; padding-bottom: '15px'; padding-left: '7px'\">\n\t\t\t\t\t\t<button class=\"btn btn-default btn-sm\">\n\t\t\t\t\t\t\t"+__("Edit in Full Page")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t"),i.find(".qe-fp").click(function(){s.hide(),frappe.set_route("Form/"+e+"/"+t)}),s.show()})})})},frappe.provide("frappe._"),frappe._.format=function(e,t){for(var a in t)e=e.replace("{"+a+"}",t[a]);return e},frappe._.fuzzy_search=function(e,t,a){return a=Object.assign({},{shouldSort:!0,threshold:.6,location:0,distance:100,minMatchCharLength:1,maxPatternLength:32},a),new Fuse(t,a).search(e)},frappe._.pluralize=function(e,t,a){return void 0===t&&(t=0),void 0===a&&(a="s"),""+e+(1===t?"":a)},frappe._.capitalize=function(e){return""+e.charAt(0).toUpperCase()+e.slice(1)},frappe._.head=function(e){return frappe._.is_empty(e)?void 0:e[0]},frappe._.copy_array=function(e){if(Array.isArray(e))return e.slice();throw frappe.TypeError("Expected Array, recieved "+typeof e+" instead.")},frappe._.is_empty=function(e){var t=!1;return null==e?t=!0:Array.isArray(e)||"string"==typeof e||e instanceof $?t=0===e.length:"object"==typeof e&&(t=0===Object.keys(e).length),t},frappe._.as_array=function(e){return Array.isArray(e)?e:[e]},frappe._.squash=function(e){return Array.isArray(e)&&1===e.length?e[0]:e},frappe._.is_mobile=function(){var e=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini","i"),t=navigator.userAgent;return e.test(t)},frappe._.compact=function(e){return e.filter(Boolean)},frappe.utils=Object.assign({},frappe.utils,frappe._),frappe.provide("frappe.user"),frappe.user.first_name=function(e){return frappe._.head(frappe.user.full_name(e).split(" "))},frappe.provide("frappe.ui.keycode"),frappe.ui.keycode={RETURN:13},frappe.provide("frappe.stores"),frappe.stores=[],frappe.Store=class{constructor(e){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e}static get(e){return e in frappe.stores||(frappe.stores[e]=new frappe.Store(e)),frappe.stores[e]}set(e,t){localStorage.setItem(this.name+":"+e,t)}get(e,t){return localStorage.getItem(this.name+":"+e)}},frappe.provide("frappe.loggers"),frappe.Logger=class{constructor(e,t){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e,this.level=t,this.level||(frappe.boot.developer_mode?this.level=frappe.Logger.ERROR:this.level=frappe.Logger.NOTSET),this.format=frappe.Logger.FORMAT}static get(e,t){return e in frappe.loggers||(frappe.loggers[e]=new frappe.Logger(e,t)),frappe.loggers[e]}debug(e){this.log(e,frappe.Logger.DEBUG)}info(e){this.log(e,frappe.Logger.INFO)}warn(e){this.log(e,frappe.Logger.WARN)}error(e){this.log(e,frappe.Logger.ERROR)}log(e,t){var a=frappe.datetime.now();if(t.value<=this.level.value){var r=frappe._.format(this.format,{time:a.format("HH:mm:ss"),name:this.name});console.log("%c "+r+":","color: "+t.color,e)}}},frappe.Logger.DEBUG={value:10,color:"#616161",name:"DEBUG"},frappe.Logger.INFO={value:20,color:"#2196F3",name:"INFO"},frappe.Logger.WARN={value:30,color:"#FFC107",name:"WARN"},frappe.Logger.ERROR={value:40,color:"#F44336",name:"ERROR"},frappe.Logger.NOTSET={value:0,name:"NOTSET"},frappe.Logger.FORMAT="{time} {name}",frappe.provide("frappe.chat"),frappe.log=frappe.Logger.get("frappe.chat",frappe.Logger.NOTSET),frappe.provide("frappe.chat.profile"),frappe.chat.profile.create=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise(function(a){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.create",{user:frappe.session.user,exists_ok:!0,fields:e},function(e){t&&t(e.message),a(e.message)})})},frappe.chat.profile.update=function(e,t,a){return new Promise(function(r){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.update",{user:e||frappe.session.user,data:t},function(e){a&&a(e.message),r(e.message)})})},frappe.provide("frappe.chat.profile.on"),frappe.chat.profile.on.update=function(e){frappe.realtime.on("frappe.chat.profile:update",function(t){return e(t.user,t.data)})},frappe.chat.profile.STATUSES=[{name:"Online",color:"green"},{name:"Away",color:"yellow"},{name:"Busy",color:"red"},{name:"Offline",color:"darkgrey"}],frappe.provide("frappe.chat.room"),frappe.chat.room.create=function(e,t,a,r,n){return"function"==typeof r&&(n=r,r=null),a=frappe._.as_array(a),new Promise(function(o){frappe.call("frappe.chat.doctype.chat_room.chat_room.create",{kind:e,owner:t||frappe.session.user,users:a,name:r},function(e){var t=e.message;t=Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}),n&&n(t),o(t)})})},frappe.chat.room.get=function(e,t,a){return"function"==typeof e?(a=e,e=null,t=null):"string"==typeof e&&(e=frappe._.as_array(e),"function"==typeof t?(a=t,t=null):"string"==typeof t&&(t=frappe._.as_array(t))),new Promise(function(r){frappe.call("frappe.chat.doctype.chat_room.chat_room.get",{user:frappe.session.user,rooms:e,fields:t},function(e){var t=e.message;t?(t=(t=frappe._.as_array(t)).map(function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation),last_message:e.last_message?Object.assign({},e.last_message,{creation:new frappe.datetime.datetime(e.last_message.creation)}):null})}),t=frappe._.squash(t)):t=[],a&&a(t),r(t)})})},frappe.chat.room.subscribe=function(e){frappe.realtime.publish("frappe.chat.room:subscribe",e)},frappe.chat.room.history=function(e,t){return new Promise(function(a){frappe.call("frappe.chat.doctype.chat_room.chat_room.history",{room:e,user:frappe.session.user},function(e){var r=e.message?frappe._.as_array(e.message):[];r=r.map(function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation)})}),t&&t(r),a(r)})})},frappe.chat.room.search=function(e,t){var a=t.map(function(e){return e.room_name?e.room_name:e.owner===frappe.session.user?frappe.user.full_name(frappe._.squash(e.users)):frappe.user.full_name(e.owner)}),r=frappe._.fuzzy_search(e,a);return t=r.map(function(e){return t[e]})},frappe.chat.room.sort=function(e,t){return void 0===t&&(t=null),t=t||function(e,t){return e.last_message&&t.last_message?frappe.datetime.compare(e.last_message.creation,t.last_message.creation):e.last_message?frappe.datetime.compare(e.last_message.creation,t.creation):t.last_message?frappe.datetime.compare(e.creation,t.last_message.creation):frappe.datetime.compare(e.creation,t.creation)},e.sort(t),e},frappe.provide("frappe.chat.room.on"),frappe.chat.room.on.update=function(e){frappe.realtime.on("frappe.chat.room:update",function(t){t.data.last_message&&(t.data=Object.assign({},t.data,{last_message:Object.assign({},t.data.last_message,{creation:new frappe.datetime.datetime(t.data.last_message.creation)})})),e(t.room,t.data)})},frappe.chat.room.on.create=function(e){frappe.realtime.on("frappe.chat.room:create",function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))})},frappe.chat.room.on.typing=function(e){frappe.realtime.on("frappe.chat.room:typing",function(t){return e(t.room,t.user)})},frappe.provide("frappe.chat.message"),frappe.chat.message.typing=function(e,t){frappe.realtime.publish("frappe.chat.message:typing",{user:t||frappe.session.user,room:e})},frappe.chat.message.send=function(e,t,a){void 0===a&&(a="Content"),frappe.call("frappe.chat.doctype.chat_message.chat_message.send",{user:frappe.session.user,room:e,content:t,type:a})},frappe.chat.message.update=function(e,t,a){return new Promise(function(r){frappe.call("frappe.chat.doctype.chat_message.chat_message.update",{user:frappe.session.user,message:e,update:t},function(e){a&&a(response.message),r(response.message)})})},frappe.chat.message.sort=function(e){return frappe._.is_empty(e)||e.sort(function(e,t){return frappe.datetime.compare(t.creation,e.creation)}),e},frappe.chat.message.seen=function(e,t){frappe.call("frappe.chat.doctype.chat_message.chat_message.seen",{message:e,user:t||frappe.session.user})},frappe.provide("frappe.chat.message.on"),frappe.chat.message.on.create=function(e){frappe.realtime.on("frappe.chat.message:create",function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))})},frappe.chat.message.on.update=function(e){frappe.realtime.on("frappe.chat.message:update",function(t){return e(t.message,t.data)})},frappe.chat.pretty_datetime=function(e){var t=moment(),a=e.moment;return t.isSame(a,"d")?a.format("hh:mm A"):t.isSame(a,"week")?a.format("dddd"):a.format("DD/MM/YYYY")},frappe.provide("frappe.chat.sound"),frappe.chat.sound.play=function(e,t){void 0===t&&(t=.1);var a=$('<audio class="chat-audio"/>');a.attr("volume",t),frappe._.is_empty(a)&&$(document).append(a),a.paused||(frappe.log.info("Stopping sound playing."),a[0].pause(),a.attr("currentTime",0)),frappe.log.info("Playing sound."),a.attr("src",frappe.chat.sound.PATH+"/chat-"+e+".mp3"),a[0].play()},frappe.chat.sound.PATH="/assets/frappe/sounds",frappe.chat.emojis=[],frappe.chat.emoji=function(e){return new Promise(function(t){frappe._.is_empty(frappe.chat.emojis)?$.get("https://cdn.rawgit.com/frappe/emoji/master/emoji",function(a){frappe.chat.emojis=JSON.parse(a),e&&e(frappe.chat.emojis),t(frappe.chat.emojis)}):(e&&e(frappe.chat.emojis),t(frappe.chat.emojis))})},frappe.provide("frappe.chat.website.settings"),frappe.chat.website.settings=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise(function(a){frappe.call("frappe.chat.website.settings",{fields:e}).then(function(e){var r=e.message;r.enable_from&&(r=Object.assign({},r,{enable_from:new frappe.datetime.datetime(r.enable_from,"HH:mm:ss")})),r.enable_to&&(r=Object.assign({},r,{enable_to:new frappe.datetime.datetime(r.enable_to,"HH:mm:ss")})),t&&t(r),a(r)})})},frappe.chat.website.token=function(e){return new Promise(function(t){frappe.call("frappe.chat.website.token").then(function(a){e&&e(a.message),t(a.message)})})};var h=hyper_min.h,Component=hyper_min.Component;frappe.provide("frappe.components"),frappe.provide("frappe.chat.component"),frappe.components.Button=class extends Component{render(){var e=this.props,t=frappe.components.Button.SIZE[e.size];return h("button",Object.assign({},e,{class:"btn "+(t&&t.class)+" btn-"+e.type+" "+(e.block?"btn-block":"")+" "+(e.class?e.class:"")}),e.children)}},frappe.components.Button.SIZE={small:{class:"btn-sm"},large:{class:"btn-lg"}},frappe.components.Button.defaultProps={type:"default",block:!1},frappe.components.FAB=class extends frappe.components.Button{render(){var e=this.props,t=frappe.components.FAB.SIZE[e.size];return h(frappe.components.Button,Object.assign({},e,{class:e.class+" "+(t&&t.class)}),h("i",{class:e.icon}))}},frappe.components.FAB.defaultProps={icon:"octicon octicon-plus"},frappe.components.FAB.SIZE={small:{class:"frappe-fab-sm"},large:{class:"frappe-fab-lg"}},frappe.components.Indicator=class extends Component{render(){var e=this.props;return e.color?h("span",Object.assign({},e,{class:"indicator "+e.color})):null}},frappe.components.FontAwesome=class extends Component{render(){var e=this.props;return e.type?h("i",Object.assign({},e,{class:"fa "+(e.fixed?"fa-fw":"")+" fa-"+e.type+" "+e.class})):null}},frappe.components.FontAwesome.defaultProps={fixed:!1},frappe.components.Octicon=class extends Component{render(){var e=this.props;return e.type?h("i",Object.assign({},e,{class:"octicon octicon-"+e.type})):null}},frappe.components.Avatar=class extends Component{render(){var e=this.props,t=e.abbr||e.title.substr(0,1),a=frappe.components.Avatar.SIZE[e.size]||frappe.components.Avatar.SIZE.medium;return h("span",{class:"avatar "+a.class+" "+(e.class?e.class:"")},e.image?h("img",{class:"media-object",src:e.image}):h("div",{class:"standard-image"},t))}},frappe.components.Avatar.SIZE={small:{class:"avatar-small"},large:{class:"avatar-large"},medium:{class:"avatar-medium"}},frappe.Chat=class{constructor(e,t){"string"==typeof e||e instanceof $||e instanceof HTMLElement||(t=e,e=null),this.options=frappe.Chat.OPTIONS,this.set_wrapper(e||"body"),this.set_options(t),frappe.chat.emoji()}set_wrapper(e){return this.$wrapper=$(e),this}set_options(e){return this.options=Object.assign({},this.options,e),this}destroy(){return this.$wrapper.remove(".frappe-chat"),this}render(e){void 0===e&&(e={}),this.destroy();var t=this.$wrapper,a=this.options,r=h(frappe.Chat.Widget,Object.assign({},{layout:a.layout,target:a.target},e));return hyper_min.render(r,t[0]),this}},frappe.Chat.Layout={PAGE:"page",POPPER:"popper"},frappe.Chat.OPTIONS={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget=class extends Component{constructor(e){super(e),this.setup(e),this.make()}setup(e){var t=this;this.room={},this.room.add=function(e){var a=(e=frappe._.as_array(e)).map(function(e){return e.name});frappe.log.info("Subscribing "+frappe.session.user+" to Chat Rooms "+a.join(", ")+"."),frappe.chat.room.subscribe(a);for(var r=[],n=0,o=e;n<o.length;n+=1){var s=o[n];(["Group","Visitor"].includes(s.type)||s.owner===frappe.session.user||s.last_message)&&(frappe.log.info("Adding "+s.name+" to component."),r.push(s))}t.set_state({rooms:t.state.rooms.concat(r)})},this.room.update=function(e,a){var r=t.state,n=!1,o=r.rooms.map(function(t){if(t.name===e){if(n=!0,a.typing)if(frappe._.is_empty(t.typing))a.typing=frappe._.as_array(a.typing);else{var r=a.typing;t.typing.includes(r)||(a.typing=frappe._.copy_array(t.typing),a.typing.push(r))}return Object.assign({},t,a)}return t});if("Guest"!==frappe.session.user&&(n?t.set_state({rooms:o}):frappe.chat.room.get(e,function(e){return t.room.add(e)})),r.room.name===e){if(a.typing)if(frappe._.is_empty(r.room.typing))a.typing=frappe._.as_array(a.typing);else{var s=a.typing;r.room.typing.includes(s)||(a.typing=frappe._.copy_array(r.room.typing),a.typing.push(s))}var i=Object.assign({},r.room,a);t.set_state({room:i})}},this.room.select=function(e){frappe.chat.room.history(e,function(a){var r=t.state,n=r.rooms.find(function(t){return t.name===e});t.set_state({room:Object.assign({},r.room,n,{messages:a})})})},this.state=Object.assign({},frappe.Chat.Widget.defaultState,e)}make(){var e=this;"Guest"!==frappe.session.user?frappe.chat.profile.create(["status","message_preview","notification_tones","conversation_tones"]).then(function(t){e.set_state({profile:t}),frappe.chat.room.get(function(t){t=frappe._.as_array(t),frappe.log.info("User "+frappe.session.user+" is subscribed to "+t.length+" "+frappe._.pluralize("room",t.length)+"."),frappe._.is_empty(t)||e.room.add(t)}),e.bind()}):this.bind()}bind(){var e=this;frappe.chat.profile.on.update(function(t,a){if(frappe.log.warn("TRIGGER: Chat Profile update "+JSON.stringify(a)+" of User "+t+"."),"status"in a)if(t===frappe.session.user)e.set_state({profile:Object.assign({},e.state.profile,{status:a.status})});else{var r='<span class="indicator '+frappe.chat.profile.STATUSES.find(function(e){return e.name===a.status}).color+'"/> '+frappe.user.full_name(t)+" is currently <b>"+a.status+"</b>";frappe.show_alert(r,3)}}),frappe.chat.room.on.create(function(t){frappe.log.warn("TRIGGER: Chat Room "+t.name+" created."),e.room.add(t)}),frappe.chat.room.on.update(function(t,a){frappe.log.warn("TRIGGER: Chat Room "+t+" update "+JSON.stringify(a)+" recieved."),e.room.update(t,a)}),frappe.chat.room.on.typing(function(t,a){a!==frappe.session.user&&(frappe.log.warn("User "+a+" typing in Chat Room "+t+"."),e.room.update(t,{typing:a}),setTimeout(function(){return e.room.update(t,{typing:null})},5e3))}),frappe.chat.message.on.create(function(t){var a=e.state;if(a.room.name?a.profile.conversation_tones&&frappe.chat.sound.play("message"):a.profile.notification_tones&&frappe.chat.sound.play("notification"),t.user!==frappe.session.user&&a.profile.message_preview&&!a.toggle){$("body").find(".frappe-chat-alert").remove();var r='\n\t\t\t\t<span data-action="show-message" class="cursor-pointer">\n\t\t\t\t\t<span class="indicator yellow"/> <b>'+frappe.user.first_name(t.user)+"</b>: "+t.content+"\n\t\t\t\t</span>\n\t\t\t\t";frappe.show_alert(r,3,{"show-message":function(e){this.room.select(e.room),this.base.firstChild._component.toggle()}.bind(e,t)})}if(t.room===a.room.name){var n=frappe._.copy_array(a.room.messages);n.push(t),e.set_state({room:Object.assign({},a.room,{messages:n})})}}),frappe.chat.message.on.update(function(e,t){frappe.log.warn("TRIGGER: Chat Message "+e+" update "+JSON.stringify(t)+" recieved.")})}render(){var e=this,t=this.props,a=this.state,r=this,n=h(frappe.Chat.Widget.ActionBar,{placeholder:__("Search or Create a New Chat"),class:"level",layout:t.layout,actions:frappe._.compact([{label:__("New"),onclick:function(){var e=new frappe.ui.Dialog({title:__("New Chat"),fields:[{label:__("Chat Type"),fieldname:"type",fieldtype:"Select",options:["Group","Direct Chat"],default:"Group",onchange:function(){var t="Group"===e.get_value("type");e.set_df_property("group_name","reqd",t),e.set_df_property("user","reqd",!t)}},{label:__("Group Name"),fieldname:"group_name",fieldtype:"Data",reqd:!0,depends_on:"eval:doc.type == 'Group'"},{label:__("Users"),fieldname:"users",fieldtype:"MultiSelect",options:frappe.user.get_emails(),depends_on:"eval:doc.type == 'Group'"},{label:__("User"),fieldname:"user",fieldtype:"Link",options:"User",depends_on:"eval:doc.type == 'Direct Chat'"}],action:{primary:{label:__("Create"),onsubmit:function(t){if("Group"===t.type){if(!frappe._.is_empty(t.users)){var a=t.group_name,r=e.fields_dict.users.get_values();frappe.chat.room.create("Group",null,r,a)}}else{var n=t.user;frappe.chat.room.create("Direct",null,n)}e.hide()}}}});e.show()}},frappe._.is_mobile()&&{icon:"octicon octicon-x",class:"frappe-chat-close",onclick:function(){return e.set_state({toggle:!1})}}],Boolean),change:function(e){r.set_state({query:e})},span:function(e){r.set_state({span:e})}}),o=[];if("user_info"in frappe.boot)for(var s=0,i=frappe.user.get_emails();s<i.length;s+=1){for(var p=i[s],c=!1,l=0,f=a.rooms;l<f.length;l+=1){var d=f[l];"Direct"===d.type&&(d.owner!==p&&frappe._.squash(d.users)!==p||(c=!0))}c||o.push({owner:frappe.session.user,users:[p]})}var u=a.query?frappe.chat.room.search(a.query,a.rooms.concat(o)):frappe.chat.room.sort(a.rooms),m=a.span?frappe.Chat.Layout.PAGE:frappe.Chat.Layout.POPPER,_=frappe._.is_empty(u)&&!a.query?h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h("p","",__("You don't have any messages yet.")))):h(frappe.Chat.Widget.RoomList,{rooms:u,click:function(t){t.name?e.room.select(t.name):frappe.chat.room.create("Direct",t.owner,frappe._.squash(t.users),function(t){var a=t.name;return e.room.select(a)})}}),g=h(frappe.Chat.Widget.Room,Object.assign({},a.room,{layout:m,destroy:function(){e.set_state({room:{name:null,messages:[]}})}})),v=m===frappe.Chat.Layout.POPPER?h(frappe.Chat.Widget.Popper,{heading:n,page:a.room.name&&g,target:t.target,toggle:function(t){return e.set_state({toggle:t})}},_):h("div",{class:"frappe-chat-popper"},h("div",{class:"frappe-chat-popper-collapse"},h("div",{class:"panel panel-default panel-span",style:{width:"25%"}},h("div",{class:"panel-heading"},n),_),g));return h("div",{class:"frappe-chat"},v)}},frappe.Chat.Widget.defaultState={query:"",profile:{},rooms:[],room:{name:null,messages:[],typing:[]},toggle:!1,span:!1},frappe.Chat.Widget.defaultProps={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget.Popper=class extends Component{constructor(e){super(e),this.setup(e)}setup(e){var t=this;this.toggle=this.toggle.bind(this),this.state=frappe.Chat.Widget.Popper.defaultState,e.target&&$(e.target).click(function(){return t.toggle()})}toggle(e){var t;t=1===arguments.length?e:!this.state.active,this.set_state({active:t}),this.props.toggle(t)}on_mounted(){var e=this;$(document.body).on("click",".page-container, .frappe-chat-close",function(t){t.currentTarget;e.toggle(!1)})}render(){var e=this,t=this.props,a=this.state;return a.destroy?null:h("div",{class:"frappe-chat-popper",style:t.target?null:{"margin-bottom":"80px"}},t.target?null:h(frappe.components.FAB,{class:"frappe-fab",icon:a.active?"fa fa-fw fa-times":"font-heavy octicon octicon-comment",size:frappe._.is_mobile()?null:"large",type:"primary",onclick:function(){return e.toggle()}}),a.active?h("div",{class:"frappe-chat-popper-collapse"},t.page?t.page:h("div",{class:"panel panel-default "+(frappe._.is_mobile()?"panel-span":"")},h("div",{class:"panel-heading"},t.heading),t.children)):null)}},frappe.Chat.Widget.Popper.defaultState={active:!1,destroy:!1},frappe.Chat.Widget.ActionBar=class extends Component{constructor(e){super(e),this.change=this.change.bind(this),this.submit=this.submit.bind(this),this.state=frappe.Chat.Widget.ActionBar.defaultState}change(e){var t,a=this.props,r=this.state;this.set_state(((t={})[e.target.name]=e.target.value,t)),a.change(r.query)}submit(e){var t=this.props,a=this.state;e.preventDefault(),t.submit(a.query)}render(){var e=this,t=this.props,a=this.state,r=t.actions;return h("div",{class:"frappe-chat-action-bar "+(t.class?t.class:"")},h("form",{oninput:this.change,onsubmit:this.submit},h("input",{autocomplete:"off",class:"form-control input-sm",name:"query",value:a.query,placeholder:t.placeholder||"Search"})),frappe._.is_empty(r)?null:r.map(function(e){return h(frappe.Chat.Widget.ActionBar.Action,Object.assign({},e))}),frappe._.is_mobile()?null:h(frappe.Chat.Widget.ActionBar.Action,{icon:"octicon octicon-screen-"+(a.span?"normal":"full"),onclick:function(){var r=!a.span;e.set_state({span:r}),t.span(r)}}))}},frappe.Chat.Widget.ActionBar.defaultState={query:null,span:!1},frappe.Chat.Widget.ActionBar.Action=class extends Component{render(){var e=this.props;return h(frappe.components.Button,Object.assign({},{size:"small",class:"btn-action"},e),e.icon?h("i",{class:e.icon}):null,(e.icon?" ":"")+(e.label?e.label:""))}},frappe.Chat.Widget.RoomList=class extends Component{render(){var e=this.props,t=e.rooms;return frappe._.is_empty(t)?null:h("ul",{class:"frappe-chat-room-list nav nav-pills nav-stacked"},t.map(function(t){return h(frappe.Chat.Widget.RoomList.Item,Object.assign({},t,{click:e.click}))}))}},frappe.Chat.Widget.RoomList.Item=class extends Component{render(){var e=this.props,t={};if("Group"===e.type)if(t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing)){if(e.last_message){var a=e.last_message,r=a.content;"File"===a.type?t.subtitle="📁 "+r.name:t.subtitle=e.last_message.content}}else{e.typing=frappe._.as_array(e.typing);var n=e.typing.map(function(e){return frappe.user.first_name(e)});t.subtitle=n.join(", ")+" typing..."}else{var o=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;if(t.title=frappe.user.full_name(o),t.image=frappe.user.image(o),t.abbr=frappe.user.abbr(o),frappe._.is_empty(e.typing)){if(e.last_message){var s=e.last_message,i=s.content;"File"===s.type?t.subtitle="📁 "+i.name:t.subtitle=e.last_message.content}}else t.subtitle="typing..."}var p=!1;return e.last_message&&(t.timestamp=frappe.chat.pretty_datetime(e.last_message.creation),p=!e.last_message.seen.includes(frappe.session.user)),h("li",null,h("a",{class:e.active?"active":"",onclick:function(){e.last_message&&frappe.chat.message.seen(e.last_message.name),e.click(e)}},h("div",{class:"row"},h("div",{class:"col-xs-9"},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t))),h("div",{class:"col-xs-3 text-right"},[h("div",{class:"text-muted",style:{"font-size":"9px"}},t.timestamp),p?h("span",{class:"indicator red"}):null]))))}},frappe.Chat.Widget.MediaProfile=class extends Component{render(){var e=this.props,t=frappe.Chat.Widget.MediaProfile.POSITION[e.position||"left"],a=h("div",{class:t.class+" media-middle"},h(frappe.components.Avatar,Object.assign({},e,{title:e.title,image:e.image,size:e.size,abbr:e.abbr})));return h("div",{class:"media",style:"media-right"===t.class?{"text-align":"right"}:null},"media-left"===t.class?a:null,h("div",{class:"media-body"},h("div",{class:"media-heading ellipsis small",style:"max-width: "+(e.width_title||"100%")+" display: inline-block"},e.title),e.content?h("div","",h("small","",e.content)):null,e.subtitle?h("div",{class:"media-subtitle small"},h("small",{class:"text-muted"},e.subtitle)):null),"media-right"===t.class?a:null)}},frappe.Chat.Widget.MediaProfile.POSITION={left:{class:"media-left"},right:{class:"media-right"}},frappe.Chat.Widget.Room=class extends Component{render(){var e=this.props,t=(this.state,[{match:/@(\w*)$/,search:function(t,a){if("Group"===e.type){var r=t.slice(1);a([].concat(frappe._.as_array(e.owner),e.users).filter(function(e){return e!==frappe.session.user&&0===e.indexOf(r)}))}},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:frappe.user.full_name(e),image:frappe.user.image(e),size:"small"})}},{match:/:([a-z]*)$/,search:function(e,t){frappe.chat.emoji(function(a){for(var r=e.slice(1),n=[],o=0,s=a;o<s.length;o+=1)for(var i=s[o],p=0,c=i.aliases;p<c.length;p+=1){var l=c[p];0===l.indexOf(r)&&n.push({name:l,value:i.emoji})}t(n)})},content:function(e){return e.value},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:e.name,abbr:e.value,size:"small"})}}]),a=frappe._.compact([!frappe._.is_mobile()&&{icon:"camera",label:"Camera",onclick:function(){var e=new frappe.ui.Capture({animate:!1,error:!0});e.show(),e.submit(function(e){})}},{icon:"file",label:"File",onclick:function(){frappe.upload.make({args:{doctype:"Chat Room",docname:e.name},callback:function(t,a,r){var n=r.file_url,o=r.filename;frappe.chat.message.send(e.name,{path:n,name:o},"File")}})}}]);if("Guest"!==frappe.session.user&&e.messages){e.messages=frappe._.as_array(e.messages);for(var r=0,n=e.messages;r<n.length;r+=1){var o=n[r];if(o.seen.includes(frappe.session.user))break;frappe.chat.message.seen(o.name)}}return h("div",{class:"panel panel-default\n\t\t\t\t"+(e.name?"panel-bg":"")+"\n\t\t\t\t"+(e.layout===frappe.Chat.Layout.PAGE||frappe._.is_mobile()?"panel-span":""),style:e.layout===frappe.Chat.Layout.PAGE&&{width:"75%",left:"25%","box-shadow":"none"}},e.name&&h(frappe.Chat.Widget.Room.Header,Object.assign({},e,{on_back:e.destroy})),e.name?frappe._.is_empty(e.messages)?h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 48px"}),h("p","",__("Start a conversation."))))):h(frappe.chat.component.ChatList,{messages:e.messages}):h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 125px"}),h("p","",__("Select a chat to start messaging."))))),e.name?h("div",{class:"chat-room-footer"},h(frappe.chat.component.ChatForm,{actions:a,onchange:function(){frappe.chat.message.typing(e.name)},onsubmit:function(t){frappe.chat.message.send(e.name,t)},hint:t})):null)}},frappe.Chat.Widget.Room.Header=class extends Component{render(){var e=this.props,t={};if(["Group","Visitor"].includes(e.type))if(t.route="Form/Chat Room/"+e.name,t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing))t.subtitle="Group"===e.type?__(e.users.length+" "+frappe._.pluralize("member",e.users.length)):"";else{e.typing=frappe._.as_array(e.typing);var a=e.typing.map(function(e){return frappe.user.first_name(e)});t.subtitle=a.join(", ")+" typing..."}else{var r=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;t.route="Form/User/"+r,t.title=frappe.user.full_name(r),t.image=frappe.user.image(r),frappe._.is_empty(e.typing)||(t.subtitle="typing...")}var n=e.layout===frappe.Chat.Layout.POPPER||frappe._.is_mobile();return h("div",{class:"panel-heading",style:{height:"50px"}},h("div",{class:"level"},n&&"Guest"!==frappe.session.user?h(frappe.components.Button,{class:"btn-back",onclick:e.on_back},h(frappe.components.Octicon,{type:"chevron-left"})):null,h("div","",h("div",{class:"panel-title"},h("div",{class:"cursor-pointer",onclick:function(){frappe.set_route(t.route)}},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t))))),h("div",{class:n?"col-xs-1":"col-xs-3"},h("div",{class:"text-right"}))))}},frappe.chat.component.ChatList=class extends Component{on_mounted(){this.$element=$(".frappe-chat").find(".chat-list"),this.$element.scrollTop(this.$element[0].scrollHeight)}on_updated(){this.$element.scrollTop(this.$element[0].scrollHeight)}render(){for(var e=[],t=0;t<this.props.messages.length;++t){var a=this.props.messages[t];a.user,frappe.session.user;0!==t&&frappe.datetime.equal(a.creation,this.props.messages[t-1].creation,"day")||e.push({type:"Notification",content:a.creation.format("MMMM DD")}),e.push(a)}return h("div",{class:"chat-list list-group"},frappe._.is_empty(e)?null:e.map(function(e){return h(frappe.chat.component.ChatList.Item,Object.assign({},e))}))}},frappe.chat.component.ChatList.Item=class extends Component{render(){var e=this.props,t=e.user===frappe.session.user,a=e.content;return h("div",{class:"chat-list-item list-group-item"},"Notification"===e.type?h("div",{class:"chat-list-notification"},h("div",{class:"chat-list-notification-content"},a)):h("div",{class:t?"text-right":""},"Group"!==e.room_type||t?null:h(frappe.components.Avatar,{title:frappe.user.full_name(e.user),image:frappe.user.image(e.user)}),h(frappe.chat.component.ChatBubble,e)))}},frappe.chat.component.ChatBubble=class extends Component{constructor(e){super(e),this.onclick=this.onclick.bind(this)}onclick(){var e=this.props;e.user===frappe.session.user&&frappe.quick_edit("Chat Message",e.name,function(e){})}render(){var e=this.props,t=e.creation.format("hh:mm A"),a=e.user===frappe.session.user,r=!frappe._.is_empty(e.seen)&&!e.seen.includes(frappe.session.user),n=e.content;return h("div",{class:"chat-bubble "+(e.groupable?"chat-groupable":"")+" chat-bubble-"+(a?"r":"l"),onclick:this.onclick},"Group"!==e.room_type||a?null:h("div",{class:"chat-bubble-author"},h("a",{onclick:function(){frappe.set_route("Form/User/"+e.user)}},frappe.user.full_name(e.user))),h("div",{class:"chat-bubble-content"},h("small","","File"===e.type?h("a",{class:"no-decoration",href:n.path,target:"_blank"},h(frappe.components.FontAwesome,{type:"file",fixed:!0})," "+n.name):n)),h("div",{class:"chat-bubble-meta"},h("span",{class:"chat-bubble-creation"},t),a&&r?h("span",{class:"chat-bubble-check"},h(frappe.components.Octicon,{type:"check"})):null))}},frappe.chat.component.ChatForm=class extends Component{constructor(e){super(e),this.onchange=this.onchange.bind(this),this.onsubmit=this.onsubmit.bind(this),this.hint=this.hint.bind(this),this.state=frappe.chat.component.ChatForm.defaultState}onchange(e){var t,a=this.props,r=this.state,n=e.target.value;this.set_state(((t={})[e.target.name]=n,t)),a.onchange(r),this.hint(n)}hint(e){var t=this,a=this.props;this.state;if(a.hint){var r=e.split(" "),n=r.slice(0,r.length-1),o=r[r.length-1];if(o){a.hint=frappe._.as_array(a.hint);var s=a.hint.find(function(e){return e.match.test(o)});s?s.search(o,function(e){var a=e.map(function(e){var t=o.replace(s.match,s.content?s.content(e):e),a=(n.join(" ")+" "+t).trim();return e={component:s.component(e),content:a}}).slice(0,s.max||5);t.set_state({hints:a})}):this.set_state({hints:[]})}else this.set_state({hints:[]})}}onsubmit(e){e.preventDefault(),this.state.content&&(this.props.onsubmit(this.state.content),this.set_state({content:null}))}render(){var e=this,t=this.props,a=this.state;return h("div",{class:"chat-form"},a.hints.length?h("ul",{class:"hint-list list-group"},a.hints.map(function(t){return h("li",{class:"hint-list-item list-group-item"},h("a",{href:"javascript:void(0)",onclick:function(){e.set_state({content:t.content,hints:[]})}},t.component))})):null,h("form",{oninput:this.onchange,onsubmit:this.onsubmit},h("div",{class:"input-group input-group-lg"},frappe._.is_empty(t.actions)?null:h("div",{class:"input-group-btn dropup"},h(frappe.components.Button,{class:"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.FontAwesome,{class:"text-muted",type:"paperclip",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-left",onclick:function(e){return e.stopPropagation()}},!frappe._.is_empty(t.actions)&&t.actions.map(function(e){return h("li",null,h("a",{onclick:e.onclick},h(frappe.components.FontAwesome,{type:e.icon,fixed:!0})," "+e.label))}))),h("textarea",{class:"form-control",name:"content",value:a.content,placeholder:"Type a message",autofocus:!0,onkeypress:function(t){t.which!==frappe.ui.keycode.RETURN||t.shiftKey||e.onsubmit(t)}}),h("div",{class:"input-group-btn"},h(frappe.components.Button,{onclick:this.onsubmit},h(frappe.components.FontAwesome,{class:frappe._.is_empty(a.content)?"text-muted":"text-primary",type:"send",fixed:!0}))))))}},frappe.chat.component.ChatForm.defaultState={content:null,hints:[]},frappe.chat.component.EmojiPicker=class extends Component{render(){var e=this.props;return h("div",{class:"frappe-chat-emoji dropup "+e.class},h(frappe.components.Button,{type:"primary",class:"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.FontAwesome,{type:"smile-o",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-right",onclick:function(e){return e.stopPropagation()}},h("div",{class:"panel panel-default"},h(frappe.chat.component.EmojiPicker.List))))}},frappe.chat.component.EmojiPicker.List=class extends Component{render(){this.props;return h("div",{class:"list-group"})}},frappe.provide("frappe._"),frappe._.platform=function(){var e=navigator.appVersion;return e.includes("Win")?"Windows":e.includes("Mac")?"Darwin":e.includes("X11")?"UNIX":e.includes("Linux")?"Linux":void 0},frappe.provide("frappe.assets"),frappe.assets.image=function(e,t){return void 0===t&&(t="frappe"),"/assets/"+t+"/images/"+e},frappe.provide("frappe.boot"),frappe.provide("frappe.browser"),frappe.browser.Notification="Notification"in window,frappe.notify=function(e,t){frappe.log=frappe.Logger.get("frappe.notify");var a={icon:frappe.assets.image("favicon.png","frappe"),lang:frappe.boot.lang||"en"};t=Object.assign({},a,t),frappe.browser.Notification||frappe.log.error("ERROR: This browser does not support desktop notifications."),Notification.requestPermission(function(a){if("granted"===a)new Notification(e,t)})},frappe.chat.render=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1),frappe.log.info((e?"Enable":"Disable")+" Chat for User.");var a="desk"in frappe;if(a){var r=$(".navbar .frappe-chat-dropdown");if(frappe.utils.is_empty(r.has(".frappe-chat-toggle"))){var n=$('\n\t\t\t\t<a class="dropdown-toggle frappe-chat-toggle" data-toggle="dropdown">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i class="octicon octicon-comment-discussion"/>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t');r.addClass("dropdown hidden"),r.html(n)}e?r.removeClass("hidden"):r.addClass("hidden")}if((!frappe.chatter||t)&&(frappe.chatter=new frappe.Chat({target:a?".navbar .frappe-chat-toggle":null}),e))if("Guest"!==frappe.session.user||a)frappe.chatter.render();else{frappe.store=frappe.Store.get("frappe.chat");var o=frappe.store.get("guest_token");frappe.log.info("Local Guest Token - "+o);var s=function(e){return new Promise(function(t){frappe.chat.room.create("Visitor",e).then(function(e){frappe.log.info("Visitor Room Created: "+e.name),frappe.chat.room.subscribe(e.name);var a=e;frappe.chat.room.history(e.name).then(function(e){return Object.assign({},a,{messages:e})}).then(function(e){t(e)})})})};o?s(o).then(function(e){frappe.chatter.render({room:e})}):frappe.chat.website.token().then(function(e){frappe.log.info("Generated Guest Token - "+e),frappe.store.set("guest_token",e),s(e).then(function(e){frappe.chatter.render({room:e})})})}},frappe.chat.setup=function(){frappe.log=frappe.Logger.get("frappe.chat"),frappe.log.info("Setting up frappe.chat"),frappe.log.warn("TODO: frappe.chat.<object> requires a storage."),"Guest"!==frappe.session.user?(frappe.log.info("Creating a Chat Profile."),frappe.chat.profile.create("enable_chat").then(function(e){var t=e.enable_chat;if(frappe.log.info("Chat Profile created for User "+frappe.session.user+"."),"desk"in frappe){var a=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t;frappe.chat.render(a)}}),frappe.chat.profile.on.update(function(e,t){if(e===frappe.session.user&&"enable_chat"in t){frappe.log.warn("Chat Profile update (Enable Chat - "+Boolean(t.enable_chat)+")");var a=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t.enable_chat;frappe.chat.render(a)}})):(frappe.log.info("Retrieving Chat Website Settings."),frappe.chat.website.settings(["socketio","enable","enable_from","enable_to"]).then(function(e){frappe.log.info("Chat Website Setting - "+JSON.stringify(e)),frappe.log.info("Chat Website Setting - "+(e.enable?"Enable":"Disable"));var t=e.enable;e.enable_from&&e.enable_to&&(frappe.log.info("Enabling Chat Schedule - "+e.enable_from.format()+" : "+e.enable_to.format()),t=new frappe.datetime.range(e.enable_from,e.enable_to).contains(frappe.datetime.now()));t&&(frappe.log.info("Initializing Socket.IO"),frappe.socketio.init(e.socketio.port)),frappe.chat.render(t)}))},$(document).on("ready toolbar_setup",function(){frappe.chat.setup()})}();
//# sourceMappingURL=chat.js.map
