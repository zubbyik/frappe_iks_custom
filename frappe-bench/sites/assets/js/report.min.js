var Rollup=function(exports){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var clusterize_min=createCommonjsModule(function(e){e.exports=function(){function e(e,t,r){return t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent("on"+e,r)}function t(e,t,r){return t.removeEventListener?t.removeEventListener(e,r,!1):t.detachEvent("on"+e,r)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}var i=function(){for(var e=3,t=document.createElement("b"),r=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",r[0];);return 4<e?e:document.documentMode}(),o=navigator.platform.toLowerCase().indexOf("mac")+1,a=function(n){if(!(this instanceof a))return new a(n);var i=this,s={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};i.options={};for(var l,d="rows_in_block blocks_in_cluster show_no_data_row no_data_class no_data_text keep_parity tag callbacks".split(" "),c=0;l=d[c];c++)i.options[l]=void 0!==n[l]&&null!=n[l]?n[l]:s[l];for(s=["scroll","content"],c=0;d=s[c];c++)if(i[d+"_elem"]=n[d+"Id"]?document.getElementById(n[d+"Id"]):n[d+"Elem"],!i[d+"_elem"])throw Error("Error! Could not find "+d+" element");i.content_elem.hasAttribute("tabindex")||i.content_elem.setAttribute("tabindex",0);var u=r(n.rows)?n.rows:i.fetchMarkup(),h={};n=i.scroll_elem.scrollTop,i.insertToDOM(u,h),i.scroll_elem.scrollTop=n;var p=!1,f=0,_=!1,m=function(){o&&(_||(i.content_elem.style.pointerEvents="none"),_=!0,clearTimeout(f),f=setTimeout(function(){i.content_elem.style.pointerEvents="auto",_=!1},50)),p!=(p=i.getClusterNum())&&i.insertToDOM(u,h),i.options.callbacks.scrollingProgress&&i.options.callbacks.scrollingProgress(i.getScrollProgress())},g=0,v=function(){clearTimeout(g),g=setTimeout(i.refresh,100)};e("scroll",i.scroll_elem,m),e("resize",window,v),i.destroy=function(e){t("scroll",i.scroll_elem,m),t("resize",window,v),i.html((e?i.generateEmptyRow():u).join(""))},i.refresh=function(e){(i.getRowsHeight(u)||e)&&i.update(u)},i.update=function(e){u=r(e)?e:[],e=i.scroll_elem.scrollTop,u.length*i.options.item_height<e&&(p=i.scroll_elem.scrollTop=0),i.insertToDOM(u,h),i.scroll_elem.scrollTop=e},i.clear=function(){i.update([])},i.getRowsAmount=function(){return u.length},i.getScrollProgress=function(){return this.options.scroll_top/(u.length*this.options.item_height)*100||0};var w=function(e,t){var n=r(t)?t:[];n.length&&(u="append"==e?u.concat(n):n.concat(u),i.insertToDOM(u,h))};i.append=function(e){w("append",e)},i.prepend=function(e){w("prepend",e)}};return a.prototype={constructor:a,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(e,t){var r=this.options;r.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(i&&9>=i&&!r.tag&&(r.tag=e[0].match(/<([^>\s/]*)/)[1].toLowerCase()),1>=this.content_elem.children.length&&(t.data=this.html(e[0]+e[0]+e[0])),r.tag||(r.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))},getRowsHeight:function(e){var t=this.options,r=t.item_height;if(t.cluster_height=0,e.length){var i=(e=this.content_elem.children)[Math.floor(e.length/2)];return t.item_height=i.offsetHeight,"tr"==t.tag&&"collapse"!=n("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(n("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag&&(e=parseInt(n("marginTop",i),10)||0,i=parseInt(n("marginBottom",i),10)||0,t.item_height+=Math.max(e,i)),t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,r!=t.item_height}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t,r=document.createElement(e.tag),n=document.createTextNode(e.no_data_text);return r.className=e.no_data_class,"tr"==e.tag&&((t=document.createElement("td")).colSpan=100,t.appendChild(n)),r.appendChild(t||n),[r.outerHTML]},generate:function(e,t){var r=this.options;if((a=e.length)<r.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:a?e:this.generateEmptyRow()};var n=Math.max((r.rows_in_cluster-r.rows_in_block)*t,0),i=n+r.rows_in_cluster,o=Math.max(n*r.item_height,0),a=(r=Math.max((a-i)*r.item_height,0),[]),s=n;for(1>o&&s++;n<i;n++)e[n]&&a.push(e[n]);return{top_offset:o,bottom_offset:r,rows_above:s,rows:a}},renderExtraTag:function(e,t){var r=document.createElement(this.options.tag);return r.className=["clusterize-extra-row","clusterize-"+e].join(" "),t&&(r.style.height=t+"px"),r.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var r=this.generate(e,this.getClusterNum()),n=r.rows.join(""),i=this.checkChanges("data",n,t),o=this.checkChanges("top",r.top_offset,t),a=this.checkChanges("bottom",r.bottom_offset,t),s=this.options.callbacks,l=[];i||o?(r.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",r.top_offset))),l.push(n),r.bottom_offset&&l.push(this.renderExtraTag("bottom-space",r.bottom_offset)),s.clusterWillChange&&s.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",r.rows_above),s.clusterChanged&&s.clusterChanged()):a&&(this.content_elem.lastChild.style.height=r.bottom_offset+"px")},html:function(e){var t=this.content_elem;if(i&&9>=i&&"tr"==this.options.tag){var r=document.createElement("div");for(r.innerHTML="<table><tbody>"+e+"</tbody></table>";e=t.lastChild;)t.removeChild(e);for(r=this.getChildNodes(r.firstChild.firstChild);r.length;)t.appendChild(r.shift())}else t.innerHTML=e},getChildNodes:function(e){for(var t=[],r=0,n=(e=e.children).length;r<n;r++)t.push(e[r]);return t},checkChanges:function(e,t,r){var n=t!=r[e];return r[e]=t,n}},a}()});frappe.views.ReportFactory=class extends frappe.views.Factory{make(e){var t=["List",e[1],"Report"];e[2]&&t.push(e[2]),frappe.set_route(t)}};var Sortable=createCommonjsModule(function(e){var t;t=function(){if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,r,n,i,o,a,s,l,d,c,u,h,p,f,_,m,g,v,w,b,y={},C=/\s+/g,x=/left|right|inline/,k="Sortable"+(new Date).getTime(),R=window,S=R.document,T=R.parseInt,I=R.setTimeout,E=R.jQuery||R.Zepto,$=R.Polymer,D=!1,M="draggable"in S.createElement("div"),H=!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&((b=S.createElement("x")).style.cssText="pointer-events:auto","auto"===b.style.pointerEvents),L=!1,j=Math.abs,O=Math.min,A=[],N=[],F=ne(function(e,t,r){if(r&&t.scroll){var n,i,o,a,c,u,h=r[k],p=t.scrollSensitivity,f=t.scrollSpeed,_=e.clientX,m=e.clientY,g=window.innerWidth,v=window.innerHeight;if(l!==r&&(s=t.scroll,l=r,d=t.scrollFn,!0===s)){s=r;do{if(s.offsetWidth<s.scrollWidth||s.offsetHeight<s.scrollHeight)break}while(s=s.parentNode)}s&&(n=s,i=s.getBoundingClientRect(),o=(j(i.right-_)<=p)-(j(i.left-_)<=p),a=(j(i.bottom-m)<=p)-(j(i.top-m)<=p)),o||a||(a=(v-m<=p)-(m<=p),((o=(g-_<=p)-(_<=p))||a)&&(n=R)),y.vx===o&&y.vy===a&&y.el===n||(y.el=n,y.vx=o,y.vy=a,clearInterval(y.pid),n&&(y.pid=setInterval(function(){if(u=a?a*f:0,c=o?o*f:0,"function"==typeof d)return d.call(h,c,u,e);n===R?R.scrollTo(R.pageXOffset+c,R.pageYOffset+u):(n.scrollTop+=u,n.scrollLeft+=c)},24)))}},30),P=function(e){function t(e,t){return void 0!==e&&!0!==e||(e=r.name),"function"==typeof e?e:function(r,n){var i=n.options.group.name;return t?e:e&&(e.join?e.indexOf(i)>-1:i==e)}}var r={},n=e.group;n&&"object"==typeof n||(n={name:n}),r.name=n.name,r.checkPull=t(n.pull,!0),r.checkPut=t(n.put),r.revertClone=n.revertClone,e.group=r};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){D={capture:!1,passive:!1}}}))}catch(e){}function W(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=t=ie({},t),e[k]=this;var r={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==W.supportPointer};for(var n in r)!(n in t)&&(t[n]=r[n]);for(var i in P(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&M,V(e,"mousedown",this._onTapStart),V(e,"touchstart",this._onTapStart),t.supportPointer&&V(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(V(e,"dragover",this),V(e,"dragenter",this)),N.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function B(t,r){"clone"!==t.lastPullMode&&(r=!0),n&&n.state!==r&&(G(n,"display",r?"none":""),r||n.state&&(t.options.group.revertClone?(i.insertBefore(n,o),t._animate(e,n)):i.insertBefore(n,e)),n.state=r)}function z(e,t,r){if(e){r=r||S;do{if(">*"===t&&e.parentNode===r||re(e,t))return e}while(e=q(e))}return null}function q(e){var t=e.host;return t&&t.nodeType?t:e.parentNode}function V(e,t,r){e.addEventListener(t,r,D)}function Y(e,t,r){e.removeEventListener(t,r,D)}function X(e,t,r){if(e)if(e.classList)e.classList[r?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(C," ").replace(" "+t+" "," ");e.className=(n+(r?" "+t:"")).replace(C," ")}}function G(e,t,r){var n=e&&e.style;if(n){if(void 0===r)return S.defaultView&&S.defaultView.getComputedStyle?r=S.defaultView.getComputedStyle(e,""):e.currentStyle&&(r=e.currentStyle),void 0===t?r:r[t];t in n||(t="-webkit-"+t),n[t]=r+("string"==typeof r?"":"px")}}function U(e,t,r){if(e){var n=e.getElementsByTagName(t),i=0,o=n.length;if(r)for(;i<o;i++)r(n[i],i);return n}return[]}function K(e,t,r,i,o,a,s,l){e=e||t[k];var d=S.createEvent("Event"),c=e.options,u="on"+r.charAt(0).toUpperCase()+r.substr(1);d.initEvent(r,!0,!0),d.to=o||t,d.from=a||t,d.item=i||t,d.clone=n,d.oldIndex=s,d.newIndex=l,t.dispatchEvent(d),c[u]&&c[u].call(e,d)}function Q(e,t,r,n,i,o,a,s){var l,d,c=e[k],u=c.options.onMove;return(l=S.createEvent("Event")).initEvent("move",!0,!0),l.to=t,l.from=e,l.dragged=r,l.draggedRect=n,l.related=i||t,l.relatedRect=o||t.getBoundingClientRect(),l.willInsertAfter=s,e.dispatchEvent(l),u&&(d=u.call(c,l,a)),d}function J(e){e.draggable=!1}function Z(){L=!1}function ee(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,r=t.length,n=0;r--;)n+=t.charCodeAt(r);return n.toString(36)}function te(e,t){var r=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"===e.nodeName.toUpperCase()||">*"!==t&&!re(e,t)||r++;return r}function re(e,t){if(e){var r=(t=t.split(".")).shift().toUpperCase(),n=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");return!(""!==r&&e.nodeName.toUpperCase()!=r||t.length&&((" "+e.className+" ").match(n)||[]).length!=t.length)}return!1}function ne(e,t){var r,n;return function(){void 0===r&&(r=arguments,n=this,I(function(){1===r.length?e.call(n,r[0]):e.apply(n,r),r=void 0},t))}}function ie(e,t){if(e&&t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function oe(e){return $&&$.dom?$.dom(e).cloneNode(!0):E?E(e).clone(!0)[0]:e.cloneNode(!0)}function ae(e){return I(e,0)}function se(e){return clearTimeout(e)}return W.prototype={constructor:W,_onTapStart:function(t){var r,n=this,i=this.el,o=this.options,s=o.preventOnFilter,l=t.type,d=t.touches&&t.touches[0],c=(d||t).target,u=t.target.shadowRoot&&t.path&&t.path[0]||c,h=o.filter;if(function(e){var t=e.getElementsByTagName("input"),r=t.length;for(;r--;){var n=t[r];n.checked&&A.push(n)}}(i),!e&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||o.disabled)&&!u.isContentEditable&&(c=z(c,o.draggable,i))&&a!==c){if(r=te(c,o.draggable),"function"==typeof h){if(h.call(this,t,c,this))return K(n,u,"filter",c,i,i,r),void(s&&t.preventDefault())}else if(h&&(h=h.split(",").some(function(e){if(e=z(u,e.trim(),i))return K(n,e,"filter",c,i,i,r),!0})))return void(s&&t.preventDefault());o.handle&&!z(u,o.handle,i)||this._prepareDragStart(t,d,c,r)}},_prepareDragStart:function(r,n,s,l){var d,c=this,u=c.el,h=c.options,f=u.ownerDocument;s&&!e&&s.parentNode===u&&(g=r,i=u,t=(e=s).parentNode,o=e.nextSibling,a=s,_=h.group,p=l,this._lastX=(n||r).clientX,this._lastY=(n||r).clientY,e.style["will-change"]="all",d=function(){c._disableDelayedDrag(),e.draggable=c.nativeDraggable,X(e,h.chosenClass,!0),c._triggerDragStart(r,n),K(c,i,"choose",e,i,i,p)},h.ignore.split(",").forEach(function(t){U(e,t.trim(),J)}),V(f,"mouseup",c._onDrop),V(f,"touchend",c._onDrop),V(f,"touchcancel",c._onDrop),V(f,"selectstart",c),h.supportPointer&&V(f,"pointercancel",c._onDrop),h.delay?(V(f,"mouseup",c._disableDelayedDrag),V(f,"touchend",c._disableDelayedDrag),V(f,"touchcancel",c._disableDelayedDrag),V(f,"mousemove",c._disableDelayedDrag),V(f,"touchmove",c._disableDelayedDrag),h.supportPointer&&V(f,"pointermove",c._disableDelayedDrag),c._dragStartTimer=I(d,h.delay)):d())},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),Y(e,"mouseup",this._disableDelayedDrag),Y(e,"touchend",this._disableDelayedDrag),Y(e,"touchcancel",this._disableDelayedDrag),Y(e,"mousemove",this._disableDelayedDrag),Y(e,"touchmove",this._disableDelayedDrag),Y(e,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(t,r){(r=r||("touch"==t.pointerType?t:null))?(g={target:e,clientX:r.clientX,clientY:r.clientY},this._onDragStart(g,"touch")):this.nativeDraggable?(V(e,"dragend",this),V(i,"dragstart",this._onDragStart)):this._onDragStart(g,!0);try{S.selection?ae(function(){S.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(){if(i&&e){var t=this.options;X(e,t.ghostClass,!0),X(e,t.dragClass,!1),W.active=this,K(this,i,"start",e,i,i,p)}else this._nulling()},_emulateDragOver:function(){if(v){if(this._lastX===v.clientX&&this._lastY===v.clientY)return;this._lastX=v.clientX,this._lastY=v.clientY,H||G(r,"display","none");var e=S.elementFromPoint(v.clientX,v.clientY),t=e,n=N.length;if(e&&e.shadowRoot&&(t=e=e.shadowRoot.elementFromPoint(v.clientX,v.clientY)),t)do{if(t[k]){for(;n--;)N[n]({clientX:v.clientX,clientY:v.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);H||G(r,"display","")}},_onTouchMove:function(e){if(g){var t=this.options,n=t.fallbackTolerance,i=t.fallbackOffset,o=e.touches?e.touches[0]:e,a=o.clientX-g.clientX+i.x,s=o.clientY-g.clientY+i.y,l=e.touches?"translate3d("+a+"px,"+s+"px,0)":"translate("+a+"px,"+s+"px)";if(!W.active){if(n&&O(j(o.clientX-this._lastX),j(o.clientY-this._lastY))<n)return;this._dragStarted()}this._appendGhost(),w=!0,v=o,G(r,"webkitTransform",l),G(r,"mozTransform",l),G(r,"msTransform",l),G(r,"transform",l),e.preventDefault()}},_appendGhost:function(){if(!r){var t,n=e.getBoundingClientRect(),o=G(e),a=this.options;X(r=e.cloneNode(!0),a.ghostClass,!1),X(r,a.fallbackClass,!0),X(r,a.dragClass,!0),G(r,"top",n.top-T(o.marginTop,10)),G(r,"left",n.left-T(o.marginLeft,10)),G(r,"width",n.width),G(r,"height",n.height),G(r,"opacity","0.8"),G(r,"position","fixed"),G(r,"zIndex","100000"),G(r,"pointerEvents","none"),a.fallbackOnBody&&S.body.appendChild(r)||i.appendChild(r),t=r.getBoundingClientRect(),G(r,"width",2*n.width-t.width),G(r,"height",2*n.height-t.height)}},_onDragStart:function(t,r){var o=this,a=t.dataTransfer,s=o.options;o._offUpEvents(),_.checkPull(o,o,e,t)&&((n=oe(e)).draggable=!1,n.style["will-change"]="",G(n,"display","none"),X(n,o.options.chosenClass,!1),o._cloneId=ae(function(){i.insertBefore(n,e),K(o,i,"clone",e)})),X(e,s.dragClass,!0),r?("touch"===r?(V(S,"touchmove",o._onTouchMove),V(S,"touchend",o._onDrop),V(S,"touchcancel",o._onDrop),s.supportPointer&&(V(S,"pointermove",o._onTouchMove),V(S,"pointerup",o._onDrop))):(V(S,"mousemove",o._onTouchMove),V(S,"mouseup",o._onDrop)),o._loopId=setInterval(o._emulateDragOver,50)):(a&&(a.effectAllowed="move",s.setData&&s.setData.call(o,a,e)),V(S,"drop",o),o._dragStartId=ae(o._dragStarted))},_onDragOver:function(a){var s,l,d,p,f=this.el,g=this.options,v=g.group,b=W.active,y=_===v,C=!1,R=g.sort;if(void 0!==a.preventDefault&&(a.preventDefault(),!g.dragoverBubble&&a.stopPropagation()),!e.animated&&(w=!0,b&&!g.disabled&&(y?R||(p=!i.contains(e)):m===this||(b.lastPullMode=_.checkPull(this,b,e,a))&&v.checkPut(this,b,e,a))&&(void 0===a.rootEl||a.rootEl===this.el))){if(F(a,g,this.el),L)return;if(s=z(a.target,g.draggable,f),l=e.getBoundingClientRect(),m!==this&&(m=this,C=!0),p)return B(b,!0),t=i,void(n||o?i.insertBefore(e,n||o):R||i.appendChild(e));if(0===f.children.length||f.children[0]===r||f===a.target&&function(e,t){var r=e.lastElementChild.getBoundingClientRect();return t.clientY-(r.top+r.height)>5||t.clientX-(r.left+r.width)>5}(f,a)){if(0!==f.children.length&&f.children[0]!==r&&f===a.target&&(s=f.lastElementChild),s){if(s.animated)return;d=s.getBoundingClientRect()}B(b,y),!1!==Q(i,f,e,l,s,d,a)&&(e.contains(f)||(f.appendChild(e),t=f),this._animate(l,e),s&&this._animate(d,s))}else if(s&&!s.animated&&s!==e&&void 0!==s.parentNode[k]){c!==s&&(c=s,u=G(s),h=G(s.parentNode));var S=(d=s.getBoundingClientRect()).right-d.left,T=d.bottom-d.top,E=x.test(u.cssFloat+u.display)||"flex"==h.display&&0===h["flex-direction"].indexOf("row"),$=s.offsetWidth>e.offsetWidth,D=s.offsetHeight>e.offsetHeight,M=(E?(a.clientX-d.left)/S:(a.clientY-d.top)/T)>.5,H=s.nextElementSibling,j=!1;if(E){var O=e.offsetTop,A=s.offsetTop;j=O===A?s.previousElementSibling===e&&!$||M&&$:s.previousElementSibling===e||e.previousElementSibling===s?(a.clientY-d.top)/T>.5:A>O}else C||(j=H!==e&&!D||M&&D);var N=Q(i,f,e,l,s,d,a,j);!1!==N&&(1!==N&&-1!==N||(j=1===N),L=!0,I(Z,30),B(b,y),e.contains(f)||(j&&!H?f.appendChild(e):s.parentNode.insertBefore(e,j?H:s)),t=e.parentNode,this._animate(l,e),this._animate(d,s))}}},_animate:function(e,t){var r=this.options.animation;if(r){var n=t.getBoundingClientRect();1===e.nodeType&&(e=e.getBoundingClientRect()),G(t,"transition","none"),G(t,"transform","translate3d("+(e.left-n.left)+"px,"+(e.top-n.top)+"px,0)"),t.offsetWidth,G(t,"transition","all "+r+"ms"),G(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=I(function(){G(t,"transition",""),G(t,"transform",""),t.animated=!1},r)}},_offUpEvents:function(){var e=this.el.ownerDocument;Y(S,"touchmove",this._onTouchMove),Y(S,"pointermove",this._onTouchMove),Y(e,"mouseup",this._onDrop),Y(e,"touchend",this._onDrop),Y(e,"pointerup",this._onDrop),Y(e,"touchcancel",this._onDrop),Y(e,"pointercancel",this._onDrop),Y(e,"selectstart",this)},_onDrop:function(a){var s=this.el,l=this.options;clearInterval(this._loopId),clearInterval(y.pid),clearTimeout(this._dragStartTimer),se(this._cloneId),se(this._dragStartId),Y(S,"mouseover",this),Y(S,"mousemove",this._onTouchMove),this.nativeDraggable&&(Y(S,"drop",this),Y(s,"dragstart",this._onDragStart)),this._offUpEvents(),a&&(w&&(a.preventDefault(),!l.dropBubble&&a.stopPropagation()),r&&r.parentNode&&r.parentNode.removeChild(r),i!==t&&"clone"===W.active.lastPullMode||n&&n.parentNode&&n.parentNode.removeChild(n),e&&(this.nativeDraggable&&Y(e,"dragend",this),J(e),e.style["will-change"]="",X(e,this.options.ghostClass,!1),X(e,this.options.chosenClass,!1),K(this,i,"unchoose",e,t,i,p),i!==t?(f=te(e,l.draggable))>=0&&(K(null,t,"add",e,t,i,p,f),K(this,i,"remove",e,t,i,p,f),K(null,t,"sort",e,t,i,p,f),K(this,i,"sort",e,t,i,p,f)):e.nextSibling!==o&&(f=te(e,l.draggable))>=0&&(K(this,i,"update",e,t,i,p,f),K(this,i,"sort",e,t,i,p,f)),W.active&&(null!=f&&-1!==f||(f=p),K(this,i,"end",e,t,i,p,f),this.save()))),this._nulling()},_nulling:function(){i=e=t=r=o=n=a=s=l=g=v=w=f=c=u=m=_=W.active=null,A.forEach(function(e){e.checked=!0}),A.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragover":case"dragenter":e&&(this._onDragOver(t),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.preventDefault()}(t));break;case"mouseover":this._onDrop(t);break;case"selectstart":t.preventDefault()}},toArray:function(){for(var e,t=[],r=this.el.children,n=0,i=r.length,o=this.options;n<i;n++)z(e=r[n],o.draggable,this.el)&&t.push(e.getAttribute(o.dataIdAttr)||ee(e));return t},sort:function(e){var t={},r=this.el;this.toArray().forEach(function(e,n){var i=r.children[n];z(i,this.options.draggable,r)&&(t[e]=i)},this),e.forEach(function(e){t[e]&&(r.removeChild(t[e]),r.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return z(e,t||this.options.draggable,this.el)},option:function(e,t){var r=this.options;if(void 0===t)return r[e];r[e]=t,"group"===e&&P(r)},destroy:function(){var e=this.el;e[k]=null,Y(e,"mousedown",this._onTapStart),Y(e,"touchstart",this._onTapStart),Y(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Y(e,"dragover",this),Y(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),N.splice(N.indexOf(this._onDragOver),1),this._onDrop(),this.el=e=null}},V(S,"touchmove",function(e){W.active&&e.preventDefault()}),W.utils={on:V,off:Y,css:G,find:U,is:function(e,t){return!!z(e,t,e)},extend:ie,throttle:ne,closest:z,toggleClass:X,clone:oe,index:te,nextTick:ae,cancelNextTick:se},W.create=function(e,t){return new W(e,t)},W.version="1.7.0",W},e.exports=t()}),Sortable$1=Object.freeze({default:Sortable,__moduleExports:Sortable}),require$$0=Sortable$1&&Sortable||Sortable$1,frappeDatatable_cjs=createCommonjsModule(function(e){var t,r=(t=require$$0)&&"object"==typeof t&&"default"in t?t.default:t;function n(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}n.each=function(e,t){return"string"==typeof e?Array.from((t||document).querySelectorAll(e)):e||null},n.create=function(e,t){var r=document.createElement(e),i=function(e){var i=t[e];if("inside"===e)n(i).appendChild(r);else if("around"===e){var o=n(i);o.parentNode.insertBefore(r,o),r.appendChild(o)}else"styles"===e?"object"==typeof i&&Object.keys(i).map(function(e){r.style[e]=i[e]}):e in r?r[e]=i:r.setAttribute(e,i)};for(var o in t)i(o);return r},n.on=function(e,t,r,i){i?n.delegate(e,t,r,i):(i=r,n.bind(e,t,i))},n.off=function(e,t,r){e.removeEventListener(t,r)},n.bind=function(e,t,r){t.split(/\s+/).forEach(function(t){e.addEventListener(t,r)})},n.delegate=function(e,t,r,n){e.addEventListener(t,function(e){var t=e.target.closest(r);t&&(e.delegatedTarget=t,n.call(this,e,t))})},n.unbind=function(e,t){if(e){var r=function(r){var n=t[r];r.split(/\s+/).forEach(function(t){e.removeEventListener(t,n)})};for(var n in t)r(n)}},n.fire=function(e,t,r){var n=document.createEvent("HTMLEvents");for(var i in n.initEvent(t,!0,!0),r)n[i]=r[i];return e.dispatchEvent(n)},n.data=function(e,t){if(!t)return e.dataset;for(var r in t)e.dataset[r]=t[r]},n.style=function(e,t){if("string"==typeof t)return n.getStyle(e,t);Array.isArray(e)||(e=[e]),e.map(function(e){for(var r in t)e.style[r]=t[r]})},n.removeStyle=function(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.map(function(e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r];e.style[i]=""}})},n.getStyle=function(e,t){if(!t)return getComputedStyle(e);var r=getComputedStyle(e)[t];return["width","height"].includes(t)&&(r=parseFloat(r)),r},n.closest=function(e,t){return t?t.matches(e)?t:n.closest(e,t.parentNode):null},n.inViewport=function(e,t){var r=e.getBoundingClientRect(),n=r.top,i=r.left,o=r.bottom,a=r.right,s=t.getBoundingClientRect(),l=s.top,d=s.left,c=s.bottom,u=s.right;return n>=l&&i>=d&&o<=c&&a<=u},n.scrollTop=function(e,t){requestAnimationFrame(function(){e.scrollTop=t})},n.scrollbarSize=function(){return n.scrollBarSizeValue||(n.scrollBarSizeValue=function(){var e=document.createElement("div");n.style(e,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}()),n.scrollBarSizeValue},n.hasVerticalOverflow=function(e){return e.scrollHeight>e.offsetHeight+10},n.hasHorizontalOverflow=function(e){return e.scrollWidth>e.offsetWidth+10},n.measureTextWidth=function(e){var t=document.createElement("div");return t.style.position="absolute",t.style.visibility="hidden",t.style.height="auto",t.style.width="auto",t.style.whiteSpace="nowrap",t.innerText=e,document.body.appendChild(t),t.clientWidth+1};var i=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},o="undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function a(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}var s="object"==typeof o&&o&&o.Object===Object&&o,l="object"==typeof self&&self&&self.Object===Object&&self,d=s||l||Function("return this")(),c=function(){return d.Date.now()},u=d.Symbol,h=Object.prototype,p=h.hasOwnProperty,f=h.toString,_=u?u.toStringTag:void 0;var m=function(e){var t=p.call(e,_),r=e[_];try{e[_]=void 0}catch(e){}var n=f.call(e);return t?e[_]=r:delete e[_],n},g=Object.prototype.toString;var v=function(e){return g.call(e)},w="[object Null]",b="[object Undefined]",y=u?u.toStringTag:void 0;var C=function(e){return null==e?void 0===e?b:w:y&&y in Object(e)?m(e):v(e)};var x=function(e){return null!=e&&"object"==typeof e},k="[object Symbol]";var R=function(e){return"symbol"==typeof e||x(e)&&C(e)==k},S=NaN,T=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,$=/^0o[0-7]+$/i,D=parseInt;var M=function(e){if("number"==typeof e)return e;if(R(e))return S;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(T,"");var r=E.test(e);return r||$.test(e)?D(e.slice(2),r?2:8):I.test(e)?S:+e},H="Expected a function",L=Math.max,j=Math.min;var O=function(e,t,r){var n,o,a,s,l,d,u=0,h=!1,p=!1,f=!0;if("function"!=typeof e)throw new TypeError(H);function _(t){var r=n,i=o;return n=o=void 0,u=t,s=e.apply(i,r)}function m(e){var r=e-d;return void 0===d||r>=t||r<0||p&&e-u>=a}function g(){var e=c();if(m(e))return v(e);l=setTimeout(g,function(e){var r=t-(e-d);return p?j(r,a-(e-u)):r}(e))}function v(e){return l=void 0,f&&n?_(e):(n=o=void 0,s)}function w(){var e=c(),r=m(e);if(n=arguments,o=this,d=e,r){if(void 0===l)return function(e){return u=e,l=setTimeout(g,t),h?_(e):s}(d);if(p)return l=setTimeout(g,t),_(d)}return void 0===l&&(l=setTimeout(g,t)),s}return t=M(t)||0,i(r)&&(h=!!r.leading,a=(p="maxWait"in r)?L(M(r.maxWait)||0,t):a,f="trailing"in r?!!r.trailing:f),w.cancel=function(){void 0!==l&&clearTimeout(l),u=0,n=d=o=l=void 0},w.flush=function(){return void 0===l?s:v(c())},w},A="Expected a function";var N=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError(A);return i(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),O(e,t,{leading:n,maxWait:t,trailing:o})},F="[object AsyncFunction]",P="[object Function]",W="[object GeneratorFunction]",B="[object Proxy]";var z,q=function(e){if(!i(e))return!1;var t=C(e);return t==P||t==W||t==F||t==B},V=d["__core-js_shared__"],Y=(z=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"";var X=function(e){return!!Y&&Y in e},G=Function.prototype.toString;var U=function(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""},K=/^\[object .+?Constructor\]$/,Q=Function.prototype,J=Object.prototype,Z=Q.toString,ee=J.hasOwnProperty,te=RegExp("^"+Z.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var re=function(e){return!(!i(e)||X(e))&&(q(e)?te:K).test(U(e))};var ne=function(e,t){return null==e?void 0:e[t]};var ie=function(e,t){var r=ne(e,t);return re(r)?r:void 0},oe=ie(Object,"create");var ae=function(){this.__data__=oe?oe(null):{},this.size=0};var se=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},le="__lodash_hash_undefined__",de=Object.prototype.hasOwnProperty;var ce=function(e){var t=this.__data__;if(oe){var r=t[e];return r===le?void 0:r}return de.call(t,e)?t[e]:void 0},ue=Object.prototype.hasOwnProperty;var he=function(e){var t=this.__data__;return oe?void 0!==t[e]:ue.call(t,e)},pe="__lodash_hash_undefined__";var fe=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=oe&&void 0===t?pe:t,this};function _e(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}_e.prototype.clear=ae,_e.prototype.delete=se,_e.prototype.get=ce,_e.prototype.has=he,_e.prototype.set=fe;var me=_e;var ge=function(){this.__data__=[],this.size=0};var ve=function(e,t){return e===t||e!=e&&t!=t};var we=function(e,t){for(var r=e.length;r--;)if(ve(e[r][0],t))return r;return-1},be=Array.prototype.splice;var ye=function(e){var t=this.__data__,r=we(t,e);return!(r<0||(r==t.length-1?t.pop():be.call(t,r,1),--this.size,0))};var Ce=function(e){var t=this.__data__,r=we(t,e);return r<0?void 0:t[r][1]};var xe=function(e){return we(this.__data__,e)>-1};var ke=function(e,t){var r=this.__data__,n=we(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Re.prototype.clear=ge,Re.prototype.delete=ye,Re.prototype.get=Ce,Re.prototype.has=xe,Re.prototype.set=ke;var Se=Re,Te=ie(d,"Map");var Ie=function(){this.size=0,this.__data__={hash:new me,map:new(Te||Se),string:new me}};var Ee=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var $e=function(e,t){var r=e.__data__;return Ee(t)?r["string"==typeof t?"string":"hash"]:r.map};var De=function(e){var t=$e(this,e).delete(e);return this.size-=t?1:0,t};var Me=function(e){return $e(this,e).get(e)};var He=function(e){return $e(this,e).has(e)};var Le=function(e,t){var r=$e(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function je(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}je.prototype.clear=Ie,je.prototype.delete=De,je.prototype.get=Me,je.prototype.has=He,je.prototype.set=Le;var Oe=je,Ae="__lodash_hash_undefined__";var Ne=function(e){return this.__data__.set(e,Ae),this};var Fe=function(e){return this.__data__.has(e)};function Pe(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Oe;++t<r;)this.add(e[t])}Pe.prototype.add=Pe.prototype.push=Ne,Pe.prototype.has=Fe;var We=Pe;var Be=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var ze=function(e){return e!=e};var qe=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1};var Ve=function(e,t,r){return t==t?qe(e,t,r):Be(e,ze,r)};var Ye=function(e,t){return!(null==e||!e.length)&&Ve(e,t,0)>-1};var Xe=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1};var Ge=function(e,t){return e.has(t)},Ue=ie(d,"Set");var Ke=function(){};var Qe=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},Je=Ue&&1/Qe(new Ue([,-0]))[1]==1/0?function(e){return new Ue(e)}:Ke,Ze=200;var et=function(e,t,r){var n=-1,i=Ye,o=e.length,a=!0,s=[],l=s;if(r)a=!1,i=Xe;else if(o>=Ze){var d=t?null:Je(e);if(d)return Qe(d);a=!1,i=Ge,l=new We}else l=t?[]:s;e:for(;++n<o;){var c=e[n],u=t?t(c):c;if(c=r||0!==c?c:0,a&&u==u){for(var h=l.length;h--;)if(l[h]===u)continue e;t&&l.push(u),s.push(c)}else i(l,u,r)||(l!==s&&l.push(u),s.push(c))}return s};var tt=function(e){return e&&e.length?et(e):[]};function rt(e){return e.replace(/([A-Z])/g,function(e){return"-"+e[0].toLowerCase()})}function nt(e){return Object.keys(e).map(function(t){var r=rt(t),n=e[t];return void 0===n?"":"data-"+r+'="'+n+'" '}).join("").trim()}function it(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t)}var ot=N,at=O;function st(e,t){return void 0===t&&(t=null),function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];return new Promise(function(n){setTimeout(function(){var i=e.apply(t,r);n(i)})})}}function lt(e,t,r){var n=r.reduce(function(e,r){return e[r]={get:function(){return t[r]}},e},{});Object.defineProperties(e,n)}function dt(e){return!isNaN(e)}function ct(e,t){return e-t}class ut{constructor(e){this.options=e,this.sortRows=st(this.sortRows,this),this.switchColumn=st(this.switchColumn,this),this.removeColumn=st(this.removeColumn,this),this.options.filterRows=st(this.options.filterRows,this)}init(e,t){e||(e=this.options.data),t&&(this.options.columns=t),this.data=e,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.prepareRows(),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()}get currentSort(){return this.columns.find(function(e){return"none"!==e.sortOrder})||{colIndex:-1,sortOrder:"none"}}prepareColumns(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()}prepareDefaultColumns(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){var e={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(e)}if(this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")){this.columns.push({id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1})}}prepareHeader(){var e=this,t=this.columns.concat(this.options.columns),r={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:function(e){return null==e?"":e+""}};this.columns=t.map(function(t,r){return e.prepareCell(t,r)}).map(function(e){return Object.assign({},r,e)}).map(function(e){return e.content=e.content||e.name||"",e.id=e.id||e.content,e})}prepareCell(e,t){var r={content:"",sortOrder:"none",colIndex:t,column:this.columns[t]};return null!==e&&"object"==typeof e?Object.assign(r,e):r.content=e,r}prepareNumericColumns(){var e=this.getRow(0);e&&(this.columns=this.columns.map(function(t,r){var n=e[r].content;return t.align||isNaN(n)||(t.align="right"),t}))}prepareRows(){var e=this;this.validateData(this.data),this.rows=this.data.map(function(t,r){var n=e._getNextRowCount(),i=[],o={rowIndex:n};if(Array.isArray(t))for(e.options.checkboxColumn&&i.push(e.getCheckboxHTML()),e.options.serialNoColumn&&i.push(n+1+""),i=i.concat(t);i.length<e.columns.length;)i.push("");else{for(var a=0,s=e.columns;a<s.length;a+=1){var l=s[a];"_checkbox"===l.id?i.push(e.getCheckboxHTML()):"_rowIndex"===l.id?i.push(n+1+""):i.push(t[l.id])}o.indent=t.indent||0}return e.prepareRow(i,o)})}prepareTreeRows(){var e=this;this.rows.forEach(function(t,r){if(dt(t.meta.indent)){var n=e.getRow(r+1);t.meta.isLeaf=!n||!function(e){return void 0!==e||null!==e}(n.meta.indent)||n.meta.indent<=t.meta.indent,t.meta.isTreeNodeClose=!1}})}prepareRowView(){this.rowViewOrder=this.rows.map(function(e){return e.meta.rowIndex})}prepareRow(e,t){var r=this,n={rowIndex:t.rowIndex,indent:t.indent};return(e=e.map(function(e,t){return r.prepareCell(e,t)}).map(function(e){return Object.assign({},n,e)})).meta=t,e}validateColumns(){var e=this.options.columns;if(!Array.isArray(e))throw new ht("`columns` must be an array");e.forEach(function(e,t){if("string"!=typeof e&&"object"!=typeof e)throw new ht('column "'+t+'" must be a string or an object')})}validateData(e){if(Array.isArray(e)&&(0===e.length||Array.isArray(e[0])||"object"==typeof e[0]))return!0;throw new ht("`data` must be an array of arrays or objects")}appendRows(e){var t;this.validateData(e),(t=this.rows).push.apply(t,this.prepareRows(e))}sortRows(e,t){void 0===t&&(t="none"),e=+e,this.getColumns().map(function(r){r.colIndex===e?r.sortOrder=t:r.sortOrder="none"}),this._sortRows(e,t)}_sortRows(e,t){var r=this;if(this.currentSort.colIndex===e&&("asc"===this.currentSort.sortOrder&&"desc"===t||"desc"===this.currentSort.sortOrder&&"asc"===t))return this.reverseArray(this.rowViewOrder),void(this.currentSort.sortOrder=t);if(this.rowViewOrder.sort(function(n,i){var o=n,a=i,s=r.getCell(e,n).content,l=r.getCell(e,i).content;if("none"===t)return o-a;if("asc"===t){if(s<l)return-1;if(s>l)return 1;if(s===l)return 0}else if("desc"===t){if(s<l)return 1;if(s>l)return-1;if(s===l)return 0}return 0}),this.hasColumnById("_rowIndex")){var n=this.getColumnIndexById("_rowIndex");this.rows.forEach(function(e,t){var i=r.rowViewOrder.indexOf(t);e[n].content=i+1+""})}}reverseArray(e){var t=null,r=null;for(t=0,r=e.length-1;t<r;t+=1,r-=1){var n=e[t];e[t]=e[r],e[r]=n}}switchColumn(e,t){var r=this.columns[e];this.columns[e]=this.columns[t],this.columns[t]=r,this.columns[e].colIndex=e,this.columns[t].colIndex=t,this.rows.forEach(function(r){var n=Object.assign({},r[e],{colIndex:t}),i=Object.assign({},r[t],{colIndex:e});r[t]=n,r[e]=i})}removeColumn(e){e=+e;this.columns=this.columns.filter(function(t){return t.colIndex!==e}).map(function(e,t){return Object.assign({},e,{colIndex:t})}),this.rows.forEach(function(t){t.splice(e,1),t.forEach(function(e,t){e.colIndex=t})})}updateRow(e,t){if(e.length<this.columns.length){if(this.hasColumnById("_rowIndex"))e=[t+1+""].concat(e);if(this.hasColumnById("_checkbox")){e=['<input type="checkbox" />'].concat(e)}}var r=this.prepareRow(e,{rowIndex:t}),n=this.rows.findIndex(function(e){return e[0].rowIndex===t});return this.rows[n]=r,r}updateCell(e,t,r){var n;for(var i in"object"==typeof e&&(e=(n=e).colIndex,t=n.rowIndex,r=n),n=this.getCell(e,t),r){var o=r[i];void 0!==o&&(n[i]=o)}return n}updateColumn(e,t){var r=this.getColumn(e);for(var n in t){var i=t[n];void 0!==i&&(r[n]=i)}return r}filterRows(e){var t=this;return this.options.filterRows(this.rows,e).then(function(e){return e||(e=t.getAllRowIndices()),e.then||(e=Promise.resolve(e)),e.then(function(e){return t._filteredRows=e,{rowsToHide:t.getAllRowIndices().filter(function(t){return!e.includes(t)}),rowsToShow:e}})})}getFilteredRowIndices(){return this._filteredRows||this.getAllRowIndices()}getAllRowIndices(){return this.rows.map(function(e){return e.meta.rowIndex})}getRowCount(){return this.rowCount}_getNextRowCount(){var e=this.rowCount;return this.rowCount++,e}getRows(e,t){return this.rows.slice(e,t)}getRowsForView(e,t){var r=this;return this.rowViewOrder.map(function(e){return r.rows[e]}).slice(e,t)}getColumns(e){var t=this.columns;return e&&(t=t.slice(this.getStandardColumnCount())),t}getStandardColumnCount(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0}getColumnCount(e){var t=this.columns.length;return e&&(t-=this.getStandardColumnCount()),t}getColumn(e){return(e=+e)<0&&(e=this.columns.length+e),this.columns.find(function(t){return t.colIndex===e})}getColumnById(e){return this.columns.find(function(t){return t.id===e})}getRow(e){return e=+e,this.rows[e]}getCell(e,t){return t=+t,e=+e,this.getRow(t)[e]}getChildren(e){e=+e;for(var t=this.getRow(e).meta.indent,r=[],n=e+1;n<this.rowCount;n++){var i=this.getRow(n);if(!isNaN(i.meta.indent)&&(i.meta.indent>t&&r.push(n),i.meta.indent===t))break}return r}getImmediateChildren(e){e=+e;for(var t=this.getRow(e).meta.indent,r=[],n=t+1,i=e+1;i<this.rowCount;i++){var o=this.getRow(i);if(!(isNaN(o.meta.indent)||o.meta.indent>n)&&(o.meta.indent===n&&r.push(i),o.meta.indent===t))break}return r}get(){return{columns:this.columns,rows:this.rows}}getData(e){return this.data[e]}hasColumn(e){return Boolean(this.columns.find(function(t){return t.content===e}))}hasColumnById(e){return Boolean(this.columns.find(function(t){return t.id===e}))}getColumnIndex(e){return this.columns.findIndex(function(t){return t.content===e})}getColumnIndexById(e){return this.columns.findIndex(function(t){return t.id===e})}getCheckboxHTML(){return'<input type="checkbox" />'}}class ht extends TypeError{}var pt={chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>'};class ft{constructor(e){this.instance=e,lt(this,this.instance,["wrapper","options","style","header","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard"]),this.bindEvents()}bindEvents(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()}bindFocusCell(){this.bindKeyboardNav()}bindEditCell(){var e=this;this.$editingCell=null,n.on(this.bodyScrollable,"dblclick",".dt-cell",function(t,r){e.activateEditing(r)}),this.keyboard.on("enter",function(){e.$focusedCell&&!e.$editingCell?e.activateEditing(e.$focusedCell):e.$editingCell&&(e.submitEditing(),e.deactivateEditing())})}bindKeyboardNav(){var e=this;["left","right","up","down","tab","shift+tab"].map(function(t){return e.keyboard.on(t,function(){return function(t){if(!e.$focusedCell||e.$editingCell)return!1;var r=e.$focusedCell;return"left"===t||"shift+tab"===t?r=e.getLeftCell$(r):"right"===t||"tab"===t?r=e.getRightCell$(r):"up"===t?r=e.getAboveCell$(r):"down"===t&&(r=e.getBelowCell$(r)),e.focusCell(r),!0}(t)})}),["left","right","up","down"].map(function(t){return e.keyboard.on("ctrl+"+t,function(){return function(t){if(!e.$focusedCell||e.$editingCell)return!1;var r=e.$focusedCell,i=n.data(r),o=i.rowIndex,a=i.colIndex;return"left"===t?r=e.getLeftMostCell$(o):"right"===t?r=e.getRightMostCell$(o):"up"===t?r=e.getTopMostCell$(a):"down"===t&&(r=e.getBottomMostCell$(a)),e.focusCell(r),!0}(t)})}),this.keyboard.on("esc",function(){e.deactivateEditing(),e.columnmanager.toggleFilter(!1)}),this.options.inlineFilters&&(this.keyboard.on("ctrl+f",function(t){var r=n.closest(".dt-cell",t.target),i=n.data(r).colIndex;return e.activateFilter(i),!0}),n.on(this.header,"focusin",".dt-filter",function(){e.unfocusCell(e.$focusedCell)}))}bindKeyboardSelection(){var e=this;["left","right","up","down"].map(function(t){return e.keyboard.on("shift+"+t,function(){return e.selectArea(function(t){var r=e.getSelectionCursor();return"left"===t?r=e.getLeftCell$(r):"right"===t?r=e.getRightCell$(r):"up"===t?r=e.getAboveCell$(r):"down"===t&&(r=e.getBelowCell$(r)),r}(t))})})}bindCopyCellContents(){var e=this;this.keyboard.on("ctrl+c",function(){var t=e.copyCellContents(e.$focusedCell,e.$selectionCursor),r=t+" cell"+(t>1?"s":"")+" copied";t&&e.instance.showToastMessage(r,2)}),this.options.pasteFromClipboard&&this.keyboard.on("ctrl+v",function(t){return e.instance.pasteTarget.focus(),setTimeout(function(){var t=e.instance.pasteTarget.value;e.instance.pasteTarget.value="",e.pasteContentInCell(t)},10),!1})}bindMouseEvents(){var e=this,t=null;n.on(this.bodyScrollable,"mousedown",".dt-cell",function(r){t=!0,e.focusCell(n(r.delegatedTarget))}),n.on(this.bodyScrollable,"mouseup",function(){t=!1});n.on(this.bodyScrollable,"mousemove",".dt-cell",ot(function(r){t&&e.selectArea(n(r.delegatedTarget))},50))}bindTreeEvents(){var e=this;n.on(this.bodyScrollable,"click",".dt-tree-node__toggle",function(t,r){var i=n.closest(".dt-cell",r),o=n.data(i).rowIndex;i.classList.contains("dt-cell--tree-close")?e.rowmanager.openSingleNode(o):e.rowmanager.closeSingleNode(o)})}focusCell(e,t){void 0===t&&(t={});var r=t.skipClearSelection;void 0===r&&(r=0);var i=t.skipDOMFocus;void 0===i&&(i=0);var o=t.skipScrollToCell;if(void 0===o&&(o=0),e&&e!==this.$editingCell){var a=n.data(e),s=a.colIndex;if(!a.isHeader)!1!==this.columnmanager.getColumn(s).focusable&&(o||this.scrollToCell(e),this.deactivateEditing(),r||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("dt-cell--focus"),this.$focusedCell=e,e.classList.add("dt-cell--focus"),i||e.focus(),this.highlightRowColumnHeader(e))}}unfocusCell(e){e&&(e.classList.remove("dt-cell--focus"),this.$focusedCell=null,this.lastHeaders&&this.lastHeaders.forEach(function(e){return e.classList.remove("dt-cell--highlight")}))}highlightRowColumnHeader(e){var t=n.data(e),r=t.colIndex,i=t.rowIndex,o=".dt-cell--header-"+r,a=".dt-cell--"+this.datamanager.getColumnIndexById("_rowIndex")+"-"+i;this.lastHeaders&&this.lastHeaders.forEach(function(e){return e.classList.remove("dt-cell--highlight")});var s=n(o,this.wrapper),l=n(a,this.wrapper);this.lastHeaders=[s,l],this.lastHeaders.forEach(function(e){return e.classList.add("dt-cell--highlight")})}selectAreaOnClusterChanged(){if(this.$focusedCell&&this.$selectionCursor){var e=n.data(this.$selectionCursor),t=e.colIndex,r=e.rowIndex,i=this.getCell$(t,r);if(i&&i!==this.$selectionCursor){var o=n.data(this.$focusedCell);this.$focusedCell=this.getCell$(o.colIndex,o.rowIndex),this.selectArea(i)}}}focusCellOnClusterChanged(){if(this.$focusedCell){var e=n.data(this.$focusedCell),t=e.colIndex,r=e.rowIndex,i=this.getCell$(t,r);i&&this.focusCell(i,{skipClearSelection:1,skipDOMFocus:1,skipScrollToCell:1})}}selectArea(e){this.$focusedCell&&this._selectArea(this.$focusedCell,e)&&(this.$selectionCursor=e)}_selectArea(e,t){var r=this;if(e===t)return!1;var n=this.getCellsInRange(e,t);return!!n&&(this.clearSelection(),this._selectedCells=n.map(function(e){var t;return(t=r).getCell$.apply(t,e)}),requestAnimationFrame(function(){r._selectedCells.map(function(e){return e.classList.add("dt-cell--highlight")})}),!0)}getCellsInRange(e,t){var r,i,o,a,s,l,d;if("number"==typeof e)a=(r=arguments)[0],s=r[1],l=r[2],d=r[3];else if("object"==typeof e){if(!e||!t)return!1;var c=n.data(e),u=n.data(t);a=+c.colIndex,s=+c.rowIndex,l=+u.colIndex,d=+u.rowIndex}if(s>d&&(s=(i=[d,s])[0],d=i[1]),a>l&&(a=(o=[l,a])[0],l=o[1]),this.isStandardCell(a)||this.isStandardCell(l))return!1;for(var h=[],p=a,f=s,_=[];f<=d;)_.push(f),f+=1;return _.map(function(e){for(;p<=l;)h.push([p,e]),p++;p=a}),h}clearSelection(){(this._selectedCells||[]).forEach(function(e){return e.classList.remove("dt-cell--highlight")}),this._selectedCells=[],this.$selectionCursor=null}getSelectionCursor(){return this.$selectionCursor||this.$focusedCell}activateEditing(e){this.focusCell(e);var t=n.data(e),r=t.rowIndex,i=t.colIndex,o=this.columnmanager.getColumn(i);if(!o||!1!==o.editable&&!1!==o.focusable){var a=this.getCell(i,r);if(!a||!1!==a.editable){if(this.$editingCell){var s=n.data(this.$editingCell),l=s._rowIndex,d=s._colIndex;if(r===l&&i===d)return}this.$editingCell=e,e.classList.add("dt-cell--editing");var c=n(".dt-cell__edit",e);c.innerHTML="";var u=this.getEditor(i,r,a.content,c);u&&(this.currentCellEditor=u,u.initValue(a.content,r,o))}}}deactivateEditing(){this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("dt-cell--editing"),this.$editingCell=null)}getEditor(e,t,r,n){var i=this.datamanager.getColumn(e),o=this.datamanager.getRow(t),a=this.datamanager.getData(t),s=this.options.getEditor?this.options.getEditor(e,t,r,n,i,o,a):this.getDefaultEditor(n);return!1!==s&&(void 0===s&&(s=this.getDefaultEditor(n)),s)}getDefaultEditor(e){var t=n.create("input",{class:"dt-input",type:"text",inside:e});return{initValue:function(e){t.focus(),t.value=e},getValue:function(){return t.value},setValue:function(e){t.value=e}}}submitEditing(){var e=this;if(this.$editingCell){var t=this.$editingCell,r=n.data(t),i=r.rowIndex,o=r.colIndex,a=this.datamanager.getColumn(o);if(t){var s=this.currentCellEditor;if(s){var l=s.getValue();l.then||(l=Promise.resolve(l)),l.then(function(r){var n=s.setValue(r,i,a),l=e.getCell(o,i).content;e.updateCell(o,i,r),t.focus(),n&&n.then&&n.catch(function(t){console.log(t),e.updateCell(o,i,l)})})}}this.currentCellEditor=null}}copyCellContents(e,t){var r=this;if(!t&&e){var i=n.data(e),o=i.colIndex,a=i.rowIndex;return it(this.getCell(o,a).content),1}var s=this.getCellsInRange(e,t);if(!s)return 0;var l=s.map(function(e){var t;return(t=r).getCell.apply(t,e)}).reduce(function(e,t){var r=t.rowIndex;return e[r]=e[r]||[],e[r].push(t.content),e},[]);return it(l.map(function(e){return e.join("\t")}).join("\n")),l.reduce(function(e,t){return e+t.length},0)}pasteContentInCell(e){var t=this;if(this.$focusedCell){var r=e.split("\n").map(function(e){return e.split("\t")}).filter(function(e){return e.length&&e.every(function(e){return e})}),i=n.data(this.$focusedCell),o=i.colIndex,a=i.rowIndex,s=+o,l=+a;r.forEach(function(e,r){var n=r+l;e.forEach(function(e,r){var i=r+s;t.updateCell(i,n,e)})})}}activateFilter(e){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(e),this.columnmanager.isFilterShown||this.$focusedCell&&this.$focusedCell.focus()}updateCell(e,t,r){var n=this.datamanager.updateCell(e,t,{content:r});this.refreshCell(n)}refreshCell(e){n(this.selector(e.colIndex,e.rowIndex),this.bodyScrollable).innerHTML=this.getCellContent(e)}toggleTreeButton(e,t){var r=this.columnmanager.getFirstColumnIndex(),n=this.getCell$(r,e);n&&n.classList[t?"remove":"add"]("dt-cell--tree-close")}isStandardCell(e){return e<this.columnmanager.getFirstColumnIndex()}getCell$(e,t){return n(this.selector(e,t),this.bodyScrollable)}getAboveCell$(e){for(var t=n.data(e).colIndex,r=e.parentElement.previousElementSibling;r&&r.classList.contains("dt-row--hide");)r=r.previousElementSibling;return r?n(".dt-cell--col-"+t,r):e}getBelowCell$(e){for(var t=n.data(e).colIndex,r=e.parentElement.nextElementSibling;r&&r.classList.contains("dt-row--hide");)r=r.nextElementSibling;return r?n(".dt-cell--col-"+t,r):e}getLeftCell$(e){return e.previousElementSibling}getRightCell$(e){return e.nextElementSibling}getLeftMostCell$(e){return this.getCell$(this.columnmanager.getFirstColumnIndex(),e)}getRightMostCell$(e){return this.getCell$(this.columnmanager.getLastColumnIndex(),e)}getTopMostCell$(e){return this.getCell$(e,this.rowmanager.getFirstRowIndex())}getBottomMostCell$(e){return this.getCell$(e,this.rowmanager.getLastRowIndex())}getCell(e,t){return this.instance.datamanager.getCell(e,t)}getRowHeight(){return n.style(n(".dt-row",this.bodyScrollable),"height")}scrollToCell(e){if(n.inViewport(e,this.bodyScrollable))return!1;var t=n.data(e).rowIndex;return this.rowmanager.scrollToRow(t),!1}getRowCountPerPage(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())}getCellHTML(e){var t=e.rowIndex,r=e.colIndex,n=e.isHeader,i=e.isFilter,o=e.isTotalRow,a=nt({rowIndex:t,colIndex:r,isHeader:n,isFilter:i,isTotalRow:o}),s=this.datamanager.getRow(t),l=!(n||i||o);return'\n            <div class="'+["dt-cell","dt-cell--col-"+r,l?"dt-cell--"+r+"-"+t:"",l?"dt-cell--row-"+t:"",n?"dt-cell--header":"",n?"dt-cell--header-"+r:"",i?"dt-cell--filter":"",l&&s.meta.isTreeNodeClose?"dt-cell--tree-close":""].join(" ")+'" '+a+' tabindex="0">\n                '+this.getCellContent(e)+"\n            </div>\n        "}getCellContent(e){var t,r=e.isHeader,n=e.isFilter,i=e.colIndex,o=!r&&!1!==e.editable?this.getEditCellHTML(i):"",a=r&&!1!==e.sortable?'<span class="sort-indicator">\n                '+this.options.sortIndicator[e.sortOrder]+"\n            </span>":"",s=r&&!1!==e.resizable?'<span class="dt-cell__resize-handle"></span>':"",l=r&&!1!==e.dropdown?this.columnmanager.getDropdownHTML():"",d=e.format||e.column&&e.column.format||null;if(r||n||!d)t=e.content;else{var c=this.datamanager.getRow(e.rowIndex),u=this.datamanager.getData(e.rowIndex);t=d(e.content,c,e.column,u)}if(e.html=t,this.options.treeView&&!r&&!n&&void 0!==e.indent){var h=this.datamanager.getRow(e.rowIndex+1),p=h&&h.meta.indent>e.indent;if(this.datamanager.getColumnIndexById("_rowIndex")+1===e.colIndex){var f=20*(e.indent||0);t='<span class="dt-tree-node" style="padding-left: '+f+'px">\n                    '+(p?'<span class="dt-tree-node__toggle" style="left: '+(f-20)+'px">\n                        <span class="icon-open">'+pt.chevronDown+'</span>\n                        <span class="icon-close">'+pt.chevronRight+"</span>\n                    </span>":"")+"\n                    <span>"+t+"</span>\n                </span>"}}return'\n            <div class="'+["dt-cell__content",r?"dt-cell__content--header-"+i:"dt-cell__content--col-"+i].join(" ")+'">\n                '+t+"\n                "+a+"\n                "+s+"\n                "+l+"\n            </div>\n            "+o+"\n        "}getEditCellHTML(e){return'<div class="dt-cell__edit dt-cell__edit--col-'+e+'"></div>'}selector(e,t){return".dt-cell--"+e+"-"+t}}class _t{constructor(e){this.instance=e,lt(this,this.instance,["options","fireEvent","header","datamanager","cellmanager","style","wrapper","rowmanager","bodyScrollable","bodyRenderer"]),this.bindEvents()}renderHeader(){this.header.innerHTML="<div></div>",this.refreshHeader()}refreshHeader(){var e=this.datamanager.getColumns();n("div",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=n(".dt-row-filter",this.header),this.$filterRow&&n.style(this.$filterRow,{display:"none"}),this.$columnMap=[],this.bindMoveColumn()}getHeaderHTML(e){var t=this.rowmanager.getRowHTML(e,{isHeader:1});return this.options.inlineFilters&&(t+=this.rowmanager.getRowHTML(e,{isFilter:1})),t}bindEvents(){this.bindDropdown(),this.bindResizeColumn(),this.bindPerfectColumnWidth(),this.bindFilter()}bindDropdown(){var e=this,t=".dt-dropdown__toggle",r=".dt-dropdown__list";this.instance.dropdownContainer.innerHTML=this.getDropdownListHTML(),this.$dropdownList=this.instance.dropdownContainer.firstElementChild,n.on(this.header,"click",t,function(t){e.openDropdown(t)});var i=function(e){var n=[t,t+" *",r,r+" *"].join(",");e.target.matches(n)||a()};n.on(document.body,"click",i),document.addEventListener("scroll",a,!0),this.instance.on("onDestroy",function(){n.off(document.body,"click",i),n.off(document,"scroll",a)}),n.on(this.$dropdownList,"click",".dt-dropdown__list-item",function(t,r){if(e._dropdownActiveColIndex){var i=e.options.headerDropdown,o=n.data(r).index,a=e._dropdownActiveColIndex,s=i[o].action;s&&s.call(e.instance,e.getColumn(a)),e.hideDropdown()}});var o=this;function a(e){o.hideDropdown()}this.hideDropdown()}openDropdown(e){this._dropdownWidth||(n.style(this.$dropdownList,{display:""}),this._dropdownWidth=n.style(this.$dropdownList,"width")),n.style(this.$dropdownList,{display:"",left:e.clientX-this._dropdownWidth+4+"px",top:e.clientY+4+"px"});var t=n.closest(".dt-cell",e.target),r=n.data(t).colIndex;this._dropdownActiveColIndex=r}hideDropdown(){n.style(this.$dropdownList,{display:"none"}),this._dropdownActiveColIndex=null}bindResizeColumn(){var e,t,r,i=this,o=!1;n.on(this.header,"mousedown",".dt-cell .dt-cell__resize-handle",function(a,s){document.body.classList.add("dt-resize");var l=s.parentNode.parentNode;e=l;var d=n.data(e).colIndex,c=i.getColumn(d);c&&!1===c.resizable||(o=!0,t=n.style(n(".dt-cell__content",e),"width"),r=a.pageX)});var a=function(t){if(document.body.classList.remove("dt-resize"),e){o=!1;var r=n.data(e).colIndex;i.setColumnWidth(r),i.style.setBodyStyle(),e=null}};n.on(document.body,"mouseup",a),this.instance.on("onDestroy",function(){n.off(document.body,"mouseup",a)});var s=function(a){if(o){var s=t+(a.pageX-r),l=n.data(e).colIndex;30>s||(i.datamanager.updateColumn(l,{width:s}),i.setColumnHeaderWidth(l))}};n.on(document.body,"mousemove",s),this.instance.on("onDestroy",function(){n.off(document.body,"mousemove",s)})}bindPerfectColumnWidth(){var e=this;n.on(this.header,"dblclick",".dt-cell .dt-cell__resize-handle",function(t,r){var i=r.parentNode.parentNode,o=n.data(i).colIndex,a=e.bodyRenderer.visibleRows.map(function(e){return e[o]}).reduce(function(e,t){return e.content.length>t.content.length?e:t}),s=e.cellmanager.getCellHTML(a),l=document.createElement("div");l.innerHTML=s;var d=l.querySelector(".dt-cell__content").textContent,c=n.getStyle(e.bodyScrollable.querySelector(".dt-cell__content")),u=[c.borderLeftWidth,c.borderRightWidth,c.paddingLeft,c.paddingRight].map(parseFloat).reduce(function(e,t){return e+t}),h=n.measureTextWidth(d)+u;e.datamanager.updateColumn(o,{width:h}),e.setColumnHeaderWidth(o),e.setColumnWidth(o)})}bindMoveColumn(){var e=this,t=n(".dt-row",this.header);this.sortable=r.create(t,{onEnd:function(t){var r=t.oldIndex,i=t.newIndex,o=t.item;+n.data(o).colIndex!==i&&e.switchColumn(r,i)},preventOnFilter:!1,filter:".dt-cell__resize-handle, .dt-dropdown",chosenClass:"dt-cell--dragging",animation:150})}sortColumn(e,t){var r=this;this.instance.freeze(),this.sortRows(e,t).then(function(){return r.refreshHeader(),r.rowmanager.refreshRows()}).then(function(){return r.instance.unfreeze()}).then(function(){r.fireEvent("onSortColumn",r.getColumn(e))})}removeColumn(e){var t=this,r=this.getColumn(e);this.instance.freeze(),this.datamanager.removeColumn(e).then(function(){return t.refreshHeader(),t.rowmanager.refreshRows()}).then(function(){return t.instance.unfreeze()}).then(function(){t.fireEvent("onRemoveColumn",r)})}switchColumn(e,t){var r=this;this.instance.freeze(),this.datamanager.switchColumn(e,t).then(function(){return r.refreshHeader(),r.rowmanager.refreshRows()}).then(function(){r.setColumnWidth(e),r.setColumnWidth(t),r.instance.unfreeze()}).then(function(){r.fireEvent("onSwitchColumn",r.getColumn(e),r.getColumn(t))})}toggleFilter(e){var t;this.options.inlineFilters&&((t=void 0===e?!this.isFilterShown:e)?n.style(this.$filterRow,{display:""}):n.style(this.$filterRow,{display:"none"}),this.isFilterShown=t,this.style.setBodyStyle())}focusFilter(e){this.isFilterShown&&n(".dt-cell--col-"+e+" .dt-filter",this.$filterRow).focus()}bindFilter(){var e=this;if(this.options.inlineFilters){n.on(this.header,"keydown",".dt-filter",at(function(t){e.applyFilter(e.getAppliedFilters())},300))}}applyFilter(e){var t=this;this.datamanager.filterRows(e).then(function(e){var r=e.rowsToShow;t.rowmanager.showRows(r)})}getAppliedFilters(){var e={};return n.each(".dt-filter",this.header).map(function(t){var r=t.value;r&&(e[t.dataset.colIndex]=r)}),e}applyDefaultSortOrder(){var e=this.getColumns().filter(function(e){return"none"!==e.sortOrder});if(1===e.length){var t=e[0];this.sortColumn(t.colIndex,t.sortOrder)}}sortRows(e,t){return this.datamanager.sortRows(e,t)}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}setColumnWidth(e,t){e=+e;var r=t||this.getColumn(e).width,n=[".dt-cell__content--col-"+e,".dt-cell__edit--col-"+e].join(", "),i={width:r+"px"};this.style.setStyle(n,i)}setColumnHeaderWidth(e){e=+e,this.$columnMap=this.$columnMap||[];var t=".dt-cell__content--header-"+e,r=this.getColumn(e).width,n=this.$columnMap[e];n||(n=this.header.querySelector(t),this.$columnMap[e]=n),n.style.width=r+"px"}getColumnMinWidth(e){return e=+e,this.getColumn(e).minWidth||24}getFirstColumnIndex(){return this.datamanager.getColumnIndexById("_rowIndex")+1}getHeaderCell$(e){return n(".dt-cell--header-"+e,this.header)}getLastColumnIndex(){return this.datamanager.getColumnCount()-1}getDropdownHTML(){return'\n            <div class="dt-dropdown">\n                <div class="dt-dropdown__toggle">'+this.options.dropdownButton+"</div>\n            </div>\n      "}getDropdownListHTML(){return'\n            <div class="dt-dropdown__list">\n            '+this.options.headerDropdown.map(function(e,t){return'\n                <div class="dt-dropdown__list-item" data-index="'+t+'">'+e.label+"</div>\n            "}).join("")+"\n            </div>\n        "}}class mt{constructor(e){this.instance=e,lt(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer","style"]),this.bindEvents(),this.refreshRows=st(this.refreshRows,this)}get datamanager(){return this.instance.datamanager}get cellmanager(){return this.instance.cellmanager}bindEvents(){this.bindCheckbox()}bindCheckbox(){var e=this;this.options.checkboxColumn&&(this.checkMap=[],n.on(this.wrapper,"click",'.dt-cell--col-0 [type="checkbox"]',function(t,r){var i=r.closest(".dt-cell"),o=n.data(i),a=o.rowIndex,s=o.isHeader,l=r.checked;s?e.checkAll(l):e.checkRow(a,l)}))}refreshRows(){this.instance.renderBody(),this.instance.setDimensions()}refreshRow(e,t){var r=this;this.datamanager.updateRow(e,t).forEach(function(e){r.cellmanager.refreshCell(e)})}getCheckedRows(){if(!this.checkMap)return[];var e=[];for(var t in this.checkMap){1===this.checkMap[t]&&e.push(t)}return e}highlightCheckedRows(){var e=this;this.getCheckedRows().map(function(t){return e.checkRow(t,!0)})}checkRow(e,t){var r=t?1:0;this.checkMap[e]=r,n.each(function(e){return".dt-cell--0-"+e+' [type="checkbox"]'}(e),this.bodyScrollable).map(function(e){e.checked=t}),this.highlightRow(e,t),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(e))}checkAll(e){var t=e?1:0;this.checkMap=e?Array.from(Array(this.getTotalRows())).map(function(e){return t}):[],n.each('.dt-cell--col-0 [type="checkbox"]',this.bodyScrollable).map(function(t){t.checked=e}),this.highlightAll(e),this.showCheckStatus(),this.fireEvent("onCheckRow")}showCheckStatus(){if(this.options.checkedRowStatus){var e=this.getCheckedRows().length;e>0?this.bodyRenderer.showToastMessage(e+" row"+(e>1?"s":"")+" selected"):this.bodyRenderer.clearToastMessage()}}highlightRow(e,t){void 0===t&&(t=!0);var r=this.getRow$(e);r&&(t||!this.bodyScrollable.classList.contains("dt-scrollable--highlight-all")?(t&&r.classList.contains("dt-row--unhighlight")&&r.classList.remove("dt-row--unhighlight"),this._highlightedRows=this._highlightedRows||{},t?(r.classList.add("dt-row--highlight"),this._highlightedRows[e]=r):(r.classList.remove("dt-row--highlight"),delete this._highlightedRows[e])):r.classList.add("dt-row--unhighlight"))}highlightAll(e){if(void 0===e&&(e=!0),e)this.bodyScrollable.classList.add("dt-scrollable--highlight-all");else{for(var t in this.bodyScrollable.classList.remove("dt-scrollable--highlight-all"),this._highlightedRows){this._highlightedRows[t].classList.remove("dt-row--highlight")}this._highlightedRows={}}}showRows(e){var t,r=this;t=e;var n=(e=Array.isArray(t)?t:[t]).map(function(e){return r.datamanager.getRow(e)});this.bodyRenderer.renderRows(n)}showAllRows(){var e=this.datamanager.getAllRowIndices();this.showRows(e)}openSingleNode(e){this.datamanager.getRow(e).meta.isTreeNodeClose=!1;var t,r=this.datamanager.getImmediateChildren(e),n=this.bodyRenderer.visibleRowIndices,i=(t=r.concat(n),tt(t)).sort(ct);this.showRows(i)}closeSingleNode(e){var t=this;this.datamanager.getRow(e).meta.isTreeNodeClose=!0;var r=this.datamanager.getChildren(e),n=this.bodyRenderer.visibleRowIndices.filter(function(e){return!r.includes(e)}).sort(ct);r.forEach(function(e){var r=t.datamanager.getRow(e);r.meta.isLeaf||(r.meta.isTreeNodeClose=!0)}),this.showRows(n)}expandAllNodes(){var e=this;this.datamanager.getRows().filter(function(e){return!e.meta.isLeaf}).map(function(t){e.openSingleNode(t.meta.rowIndex)})}collapseAllNodes(){var e=this;this.datamanager.getRows().filter(function(e){return 0===e.meta.indent}).map(function(t){e.closeSingleNode(t.meta.rowIndex)})}getRow$(e){return n(this.selector(e),this.bodyScrollable)}getTotalRows(){return this.datamanager.getRowCount()}getFirstRowIndex(){return 0}getLastRowIndex(){return this.datamanager.getRowCount()-1}scrollToRow(e){e=+e,this._lastScrollTo=this._lastScrollTo||0;var t=this.getRow$(e);if(!n.inViewport(t,this.bodyScrollable)){var r=t.getBoundingClientRect().height,i=this.bodyScrollable.getBoundingClientRect(),o=i.top,a=i.bottom,s=Math.floor((a-o)/r),l=0;l=e>this._lastScrollTo?r*(e+1-s):r*(e+1-1),this._lastScrollTo=e,n.scrollTop(this.bodyScrollable,l)}}getRowHTML(e,t){var r=this,n=nt(t),i=t.rowIndex;return t.isFilter&&(e=e.map(function(e){return Object.assign({},e,{content:r.getFilterInput({colIndex:e.colIndex}),isFilter:1,isHeader:void 0,editable:!1})}),i="filter"),t.isHeader&&(i="header"),'\n            <div class="dt-row dt-row-'+i+'" '+n+">\n                "+e.map(function(e){return r.cellmanager.getCellHTML(e)}).join("")+"\n            </div>\n        "}getFilterInput(e){return'<input class="dt-filter dt-input" type="text" '+nt(e)+' tabindex="1" />'}selector(e){return".dt-row-"+e}}var gt,vt=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){e.exports=function e(t,r,n){function i(s,l){if(!r[s]){if(!t[s]){var d=a;if(!l&&d)return d(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return i(r||e)},u,u.exports,e,t,r,n)}return r[s].exports}for(var o=a,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i={width:"100%",height:"100%"},o=function(e){return Number(e)==Number(e)},a=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config={},this._lastRepaint=null,this._maxElementHeight=e.getMaxBrowserHeight(),this.refresh(t,r);var i=this._config;!function e(){var t=n._getScrollPosition(),r=n._lastRepaint;if(n._renderAnimationFrame=window.requestAnimationFrame(e),t!==r&&(!r||Math.abs(t-r)>n._averageHeight)){var o=n._renderChunk();n._lastRepaint=t,!1!==o&&"function"==typeof i.afterRender&&i.afterRender()}}()}return n(e,null,[{key:"create",value:function(t,r){return new e(t,r)}},{key:"mergeStyle",value:function(e,t){for(var r in t)e.style[r]!==t[r]&&(e.style[r]=t[r])}},{key:"getMaxBrowserHeight",value:function(){var t=document.createElement("div"),r=document.createElement("div");e.mergeStyle(t,{position:"absolute",height:"1px",opacity:0}),e.mergeStyle(r,{height:"1e7px"}),t.appendChild(r),document.body.appendChild(t);var n=r.offsetHeight;return document.body.removeChild(t),n}}]),n(e,[{key:"destroy",value:function(){window.cancelAnimationFrame(this._renderAnimationFrame)}},{key:"refresh",value:function(t,r){var n=this;if(Object.assign(this._config,i,r),!t||1!==t.nodeType)throw new Error("HyperList requires a valid DOM Node container");this._element=t;var a=this._config,s=this._scroller||a.scroller||document.createElement(a.scrollerTagName||"tr");if("boolean"!=typeof a.useFragment&&(this._config.useFragment=!0),!a.generate)throw new Error("Missing required `generate` function");if(!o(a.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(a.itemHeight)&&!o(a.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());o(a.itemHeight)?this._itemHeights=Array(a.total).fill(a.itemHeight):this._itemHeights=a.itemHeight,Object.keys(i).filter(function(e){return e in a}).forEach(function(e){var t=a[e],r=o(t),i=!r&&"%"===t.slice(-1);if(t&&"string"!=typeof t&&"number"!=typeof t){var s="Invalid optional `"+e+"`, expected string or number";throw new Error(s)}if(r&&(a[e]=t+"px"),"height"===e){var l=r?t:parseInt(t.replace(/px|%/,""),10);n._containerHeight=i?window.innerHeight*l/100:o(t)?t:l}});var l={width:""+a.width,height:""+a.height,overflow:"auto",position:"relative"};e.mergeStyle(t,l);var d=a.itemHeight*a.total,c=this._maxElementHeight;d>c&&console.warn(["HyperList: The maximum element height",c+"px has","been exceeded; please reduce your item height."].join(" "));var u={opacity:"0",position:"absolute",width:"1px",height:d+"px"};e.mergeStyle(s,u),this._scroller||t.appendChild(s),this._scroller=s,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(a.total).fill(0),this._computePositions(0),this._renderChunk(null!==this._lastRepaint),"function"==typeof a.afterRender&&a.afterRender()}},{key:"_getRow",value:function(t){var r=this._config,n=r.generate(t),i=n.height;if(void 0!==i&&o(i)?(n=n.element,i!==this._itemHeights&&(this._itemHeights[t]=i,this._computePositions(t),this._scrollHeight=this._computeScrollHeight(t))):i=this._itemHeights[t],!n||1!==n.nodeType)throw new Error("Generator did not return a DOM Node for index: "+t);var a=n.getAttribute("class")||"";n.setAttribute("class",a+" "+(r.rowClassName||"vrow"));var s=this._itemPositions[t];return e.mergeStyle(n,{position:"absolute",top:s+"px"}),n}},{key:"_getScrollPosition",value:function(){var e=this._config;return"function"==typeof e.overrideScrollPosition?e.overrideScrollPosition():this._element.scrollTop}},{key:"_renderChunk",value:function(e){var t=this._config,r=this._element,n=this._getScrollPosition(),i=t.total,o=t.reverse?this._getReverseFrom(n):this._getFrom(n)-1;if((o<0||o-this._screenItemsLen<0)&&(o=0),!e&&this._lastFrom===o)return!1;this._lastFrom=o;var a=o+this._cachedItemsLen;(a>i||a+this._cachedItemsLen>i)&&(a=i);var s=t.useFragment?document.createDocumentFragment():[],l=this._scroller;s[t.useFragment?"appendChild":"push"](l);for(var d=o;d<a;d++){var c=this._getRow(d);s[t.useFragment?"appendChild":"push"](c)}if(t.applyPatch)return t.applyPatch(r,s);r.innerHTML="",r.appendChild(s)}},{key:"_computePositions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=this._config,r=t.total,n=t.reverse;e<1&&!n&&(e=1);for(var i=e;i<r;i++)n?0===i?this._itemPositions[0]=this._scrollHeight-this._itemHeights[0]:this._itemPositions[i]=this._itemPositions[i-1]-this._itemHeights[i]:this._itemPositions[i]=this._itemHeights[i-1]+this._itemPositions[i-1]}},{key:"_computeScrollHeight",value:function(){var t=this,r=this._config,n=r.total,i=this._itemHeights.reduce(function(e,t){return e+t},0);e.mergeStyle(this._scroller,{opacity:0,position:"absolute",width:"1px",height:i+"px"});var o=this._itemHeights.slice(0).sort(function(e,t){return e-t}),a=Math.floor(n/2),s=n%2==0?(o[a]+o[a-1])/2:o[a],l=this._element.clientHeight?this._element.clientHeight:this._containerHeight;return this._screenItemsLen=Math.ceil(l/s),this._containerHeight=l,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,3*this._screenItemsLen),this._averageHeight=s,r.reverse&&window.requestAnimationFrame(function(){t._element.scrollTop=i}),i}},{key:"_getFrom",value:function(e){for(var t=0;this._itemPositions[t]<e;)t++;return t}},{key:"_getReverseFrom",value:function(e){for(var t=this._config.total-1;t>0&&this._itemPositions[t]<e+this._containerHeight;)t--;return t}}]),e}();r.default=a,t.exports=r.default},{}]},{},[1])(1)}),wt=(gt=vt)&&gt.__esModule&&Object.prototype.hasOwnProperty.call(gt,"default")?gt.default:gt;class bt{constructor(e){this.instance=e,this.options=e.options,this.datamanager=e.datamanager,this.rowmanager=e.rowmanager,this.cellmanager=e.cellmanager,this.bodyScrollable=e.bodyScrollable,this.footer=this.instance.footer,this.log=e.log}renderRows(e){var t=this;this.visibleRows=e,this.visibleRowIndices=e.map(function(e){return e.meta.rowIndex});var r=this.datamanager.rowViewOrder.map(function(e){return t.visibleRowIndices.includes(e)?e:null}).filter(function(e){return null!==e}),n=getComputedStyle(this.bodyScrollable),i={width:n.width,height:n.height,itemHeight:this.options.cellHeight,total:e.length,generate:function(e){var n=document.createElement("div"),i=r[e],o=t.datamanager.getRow(i),a=t.rowmanager.getRowHTML(o,o.meta);return n.innerHTML=a,n.children[0]},afterRender:function(){t.restoreState()}};this.hyperlist?this.hyperlist.refresh(this.bodyScrollable,i):this.hyperlist=new wt(this.bodyScrollable,i),this.renderFooter()}render(){var e=this.datamanager.getRowsForView();this.renderRows(e),this.instance.setDimensions()}renderFooter(){if(this.options.showTotalRow){var e=this.getTotalRow(),t=this.rowmanager.getRowHTML(e,{isTotalRow:1,rowIndex:"totalRow"});this.footer.innerHTML=t}}getTotalRow(){var e=this;return this.datamanager.getColumns().map(function(e){var t=null;return["_rowIndex","_checkbox"].includes(e.id)&&(t=""),{content:t,isTotalRow:1,colIndex:e.colIndex,column:e}}).map(function(t,r){if(""===t.content)return t;if(e.options.hooks.columnTotal){var n=e.visibleRows.map(function(e){return e[r].content}),i=e.options.hooks.columnTotal.call(e.instance,n,t);if(null!=i)return t.content=i,t}return t.content=e.visibleRows.reduce(function(e,t){var n=t[r];return"number"==typeof n.content?(null==e&&(e=0),e+n.content):e},t.content),t})}restoreState(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()}showToastMessage(e,t){var r=this;this.instance.toastMessage.innerHTML=this.getToastMessageHTML(e),t&&setTimeout(function(){r.clearToastMessage()},1e3*t)}clearToastMessage(){this.instance.toastMessage.innerHTML=""}getNoDataHTML(){return'<div class="dt-scrollable__no-data">'+this.options.noDataMessage+"</div>"}getToastMessageHTML(e){return'<span class="dt-toast__message">'+e+"</span>"}}class yt{constructor(e){this.instance=e,lt(this,this.instance,["options","datamanager","columnmanager","header","footer","bodyScrollable","datatableWrapper","getColumn","bodyRenderer"]),this.scopeClass="dt-instance-"+e.constructor.instances,e.datatableWrapper.classList.add(this.scopeClass);var t=document.createElement("style");e.wrapper.insertBefore(t,e.datatableWrapper),this.styleEl=t,this.bindResizeWindow(),this.bindScrollHeader()}get stylesheet(){return this.styleEl.sheet}bindResizeWindow(){this.onWindowResize=this.onWindowResize.bind(this),this.onWindowResize=ot(this.onWindowResize,300),"fluid"===this.options.layout&&n.on(window,"resize",this.onWindowResize)}bindScrollHeader(){var e=this;this._settingHeaderPosition=!1,n.on(this.bodyScrollable,"scroll",function(t){e._settingHeaderPosition||(e._settingHeaderPosition=!0,requestAnimationFrame(function(){var r=t.target.scrollLeft;n.style(e.header,{transform:"translateX(-"+r+"px)"}),n.style(e.footer,{transform:"translateX(-"+r+"px)"}),e._settingHeaderPosition=!1}))})}onWindowResize(){this.distributeRemainingWidth(),this.refreshColumnWidth(),this.setBodyStyle()}destroy(){this.styleEl.remove(),n.off(window,"resize",this.onWindowResize)}setStyle(e,t){var r=this;if(e.includes(","))e.split(",").map(function(e){return e.trim()}).forEach(function(e){r.setStyle(e,t)});else if(e=e.trim()){this._styleRulesMap=this._styleRulesMap||{};var n=this._getPrefixedSelector(e);this._styleRulesMap[n]&&(this.removeStyle(e),t=Object.assign({},this._styleRulesMap[n],t));var i=n+" { "+this._getRuleString(t)+" }";this._styleRulesMap[n]=t,this.stylesheet.insertRule(i)}}removeStyle(e){var t=this;if(e.includes(","))e.split(",").map(function(e){return e.trim()}).forEach(function(e){t.removeStyle(e)});else if(e=e.trim()){var r=this._getPrefixedSelector(e),n=Array.from(this.stylesheet.cssRules).findIndex(function(e){return e.selectorText===r});-1!==n&&this.stylesheet.deleteRule(n)}}_getPrefixedSelector(e){return"."+this.scopeClass+" "+e}_getRuleString(e){return Object.keys(e).map(function(t){var r=t;return t.includes("-")||(r=rt(t)),r+":"+e[t]+";"}).join("")}setDimensions(){this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.setBodyStyle()}setupMinWidth(){var e=this;n.each(".dt-cell--header",this.header).map(function(t){var r=n.data(t).colIndex,i=e.getColumn(r);if(!i.minWidth){var o=n.style(n(".dt-cell__content",t),"width");i.minWidth=o}})}setupNaturalColumnWidth(){var e=this;n(".dt-row")&&(n.each(".dt-row-header .dt-cell",this.header).map(function(t){var r=n.data(t).colIndex,i=e.datamanager.getColumn(r),o=n.style(n(".dt-cell__content",t),"width");"number"==typeof o&&o>=e.options.minimumColumnWidth?i.naturalWidth=o:i.naturalWidth=e.options.minimumColumnWidth}),n.each(".dt-row-0 .dt-cell",this.bodyScrollable).map(function(t){var r=n.data(t).colIndex,i=e.datamanager.getColumn(r),o=n.style(n(".dt-cell__content",t),"width");"_rowIndex"===i.id&&(o=e.getRowIndexColumnWidth(),i.width=o),"number"==typeof o&&o>=e.options.minimumColumnWidth?i.naturalWidth=o:i.naturalWidth=e.options.minimumColumnWidth}))}setupColumnWidth(){if("ratio"===this.options.layout){var e=n.style(this.datatableWrapper,"width");if(this.options.serialNoColumn)e=e-this.datamanager.getColumnById("_rowIndex").width-1;if(this.options.checkboxColumn)e=e-this.datamanager.getColumnById("_checkbox").width-1;var t=e/this.datamanager.getColumns().map(function(e){return"_rowIndex"===e.id||"_checkbox"===e.id?0:(e.width||(e.width=1),e.ratioWidth=parseInt(e.width,10),e.ratioWidth)}).reduce(function(e,t){return e+t});this.datamanager.getColumns().map(function(e){"_rowIndex"!==e.id&&"_checkbox"!==e.id&&(e.width=Math.floor(t*e.ratioWidth)-1)})}else this.datamanager.getColumns().map(function(e){e.width||(e.width=e.naturalWidth),e.width<e.minWidth&&(e.width=e.minWidth)})}distributeRemainingWidth(){var e=this;if("fluid"===this.options.layout){var t=n.style(this.instance.datatableWrapper,"width"),r=n.style(n(".dt-row",this.bodyScrollable),"width"),i=this.datamanager.getColumns().filter(function(e){return e.resizable}),o=(t-r)/i.length;i.map(function(t){var r=n.style(e.getColumnHeaderElement(t.colIndex),"width"),i=Math.floor(r+o)-2;e.datamanager.updateColumn(t.colIndex,{width:i})})}}setColumnStyle(){var e=this;this.datamanager.getColumns().map(function(t){t.align||(t.align="left"),["left","center","right"].includes(t.align)||(t.align="left"),e.setStyle(".dt-cell--col-"+t.colIndex,{"text-align":t.align}),e.columnmanager.setColumnHeaderWidth(t.colIndex),e.columnmanager.setColumnWidth(t.colIndex)})}refreshColumnWidth(){var e=this;this.datamanager.getColumns().map(function(t){e.columnmanager.setColumnHeaderWidth(t.colIndex),e.columnmanager.setColumnWidth(t.colIndex)})}setBodyStyle(){var e=n.style(this.datatableWrapper,"width"),t=n(".dt-row",this.bodyScrollable),r=n.style(t,"width"),i=e>r?r:e;n.style(this.bodyScrollable,{width:i+"px"}),n.removeStyle(this.bodyScrollable,"height");var o,a=n.getStyle(this.bodyScrollable,"height"),s=(this.bodyRenderer.hyperlist||{})._scrollHeight||1/0,l=n.hasHorizontalOverflow(this.bodyScrollable);s<a&&(o=s,l&&(o+=n.scrollbarSize()),n.style(this.bodyScrollable,{height:o+"px"})),this.bodyScrollable.scrollHeight-this.bodyScrollable.offsetHeight<n.scrollbarSize()&&n.style(this.bodyScrollable,{overflowY:"hidden"}),"fluid"===this.options.layout&&n.style(this.bodyScrollable,{overflowX:"hidden"})}getColumnHeaderElement(e){return(e=+e)<0?null:n(".dt-cell--col-"+e,this.header)}getRowIndexColumnWidth(){var e=this.datamanager.getRowCount();return n.measureTextWidth(e+"")+22}}var Ct={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f",86:"v"};class xt{constructor(e){this.listeners={},n.on(e,"keydown",this.handler.bind(this))}handler(e){var t=Ct[e.keyCode];e.shiftKey&&"shift"!==t&&(t="shift+"+t),(e.ctrlKey&&"ctrl"!==t||e.metaKey&&"meta"!==t)&&(t="ctrl+"+t);var r=this.listeners[t];if(r&&r.length>0)for(var n=0,i=r;n<i.length;n+=1){var o=(0,i[n])(e);void 0!==o&&!0!==o||e.preventDefault()}}on(e,t){var r=this;e.split(",").map(function(e){return e.trim()}).map(function(e){r.listeners[e]=r.listeners[e]||[],r.listeners[e].push(t)})}}var kt={columns:[],data:[],dropdownButton:pt.chevronDown,headerDropdown:[{label:"Sort Ascending",action:function(e){this.sortColumn(e.colIndex,"asc")}},{label:"Sort Descending",action:function(e){this.sortColumn(e.colIndex,"desc")}},{label:"Reset sorting",action:function(e){this.sortColumn(e.colIndex,"none")}},{label:"Remove column",action:function(e){this.removeColumn(e.colIndex)}}],events:{onRemoveColumn:function(e){},onSwitchColumn:function(e,t){},onSortColumn:function(e){},onCheckRow:function(e){},onDestroy:function(){}},hooks:{columnTotal:null},sortIndicator:{asc:"",desc:"",none:""},filterRows:function(e,t){var r=[];if(0===Object.keys(t).length)return e.map(function(e){return e.meta.rowIndex});var n=function(n){var i=t[n],o=(r.length?r.map(function(t){return e[t]}):e).map(function(e){return e[n]}),a=function(e){if(void 0===e&&(e=""),0===e.length)return{};var t=e;return[">","<","="].includes(t[0])?t=e.slice(1):t.startsWith("!=")&&(t=e.slice(2)),e.startsWith(">")&&t?{type:"greaterThan",text:t.trim()}:e.startsWith("<")&&t?{type:"lessThan",text:t.trim()}:e.startsWith("=")&&dt(t)?{type:"equals",text:Number(e.slice(1).trim())}:e.startsWith("!=")&&dt(t)?{type:"notEquals",text:Number(e.slice(2).trim())}:2===e.split(":").length?{type:"range",text:(t=e.split(":")).map(function(e){return e.trim()})}:{type:"contains",text:t.toLowerCase()}}(i),s=function(e){var t=function(e){return String((t=e.html||"",t.replace(/<[^>]*>/g,"")||e.content||"")).toLowerCase();var t},r=function(e,r){if(e.column.compareValue){var n=e.column.compareValue(e,r);if(n&&Array.isArray(n))return n}var i=function(e){return parseFloat(e.content)}(e);return isNaN(i)?[t(e),r]:[i,r]};return{contains:function(e,r){return r.filter(function(r){var n=t(r),i=(e||"").toLowerCase();return!i||n.includes(i)}).map(function(e){return e.rowIndex})},greaterThan:function(e,t){return t.filter(function(t){var n=r(t,e),i=n[0],o=n[1];return i>o}).map(function(e){return e.rowIndex})},lessThan:function(e,t){return t.filter(function(t){var n=r(t,e),i=n[0],o=n[1];return i<o}).map(function(e){return e.rowIndex})},equals:function(e,t){return t.filter(function(t){var r=parseFloat(t.content);return r===e}).map(function(e){return e.rowIndex})},notEquals:function(e,t){return t.filter(function(t){var r=parseFloat(t.content);return r!==e}).map(function(e){return e.rowIndex})},range:function(e,t){return t.filter(function(t){var n=r(t,e[0]),i=r(t,e[1]),o=n[0];return o>=n[1]&&o<=i[1]}).map(function(e){return e.rowIndex})}}[e.type]}(a);r=s?s(a.text,o):o.map(function(e){return e.rowIndex})};for(var i in t)n(i);return r},freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:"No Data",cellHeight:40,minimumColumnWidth:70,inlineFilters:!1,treeView:!1,checkedRowStatus:!0,dynamicRowHeight:!1,pasteFromClipboard:!1,showTotalRow:!1};class Rt{constructor(e,t){if(Rt.instances++,"string"==typeof e&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.buildOptions(t),this.prepare(),this.style=new yt(this),this.keyboard=new xt(this.wrapper),this.datamanager=new ut(this.options),this.rowmanager=new mt(this),this.columnmanager=new _t(this),this.cellmanager=new ft(this),this.bodyRenderer=new bt(this),this.options.data&&(this.refresh(),this.columnmanager.applyDefaultSortOrder())}buildOptions(e){this.options=this.options||{},this.options=Object.assign({},kt,this.options||{},e),e.headerDropdown=e.headerDropdown||[],this.options.headerDropdown=kt.headerDropdown.concat(e.headerDropdown),this.events=Object.assign({},kt.events,this.options.events||{},e.events||{}),this.fireEvent=this.fireEvent.bind(this)}prepare(){this.prepareDom(),this.unfreeze()}prepareDom(){this.wrapper.innerHTML='\n            <div class="datatable">\n                <div class="dt-header"></div>\n                <div class="dt-scrollable"></div>\n                <div class="dt-footer"></div>\n                <div class="dt-freeze">\n                    <span class="dt-freeze__message">\n                        '+this.options.freezeMessage+'\n                    </span>\n                </div>\n                <div class="dt-toast"></div>\n                <div class="dt-dropdown-container"></div>\n                <textarea class="dt-paste-target"></textarea>\n            </div>\n        ',this.datatableWrapper=n(".datatable",this.wrapper),this.header=n(".dt-header",this.wrapper),this.footer=n(".dt-footer",this.wrapper),this.bodyScrollable=n(".dt-scrollable",this.wrapper),this.freezeContainer=n(".dt-freeze",this.wrapper),this.toastMessage=n(".dt-toast",this.wrapper),this.pasteTarget=n(".dt-paste-target",this.wrapper),this.dropdownContainer=n(".dt-dropdown-container",this.wrapper)}refresh(e,t){this.datamanager.init(e,t),this.render(),this.setDimensions()}destroy(){this.wrapper.innerHTML="",this.style.destroy(),this.fireEvent("onDestroy")}appendRows(e){this.datamanager.appendRows(e),this.rowmanager.refreshRows()}refreshRow(e,t){this.rowmanager.refreshRow(e,t)}render(){this.renderHeader(),this.renderBody()}renderHeader(){this.columnmanager.renderHeader()}renderBody(){this.bodyRenderer.render()}setDimensions(){this.style.setDimensions()}showToastMessage(e,t){this.bodyRenderer.showToastMessage(e,t)}clearToastMessage(){this.bodyRenderer.clearToastMessage()}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}getRows(){return this.datamanager.getRows()}getCell(e,t){return this.datamanager.getCell(e,t)}getColumnHeaderElement(e){return this.columnmanager.getColumnHeaderElement(e)}getViewportHeight(){return this.viewportHeight||(this.viewportHeight=n.style(this.bodyScrollable,"height")),this.viewportHeight}sortColumn(e,t){this.columnmanager.sortColumn(e,t)}removeColumn(e){this.columnmanager.removeColumn(e)}scrollToLastColumn(){this.datatableWrapper.scrollLeft=9999}freeze(){n.style(this.freezeContainer,{display:""})}unfreeze(){n.style(this.freezeContainer,{display:"none"})}updateOptions(e){this.buildOptions(e)}fireEvent(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=0,i=(this._internalEventHandlers[e]||[]).concat([this.events[e]]).filter(Boolean);n<i.length;n+=1){i[n].apply(this,t)}}on(e,t){this._internalEventHandlers=this._internalEventHandlers||{},this._internalEventHandlers[e]=this._internalEventHandlers[e]||[],this._internalEventHandlers[e].push(t)}log(){this.options.logs&&console.log.apply(console,arguments)}}Rt.instances=0;var St="0.0.0-development";Rt.__version__=St,e.exports=Rt}),DataTable=unwrapExports(frappeDatatable_cjs);return frappe.provide("frappe.views"),frappe.views.ReportView=class extends frappe.views.ListView{get view_name(){return"Report"}setup_defaults(){var e=this;super.setup_defaults(),this.page_title=__("Report:")+" "+this.page_title,this.menu_items=this.report_menu_items();var t=frappe.get_route();if(4===t.length&&(this.report_name=t[3]),this.add_totals_row=this.view_user_settings.add_totals_row||0,this.report_name)return this.get_report_doc().then(function(t){e.report_doc=t,e.report_doc.json=JSON.parse(e.report_doc.json),e.filters=e.report_doc.json.filters,e.order_by=e.report_doc.json.order_by,e.add_totals_row=e.report_doc.json.add_totals_row,e.page_title=e.report_name,e.page_length=e.report_doc.json.page_length||20,e.order_by=e.report_doc.json.order_by||"modified desc"})}setup_view(){this.setup_columns(),this.bind_charts_button()}setup_result_area(){super.setup_result_area(),this.$datatable_wrapper=$('<div class="datatable-wrapper">'),this.$charts_wrapper=$('<div class="charts-wrapper">'),this.$result.append(this.$charts_wrapper),this.$result.append(this.$datatable_wrapper)}setup_paging_area(){super.setup_paging_area();var e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10).");this.$paging_area.find(".level-left").append('<p class="text-muted text-medium margin-left">'+e+"</p>")}setup_sort_selector(){this.sort_selector=new frappe.ui.SortSelector({parent:this.filter_area.$filter_list_wrapper,doctype:this.doctype,args:this.order_by,onchange:this.on_sort_change.bind(this)})}before_refresh(){return this.report_doc?Promise.resolve():super.before_refresh()}after_render(){this.report_doc?this.set_dirty_state_for_custom_report():this.save_report_settings()}set_dirty_state_for_custom_report(){var e={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths()},t={filters:this.report_doc.json.filters,fields:this.report_doc.json.fields,order_by:this.report_doc.json.order_by,add_totals_row:this.report_doc.json.add_totals_row,page_length:this.report_doc.json.page_length,column_widths:this.report_doc.json.column_widths};frappe.utils.deep_equal(e,t)?this.page.clear_indicator():this.page.set_indicator(__("Not Saved"),"orange")}save_report_settings(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.report_name||this.save_view_user_settings({fields:this.fields,filters:this.filter_area.get(),order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row})}prepare_data(e){var t=e.message||{};t=frappe.utils.dict(t.keys,t.values),0===this.start?this.data=t:this.data=this.data.concat(t)}render(e){0!==this.data.length&&(this.render_count(),this.setup_columns(),this.chart&&this.refresh_charts(),!this.datatable||e?this.setup_datatable(this.data):this.datatable.refresh(this.get_data(this.data),this.columns))}render_count(){var e=this.$paging_area.find(".list-count");e.length||(this.$paging_area.find(".btn-more").addClass("margin-left"),e=$("<span>").addClass("text-muted text-medium list-count").prependTo(this.$paging_area.find(".level-right"))),this.get_count_str().then(function(t){e.text(t)})}on_update(e){var t=this;if(this.doctype===e.doctype&&e.name){var r=e.user!==frappe.session.user;this.data.find(function(t){return t.name===e.name})?frappe.db.get_doc(e.doctype,e.name).then(function(e){return t.update_row(e,r)}):this.refresh()}}update_row(e,t){var r=this,n=[];this.data=this.data.map(function(t,r){if(t.name===e.name){for(var i in t)if(i.includes(":")){var o=i.split(":"),a=o[0],s=o[1],l=Object.keys(e).filter(function(t){return Array.isArray(e[t])&&e[t][0].doctype===a}).map(function(t){return e[t]}).map(function(e){return e[0]}).filter(function(e){return e.name===t[a+":name"]})[0];l&&(t[i]=l[s])}else t[i]=e[i];n.push([t,r])}return t});n.forEach(function(e){var n=e[0],i=e[1],o=r.build_row(n);r.datatable.refreshRow(o,i),function(e){if(t){var n=r.$result.find('.dt-row[data-row-index="'+e+'"]');n.addClass("row-update"),setTimeout(function(){return n.removeClass("row-update")},500)}}(i)})}setup_datatable(e){var t=this;this.$datatable_wrapper.empty(),this.datatable=new DataTable(this.$datatable_wrapper[0],{columns:this.columns,data:this.get_data(e),getEditor:this.get_editing_object.bind(this),checkboxColumn:!0,inlineFilters:!0,cellHeight:35,events:{onRemoveColumn:function(e){t.remove_column_from_datatable(e)},onSwitchColumn:function(e,r){t.switch_column(e,r)},onCheckRow:function(){var e=t.get_checked_items();t.toggle_actions_menu_button(e.length>0)}},hooks:{columnTotal:frappe.utils.report_column_total},headerDropdown:[{label:__("Add Column"),action:function(e){var r=[],n=t.get_columns_for_picker();r=n[t.doctype].filter(function(e){return!t.is_column_added(e)}).map(function(e){return{label:__(e.label),value:e.fieldname}}),delete n[t.doctype];var i=function(e){n[e].filter(function(e){return!t.is_column_added(e)}).map(function(t){return{label:__(t.label)+" ("+e+")",value:t.fieldname+","+e}}).forEach(function(e){return r.push(e)})};for(var o in n)i(o);var a=new frappe.ui.Dialog({title:__("Add Column"),fields:[{label:__("Select Column"),fieldname:"column",fieldtype:"Autocomplete",options:r},{label:__("Insert Column Before {0}",[e.docfield.label.bold()]),fieldname:"insert_before",fieldtype:"Check"}],primary_action:function(n){var i,o=n.column,s=n.insert_before;if(!r.map(function(e){return e.value}).includes(o))return frappe.show_alert(__("Invalid column")),void a.hide();var l=t.doctype;o.includes(",")&&(o=(i=o.split(","))[0],l=i[1]);var d=e.colIndex;s&&(d-=1),t.add_column_to_datatable(o,l,d),a.hide()}});a.show()}}]})}bind_charts_button(){var e=this;this.list_sidebar.sidebar.find(".charts-menu").removeClass("hide"),this.list_sidebar.sidebar.on("click",".toggle-charts",function(t){t.preventDefault(),e.toggle_charts()}),this.list_sidebar.sidebar.on("click",".configure-charts",function(t){t.preventDefault(),e.get_chart_data().then(function(){return e.refresh_charts()})}),this.refresh_charts_sidebar_button()}refresh_charts_sidebar_button(){var e=this.list_sidebar.sidebar.find(".configure-charts");this.chart&&!this.$charts_wrapper.hasClass("hidden")?e.removeClass("hidden"):e.addClass("hidden")}toggle_charts(){this.chart?(this.$charts_wrapper.toggleClass("hidden"),this.$charts_wrapper.hasClass("hidden")||this.chart.refresh(),this.refresh_charts_sidebar_button()):this.setup_charts()}setup_charts(){var e=this;this.get_chart_data().then(function(t){var r={labels:t.labels,datasets:t.datasets};e.last_chart_type=t.chart_type;e.chart=new Chart(e.$charts_wrapper[0],{title:__("{0} Chart",[e.doctype]),data:r,type:t.chart_type,height:150,colors:["violet","light-blue","orange","red"],format_tooltip_x:function(e){return e.doc.name},format_tooltip_y:function(t){return frappe.format(t,(r=t.field,frappe.meta.get_docfield(e.doctype,r)),{always_show_decimals:!0,inline:!0},function(t,r){return e.data.find(function(e){return e[r]===t})}(t.doc));var r}}),e.refresh_charts_sidebar_button()})}refresh_charts(){if(this.chart){var e=this.chart_args,t=e.x_field,r=e.y_fields,n=e.chart_type,i=this.get_chart_args(t,r,n);this.chart.update_values(i.datasets,i.labels),this.chart.refresh(),i.chart_type!==this.last_chart_type&&this.chart.get_different_chart(i.chart_type)}}get_chart_data(){var e=this;return new Promise(function(t){var r=e.fields.map(function(e){return e[0]}),n=e.meta.fields.filter(function(e){return!e.hidden&&r.includes(e.fieldname)}).map(function(e){return e.fieldname}),i=e.meta.fields.filter(function(e){return!e.hidden&&frappe.model.is_numeric_field(e)&&r.includes(e.fieldname)}).map(function(e){return e.fieldname}),o=e.chart_args||{},a=new frappe.ui.Dialog({title:__("Configure Chart"),fields:[{label:__("X Axis Field"),fieldtype:"Autocomplete",fieldname:"x_axis",options:n,default:o.x_field},{label:__("Y Axis Fields"),fieldtype:"MultiSelect",fieldname:"y_axes",options:i,description:__("Showing only Numeric fields from Report"),default:o.y_fields},{label:__("Chart Type"),fieldtype:"Select",options:["Bar","Line","Pie","Percentage"],fieldname:"chart_type",default:toTitle(o.chart_type||"Bar")}],primary_action:function(r){var o=r.x_axis,s=r.y_axes,l=r.chart_type;if((s=s.split(",").map(function(e){return e.trim()}).filter(Boolean)).every(function(e){return i.includes(e)})&&n.includes(o)){var d=e.get_chart_args(o,s,l);e.chart_args=d,t(d),a.hide()}}});a.show()})}get_chart_args(e,t,r){var n=this,i=this.data.map(function(t){return{doc:t,toString:function(){return t[e]},slice:String.prototype.slice}});return{chart_type:r.toLowerCase(),x_field:e,y_fields:t,labels:i,datasets:t.map(function(e){return{name:frappe.meta.get_docfield(n.doctype,e).label,values:n.data.map(function(t){return{doc:t,field:e,toString:function(){return t[e]},slice:String.prototype.slice}})}})}}get_editing_object(e,t,r,n){var i=this,o=this.render_editing_input(e,r,n);return!!o&&(o.df.change=function(){return o.set_focus()},{initValue:function(e){return o.set_value(e)},setValue:function(r){var n=i.datatable.getCell(e,t),a=i.datatable.getColumn(e).docfield.fieldname,s=n.name,l=n.doctype;return o.set_value(r),i.set_control_value(l,s,a,r).then(function(e){var t=i.data.find(function(t){return t.name===e.name});for(var r in t)t[r]=e[r]}).then(function(){return i.refresh_charts()})},getValue:function(){return o.get_value()}})}set_control_value(e,t,r,n){return this.last_updated_doc=t,new Promise(function(i,o){var a;frappe.db.set_value(e,t,(a={},a[r]=n,a)).then(function(e){e.message?i(e.message):o()}).fail(o)})}render_editing_input(e,t,r){var n=this,i=this.datatable.getColumn(e),o=null;if("Text Editor"===i.docfield.fieldtype){var a=new frappe.ui.Dialog({title:__("Edit {0}",[i.docfield.label]),fields:[i.docfield],primary_action:function(){n.datatable.cellmanager.submitEditing(),n.datatable.cellmanager.deactivateEditing(),a.hide()}});a.show(),o=a.fields_dict[i.docfield.fieldname]}else(o=frappe.ui.form.make_control({df:i.docfield,parent:r,render_input:!0})).set_value(t),o.toggle_label(!1),o.toggle_description(!1);return o}is_editable(e,t){return!(!e||0!==t.docstatus)&&!(frappe.model.std_fields_list.includes(e.fieldname)||e.read_only||e.hidden||!frappe.model.can_write(this.doctype))}get_data(e){return this.build_rows(e)}set_fields(){var e=this;if(this.report_name&&this.report_doc.json.fields)this.fields=this.report_doc.json.fields.slice();else if(this.view_user_settings.fields)this.fields=this.view_user_settings.fields;else{this.fields=[];var t=function(t){return e._add_field(t)};["name","docstatus",this.meta.title_field,this.meta.image_field].map(t);var r=this.meta.fields.filter(function(t){return(t.in_list_view||t.in_standard_filter)&&frappe.perm.has_perm(e.doctype,t.permlevel,"read")&&frappe.model.is_value_type(t.fieldtype)&&!t.report_hide});r.map(t),r.filter(function(e){return"Currency"===e.fieldtype&&e.options}).map(function(e){e.options.includes(":")?t(e.options.split(":")[1]):t(e.options)}),(this.settings.add_fields||[]).map(t)}}build_fields(){this.fields.push(["docstatus",this.doctype]),super.build_fields()}get_fields(){var e=this,t=this.fields.map(function(t){var r=frappe.model.get_full_column_name(t[0],t[1]);return t[1]!==e.doctype&&(r=r+" as '"+t[1]+":"+t[0]+"'"),r}),r=this.get_unique_cdt_in_view().map(function(e){return frappe.model.get_full_column_name("name",e)+" as '"+e+":name'"});return t=t.concat(r)}get_unique_cdt_in_view(){var e=this;return this.fields.filter(function(t){return t[1]!==e.doctype}).map(function(e){return e[1]}).uniqBy(function(e){return e})}add_column_to_datatable(e,t,r){var n=[e,t];this.fields.splice(r,0,n),this.add_currency_column(e,t,r),this.build_fields(),this.setup_columns(),this.datatable.destroy(),this.datatable=null,this.refresh()}add_currency_column(e,t,r){var n=frappe.meta.get_docfield(t,e);if(n&&"Currency"===n.fieldtype&&n.options&&!n.options.includes(":")&&frappe.meta.has_field(t,n.options)){var i=[n.options,t];void 0===r?this.fields.push(i):this.fields.splice(r,0,i),frappe.show_alert(__("Also adding the dependent currency field {0}",[i[0].bold()]))}}remove_column_from_datatable(e){var t=this.fields.findIndex(function(t){return e.field===t[0]});-1!==t&&("name"===this.fields[t][0]&&(this.refresh(),frappe.throw(__("Cannot remove ID field"))),this.fields.splice(t,1),this.build_fields(),this.setup_columns(),this.refresh())}switch_column(e,t){var r=this.fields.findIndex(function(t){return e.field===t[0]}),n=this.fields.findIndex(function(e){return t.field===e[0]}),i=this.fields.slice(),o=i[r];i[r]=i[n],i[n]=o,this.fields=i,this.build_fields(),this.setup_columns(),this.refresh()}get_columns_for_picker(){var e={},t=function(e){return!in_list(frappe.model.no_value_type,e.fieldtype)&&!e.report_hide&&"naming_series"!==e.fieldname&&!e.hidden},r=frappe.meta.get_docfields(this.doctype).filter(t);return r=[{label:__("ID"),fieldname:"name",fieldtype:"Data"}].concat(r,frappe.model.std_fields),e[this.doctype]=r,frappe.meta.get_table_fields(this.doctype).filter(function(e){return!e.hidden}).forEach(function(r){var n=r.options,i=frappe.meta.get_docfields(n).filter(t);e[n]=i}),e}get_dialog_fields(){var e=this,t=[],r=this.get_columns_for_picker();return t.push({label:__(this.doctype),fieldname:this.doctype,fieldtype:"MultiCheck",columns:2,options:r[this.doctype].map(function(t){return{label:__(t.label),value:t.fieldname,checked:e.fields.find(function(e){return e[0]===t.fieldname})}})}),delete r[this.doctype],frappe.meta.get_table_fields(this.doctype).filter(function(e){return!e.hidden}).forEach(function(n){var i=n.options;t.push({label:__(n.label)+" ("+__(i)+")",fieldname:n.options,fieldtype:"MultiCheck",columns:2,options:r[i].map(function(t){return{label:__(t.label),value:t.fieldname,checked:e.fields.find(function(e){return e[0]===t.fieldname&&e[1]===i})}})})}),t}is_column_added(e){return Boolean(this.fields.find(function(t){return t[0]===e.fieldname&&e.parent===t[1]}))}setup_columns(){var e=this,t=["docstatus"],r=this.fields.filter(function(e){return!t.includes(e[0])});this.columns=r.map(function(t){return e.build_column(t)}).filter(Boolean)}build_column(e){var t=e[0],r=e[1],n=frappe.meta.docfield_map[r||this.doctype][t];if(n||(n=frappe.model.get_std_field(t))&&(n.parent=this.doctype,"name"==t&&(n.options=this.doctype)),n){var i=__(n?n.label:toTitle(t));r!==this.doctype&&(i+=" ("+__(r)+")");var o=frappe.model.is_non_std_field(t)&&!n.read_only,a=frappe.model.is_numeric_field(n)?"right":"Date"===n.fieldtype?"right":"left",s=r!==this.doctype?r+":"+t:t,l=(n?cint(n.width):null)||null;if(this.report_doc)l=(this.report_doc.json.column_widths||{})[s]||l;var d=null;return"Date"===n.fieldtype&&(d=function(e,t){if(!e.content)return null;if(t.length!=="YYYY-MM-DD".length)return null;var r=frappe.datetime.user_to_obj(t);return[+frappe.datetime.str_to_obj(e.content),+r]}),{id:s,field:t,name:i,content:i,docfield:n,width:l,editable:o,align:a,compareValue:d,format:function(e,t,r,n){var i=null;return i=Array.isArray(t)?t.reduce(function(e,t){return t.column.docfield?(e[t.column.docfield.fieldname]=t.content,e):e},{}):t,frappe.format(e,r.docfield,{always_show_decimals:!0},i)}}}}build_rows(e){var t=this,r=e.map(function(e){return t.build_row(e)});if(this.add_totals_row){var n=this.get_columns_totals(e),i=this.columns.map(function(e,t){return{name:__("Totals Row"),content:n[e.id],format:function(t){return frappe.format(t,e.docfield,{always_show_decimals:!0})}}});i[0].content=__("Totals").bold(),r.push(i)}return r}build_row(e){var t=this;return this.columns.map(function(r){if(r.docfield.parent!==t.doctype){var n=function(e){return r.docfield.parent+":"+e},i=e[n("name")];return{name:i,doctype:r.docfield.parent,content:e[n(r.field)],editable:Boolean(i&&t.is_editable(r.docfield,e)),format:function(e){return frappe.format(e,r.docfield,{always_show_decimals:!0})}}}if(r.field in e){var o=e[r.field];return{name:e.name,doctype:r.docfield.parent,content:o,editable:t.is_editable(r.docfield,e)}}return{content:""}})}get_checked_items(e){var t=this,r=this.datatable.rowmanager.getCheckedRows().filter(function(e){return null!=e}).map(function(e){return t.data[e]});return e?r.map(function(e){return e.name}):r}save_report(e){var t=this,r=function(e){var r={filters:t.filter_area.get(),fields:t.fields,order_by:t.sort_selector.get_sql_string(),add_totals_row:t.add_totals_row,page_length:t.page_length,column_widths:t.get_column_widths()};return frappe.call({method:"frappe.desk.reportview.save_report",args:{name:e,doctype:t.doctype,json:JSON.stringify(r)},callback:function(e){if(e.exc)frappe.msgprint(__("Report was not saved (there were errors)"));else{if(e.message!=t.report_name)return frappe.boot.user.all_reports[e.message]={ref_doctype:"Item",report_type:"Report Builder",title:e.message},t.list_sidebar.setup_reports(),void frappe.set_route("List",t.doctype,"Report",e.message);t.report_doc.json=r,t.set_dirty_state_for_custom_report()}}})};this.report_name&&"save"==e?r(this.report_name):frappe.prompt({fieldname:"name",label:__("New Report name"),reqd:1,fieldtype:"Data"},function(e){r(e.name)},__("Save As"))}get_column_widths(){return this.datatable?this.datatable.datamanager.getColumns(!0).reduce(function(e,t){return e[t.id]=parseInt(t.width),e},{}):{}}get_report_doc(){var e=this;return new Promise(function(t){frappe.model.with_doc("Report",e.report_name,function(){t(frappe.get_doc("Report",e.report_name))})})}get_filters_html_for_print(){return this.filter_area.get().map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];if("="!==n)return"";var o=frappe.meta.get_label(t,r);return"<h6>"+__(o)+": "+i+"</h6>"}).join("")}get_columns_totals(e){if(!this.add_totals_row)return[];var t={};return this.columns.forEach(function(r,n){var i=e.reduce(function(e,t){if(r.id in t&&frappe.model.is_numeric_field(r.docfield))return e+=flt(t[r.id])},0);t[r.id]=i}),t}report_menu_items(){var e=this,t=[{label:__("Show Totals"),action:function(){e.add_totals_row=!e.add_totals_row,e.save_view_user_settings({add_totals_row:e.add_totals_row}),e.datatable.refresh(e.get_data(e.data))}},{label:__("Print"),action:function(){var t=e.datatable.datamanager.rowViewOrder.map(function(t){if(e.datatable.bodyRenderer.visibleRowIndices.includes(t))return e.data[t]}).filter(Boolean);if(e.add_totals_row){var r=e.get_columns_totals(e.data);r.name=__("Totals").bold(),t.push(r)}frappe.ui.get_print_settings(!1,function(r){var n=__(e.doctype);frappe.render_grid({title:n,subtitle:e.get_filters_html_for_print(),print_settings:r,columns:e.columns,data:t})})}},{label:__("Toggle Chart"),action:function(){return e.toggle_charts()}},{label:__("Toggle Sidebar"),action:function(){return e.toggle_side_bar()}},{label:__("Pick Columns"),action:function(){var t=new frappe.ui.Dialog({title:__("Pick Columns"),fields:e.get_dialog_fields(),primary_action:function(r){var n=r[e.doctype].map(function(t){return[t,e.doctype]});delete r[e.doctype];var i=function(e){n=n.concat(r[e].map(function(t){return[t,e]}))};for(var o in r)i(o);e.fields=[["name",e.doctype]].concat(n),e.fields.map(function(t){return e.add_currency_column(t[0],t[1])}),e.build_fields(),e.setup_columns(),e.datatable.destroy(),e.datatable=null,e.refresh(),t.hide()}});t.show()}}];return frappe.model.can_export(this.doctype)&&t.push({label:__("Export"),action:function(){var t=e.get_args(),r=e.get_checked_items(!0),n=new frappe.ui.Dialog({title:__("Export Report: {0}",[__(e.doctype)]),fields:[{fieldtype:"Select",label:__("Select File Type"),fieldname:"file_format_type",options:["Excel","CSV"],default:"Excel"},{fieldtype:"Check",fieldname:"export_all_rows",label:__("Export All {0} rows?",[(e.total_count+"").bold()])}],primary_action_label:__("Download"),primary_action:function(i){t.cmd="frappe.desk.reportview.export_query",t.file_format_type=i.file_format_type,e.add_totals_row&&(t.add_totals_row=1),r.length>0&&(t.selected_items=r),i.export_all_rows?(delete t.start,delete t.page_length):(t.start=0,t.page_length=e.data.length),open_url_post(frappe.request.url,t),n.hide()}});n.show()}}),t.push({label:__("Setup Auto Email"),action:function(){e.report_name?frappe.set_route("List","Auto Email Report",{report:e.report_name}):frappe.msgprint(__("Please save the report first"))}}),frappe.user.is_report_manager()&&(t=t.concat([{label:__("Save"),action:function(){return e.save_report("save")}},{label:__("Save As"),action:function(){return e.save_report("save_as")}}])),this.report_name&&frappe.model.can_set_user_permissions("Report")&&t.push({label:__("User Permissions"),action:function(){var t={doctype:"Report",name:e.report_name};frappe.set_route("List","User Permission",t)}}),t.push({label:__("Add to Desktop"),action:function(){frappe.add_to_desktop(e.report_name||__("{0} Report",[e.doctype]),e.doctype,e.report_name)}}),t.map(function(e){return Object.assign(e,{standard:!0})})}},frappe.templates.reportview_footer='<div class="row">  <div class="col-md-6">   {% if has_child_column %}    <div class="checkbox">        <label>            <input type="checkbox" class="show-all-data"       style="margin-top: 2px"       {{ show_all_data ? "checked" : "" }}>       {{ __("Show all data") }}        </label>    </div>   {% endif %}  </div>  {% if can_write %}  <div class="col-md-6 text-right"><p class="text-muted">   {{ __("Tip:  Double click cell to edit") }}</p></div>  {% endif %} </div>',frappe.provide("frappe.views"),frappe.provide("frappe.query_reports"),frappe.standard_pages["query-report"]=function(){var e=frappe.container.add_page("query-report");frappe.ui.make_app_page({parent:e,title:__("Query Report"),single_column:!0}),frappe.query_report=new frappe.views.QueryReport({parent:e}),$(e).bind("show",function(){frappe.query_report.show()})},frappe.views.QueryReport=class extends frappe.views.BaseList{show(){var e=this;this.init().then(function(){return e.load()})}init(){var e=this;if(this.init_promise)return this.init_promise;var t=[this.setup_defaults,this.setup_page,this.setup_report_wrapper,this.setup_events].map(function(t){return t.bind(e)});return this.init_promise=frappe.run_serially(t),this.init_promise}setup_defaults(){var e=this;this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.primary_action=null,this.secondary_action={label:__("Refresh"),action:function(){e.setup_progress_bar(),e.refresh()}},this.refresh=frappe.utils.throttle(this.refresh,300),this.menu_items=[]}setup_events(){var e=this;frappe.realtime.on("report_generated",function(t){if(t.report_name)if(e.prepared_report_action="Rebuild",t.name==e.prepared_report_doc_name)e.refresh();else{var r="Report "+e.report_name+' generated.\n\t\t\t\t\t\t<a href="#query-report/'+e.report_name+"/?prepared_report_name="+t.name+'">View</a>';frappe.show_alert({message:r,indicator:"orange"})}}),this.page.wrapper.on("click","[data-action]",function(t){var r=$(t.currentTarget).data("action"),n=e[r];n.call&&n.call(e,t)})}load(){frappe.get_route().length<2?this.toggle_nothing_to_show(!0):this.report_name!==frappe.get_route()[1]&&this.load_report()}load_report(){var e=this;this.page.clear_inner_toolbar(),this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.report_name=this.route[1],this.page_title=__(this.report_name),this.menu_items=this.get_menu_items(),this.datatable=null,this.prepared_report_action="New",frappe.run_serially([function(){return e.get_report_doc()},function(){return e.get_report_settings()},function(){return e.setup_progress_bar()},function(){return e.setup_page_head()},function(){return e.refresh_report()},function(){return e.add_make_chart_button()}])}add_make_chart_button(){var e=this;this.page.add_inner_button(__("Set Chart"),function(){e.get_possible_chart_options()})}refresh_report(){var e=this;return this.toggle_message(!0),frappe.run_serially([function(){return e.setup_filters()},function(){return e.set_route_filters()},function(){return e.report_settings.onload&&e.report_settings.onload(e)},function(){return e.get_user_settings()},function(){return e.refresh()}])}get_report_doc(){var e=this;return frappe.model.with_doc("Report",this.report_name).then(function(t){e.report_doc=t}).then(function(){return frappe.model.with_doctype(e.report_doc.ref_doctype)})}get_report_settings(){var e=this;return frappe.query_reports[this.report_name]?(this.report_settings=frappe.query_reports[this.report_name],this._load_script):(this._load_script=new Promise(function(t){return frappe.call({method:"frappe.desk.query_report.get_script",args:{report_name:e.report_name},callback:t})}).then(function(e){return frappe.dom.eval(e.message.script||""),e}).then(function(t){return frappe.after_ajax(function(){e.report_settings=frappe.query_reports[e.report_name],e.report_settings.html_format=t.message.html_format,e.report_settings.execution_time=t.message.execution_time||0})}),this._load_script)}setup_progress_bar(){var e=0,t=this.report_settings.execution_time||0;t<5||(this.interval=setInterval(function(){e+=1,frappe.show_progress(__("Preparing Report"),e,t)},1e3))}setup_filters(){var e=this;this.clear_filters();var t=this.report_settings.filters;void 0===t&&(t=[]),this.filters=t.map(function(t){if("Break"!==t.fieldtype){var r=e.page.add_field(t);return t.default&&r.set_input(t.default),t.get_query&&(r.get_query=t.get_query),t.on_change&&(r.on_change=t.on_change),t.onchange=function(){e.previous_filters&&JSON.stringify(e.previous_filters)==JSON.stringify(e.get_filter_values())||(e.previous_filters=e.get_filter_values(),setTimeout(function(){return e.previous_filters=null},1e4),r.on_change?r.on_change(e):e.prepared_report?e.reset_report_view():e._no_refresh||e.refresh())},r=Object.assign(r,t)}}).filter(Boolean),0===this.filters.length?this.page.hide_form():this.page.show_form()}set_filters(e){this.filters.map(function(t){t.set_input(e[t.fieldname])})}set_route_filters(){if(frappe.route_options){var e=Object.keys(frappe.route_options),t=this.filters.filter(function(t){return e.includes(t.df.fieldname)}).map(function(e){return function(){var t=frappe.route_options[e.df.fieldname];return e.set_value(t)}});return t.push(function(){frappe.route_options=null}),frappe.run_serially(t)}}clear_filters(){this.page.clear_fields()}refresh(){var e=this;this.toggle_message(!0);var t=this.get_filter_values(!0),r=frappe.utils.get_query_string(frappe.get_route_str());if(r){var n=frappe.utils.get_query_params(r);t=Object.assign(t||{},n)}return this.last_ajax&&this.last_ajax.abort(),new Promise(function(r){e.last_ajax=frappe.call({method:"frappe.desk.query_report.run",type:"GET",args:{report_name:e.report_name,filters:t},callback:r,always:function(){return e.page.btn_secondary.prop("disabled",!1)}})}).then(function(t){var r=t.message;if(e.hide_status(),clearInterval(e.interval),e.execution_time=r.execution_time||.1,r.prepared_report){e.prepared_report=!0;var n=frappe.utils.get_query_string(frappe.get_route_str());if(frappe.utils.get_query_params(n).prepared_report_name){e.prepared_report_action="Edit";var i=JSON.parse(r.doc.filters);Object.values(e.filters).forEach(function(e){i[e.fieldname]&&e.set_input(i[e.fieldname]),e.input.disabled=!0})}e.add_prepared_report_buttons(r.doc)}if(e.toggle_message(!1),r.result&&r.result.length){e.prepare_report_data(r);var o=e.get_chart_options(r);e.$chart.empty(),o&&e.render_chart(o),e.render_datatable()}else e.toggle_nothing_to_show(!0);e.show_footer_message(),frappe.hide_progress()})}add_prepared_report_buttons(e){var t=this;if(e){this.page.add_inner_button(__("Download Report"),function(){window.open(frappe.urllib.get_full_url("/api/method/frappe.core.doctype.prepared_report.prepared_report.download_attachment?dn="+encodeURIComponent(e.name)))});var r=__("This report was generated {0}.",[frappe.datetime.comment_when(e.report_end_time)]),n=__("To get the updated report, click on {0}.",[__("Rebuild")]),i=__("See all past reports.");this.show_status('\n\t\t\t\t<span class="indicator orange">\n\t\t\t\t\t'+r+"\n\t\t\t\t\t"+n+'\n\t\t\t\t\t<a href="#List/Prepared%20Report?report_name='+this.report_name+'">'+i+"</a>\n\t\t\t\t</span>\n\t\t\t")}"New"==this.prepared_report_action?this.page.set_primary_action(__("Generate New Report"),function(){t.generate_background_report()}):"Edit"==this.prepared_report_action?this.page.set_primary_action(__("Edit"),function(){frappe.set_route(frappe.get_route())}):"Rebuild"==this.prepared_report_action&&this.page.set_primary_action(__("Rebuild"),this.generate_background_report.bind(this))}generate_background_report(){var e=this;if(!this.filters.filter(function(e){return e.df.reqd}).filter(function(e){return!e.get_value()}).length){var t=this.get_filter_values(!0);return new Promise(function(r){return frappe.call({method:"frappe.desk.query_report.background_enqueue_run",type:"GET",args:{report_name:e.report_name,filters:t},callback:r})}).then(function(t){var r=t.message;e.prepared_report_doc_name=r.name;var n="Report initiated. You can track its status\n\t\t\t\t\t<a class='text-info' href='#Form/Prepared Report/"+r.name+"'>here</a>";frappe.show_alert({message:n,indicator:"orange"}),e.toggle_nothing_to_show(!0)})}}prepare_report_data(e){this.raw_data=e,this.columns=this.prepare_columns(e.columns),this.data=this.prepare_data(e.result),this.tree_report=this.data.some(function(e){return"indent"in e})}render_datatable(){var e=this.data;if(this.raw_data.add_total_row&&(e=e.slice()).splice(-1,1),this.datatable)this.datatable.options.treeView=this.tree_report,this.datatable.refresh(e,this.columns);else{var t={columns:this.columns,data:e,inlineFilters:!0,treeView:this.tree_report,layout:"fixed",cellHeight:33,showTotalRow:this.raw_data.add_total_row,hooks:{columnTotal:frappe.utils.report_column_total}};this.report_settings.get_datatable_options&&(t=this.report_settings.get_datatable_options(t)),this.datatable=new DataTable(this.$report[0],t)}this.report_settings.after_datatable_render&&this.report_settings.after_datatable_render(this.datatable)}get_chart_options(e){var t=this.report_settings.get_chart_data?this.report_settings.get_chart_data(e.columns,e.result):e.chart?e.chart:void 0;if(t&&t.data&&t.data.labels&&t.data.labels.length>0)return t}render_chart(e,t){void 0===t&&(t=200),Object.assign(e,{height:t}),this.$chart.empty(),this.chart=new Chart(this.$chart[0],e),this.$chart.show()}get_possible_chart_options(){var e=this,t=this.raw_data.columns,r=this.raw_data.result,n=r[0],i=this.raw_data.add_total_row,o=n.reduce(function(e,t,r){return isNaN(Number(t))||e.push(r),e},[]);function a(e){var n=t.indexOf(e);return r.map(function(e){return e[n]})}function s(e){var t=e.y_field,r=e.x_field,n=e.chart_type,o=e.color,s=n.toLowerCase(),l=o?[o]:void 0,d=a(r),c=a(t).map(function(e){return Number(e)});return i&&(d=d.slice(0,-1),c=c.slice(0,-1)),{data:{labels:d,datasets:[{values:c}]},type:s,colors:l}}function l(){var e=$(u.fields_dict.chart_preview.wrapper),t=s(u.get_values(!0));Object.assign(t,{height:150}),e.empty(),new Chart(e[0],t),e.find(".chart-container .title, .chart-container .sub-title").hide(),e.show()}var d=t.filter(function(e,t){return o.includes(t)}),c=t.filter(function(e,t){return!o.includes(t)}),u=new frappe.ui.Dialog({title:__("Make Chart"),fields:[{fieldname:"y_field",label:"Y Field",fieldtype:"Select",options:d,default:d[0],onchange:l},{fieldname:"x_field",label:"X Field",fieldtype:"Select",options:c,default:c[0],onchange:l},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"chart_type",label:"Type of Chart",fieldtype:"Select",options:["Bar","Line","Percentage","Pie"],default:"Bar",onchange:l},{fieldname:"color",label:"Color",fieldtype:"Color",depends_on:function(e){return["Bar","Line"].includes(e.chart_type)},onchange:l},{fieldname:"sb_1",fieldtype:"Section Break",label:"Chart Preview"},{fieldname:"chart_preview",label:"Chart Preview",fieldtype:"HTML"}],primary_action_label:__("Make"),primary_action:function(t){var r=s(t);r.title=__(e.report_name+": "+t.y_field+" vs "+t.x_field),e.render_chart(r),u.hide()}});u.show(),setTimeout(l,500)}get_user_settings(){var e=this;return frappe.model.user_settings.get(this.report_name).then(function(t){e.user_settings=t})}prepare_columns(e){var t=this;return e.map(function(e){var r;if("string"==typeof e)if(e.includes(":")){var n,i=e.split(":"),o=i[0],a=i[1],s=i[2];a.includes("/")&&(a=(r=a.split("/"))[0],n=r[1]),e={label:o,fieldname:o,fieldtype:a,width:s,options:n}}else e={label:e,fieldname:e,fieldtype:"Data"};var l=function(e,t,r,n){return frappe.format(e,r,{for_print:!1,always_show_decimals:!0},n)},d=null;return"Date"===e.fieldtype&&(d=function(e,t){if(!e.content)return null;if(t.length!=="YYYY-MM-DD".length)return null;var r=frappe.datetime.user_to_obj(t);return[+frappe.datetime.str_to_obj(e.content),+r]}),Object.assign(e,{id:e.fieldname,name:e.label,width:parseInt(e.width)||null,editable:!1,compareValue:d,format:function(e,r,n,i){return t.report_settings.formatter?t.report_settings.formatter(e,r,n,i,l):l(e,0,n,i)}})})}prepare_data(e){var t=this;return e.map(function(e){var r={};return Array.isArray(e)?(t.columns.forEach(function(t,n){r[t.id]=e[n]}),r):e})}get_visible_columns(){var e=this;return this.datatable.datamanager.getColumns(!0).map(function(e){return e.id}).map(function(t){return e.columns.find(function(e){return e.id===t})}).filter(Boolean)}get_filter_values(e){var t=this.filters.filter(function(e){return e.df.reqd}).filter(function(e){return!e.get_value()});if(e&&t.length>0){var r=__("Please set filters");throw this.toggle_message(e,r),"Filter missing"}return this.filters.filter(function(e){return e.get_value()}).map(function(e){var t,r=e.get_value();return e.df.hidden&&(r=e.value),"%"===r&&(r=null),(t={})[e.df.fieldname]=r,t}).reduce(function(e,t){return Object.assign(e,t),e},{})}get_filter(e){var t=(this.filters||[]).find(function(t){return t.df.fieldname===e});return t||console.warn("[Query Report] Invalid filter: "+e),t}get_filter_value(e){var t=this.get_filter(e);return t?t.get_value():null}set_filter_value(e,t){var r=this,n={};"string"==typeof e?n[e]=t:n=e,this._no_refresh=!0,Object.keys(n).forEach(function(e,t,i){var o=n[e];t===i.length-1&&(r._no_refresh=!1),r.get_filter(e).set_value(o)})}set_breadcrumbs(){if(this.report_doc&&this.report_doc.ref_doctype){var e=frappe.get_meta(this.report_doc.ref_doctype);frappe.breadcrumbs.add(e.module)}}print_report(e){var t=this.report_settings.html_format||null,r=this.get_filters_html_for_print(),n="Landscape"==e.orientation;frappe.render_grid({template:t,title:__(this.report_name),subtitle:r,print_settings:e,landscape:n,filters:this.get_filter_values(),data:t?this.data:this.get_data_for_print(),columns:t?this.columns:this.get_columns_for_print(),report:this})}pdf_report(e){var t=frappe.urllib.get_base_url(),r=frappe.boot.print_css,n="Landscape"==e.orientation,i=this.report_settings.html_format||null,o=i?this.columns:this.get_columns_for_print(),a=i?this.data:this.get_data_for_print(),s=this.get_filter_values(),l=this.get_filters_html_for_print(),d=frappe.render_template(i||"print_grid",{title:__(this.report_name),subtitle:l,filters:s,data:a,columns:o,report:this}),c=frappe.render_template("print_template",{title:__(this.report_name),content:d,base_url:t,print_css:r,print_settings:e,landscape:n,columns:o});frappe.render_pdf(c,e)}get_filters_html_for_print(){var e=this.get_filter_values();return Object.keys(e).map(function(t){var r=frappe.query_report.get_filter(t).df.label,n=e[t];return"<h6>"+__(r)+": "+n+"</h6>"}).join("")}export_report(){var e=this;if(this.export_dialog)return this.export_dialog.clear(),void this.export_dialog.show();this.export_dialog=frappe.prompt([{label:__("Select File Format"),fieldname:"file_format",fieldtype:"Select",options:["Excel","CSV"],default:"Excel",reqd:1,onchange:function(){e.export_dialog.set_df_property("with_indentation","hidden","CSV"!==e.export_dialog.get_value("file_format"))}},{label:__("With Group Indentation"),fieldname:"with_indentation",fieldtype:"Check",hidden:1}],function(t){var r=t.file_format,n=t.with_indentation;if("CSV"===r){var i=e.columns.map(function(e){return e.label}),o=e.get_data_for_csv(n),a=[i].concat(o);frappe.tools.downloadify(a,null,e.report_name)}else{var s=e.get_filter_values(!0);frappe.urllib.get_dict("prepared_report_name")&&(s=Object.assign(frappe.urllib.get_dict("prepared_report_name"),s));var l=e.datatable.datamanager.getFilteredRowIndices();l.length+1===e.data.length&&l.push(l.length);var d={cmd:"frappe.desk.query_report.export_query",report_name:e.report_name,file_format_type:r,filters:s,visible_idx:l};open_url_post(frappe.request.url,d)}},__("Export Report: "+this.report_name),__("Download"))}get_data_for_csv(e){var t=this;return void 0===e&&(e=!1),this.datatable.datamanager.getFilteredRowIndices().map(function(e){return t.datatable.datamanager.getRow(e)}).map(function(r){var n=t.datatable.datamanager.getStandardColumnCount();return r.slice(n).map(function(t,n){return e&&0===n?"   ".repeat(r.meta.indent)+t.content:t.content})})}get_data_for_print(){var e=this,t=this.datatable.datamanager.getFilteredRowIndices().map(function(t){return e.data[t]}),r=this.datatable.bodyRenderer.getTotalRow().reduce(function(e,t){return e[t.column.id]=t.content,e},{});return t.push(r),t}get_columns_for_print(){return this.get_visible_columns()}get_menu_items(){var e=this;return[{label:__("Refresh"),action:function(){return e.refresh()},class:"visible-xs"},{label:__("Edit"),action:function(){return frappe.set_route("Form","Report",e.report_name)},condition:function(){return frappe.user.is_report_manager()},standard:!0},{label:__("Print"),action:function(){frappe.ui.get_print_settings(!1,function(t){return e.print_report(t)},e.report_doc.letter_head)},condition:function(){return frappe.model.can_print(e.report_doc.ref_doctype)},standard:!0},{label:__("PDF"),action:function(){frappe.ui.get_print_settings(!1,function(t){return e.pdf_report(t)},e.report_doc.letter_head)},condition:function(){return frappe.model.can_print(e.report_doc.ref_doctype)},standard:!0},{label:__("Export"),action:function(){return e.export_report()},standard:!0},{label:__("Setup Auto Email"),action:function(){return frappe.set_route("List","Auto Email Report",{report:e.report_name})},standard:!0},{label:__("User Permissions"),action:function(){return frappe.set_route("List","User Permission",{doctype:"Report",name:e.report_name})},condition:function(){return frappe.model.can_set_user_permissions("Report")},standard:!0},{label:__("Add to Desktop"),action:function(){return frappe.add_to_desktop(e.report_name,null,e.report_name)},standard:!0}]}setup_report_wrapper(){if(!this.$report){var e=this.page.main.find(".page-form");this.$status=$('<div class="form-message text-muted small"></div>').hide().insertAfter(e),this.$chart=$('<div class="chart-wrapper">').hide().appendTo(this.page.main),this.$report=$('<div class="report-wrapper">').appendTo(this.page.main),this.$message=$(this.message_div("")).hide().appendTo(this.page.main)}}show_status(e){this.$status.html(e).show()}hide_status(){this.$status.hide()}show_footer_message(){var e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10)."),t=__("Execution Time: {0} sec",[this.execution_time||.1]);this.page.footer.removeClass("hide").addClass("text-muted col-md-12").html('\n\t\t\t<span class="text-left col-md-6">'+e+'</span><span class="text-right col-md-6">'+t+"</span>\n\t\t"),this.page.wrapper.find(".tree-footer").remove(),this.tree_report&&(this.$tree_footer=this.page.footer.clone().addClass("tree-footer"),this.$tree_footer.html('<div class="col-md-12">\n\t\t\t\t<button class="btn btn-xs btn-default" data-action="expand_all_rows">\n\t\t\t\t\t'+__("Expand All")+'</button>\n\t\t\t\t<button class="btn btn-xs btn-default" data-action="collapse_all_rows">\n\t\t\t\t\t'+__("Collapse All")+"</button>\n\t\t\t</div>"),this.page.footer.before(this.$tree_footer)),this.$tree_footer.find("[data-action=collapse_all_rows]").show(),this.$tree_footer.find("[data-action=expand_all_rows]").hide()}expand_all_rows(){this.$tree_footer.find("[data-action=expand_all_rows]").hide(),this.datatable.rowmanager.expandAllNodes(),this.$tree_footer.find("[data-action=collapse_all_rows]").show()}collapse_all_rows(){this.$tree_footer.find("[data-action=collapse_all_rows]").hide(),this.datatable.rowmanager.collapseAllNodes(),this.$tree_footer.find("[data-action=expand_all_rows]").show()}message_div(e){return"<div class='flex justify-center align-center text-muted' style='height: 50vh;'>\n\t\t\t<div>"+e+"</div>\n\t\t</div>"}reset_report_view(){this.hide_status(),this.toggle_nothing_to_show(!0),this.refresh()}toggle_loading(e){this.toggle_message(e,__("Loading")+"...")}toggle_nothing_to_show(e){var t=this.prepared_report?__("This is a background report. Please set the appropriate filters and then generate a new one."):__("Nothing to show");this.toggle_message(e,t),e&&this.prepared_report&&(this.prepared_report_action="New",this.add_prepared_report_buttons())}toggle_message(e,t){e?(this.$message.find("div").html(t),this.$message.show()):this.$message.hide(),this.$report.toggle(!e),this.$chart.toggle(!e)}get get_values(){return this.get_filter_values}},Object.defineProperty(frappe,"query_report_filters_by_name",{get:function(){return console.warn("[Query Report] frappe.query_report_filters_by_name is deprecated. Please use the new api: frappe.query_report.get_filter_value(fieldname) and frappe.query_report.set_filter_value(fieldname, value)"),null}}),frappe.provide("frappe.report_dump"),$.extend(frappe.report_dump,{data:{},last_modified:{},with_data:function(e,t){var r=Object.keys(frappe.report_dump.last_modified);return frappe.call({method:"frappe.desk.report_dump.get_data",type:"GET",args:{doctypes:e,last_modified:frappe.report_dump.last_modified},freeze:!0,callback:function(e){$.each(e.message,function(e,t){frappe.report_dump.set_data(e,t)}),$.each(e.message,function(e,t){in_list(r,e)||t.links&&$.each(frappe.report_dump.data[e],function(e,r){$.each(t.links,function(e,t){frappe.report_dump.data[t[0]][r[e]]?r[e]=frappe.report_dump.data[t[0]][r[e]][t[1]]:r[e]=null})})}),t()}})},set_data:function(e,t){var r=[],n={},i=function(r){var n={};return $.each(t.columns,function(e,t){n[t]=r[e]}),n.id=n.name,n.doctype=e,n};frappe.report_dump.last_modified[e]?($.each(t.data,function(e,t){var r=i(t);n[r.name]=r}),$.each(frappe.report_dump.data[e],function(e,i){n[i.name]?(r.push(n[i.name]),delete n[i.name]):-1!==t.modified_names.indexOf(i.name)||r.push(i)}),$.each(n,function(e,t){r.push(t)})):$.each(t.data,function(e,t){r.push(i(t))}),frappe.report_dump.last_modified[e]=t.last_modified,frappe.report_dump.data[e]=r}}),frappe.provide("frappe.views"),frappe.views.GridReport=Class.extend({init:function(e){this.filter_inputs={},this.preset_checks=[],this.tree_grid={show:!1},$.extend(this,e),this.wrapper=$('<div class="grid-report"></div>').appendTo(this.page.main),this.page.main.find(".page").css({"padding-top":"0px"}),this.filters&&this.make_filters(),this.make_waiting(),this.get_data_and_refresh()},bind_show:function(){var e=this;$(this.page).bind("show",function(){frappe.cur_grid_report=e,e.get_data_and_refresh()})},get_data_and_refresh:function(){var e=this;this.get_data(function(){e.apply_filters_from_route(),e.refresh()})},get_data:function(e){var t=this;frappe.report_dump.with_data(this.doctypes,function(){t.setup_filters_done||(t.setup_filters(),t.setup_filters_done=!0),e()})},setup_filters:function(){var e=this;$.each(e.filter_inputs,function(t,r){var n=r.get(0).opts;"Select"==n.fieldtype&&in_list(e.doctypes,n.link)?$(r).add_options(frappe.report_dump.data[n.link].map(function(e){return e.name})):"Link"==n.fieldtype&&in_list(e.doctypes,n.link)&&(n.list=frappe.report_dump.data[n.link].map(function(e){return e.name}),e.set_autocomplete(r,n.list))}),this.page.set_primary_action(__("Refresh"),function(){e.get_data(function(){e.refresh()})}),this.filter_inputs&&this.page.add_menu_item(__("Reset Filters"),function(){e.init_filter_values(),e.refresh()},!0),this.page.add_menu_item(__("Print"),function(){frappe.ui.get_print_settings(!1,function(t){frappe.render_grid({grid:e.grid,title:e.page.title,print_settings:t,report:e})})},!0),this.filter_inputs.range&&this.filter_inputs.range.on("change",function(){e.refresh()})},set_filter:function(e,t){var r=this.filter_inputs[e];if(r){var n=r.get(0).opts;"Check"===n.fieldtype&&r.prop("checked",!!cint(t)),"Date"==n.fieldtype?r.val(frappe.datetime.str_to_user(t)):r.val(t)}else frappe.msgprint(__("Invalid Filter: {0}",[e]))},set_autocomplete:function(e,t){var r=this;new Awesomplete(e.get(0),{list:t}),e.on("awesomplete-select",function(t){var n=t.originalEvent.text.value;e.val(n),r.refresh()})},init_filter_values:function(){$.each(this.filter_inputs,function(e,t){var r=t.get(0).opts;frappe.sys_defaults[e]?t.val(frappe.sys_defaults[e]):"Select"==r.fieldtype?t.get(0).selectedIndex=0:"Data"==r.fieldtype?t.val(""):"Link"==r.fieldtype&&t.val("")}),this.set_default_values()},set_default_values:function(){var e={from_date:frappe.datetime.str_to_user(frappe.sys_defaults.year_start_date),to_date:frappe.datetime.str_to_user(frappe.sys_defaults.year_end_date)},t=this;$.each(e,function(e,r){t.filter_inputs[e]&&!t.filter_inputs[e].val()&&t.filter_inputs[e].val(r)})},make_filters:function(){var e=this;$.each(this.filters,function(t,r){r.fieldname=r.fieldname||r.label.replace(/ /g,"_").toLowerCase();var n=null;"Select"==r.fieldtype?n=e.page.add_select(r.label,r.options||[r.default_value]):"Link"==r.fieldtype?(n=e.page.add_data(r.label),new Awesomplete(n.get(0),{list:r.list||[]})):"Button"===r.fieldtype&&r.label===__("Refresh")?n=e.page.set_primary_action(r.label,null,r.icon):"Button"===r.fieldtype?n=e.page.add_menu_item(r.label,null,!0):"Date"===r.fieldtype?n=e.page.add_date(r.label):"Label"===r.fieldtype?n=e.page.add_label(r.label):"Data"===r.fieldtype?n=e.page.add_data(r.label):"Check"===r.fieldtype&&(n=e.page.add_check(r.label)),n&&(n&&(n.get(0).opts=r),r.cssClass&&n.addClass(r.cssClass),n.keypress(function(t){13==t.which&&e.refresh()})),e.filter_inputs[r.fieldname]=n})},make_waiting:function(){this.waiting=frappe.messages.waiting(this.wrapper,__("Loading Report")+"...")},load_filter_values:function(){var e=this;$.each(this.filter_inputs,function(t,r){var n=r.get(0).opts;"Check"==n.fieldtype?e[n.fieldname]=r.prop("checked")?1:0:"Button"!=n.fieldtype&&(e[n.fieldname]=r.val(),"Date"==n.fieldtype?e[n.fieldname]=frappe.datetime.user_to_str(e[n.fieldname]):"Select"==n.fieldtype&&(e[n.fieldname+"_default"]=n.default_value))}),this.filter_inputs.from_date&&this.filter_inputs.to_date&&this.to_date<this.from_date&&frappe.msgprint(__("From Date must be before To Date"))},make_name_map:function(e,t){var r={};return t=t||"name",$.each(e,function(e,n){r[n[t]]=n}),r},reset_item_values:function(e){var t=this;$.each(this.columns,function(r,n){n.formatter==t.currency_formatter&&(e[n.id]=0)})},round_item_values:function(e){var t=this;$.each(this.columns,function(r,n){n.formatter==t.currency_formatter&&(e[n.id]=flt(e[n.id],frappe.defaults.get_default("float_precision")||3))})},round_off_data:function(){var e=this;$.each(this.data,function(t,r){e.round_item_values(r)})},refresh:function(){this.waiting.toggle(!1),this.grid_wrapper||this.make(),this.load_filter_values(),this.setup_columns(),this.setup_dataview_columns(),this.apply_link_formatters(),this.prepare_data(),this.round_off_data(),this.prepare_data_view(),frappe.show_alert("Updated",2),this.render(),this.setup_chart&&this.setup_chart()},setup_dataview_columns:function(){this.columns=this.columns.filter(function(e){return!e.hidden}),this.datatable_columns=this.columns.map(function(e){return Object.assign(e,{format:function(e,t,r,n){return r.formatter?r.formatter(t,{},e,r,n):e||""}})})},make:function(){var e=this;this.chart_area=$('<div class="chart" style="padding-bottom: 1px"></div>').appendTo(this.wrapper),this.page.add_menu_item(__("Export"),function(){return e.export()},!0),this.grid_wrapper=$("<div style='height: 500px;'>").appendTo(this.wrapper),this.id=frappe.dom.set_unique_id(this.grid_wrapper.get(0)),this.bind_show(),frappe.cur_grid_report=this,$(this.wrapper).trigger("make")},apply_filters_from_route:function(){var e=this;frappe.route_options?($.each(frappe.route_options,function(t,r){e.set_filter(t,r)}),frappe.route_options=null):this.init_filter_values(),this.set_default_values(),$(this.wrapper).trigger("apply_filters_from_route")},options:{editable:!1,enableColumnReorder:!1},render:function(){var e=this;this.datatable=new DataTable("#"+this.id,{columns:this.datatable_columns,data:this.data,layout:"fixed",inlineFilters:!0,treeView:!0,checkboxColumn:!0,checkedRowStatus:!1,events:{onCheckRow:function(t){var r=t.meta.rowIndex,n=e.datatable.rowmanager.checkMap[r];e.datatable.datamanager.getData(r).checked=Boolean(n),e.setup_chart&&e.setup_chart()}},hooks:{columnTotal:frappe.utils.report_column_total}}),this.data.forEach(function(t,r){t.checked&&e.datatable.rowmanager.checkRow(r,!0)})},prepare_data_view:function(){},export:function(){return frappe.tools.downloadify(frappe.slickgrid_tools.get_view_data(this.columns,this.dataView),["Report Manager","System Manager"],this.title),!1},apply_filters:function(e){var t=this.filter_inputs;if(e._show)return!0;for(var r in t)if(!this.apply_filter(e,r))return!1;return!0},apply_filter:function(e,t){var r=this.filter_inputs[t].get(0);return!(r.opts.filter&&!r.opts.filter(this[r.opts.fieldname],e,r.opts,this))},apply_zero_filter:function(e,t,r,n){if(!n.show_zero){for(var i=0,o=n.columns.length;i<o;i++){var a=n.columns[i];if(a.formatter==n.currency_formatter&&!a.hidden&&(flt(t[a.field])>.001||flt(t[a.field])<-.001))return!0}return!1}return!0},show_zero_check:function(){var e=this;this.wrapper.bind("make",function(){e.wrapper.find(".show-zero").toggle(!0).find("input").click(function(){e.refresh()})})},is_default:function(e){return this[e]==this[e+"_default"]},date_formatter:function(e,t,r){return frappe.datetime.str_to_user(r)},currency_formatter:function(e,t,r,n,i){return isNaN(r)&&(r=""),repl('<div style="text-align: right; %(_style)s">%(value)s</div>',{_style:i._style||"",value:null==r||""===r?"":format_number(r)})},text_formatter:function(e,t,r,n,i){return repl('<span style="%(_style)s" title="%(esc_value)s">%(value)s</span>',{_style:i._style||"",esc_value:cstr(r).replace(/"/g,'\\"'),value:cstr(r)})},check_formatter:function(e,t,r,n,i){return repl('<input type="checkbox" data-id="%(id)s" \t\t\tclass="chart-check" %(checked)s>',{id:i.id,checked:i.checked?'checked="checked"':""})},apply_link_formatters:function(){$.each(this.columns,function(i,col){col.link_formatter&&(col.formatter=function(row,cell,value,columnDef,dataContext,for_print){if(!value)return"";if(for_print)return value;var me=frappe.cur_grid_report,html;if(dataContext._show)return repl('<span style="%(_style)s">%(value)s</span>',{_style:dataContext._style||"",value:value});var link_formatter=me.dataview_columns[cell].link_formatter;if(html=link_formatter.filter_input?repl("<a href=\"#\" \t\t\t\t\t\t\tonclick=\"frappe.cur_grid_report.set_filter('%(col_name)s', '%(value)s'); \t\t\t\t\t\t\t\tfrappe.cur_grid_report.refresh(); return false;\">\t\t\t\t\t\t\t%(value)s</a>",{value:value,col_name:link_formatter.filter_input,page_name:frappe.container.page.page_name}):value,link_formatter.open_btn){var doctype=link_formatter.doctype?eval(link_formatter.doctype):dataContext.doctype;html+=me.get_link_open_icon(doctype,value)}return html})})},get_link_open_icon:function(e,t){return repl(' <a href="#Form/%(doctype)s/%(name)s">\t\t\t<i class="fa fa-share" style="cursor: pointer;"></i></a>',{doctype:e,name:encodeURIComponent(t)})},make_date_range_columns:function(){this.columns=[];var e=this,t=this.filter_inputs.range.val();this.from_date=frappe.datetime.user_to_str(this.filter_inputs.from_date.val()),this.to_date=frappe.datetime.user_to_str(this.filter_inputs.to_date.val());var r=frappe.datetime.get_diff(this.to_date,this.from_date);e.column_map={},e.last_date=null;var n=function(t){e.columns.push({id:t,name:frappe.datetime.str_to_user(t),field:t,formatter:e.currency_formatter,width:100})},i=function(t){for(var i=0;i<=r;i++){var o=frappe.datetime.add_days(e.from_date,i);t||(t=function(){return!0}),t(o)&&n(o),e.last_date=o,e.columns.length&&(e.column_map[o]=e.columns[e.columns.length-1])}};"Daily"==t?i():"Weekly"==t?i(function(t){return!e.last_date||!(frappe.datetime.get_diff(t,e.from_date)%7)}):"Monthly"==t?i(function(t){return!e.last_date||frappe.datetime.str_to_obj(e.last_date).getMonth()!=frappe.datetime.str_to_obj(t).getMonth()}):"Quarterly"==t?i(function(t){return!e.last_date||1==frappe.datetime.str_to_obj(t).getDate()&&in_list([0,3,6,9],frappe.datetime.str_to_obj(t).getMonth())}):"Yearly"==t&&i(function(t){return!e.last_date||$.map(frappe.report_dump.data["Fiscal Year"],function(e){return t==e.year_start_date||null}).length}),$.each(this.columns,function(t,r){r.name=e.columns[t+1]?frappe.datetime.str_to_user(frappe.datetime.add_days(e.columns[t+1].id,-1)):frappe.datetime.str_to_user(e.to_date)})},trigger_refresh_on_change:function(e){var t=this;$.each(e,function(e,r){t.filter_inputs[r]&&t.filter_inputs[r].on("change",function(){t.refresh()})})}}),frappe.views.GridReportWithPlot=frappe.views.GridReport.extend({setup_chart:function(){if(in_list(["Daily","Weekly"],this.filter_inputs.range.val()))this.chart_area.toggle(!1);else{this.chart_area.toggle(!0);var e=this.get_chart_data?this.get_chart_data():null,t=this.wrapper.find(".chart")[0];this.chart=new Chart(t,{height:200,data:e,type:"line"})}},get_chart_data:function(){var e=this,t=[];$.each(e.columns,function(r,n){n.formatter!=e.currency_formatter||n.hidden||!1===n.plot||t.push(n.field)});var r={labels:t,datasets:[]};return $.each(this.data,function(e,n){if(n.checked){var i={};i.name=n.name,i.values=[],$.each(t,function(e,t){i.values.push(n[t])}),r.datasets.push(i)}}),r}}),frappe.views.TreeGridReport=frappe.views.GridReportWithPlot.extend({make_transaction_list:function(e,t){var r=this,n={};$.each(frappe.report_dump.data[t],function(e,t){n[t.parent]||(n[t.parent]=[]),n[t.parent].push(t)}),this.tl||(this.tl={}),this.tl[e]||(this.tl[e]=[]),$.each(frappe.report_dump.data[e],function(t,i){n[i.name]&&$.each(n[i.name],function(t,n){r.tl[e].push($.extend(copy_dict(i),n))})})},add_tree_grid_events:function(){var e=this;this.grid.onClick.subscribe(function(t,r){if($(t.target).hasClass("toggle")){var n=e.dataView.getItem(r.row);n&&(n._collapsed?n._collapsed=!1:n._collapsed=!0,e.dataView.updateItem(n.id,n)),t.stopImmediatePropagation()}})},tree_formatter:function(e,t,r,n,i){var o=frappe.cur_grid_report,a=o.data,s="<span style='display:inline-block;height:1px;width:"+15*i.indent+"px'></span>",l=o.dataView.getIdxById(i.id),d=o.tree_grid.formatter(i);return i.doctype&&(d+=o.get_link_open_icon(i.doctype,i.name)),a[l+1]&&a[l+1].indent>a[l].indent?i._collapsed?s+" <span class='toggle expand'></span>&nbsp;"+d:s+" <span class='toggle collapse'></span>&nbsp;"+d:s+" <span class='toggle'></span>&nbsp;"+d},tree_dataview_filter:function(e){var t=frappe.cur_grid_report;if(!t.apply_filters(e))return!1;for(var r=e[t.tree_grid.parent_field];r;){if(t.item_by_name[r]._collapsed)return!1;r=t.parent_map[r]}return!0},prepare_tree:function(e,t){var r=frappe.report_dump.data[t],n=frappe.report_dump.data[e],i=this,o={},a=r.map(function(e){return e.id});$.each(n,function(e,t){var r=t[i.tree_grid.parent_field];o[r]||(o[r]=[]),-1==a.indexOf(t.name)?o[r].push(t):frappe.msgprint(__("Ignoring Item {0}, because a group exists with the same name!",[t.name.bold()]))});var s=[];return $.each(r,function(e,t){t.is_group=!0,s.push(t),s=s.concat(o[t.name]||[])}),s},set_indent:function(){var e=this;$.each(this.data,function(t,r){var n=0,i=e.parent_map[r.name];if(i)for(;i;)n++,i=e.parent_map[i];r.indent=n})},export:function(){var e=frappe.msgprint($.format('<p>{0}</p>\t\t\t<p><input type="checkbox" name="with_groups" checked="checked"> {1}</p>\t\t\t<p><input type="checkbox" name="with_ledgers" checked="checked"> {2}</p>\t\t\t<p><button class="btn btn-primary"> {3}</button>',[__("Select To Download:"),__("With Groups"),__("With Ledgers"),__("Download")])),t=this;return $(e.body).find("button").click(function(){var r=$(e.body).find("[name='with_groups']").prop("checked"),n=$(e.body).find("[name='with_ledgers']").prop("checked"),i=frappe.slickgrid_tools.get_view_data(t.columns,t.data,function(e,t){if(r)for(var i=0;i<t.indent;i++)e[0]="   "+e[0];return!(!r||1!=t.is_group&&!t.is_group)||!(!n||1==t.is_group||t.is_group)});return frappe.tools.downloadify(i,["Report Manager","System Manager"],t.title),!1}),!1}}),frappe.templates.print_grid=' {% if title %} <h2>{{ __(title) }}</h2> <hr> {% endif %} {% if subtitle %} {{ subtitle }} <hr> {% endif %} <table class="table table-bordered">          <thead>         <tr>         {% for col in columns %}             {% if col.name && col._id !== "_check" %}             <th style="min-width: {{ col.minWidth }}px"                 {% if col.docfield && frappe.model.is_numeric_field(col.docfield) %}                     class="text-right"                 {% endif %}>{{ __(col.name) }}</th>             {% endif %}         {% endfor %}         </tr>     </thead>          <tbody>         {% for row in data %}             <tr>             {% for col in columns %}                 {% if col.name && col._id !== "_check" %}                      {% var value = col.fieldname ? row[col.fieldname] : row[col.id]; %}                      <td>                         {{                             col.formatter                                 ? col.formatter(row._index, col._index, value, col, row, true)                                 : col.format                                     ? col.format(value, row, col, data)                                     : col.docfield                                         ? frappe.format(value, col.docfield)                                         : value                         }}                     </td>                 {% endif %}             {% endfor %}             </tr>         {% endfor %}     </tbody> </table>  ',frappe.templates.print_tree='<!DOCTYPE html> <html lang="en">   <head>     <meta charset="utf-8">     <meta http-equiv="X-UA-Compatible" content="IE=edge">     <meta name="viewport" content="width=device-width, initial-scale=1">     <meta name="description" content="">     <meta name="author" content="">     <title>{{ title }}</title>     <link href="{{ base_url }}/assets/frappe/css/bootstrap.css" rel="stylesheet">  <link type="text/css" rel="stylesheet"   href="{{ base_url }}/assets/frappe/css/font-awesome.css">  <link rel="stylesheet" type="text/css" href="{{ base_url }}/assets/frappe/css/tree.css">   <style>   {{ print_css }}  </style>  <style>   .tree.opened::before,    .tree-node.opened::before,    .tree:last-child::after,    .tree-node:last-child::after {    z-index: 1;    border-left: 1px solid #d1d8dd;    background: none;   }   .tree a,   .tree-link {    text-decoration: none;    cursor: default;   }   .tree.opened > .tree-children > .tree-node > .tree-link::before,    .tree-node.opened > .tree-children > .tree-node > .tree-link::before {    border-top: 1px solid #d1d8dd;    z-index: 1;    background: none;   }   i.fa.fa-fw.fa-folder {    z-index: 2;    position: relative;   }   .tree:last-child::after, .tree-node:last-child::after {    display: none;   }   .tree-node-toolbar {    display: none;   }   i.octicon.octicon-primitive-dot.text-extra-muted {    width: 7px;    height: 7px;    border-radius: 50%;    background: #d1d8dd;    display: inline-block;    position: relative;    z-index: 2;   }    @media (max-width: 767px) {    ul.tree-children {     padding-left: 20px;    }   }  </style>   </head>   <body>    <div class="print-format-gutter">     {% if print_settings.repeat_header_footer %}    <div id="footer-html" class="visible-pdf">     {% if print_settings.letter_head && print_settings.letter_head.footer %}      <div class="letter-head-footer">       {{ print_settings.letter_head.footer }}      </div>     {% endif %}     <p class="text-center small page-number visible-pdf">      {{ __("Page {0} of {1}", [`<span class="page"></span>`, `<span class="topage"></span>`]) }}     </p>    </div>     {% endif %}      <div class="print-format {% if landscape %} landscape {% endif %}">      {% if print_settings.letter_head %}      <div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>       <div class="letter-head">{{ print_settings.letter_head.header }}</div>      </div>     {% endif %}     <div class="tree opened">      {{ tree }}     </div>     </div>    </div>   </body> </html> ',exports.__moduleExports=clusterize_min,exports}({});
//# sourceMappingURL=report.min.js.map
