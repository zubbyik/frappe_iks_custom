!function(){"use strict";function LayoutRow(t,e){this.layout=t,this.wrapper=$a(e,"div","form-layout-row"),this.main_head=$a(this.wrapper,"div"),this.main_body=$a(this.wrapper,"div"),t.with_border&&(this.wrapper.style.border="1px solid #000",this.wrapper.style.borderBottom="0px"),this.header=$a(this.main_body,"div","",{padding:t.with_border?"0px 8px":"0px"}),this.body=$a(this.main_body,"div"),this.table=$a(this.body,"table","",{width:"100%",borderCollapse:"collapse",tableLayout:"fixed"}),this.row=this.table.insertRow(0),this.mycells=[]}function LayoutCell(t,e,r){if(r){var i=r+"";"px"!=i.substr(i.length-2,2)&&"%"!=i.substr(i.length-1,1)&&(r+="%")}this.width=r,this.layout=t;var a=e.row.cells.length;this.cell=e.row.insertCell(a),this.cell.style.verticalAlign="top",this.set_width(e.row,r);var n=$a(this.cell,"div","",{padding:t.with_border?"0px 8px":"0px"});this.wrapper=$a(this.cell,"div","",{padding:t.with_border?"8px":"0px"}),t.cur_cell=this.wrapper,t.cur_cell.header=n}window.Layout=function(t,e){t&&t.substr&&(t=$i(t)),this.wrapper=$a(t,"div","",{display:"none"}),e&&(this.width=this.wrapper.style.width),this.myrows=[]},Layout.prototype.addrow=function(){return this.cur_row=new LayoutRow(this,this.wrapper),this.myrows[this.myrows.length]=this.cur_row,this.cur_row},Layout.prototype.addsubrow=function(){return this.cur_row=new LayoutRow(this,this.cur_row.main_body),this.myrows[this.myrows.length]=this.cur_row,this.cur_row},Layout.prototype.addcell=function(t){return this.cur_row.addCell(t)},Layout.prototype.setcolour=function(t){$bg(cc,t)},Layout.prototype.show=function(){$(this.wrapper).toggle(!1)},Layout.prototype.hide=function(){$(this.wrapper).toggle(!1)},Layout.prototype.close_borders=function(){this.with_border&&(this.myrows[this.myrows.length-1].wrapper.style.borderBottom="1px solid #000")},LayoutRow.prototype.hide=function(){$(this.wrapper).toggle(!1)},LayoutRow.prototype.show=function(){$(this.wrapper).toggle(!0)},LayoutRow.prototype.addCell=function(t){var e=new LayoutCell(this.layout,this,t);return this.mycells[this.mycells.length]=e,e},LayoutCell.prototype.set_width=function(t,e){var r=100,i=t.cells.length,a=i;e?$y(t.cells[i-1],{width:cint(e)+"%"}):t.cells[i-1].estimated_width=1;for(var n=0;n<i;n++)t.cells[n].estimated_width||(r-=cint(t.cells[n].style.width),a--);for(n=0;n<i;n++)t.cells[n].estimated_width&&$y(t.cells[n],{width:cint(r/a)+"%"})},LayoutCell.prototype.show=function(){$(this.wrapper).toggle(!0)},LayoutCell.prototype.hide=function(){$(this.wrapper).toggle(!1)},frappe.printTable=Class.extend({init:function(t){$.extend(this,t),this.columns||(this.columns=this.get_columns()),this.data=this.get_data(),this.remove_empty_cols(),this.set_widths(),this.make()},get_columns:function(){var t=frappe.perm.get_perm(this.doctype);return["Sr"].concat($.map(frappe.meta.docfield_list[this.tabletype],function(e){return!cint(e.print_hide)&&t[e.permlevel]&&t[e.permlevel].read?e.fieldname:null}))},get_data:function(){for(var t=frappe.get_doc(this.doctype,this.docname)[this.fieldname]||[],e=[],r=0;r<t.length;r++)e.push(copy_dict(t[r]));return e},remove_empty_cols:function(){var t=this,e=[];$.each(this.data,function(r,i){$.each(t.columns,function(t,r){(i[r]||0==t)&&-1===e.indexOf(t)&&e.push(t)})});var r=[],i=[],a=[];e.sort(function(t,e){return t-e}),$.each(e,function(e,n){r.push(t.columns[n]),t.widths&&i.push(t.widths[n]),t.head_labels&&a.push(t.head_labels[n])}),this.columns=r,this.widths&&(this.widths=i),this.head_labels&&(this.head_labels=a)},make:function(){var t=this;this.tables=[];var e=[];$.each(this.data,function(r,i){e.push(i),i.page_break&&(t.add_table(e),e=[])}),e&&t.add_table(e)},add_table:function(t){var e=this,r=$("<div>"),i=$("<table>").css(this.table_style).appendTo(r),a=$("<tr>").appendTo(i);$.each(e.columns,function(t,r){var i=frappe.meta.docfield_map[e.tabletype][r];if(e.head_labels)var n=e.head_labels[t];else n=i?i.label:r;var l=$("<td>").html(__(n)).css(e.head_cell_style).css({width:e.widths[t]}).appendTo(a);i&&in_list(["Float","Currency"],i.fieldtype)&&l.css({"text-align":"right"})}),$.each(t,function(t,r){var a=!0;if(e.condition&&(a=e.condition(r)),a){var n=$("<tr>").appendTo(i);$.each(e.columns,function(t,i){if("sr"===i.toLowerCase())var a=r.idx;else a=r[i];var l=frappe.meta.docfield_map[e.tabletype][i];a=frappe.format(a,l,{for_print:!0}),r[i]=a,e.modifier&&e.modifier[i]&&(a=e.modifier[i](r));$("<td>").html(a).css(e.cell_style).css({width:e.widths[t]}).appendTo(n)})}}),this.tables.push(r)},set_widths:function(){var t=this;if(!this.widths){this.widths=$.map(this.columns,function(e,r){var i=frappe.meta.docfield_map[t.tabletype][e];return i&&i.print_width||("Sr"==e?30:80)});var e=0;$.each(this.widths,function(t,r){e+=cint(r)}),this.widths=$.map(this.widths,function(t){return((t=(flt(t)/e*100).toFixed(0))<5?5:t)+"%"})}},get_tables:function(){return this.tables.length>1?$.map(this.tables,function(t){return t.get(0)}):this.tables[0].get(0)},cell_style:{border:"1px solid #999",padding:"3px","vertical-align":"top","word-wrap":"break-word"},head_cell_style:{border:"1px solid #999",padding:"3px","vertical-align":"top","background-color":"#ddd","font-weight":"bold","word-wrap":"break-word"},table_style:{width:"100%","border-collapse":"collapse","margin-bottom":"10px","margin-top":"10px","table-layout":"fixed"}}),window.print_table=function(t,e,r,i,a,n,l,o,d,s){return new frappe.printTable({doctype:t,docname:e,fieldname:r,tabletype:i,columns:a,head_labels:n,widths:l,condition:o,cssClass:d,modifier:s}).get_tables()},_p.def_print_style_body="html, body, div, span, td, p { \t\tfont-family: inherit; \t\tfont-size: inherit; \t}\t.page-settings {\t\tfont-family: Helvetica, 'Open Sans', sans-serif;\t\tfont-size: 9pt;\t}\tpre { margin:0; padding:0;}",_p.def_print_style_other="\n.simpletable, .noborder { \t\tborder-collapse: collapse;\t\tmargin-bottom: 10px;\t}\t.simpletable td {\t\tborder: 1pt solid #777;\t\tvertical-align: top;\t\tpadding: 4px;\t}\t.noborder td {\t\tvertical-align: top;\t}",_p.go=function(t){var e=_p.preview(t);e.print(),e.close()},_p.preview=function(t){var e=window.open();if(e)return e.document.write(t),e.document.close(),e;frappe.msgprint(__("Please enable pop-ups"))},_f.get_value=function(t,e,r){if(locals[t]&&locals[t][e])return locals[t][e][r]},$.extend(_p,{show_dialog:function(){_p.dialog||_p.make_dialog(),_p.dialog.show()},make_dialog:function(){var t=new frappe.ui.Dialog({title:"Print Formats",fields:[{fieldtype:"Select",label:"Print Format",fieldname:"print_format",reqd:1},{fieldtype:"Check",label:"No Letter Head",fieldname:"no_letterhead"},{fieldtype:"HTML",options:'<p style="text-align: right;">\t\t\t\t\t<button class="btn btn-primary btn-print">Print</button>\t\t\t\t\t<button class="btn btn-default btn-preview">Preview</button>\t\t\t\t</p>'}]});t.$wrapper.find(".btn-print").click(function(){var e=t.get_values();_p.build(e.print_format,_p.go,e.no_letterhead)}),t.$wrapper.find(".btn-preview").click(function(){var e=t.get_values();_p.build(e.print_format,_p.preview,e.no_letterhead)}),t.on_page_show=function(){var e=t.fields_dict.print_format.$input;e.empty().add_options(cur_frm.print_preview.print_formats),cur_frm.$print_view_select&&cur_frm.$print_view_select.val()&&e.val(cur_frm.$print_view_select.val())},_p.dialog=t},formats:{},build:function(t,e,r,i,a){t||(t="Standard");var n={fmtname:t,onload:e,no_letterhead:r,only_body:i};if(cur_frm)if(frappe.model.can_print(cur_frm.doctype,cur_frm)){var l=locals[cur_frm.doctype][cur_frm.docname];if("Standard"==n.fmtname)n.onload(_p.render({body:_p.print_std(n.no_letterhead,a),style:_p.print_style,doc:l,title:l.name,no_letterhead:n.no_letterhead,no_heading:a,only_body:n.only_body}));else{var o=locals["Print Format"][n.fmtname];if(!o)return void frappe.msgprint(__("Unknown Print Format: {0}",[n.fmtname]));n.onload(_p.render({body:o.html,style:"",doc:l,title:l.name,no_letterhead:n.no_letterhead,no_heading:a,only_body:n.only_body}))}}else frappe.msgprint(__("You are not allowed to print this document"));else frappe.msgprint(__("No document selected"))},render:function(t){var e=document.createElement("div"),r="";t.no_heading||(r+=_p.show_draft(t),r+=_p.show_archived(t),r+=_p.show_cancelled(t)),e.innerHTML=t.body,_p.show_letterhead(e,t),_p.run_embedded_js(e,t.doc);var i=_p.consolidate_css(e,t);return _p.render_header_on_break(e,t),_p.render_final(i,r,e,t)},head_banner_format:function(){return"\t\t\t<div style = '\t\t\t\t\ttext-align: center; \t\t\t\t\tpadding: 8px; \t\t\t\t\tbackground-color: #CCC;'> \t\t\t\t<div style = '\t\t\t\t\t\tfont-size: 20px; \t\t\t\t\t\tfont-weight: bold;'>\t\t\t\t\t{{HEAD}}\t\t\t\t</div>\t\t\t\t{{DESCRIPTION}}\t\t\t</div>"},show_draft:function(t){var e=0,r=locals.DocPerm;for(var i in r){var a=r[i];if(a.parent==t.doc.doctype&&1==a.submit){e=1;break}}if(t.doc&&0==cint(t.doc.docstatus)&&e){var n=_p.head_banner_format();return n=(n=n.replace("{{HEAD}}","DRAFT")).replace("{{DESCRIPTION}}","This box will go away after the document is submitted.")}return""},show_archived:function(t){if(t.doc&&t.doc.__archived){var e=_p.head_banner_format();return e=(e=e.replace("{{HEAD}}","ARCHIVED")).replace("{{DESCRIPTION}}","You must restore this document to make it editable.")}return""},show_cancelled:function(t){if(t.doc&&2==t.doc.docstatus){var e=_p.head_banner_format();return e=(e=e.replace("{{HEAD}}","CANCELLED")).replace("{{DESCRIPTION}}","You must amend this document to make it editable.")}return""},consolidate_css:function(t,e){for(var r="",i=t.getElementsByTagName("style");i&&i.length>0;){for(var a in i)if(i[a]&&i[a].innerHTML){r+=i[a].innerHTML;var n=i[a].parentNode;n?n.removeChild(i[a]):t.removeChild(i[a])}i=t.getElementsByTagName("style")}return(e.only_body?"":_p.def_print_style_body)+_p.def_print_style_other+e.style+r},run_embedded_js:function(container,doc){for(var this$1=this,script_list=$(container).find("script"),i=0,j=script_list.length;i<j;i++){var element=script_list[i],code=element.innerHTML;try{var new_html=code&&eval(code)||""}catch(t){throw console.log("Error in Custom Script:"+t+"\n"+code),console.trace(t),t}in_list(["string","number"],typeof new_html)&&$(element).replaceWith(this$1.add_span(new_html+""))}$(container).find("script").remove()},add_span:function(t){for(var e=["<span","<p","<div","<br","<table"],r=!1,i=0;i<e.length;i++)if(t.match(e[i])){r=!0;break}return r||(t="<span>"+t+"</span>"),t},show_letterhead:function(t,e){e.no_letterhead||(t.innerHTML='<div style="max-width: 100%">'+_p.get_letter_head()+"</div>"+t.innerHTML)},render_header_on_break:function(t,e){var r=t.getElementsByClassName("page-settings");if(r.length)for(var i=0;i<r.length;i++){var a="";a+=_p.show_draft(e),a+=_p.show_archived(e),_p.show_letterhead(r[i],e),r[i].innerHTML=a+r[i].innerHTML}},render_final:function(t,e,r,i){if(i.only_body)a="",n="";else var a='<!DOCTYPE html><html>\t<head>\t\t<meta charset="utf-8" />\t\t<title>'+i.title+"</title>\t\t<style>"+t+"</style>\t</head>\t<body>",n="\t</body></html>";var l=a+'<div class="page-settings">'+e+r.innerHTML+"</div>"+n,o=window.location.href.split("desk")[0],d=$.unique(l.match(/src=['"]([^'"]*)['"]/g)||[]);return $.each(d,function(t,e){"src="==e.substr(0,4)&&("http"!=(e=e.substr(5,e.length-6)).substr(0,4)&&(l=l.split(e).join(o+lstrip(e,"/"))))}),l},get_letter_head:function(){var t="";return cur_frm.doc.letter_head?t=cstr(frappe.boot.letter_heads[cur_frm.doc.letter_head].header):frappe.boot.sysdefaults.default_letter_head_content&&(t=frappe.boot.sysdefaults.default_letter_head_content),t},print_style:"\t\t.datalabelcell { \t\t\tpadding: 2px 0px; \t\t\twidth: 38%; \t\t\tvertical-align: top; \t\t\t} \t\t.datainputcell { \t\t\tpadding: 2px 0px; \t\t\twidth: 62%; \t\t\ttext-align: left; \t\t\t}\t\t.sectionHeading { \t\t\tfont-size: 16px; \t\t\tfont-weight: bold; \t\t\tmargin: 8px 0px; \t\t\t} \t\t.columnHeading { \t\t\tfont-size: 14px; \t\t\tfont-weight: bold; \t\t\tmargin: 8px 0px; \t\t\t}",print_std:function(t,e){var r=cur_frm.docname,i=cur_frm.doctype,a=frappe.get_children("DocType",i,"fields"),n=_p.add_layout(i);this.pf_list=[n];var l=this;return l.layout=n,$.extend(this,{build_head:function(t,e,r){var i=$a(l.layout.cur_row.header,"h1","",{fontSize:"22px",marginBottom:"8px"});if(cur_frm.pformat[r])i.innerHTML=cur_frm.pformat[r];else{for(var a=null,n=0;n<t.length;n++)if("select_print_heading"===t[n].fieldname){a=_f.get_value(e,r,t[n].fieldname);break}i.innerHTML=a||__(e)}var o={fontSize:"16px",color:"#888",marginBottom:"8px",paddingBottom:"8px",borderBottom:l.layout.with_border?"0px":"1px solid #000"},d=$a(l.layout.cur_row.header,"div","",o);(d.innerHTML=r,cur_frm.state_fieldname&&!cur_frm.fields_dict[cur_frm.state_fieldname].df.print_hide)&&($a(d,"br"),$a(d,"span","",{padding:"3px",color:"#fff",backgroundColor:"#777",display:"inline-block"}).innerHTML=cur_frm.doc[cur_frm.state_fieldname])},build_data:function(e,r,i){e[0]&&"Section Break"!=e[0].fieldtype&&(l.layout.addrow(),"Column Break"!=e[0].fieldtype&&l.layout.addcell()),$.extend(this,{generate_custom_html:function(t,e,r){$a(l.layout.cur_cell,"div").innerHTML=cur_frm.pformat[t.fieldname](locals[e][r])},render_normal:function(e,a,n){switch(e.fieldtype){case"Fold":break;case"Section Break":l.layout.addrow(),a[n+1]&&"Column Break"!=a[n+1].fieldtype&&l.layout.addcell();break;case"Column Break":l.layout.addcell(e.width,e.label);break;case"Table":var o=print_table(r,i,e.fieldname,e.options,null,null,null,null);l.layout=_p.print_std_add_table(o,l.layout,l.pf_list,r,t);break;case"HTML":(d=$a(l.layout.cur_cell,"div")).innerHTML=cstr(e.options);break;case"Code":var d=$a(l.layout.cur_cell,"div"),s=_f.get_value(r,i,e.fieldname);d.innerHTML="<div>"+__(e.label)+': </div><pre style="font-family: Courier, Fixed;">'+(s||"")+"</pre>";break;case"Text Editor":d=$a(l.layout.cur_cell,"div"),s=_f.get_value(r,i,e.fieldname);d.innerHTML=s||"";break;default:_p.print_std_add_field(r,i,e,l.layout)}}});for(var a=0;a<e.length;a++){var n=e[a].fieldname?e[a].fieldname:e[a].label,o=n?frappe.meta.get_docfield(r,n,i):e[a];o.print_hide||(cur_frm.pformat[o.fieldname]?this.generate_custom_html(o,r,i):this.render_normal(o,e,a))}l.layout.close_borders()},build_html:function(){for(var t="",e=0;e<l.pf_list.length;e++)l.pf_list[e].wrapper?t+=l.pf_list[e].wrapper.innerHTML:l.pf_list[e].innerHTML?t+=l.pf_list[e].innerHTML:t+=l.pf_list[e];return this.pf_list=[],t}}),e||this.build_head(a,i,r),this.build_data(a,i,r),this.build_html()},add_layout:function(t){var e=new Layout;return e.addrow(),"Yes"==locals.DocType[t].print_outline&&(e.with_border=1),e},print_std_add_table:function(t,e,r,i,a){if(t.appendChild)e.cur_cell.appendChild(t);else{for(var n=0;n<t.length-1;n++){e.cur_cell.appendChild(t[n]),e.close_borders(),r.push('\n\t\t\t\t<div style = "page-break-after: always;" \t\t\t\tclass = "page_break"></div><div class="page-settings"></div>'),e=_p.add_layout(i,a),r.push(e),e.addrow(),e.addcell();var l=$a(e.cur_cell,"div");l.innerHTML="Continued from previous page...",l.style.padding="4px"}e.cur_cell.appendChild(t[t.length-1])}return e},print_std_add_field:function(t,e,r,i){var a=_f.get_value(t,e,r.fieldname);if("Button"!=r.fieldtype&&(a||in_list(["Float","Int","Currency"],r.fieldtype))){var n=_p.field_tab(i.cur_cell);n.cells[0].innerHTML=__(r.label?r.label:r.fieldname),n.cells[1].innerHTML=frappe.format(a,r,{for_print:!0}),"Currency"==r.fieldtype&&$y(n.cells[1],{textAlign:"left"})}},field_tab:function(t){var e=$a(t,"table","",{width:"100%"}).insertRow(0);return _p.row=e,e.insertCell(0),e.insertCell(1),e.cells[0].className="datalabelcell",e.cells[0].style.width="38%",e.cells[1].className="datainputcell",e}})}();
//# sourceMappingURL=print_format_v3.min.js.map
