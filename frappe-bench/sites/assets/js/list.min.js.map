{"version":3,"file":"list.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/model/indicator.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter_list.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/field_select.js","../../../apps/frappe/frappe/public/js/frappe/ui/tags.js","../../../apps/frappe/frappe/public/js/frappe/ui/tag_editor.js","../../../apps/frappe/frappe/public/js/frappe/ui/like.js","../../../apps/frappe/frappe/public/js/frappe/list/base_list.js","../../../apps/frappe/frappe/public/js/frappe/list/bulk_operations.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view.js","../../../apps/frappe/frappe/public/js/frappe/list/list_factory.js","../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js","../../../apps/frappe/frappe/public/js/frappe/views/file/file_view.js","../../../apps/frappe/frappe/public/js/frappe/views/interaction.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/views/gantt/gantt_view.js","../../../apps/frappe/frappe/public/js/frappe/views/calendar/calendar.js","../../../apps/frappe/frappe/public/js/frappe/views/image/image_view.js","../../../apps/frappe/frappe/public/js/frappe/views/kanban/kanban_view.js","../../../apps/frappe/frappe/public/js/frappe/views/inbox/inbox_view.js","../../../apps/frappe/frappe/public/js/frappe/views/treeview.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n\nfrappe.has_indicator = function(doctype) {\n\t// returns true if indicator is present\n\tif(frappe.model.is_submittable(doctype)) {\n\t\treturn true;\n\t} else if((frappe.listview_settings[doctype] || {}).get_indicator\n\t\t|| frappe.workflow.get_state_fieldname(doctype)) {\n\t\treturn true;\n\t} else if(frappe.meta.has_field(doctype, 'enabled')\n\t\t|| frappe.meta.has_field(doctype, 'disabled')) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfrappe.get_indicator = function(doc, doctype) {\n\tif(doc.__unsaved) {\n\t\treturn [__(\"Not Saved\"), \"orange\"];\n\t}\n\n\tif(!doctype) doctype = doc.doctype;\n\n\tvar workflow = frappe.workflow.workflows[doctype];\n\tvar without_workflow = workflow ? workflow['override_status'] : true;\n\n\tvar settings = frappe.listview_settings[doctype] || {};\n\n\tvar is_submittable = frappe.model.is_submittable(doctype),\n\t\tworkflow_fieldname = frappe.workflow.get_state_fieldname(doctype);\n\n\t// workflow\n\tif(workflow_fieldname && !without_workflow) {\n\t\tvar value = doc[workflow_fieldname];\n\t\tif(value) {\n\t\t\tvar colour = \"\";\n\n\t\t\tif(locals[\"Workflow State\"][value] && locals[\"Workflow State\"][value].style) {\n\t\t\t\tvar colour = {\n\t\t\t\t\t\"Success\": \"green\",\n\t\t\t\t\t\"Warning\": \"orange\",\n\t\t\t\t\t\"Danger\": \"red\",\n\t\t\t\t\t\"Primary\": \"blue\",\n\t\t\t\t}[locals[\"Workflow State\"][value].style];\n\t\t\t}\n\t\t\tif(!colour) colour = \"darkgrey\";\n\n\t\t\treturn [__(value), colour, workflow_fieldname + ',=,' + value];\n\t\t}\n\t}\n\n\t// draft if document is submittable\n\tif(is_submittable && doc.docstatus==0 && !settings.has_indicator_for_draft) {\n\t\treturn [__(\"Draft\"), \"red\", \"docstatus,=,0\"];\n\t}\n\n\t// cancelled\n\tif(is_submittable && doc.docstatus==2) {\n\t\treturn [__(\"Cancelled\"), \"red\", \"docstatus,=,2\"];\n\t}\n\n\tif(settings.get_indicator) {\n\t\tvar indicator = settings.get_indicator(doc);\n\t\tif(indicator) return indicator;\n\t}\n\n\t// if submittable\n\tif(is_submittable && doc.docstatus==1) {\n\t\treturn [__(\"Submitted\"), \"blue\", \"docstatus,=,1\"];\n\t}\n\n\t// based on status\n\tif(doc.status) {\n\t\treturn [__(doc.status), frappe.utils.guess_colour(doc.status)];\n\t}\n\n\t// based on enabled\n\tif(frappe.meta.has_field(doctype, 'enabled')) {\n\t\tif(doc.enabled) {\n\t\t\treturn [__('Enabled'), 'blue', 'enabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Disabled'), 'grey', 'enabled,=,0'];\n\t\t}\n\t}\n\n\t// based on disabled\n\tif(frappe.meta.has_field(doctype, 'disabled')) {\n\t\tif(doc.disabled) {\n\t\t\treturn [__('Disabled'), 'grey', 'disabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Enabled'), 'blue', 'disabled,=,0'];\n\t\t}\n\t}\n}\n","frappe.ui.Filter = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (this.value === null || this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\n\t\tthis.utils = frappe.ui.filter_utils;\n\t\tthis.conditions = [\n\t\t\t[\"=\", __(\"Equals\")],\n\t\t\t[\"!=\", __(\"Not Equals\")],\n\t\t\t[\"like\", __(\"Like\")],\n\t\t\t[\"not like\", __(\"Not Like\")],\n\t\t\t[\"in\", __(\"In\")],\n\t\t\t[\"not in\", __(\"Not In\")],\n\t\t\t[\"is\", __(\"Is\")],\n\t\t\t[\">\", \">\"],\n\t\t\t[\"<\", \"<\"],\n\t\t\t[\">=\", \">=\"],\n\t\t\t[\"<=\", \"<=\"],\n\t\t\t[\"Between\", __(\"Between\")],\n\t\t\t[\"descendants of\", __(\"Descendants Of\")],\n\t\t\t[\"not descendants of\", __(\"Not Descendants Of\")],\n\t\t\t[\"ancestors of\", __(\"Ancestors Of\")],\n\t\t\t[\"not ancestors of\", __(\"Not Ancestors Of\")]\n\t\t];\n\t\tthis.invalid_condition_map = {\n\t\t\tDate: ['like', 'not like'],\n\t\t\tDatetime: ['like', 'not like'],\n\t\t\tData: ['Between'],\n\t\t\tSelect: [\"Between\", \"<=\", \">=\", \"<\", \">\"],\n\t\t\tLink: [\"Between\"],\n\t\t\tCurrency: [\"Between\"],\n\t\t\tColor: [\"Between\"]\n\t\t};\n\t\tthis.make();\n\t\tthis.make_select();\n\t\tthis.set_events();\n\t\tthis.setup();\n\t}\n\n\tmake() {\n\t\tthis.filter_edit_area = $(frappe.render_template(\"edit_filter\", {\n\t\t\tconditions: this.conditions\n\t\t}))\n\t\t\t.appendTo(this.parent.find('.filter-edit-area'));\n\t}\n\n\tmake_select() {\n\t\tthis.fieldselect = new frappe.ui.FieldSelect({\n\t\t\tparent: this.filter_edit_area.find('.fieldname-select-area'),\n\t\t\tdoctype: this.parent_doctype,\n\t\t\tfilter_fields: this.filter_fields,\n\t\t\tselect: (doctype, fieldname) => {\n\t\t\t\tthis.set_field(doctype, fieldname);\n\t\t\t}\n\t\t});\n\n\t\tif(this.fieldname) {\n\t\t\tthis.fieldselect.set_value(this.doctype, this.fieldname);\n\t\t}\n\t}\n\n\tset_events() {\n\t\tthis.filter_edit_area.find(\"a.remove-filter\").on(\"click\", () => {\n\t\t\tthis.remove();\n\t\t});\n\n\t\tthis.filter_edit_area.find(\".set-filter-and-run\").on(\"click\", () => {\n\t\t\tthis.filter_edit_area.removeClass(\"new-filter\");\n\t\t\tthis.on_change();\n\t\t\tthis.update_filter_tag();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.condition').change(() => {\n\t\t\tif(!this.field) return;\n\n\t\t\tlet condition = this.get_condition();\n\t\t\tlet fieldtype = null;\n\n\t\t\tif([\"in\", \"like\", \"not in\", \"not like\"].includes(condition)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tthis.add_condition_help(condition);\n\t\t\t}\n\n\t\t\tif (['Select', 'MultiSelect'].includes(this.field.df.fieldtype) && [\"in\", \"not in\"].includes(condition)) {\n\t\t\t\tfieldtype = 'MultiSelect';\n\t\t\t}\n\n\t\t\tthis.set_field(this.field.df.parent, this.field.df.fieldname, fieldtype, condition);\n\t\t});\n\t}\n\n\tsetup() {\n\t\tconst fieldname = this.fieldname || 'name';\n\t\t// set the field\n\t\treturn this.set_values(this.doctype, fieldname, this.condition, this.value);\n\t}\n\n\tsetup_state(is_new) {\n\t\tlet promise = Promise.resolve();\n\t\tif (is_new) {\n\t\t\tthis.filter_edit_area.addClass(\"new-filter\");\n\t\t} else {\n\t\t\tpromise = this.update_filter_tag();\n\t\t}\n\n\t\tif(this.hidden) {\n\t\t\tpromise.then(() => this.$filter_tag.hide());\n\t\t}\n\t}\n\n\tfreeze() {\n\t\tthis.update_filter_tag();\n\t}\n\n\tupdate_filter_tag() {\n\t\tif (this._filter_value_set) {\n\t\t\treturn this._filter_value_set.then(() => {\n\t\t\t\t!this.$filter_tag ? this.make_tag() : this.set_filter_button_text();\n\t\t\t\tthis.filter_edit_area.hide();\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.filter_edit_area.remove();\n\t\tthis.$filter_tag && this.$filter_tag.remove();\n\t\tthis.field = null;\n\t\tthis.on_change(true);\n\t}\n\n\tset_values(doctype, fieldname, condition, value) {\n\t\t// presents given (could be via tags!)\n\t\tif (this.set_field(doctype, fieldname) === false) {\n\t\t\treturn\n\t\t}\n\n\t\tif(this.field.df.original_type==='Check') {\n\t\t\tvalue = (value==1) ? 'Yes' : 'No';\n\t\t}\n\t\tif(condition) this.set_condition(condition, true);\n\n\t\t// set value can be asynchronous, so update_filter_tag should happen after field is set\n\t\tthis._filter_value_set = Promise.resolve();\n\n\t\tif (['in', 'not in'].includes(condition) && Array.isArray(value)) {\n\t\t\tvalue = value.join(',');\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\tthis._filter_value_set = this.field.set_value(value);\n\t\t} else if (value !== undefined || value !== null) {\n\t\t\tthis._filter_value_set = this.field.set_value((value + '').trim());\n\t\t}\n\t\treturn this._filter_value_set;\n\t}\n\n\tset_field(doctype, fieldname, fieldtype, condition) {\n\t\t// set in fieldname (again)\n\t\tlet cur = {};\n\t\tif(this.field) for(let k in this.field.df) cur[k] = this.field.df[k];\n\n\t\tlet original_docfield = (this.fieldselect.fields_by_name[doctype] || {})[fieldname];\n\t\tif(!original_docfield) {\n\t\t\tconsole.warn(`Field ${fieldname} is not selectable.`);\n\t\t\tthis.remove();\n\t\t\treturn false;\n\t\t}\n\n\t\tlet df = copy_dict(original_docfield);\n\n\t\t// filter field shouldn't be read only or hidden\n\t\tdf.read_only = 0;\n\t\tdf.hidden = 0;\n\t\tdf.is_filter = true;\n\n\t\tlet c = condition ? condition : this.utils.get_default_condition(df);\n\t\tthis.set_condition(c);\n\n\t\tthis.utils.set_fieldtype(df, fieldtype, this.get_condition());\n\n\t\t// called when condition is changed,\n\t\t// don't change if all is well\n\t\tif(this.field && cur.fieldname == fieldname && df.fieldtype == cur.fieldtype &&\n\t\t\tdf.parent == cur.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\t// clear field area and make field\n\t\tthis.fieldselect.selected_doctype = doctype;\n\t\tthis.fieldselect.selected_fieldname = fieldname;\n\n\t\tthis.make_field(df, cur.fieldtype);\n\t}\n\n\tmake_field(df, old_fieldtype) {\n\t\tlet old_text = this.field ? this.field.get_value() : null;\n\t\tthis.hide_invalid_conditions(df.fieldtype, df.original_type);\n\t\tthis.hide_nested_set_conditions(df);\n\t\tlet field_area = this.filter_edit_area.find('.filter-field').empty().get(0);\n\t\tlet f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: field_area,\n\t\t\tonly_input: true,\n\t\t});\n\t\tf.refresh();\n\n\t\tthis.field = f;\n\t\tif(old_text && f.fieldtype===old_fieldtype) {\n\t\t\tthis.field.set_value(old_text);\n\t\t}\n\n\t\t// run on enter\n\t\t$(this.field.wrapper).find(':input').keydown(e => {\n\t\t\tif(e.which==13 && this.field.df.fieldtype !== 'MultiSelect') {\n\t\t\t\tthis.on_change();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_value() {\n\t\treturn [\n\t\t\tthis.fieldselect.selected_doctype,\n\t\t\tthis.field.df.fieldname,\n\t\t\tthis.get_condition(),\n\t\t\tthis.get_selected_value(),\n\t\t\tthis.hidden\n\t\t];\n\t}\n\tget_selected_value() {\n\t\treturn this.utils.get_selected_value(this.field, this.get_condition());\n\t}\n\n\tget_condition() {\n\t\treturn this.filter_edit_area.find('.condition').val();\n\t}\n\n\tset_condition(condition, trigger_change=false) {\n\t\tlet $condition_field = this.filter_edit_area.find('.condition');\n\t\t$condition_field.val(condition);\n\t\tif(trigger_change) $condition_field.change();\n\n\t}\n\n\tmake_tag() {\n\t\tthis.$filter_tag = this.get_filter_tag_element()\n\t\t\t.insertAfter(this.parent.find(\".active-tag-filters .add-filter\"));\n\t\tthis.set_filter_button_text();\n\t\tthis.bind_tag();\n\t}\n\n\tbind_tag() {\n\t\tthis.$filter_tag.find(\".remove-filter\").on(\"click\", this.remove.bind(this));\n\n\t\tlet filter_button = this.$filter_tag.find(\".toggle-filter\");\n\t\tfilter_button.on(\"click\", () => {\n\t\t\tfilter_button.closest('.tag-filters-area').find('.filter-edit-area').show();\n\t\t\tthis.filter_edit_area.toggle();\n\t\t});\n\t}\n\n\tset_filter_button_text() {\n\t\tthis.$filter_tag.find(\".toggle-filter\").html(this.get_filter_button_text());\n\t}\n\n\tget_filter_button_text() {\n\t\tlet value = this.utils.get_formatted_value(this.field, this.get_selected_value());\n\t\treturn `${__(this.field.df.label)} ${__(this.get_condition())} ${__(value)}`;\n\t}\n\n\tget_filter_tag_element() {\n\t\treturn $(`<div class=\"filter-tag btn-group\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-filter\"\n\t\t\t\ttitle=\"${ __(\"Edit Filter\") }\">\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-filter\"\n\t\t\t\ttitle=\"${ __(\"Remove Filter\") }\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button>\n\t\t</div>`);\n\t}\n\n\tadd_condition_help(condition) {\n\t\tlet $desc = this.field.desc_area;\n\t\tif(!$desc) {\n\t\t\t$desc = $('<div class=\"text-muted small\">').appendTo(this.field.wrapper);\n\t\t}\n\t\t// set description\n\t\t$desc.html((in_list([\"in\", \"not in\"], condition)===\"in\"\n\t\t\t? __(\"values separated by commas\")\n\t\t\t: __(\"use % as wildcard\"))+'</div>');\n\t}\n\n\thide_invalid_conditions(fieldtype, original_type) {\n\t\tlet invalid_conditions = this.invalid_condition_map[fieldtype] ||\n\t\t\tthis.invalid_condition_map[original_type] || [];\n\n\t\tfor (let condition of this.conditions) {\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"${condition[0]}\"]`).toggle(\n\t\t\t\t!invalid_conditions.includes(condition[0])\n\t\t\t);\n\t\t}\n\t}\n\n\thide_nested_set_conditions(df) {\n\t\tif ( !( df.fieldtype == \"Link\" && frappe.boot.nested_set_doctypes.includes(df.options))) {\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"descendants of\"]`).hide();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"not descendants of\"]`).hide();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"ancestors of\"]`).hide();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"not ancestors of\"]`).hide();\n\t\t}else {\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"descendants of\"]`).show();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"not descendants of\"]`).show();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"ancestors of\"]`).show();\n\t\t\tthis.filter_edit_area.find(`.condition option[value=\"not ancestors of\"]`).show();\n\t\t}\n\t}\n};\n\nfrappe.ui.filter_utils = {\n\tget_formatted_value(field, value) {\n\t\tif(field.df.fieldname===\"docstatus\") {\n\t\t\tvalue = {0:\"Draft\", 1:\"Submitted\", 2:\"Cancelled\"}[value] || value;\n\t\t} else if(field.df.original_type===\"Check\") {\n\t\t\tvalue = {0:\"No\", 1:\"Yes\"}[cint(value)];\n\t\t}\n\t\treturn frappe.format(value, field.df, {only_value: 1});\n\t},\n\n\tget_selected_value(field, condition) {\n\t\tlet val = field.get_value();\n\n\t\tif(typeof val==='string') {\n\t\t\tval = strip(val);\n\t\t}\n\n\t\tif(field.df.original_type == 'Check') {\n\t\t\tval = (val=='Yes' ? 1 :0);\n\t\t}\n\n\t\tif(condition.indexOf('like', 'not like')!==-1) {\n\t\t\t// automatically append wildcards\n\t\t\tif(val && !(val.startsWith('%') || val.endsWith('%'))) {\n\t\t\t\tval = '%' + val + '%';\n\t\t\t}\n\t\t} else if(in_list([\"in\", \"not in\"], condition)) {\n\t\t\tif(val) {\n\t\t\t\tval = val.split(',').map(v => strip(v));\n\t\t\t}\n\t\t} if(val === '%') {\n\t\t\tval = \"\";\n\t\t}\n\n\t\treturn val;\n\t},\n\n\tget_default_condition(df) {\n\t\tif (df.fieldtype == 'Data') {\n\t\t\treturn 'like';\n\t\t} else if (df.fieldtype == 'Date' || df.fieldtype == 'Datetime'){\n\t\t\treturn 'Between';\n\t\t} else {\n\t\t\treturn '=';\n\t\t}\n\t},\n\n\tset_fieldtype(df, fieldtype, condition) {\n\t\t// reset\n\t\tif(df.original_type)\n\t\t\tdf.fieldtype = df.original_type;\n\t\telse\n\t\t\tdf.original_type = df.fieldtype;\n\n\t\tdf.description = ''; df.reqd = 0;\n\t\tdf.ignore_link_validation = true;\n\n\t\t// given\n\t\tif(fieldtype) {\n\t\t\tdf.fieldtype = fieldtype;\n\t\t\treturn;\n\t\t}\n\n\t\t// scrub\n\t\tif(df.fieldname==\"docstatus\") {\n\t\t\tdf.fieldtype=\"Select\",\n\t\t\tdf.options=[\n\t\t\t\t{value:0, label:__(\"Draft\")},\n\t\t\t\t{value:1, label:__(\"Submitted\")},\n\t\t\t\t{value:2, label:__(\"Cancelled\")}\n\t\t\t];\n\t\t} else if(df.fieldtype=='Check') {\n\t\t\tdf.fieldtype='Select';\n\t\t\tdf.options='No\\nYes';\n\t\t} else if(['Text','Small Text','Text Editor','Code','Tag','Comments',\n\t\t\t'Dynamic Link','Read Only','Assign'].indexOf(df.fieldtype)!=-1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if(df.fieldtype=='Link' && ['=', '!=', 'descendants of', 'ancestors of', 'not descendants of', 'not ancestors of'].indexOf(condition)==-1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif(df.fieldtype===\"Data\" && (df.options || \"\").toLowerCase()===\"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t\tif(condition == \"Between\" && (df.fieldtype == 'Date' || df.fieldtype == 'Datetime')){\n\t\t\tdf.fieldtype = 'DateRange';\n\t\t}\n\t\tif (condition === 'is') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [\n\t\t\t\t{ label: __('Set'), value: 'set' },\n\t\t\t\t{ label: __('Not Set'), value: 'not set' },\n\t\t\t];\n\t\t}\n\t}\n};\n","frappe.ui.FilterGroup = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = this.parent;\n\t\tthis.filters = [];\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.wrapper.append(this.get_container_template());\n\t\tthis.set_events();\n\t}\n\n\tset_events() {\n\t\tthis.wrapper.find('.add-filter').on('click', () => {\n\t\t\tthis.add_filter(this.doctype, 'name');\n\t\t});\n\t}\n\n\tadd_filters(filters) {\n\t\tlet promises = [];\n\n\t\tfor (const filter of filters) {\n\t\t\tpromises.push(() => this.add_filter(...filter));\n\t\t}\n\n\t\treturn frappe.run_serially(promises);\n\t}\n\n\tadd_filter(doctype, fieldname, condition, value, hidden) {\n\t\tif (!fieldname) return Promise.resolve();\n\t\t// adds a new filter, returns true if filter has been added\n\n\t\t// {}: Add in page filter by fieldname if exists ('=' => 'like')\n\n\t\tif(!this.validate_args(doctype, fieldname)) return false;\n\n\t\tconst is_new_filter = arguments.length < 2;\n\t\tif (is_new_filter && this.wrapper.find(\".new-filter:visible\").length) {\n\t\t\t// only allow 1 new filter at a time!\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet args = [doctype, fieldname, condition, value, hidden];\n\t\t\tconst promise = this.push_new_filter(args, is_new_filter);\n\t\t\treturn (promise && promise.then) ? promise : Promise.resolve();\n\t\t}\n\t}\n\n\tvalidate_args(doctype, fieldname) {\n\t\tif(doctype && fieldname\n\t\t\t&& !frappe.meta.has_field(doctype, fieldname)\n\t\t\t&& !frappe.model.std_fields_list.includes(fieldname)) {\n\n\t\t\tfrappe.throw(__(`Invalid filter: \"${[fieldname.bold()]}\"`));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpush_new_filter(args, is_new_filter=false) {\n\t\t// args: [doctype, fieldname, condition, value]\n\t\tif(this.filter_exists(args)) return;\n\n\t\t// {}: Clear page filter fieldname field\n\n\t\tlet filter = this._push_new_filter(...args);\n\n\t\tif (filter && filter.value) {\n\t\t\tfilter.setup_state(is_new_filter);\n\t\t\treturn filter._filter_value_set; // internal promise\n\t\t}\n\t}\n\n\t_push_new_filter(doctype, fieldname, condition, value, hidden = false) {\n\t\tlet args = {\n\t\t\tparent: this.wrapper,\n\t\t\tparent_doctype: this.doctype,\n\t\t\tdoctype: doctype,\n\t\t\tfieldname: fieldname,\n\t\t\tcondition: condition,\n\t\t\tvalue: value,\n\t\t\thidden: hidden,\n\t\t\ton_change: (update) => {\n\t\t\t\tif(update) this.update_filters();\n\t\t\t\tthis.on_change();\n\t\t\t},\n\t\t\tfilter_items: (doctype, fieldname) => {\n\t\t\t\treturn !this.filter_exists([doctype, fieldname]);\n\t\t\t}\n\t\t};\n\t\tlet filter = new frappe.ui.Filter(args);\n\t\tthis.filters.push(filter);\n\t\treturn filter;\n\t}\n\n\tfilter_exists(filter_value) {\n\t\t// filter_value of form: [doctype, fieldname, condition, value]\n\t\tlet exists = false;\n\t\tthis.filters.filter(f => f.field).map(f => {\n\t\t\tlet f_value = f.get_value();\n\t\t\tif (filter_value.length === 2) {\n\t\t\t\texists = filter_value[0] === f_value[0] && filter_value[1] === f_value[1];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet value = filter_value[3];\n\t\t\tlet equal = frappe.utils.arrays_equal;\n\n\t\t\tif(equal(f_value.slice(0, 4), filter_value.slice(0, 4)) || (Array.isArray(value) && equal(value, f_value[3]))) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t});\n\t\treturn exists;\n\t}\n\n\tget_filters() {\n\t\treturn this.filters.filter(f => f.field).map(f => {\n\t\t\tf.freeze();\n\t\t\treturn f.get_value();\n\t\t});\n\t\t// {}: this.list.update_standard_filters(values);\n\t}\n\n\tupdate_filters() {\n\t\tthis.filters = this.filters.filter(f => f.field); // remove hidden filters\n\t}\n\n\tclear_filters() {\n\t\tthis.filters.map(f => f.remove(true));\n\t\t// {}: Clear page filters, .date-range-picker (called list run())\n\t\tthis.filters = [];\n\t}\n\n\tget_filter(fieldname) {\n\t\treturn this.filters.filter(f => {\n\t\t\treturn (f.field && f.field.df.fieldname==fieldname);\n\t\t})[0];\n\t}\n\n\tget_container_template() {\n\t\treturn $(`<div class=\"tag-filters-area\">\n\t\t\t<div class=\"active-tag-filters\">\n\t\t\t\t<button class=\"btn btn-default btn-xs add-filter text-muted\">\n\t\t\t\t\t\t${__(\"Add Filter\")}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"filter-edit-area\"></div>`);\n\t}\n};\n","// <select> widget with all fields of a doctype as options\nfrappe.ui.FieldSelect = Class.extend({\n\t// opts parent, doctype, filter_fields, with_blank, select\n\tinit(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fields_by_name = {};\n\t\tthis.options = [];\n\t\tthis.$input = $('<input class=\"form-control\">')\n\t\t\t.appendTo(this.parent)\n\t\t\t.on(\"click\", function () { $(this).select(); });\n\t\tthis.select_input = this.$input.get(0);\n\t\tthis.awesomplete = new Awesomplete(this.select_input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: me.options,\n\t\t\titem(item) {\n\t\t\t\treturn $(repl('<li class=\"filter-field-select\"><p>%(label)s</p></li>', item))\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.get(0);\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-select\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.selected_doctype = item.doctype;\n\t\t\tme.selected_fieldname = item.fieldname;\n\t\t\tif(me.select) me.select(item.doctype, item.fieldname);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-selectcomplete\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.$input.val(item.label);\n\t\t});\n\n\t\tif(this.filter_fields) {\n\t\t\tfor(var i in this.filter_fields)\n\t\t\t\tthis.add_field_option(this.filter_fields[i]);\n\t\t} else {\n\t\t\tthis.build_options();\n\t\t}\n\t\tthis.set_value(this.doctype, \"name\");\n\t},\n\tget_value() {\n\t\treturn this.selected_doctype ? this.selected_doctype + \".\" + this.selected_fieldname : null;\n\t},\n\tval(value) {\n\t\tif(value===undefined) {\n\t\t\treturn this.get_value();\n\t\t} else {\n\t\t\tthis.set_value(value);\n\t\t}\n\t},\n\tclear() {\n\t\tthis.selected_doctype = null;\n\t\tthis.selected_fieldname = null;\n\t\tthis.$input.val(\"\");\n\t},\n\tset_value(doctype, fieldname) {\n\t\tvar me = this;\n\t\tthis.clear();\n\t\tif(!doctype) return;\n\n\t\t// old style\n\t\tif(doctype.indexOf(\".\")!==-1) {\n\t\t\tvar parts = doctype.split(\".\");\n\t\t\tdoctype = parts[0];\n\t\t\tfieldname = parts[1];\n\t\t}\n\n\t\t$.each(this.options, function(i, v) {\n\t\t\tif(v.doctype===doctype && v.fieldname===fieldname) {\n\t\t\t\tme.selected_doctype = doctype;\n\t\t\t\tme.selected_fieldname = fieldname;\n\t\t\t\tme.$input.val(v.label);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tbuild_options() {\n\t\tvar me = this;\n\t\tme.table_fields = [];\n\t\tvar std_filters = $.map(frappe.model.std_fields, function(d) {\n\t\t\tvar opts = {parent: me.doctype};\n\t\t\tif(d.fieldname==\"name\") opts.options = me.doctype;\n\t\t\treturn $.extend(copy_dict(d), opts);\n\t\t});\n\n\t\t// add parenttype column\n\t\tvar doctype_obj = locals['DocType'][me.doctype];\n\t\tif(doctype_obj && cint(doctype_obj.istable)) {\n\t\t\tstd_filters = std_filters.concat([{\n\t\t\t\tfieldname: 'parent',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Parent',\n\t\t\t\tparent: me.doctype,\n\t\t\t}]);\n\t\t}\n\n\t\t// blank\n\t\tif(this.with_blank) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel:\"\",\n\t\t\t\tvalue:\"\",\n\t\t\t});\n\t\t}\n\n\t\t// main table\n\t\tvar main_table_fields = std_filters.concat(frappe.meta.docfield_list[me.doctype]);\n\t\t$.each(frappe.utils.sort(main_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\tme.add_field_option(df);\n\t\t});\n\n\t\t// child tables\n\t\t$.each(me.table_fields, function(i, table_df) {\n\t\t\tif(table_df.options) {\n\t\t\t\tvar child_table_fields = [].concat(frappe.meta.docfield_list[table_df.options]);\n\t\t\t\t$.each(frappe.utils.sort(child_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\") && !df.report_hide)\n\t\t\t\t\t\tme.add_field_option(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_field_option(df) {\n\t\tif (df.fieldname == 'docstatus' && !frappe.model.is_submittable(this.doctype))\n\t\t\treturn;\n\n\t\tvar me = this;\n\t\tvar label, table;\n\t\tif(me.doctype && df.parent==me.doctype) {\n\t\t\tlabel = __(df.label);\n\t\t\ttable = me.doctype;\n\t\t\tif(df.fieldtype=='Table') me.table_fields.push(df);\n\t\t} else {\n\t\t\tlabel = __(df.label) + ' (' + __(df.parent) + ')';\n\t\t\ttable = df.parent;\n\t\t}\n\n\t\tif(frappe.model.no_value_type.indexOf(df.fieldtype) == -1 &&\n\t\t\t!(me.fields_by_name[df.parent] && me.fields_by_name[df.parent][df.fieldname])) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel: label,\n\t\t\t\tvalue: table + \".\" + df.fieldname,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tdoctype: df.parent\n\t\t\t});\n\t\t\tif(!me.fields_by_name[df.parent]) me.fields_by_name[df.parent] = {};\n\t\t\tme.fields_by_name[df.parent][df.fieldname] = df;\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.Tags = class {\n\tconstructor({\n\t\tparent, placeholder, tagsList,\n\t\tonTagAdd,\n\t\tonTagRemove,\n\t\tonTagClick,\n\t\tonChange\n\t}) {\n\t\tthis.tagsList = tagsList || [];\n\t\tthis.onTagAdd = onTagAdd;\n\t\tthis.onTagRemove = onTagRemove;\n\t\tthis.onTagClick = onTagClick;\n\t\tthis.onChange = onChange;\n\n\t\tthis.setup(parent, placeholder);\n\t}\n\n\tsetup(parent, placeholder) {\n\t\tthis.$wrapper = $(`<div class=\"tags-wrapper\"></div>`).appendTo(parent);\n\t\tthis.$ul = $(`<ul class=\"tags-list\"></ul>`).appendTo(this.$wrapper);\n\t\tthis.$input = $(`<input class=\"tags-input\"></input>`);\n\n\t\tthis.$inputWrapper = this.getListElement(this.$input);\n\t\tthis.$placeholder = this.getListElement($(`<span class=\"tags-placeholder text-muted\">${placeholder}</span>`));\n\t\tthis.$inputWrapper.appendTo(this.$ul);\n\t\tthis.$placeholder.appendTo(this.$ul);\n\n\t\tthis.deactivate();\n\t\tthis.bind();\n\t\tthis.boot();\n\t}\n\n\tbind() {\n\t\tthis.$input.keypress((e) => {\n\t\t\tif(e.which == 13 || e.keyCode == 13) {\n\t\t\t\tconst tagValue = frappe.utils.xss_sanitise(this.$input.val());\n\t\t\t\tthis.addTag(tagValue);\n\t\t\t\tthis.$input.val('');\n\t\t\t}\n\t\t});\n\n\t\tthis.$input.on('blur', () => {\n\t\t\tthis.deactivate();\n\t\t});\n\n\t\tthis.$placeholder.on('click', () => {\n\t\t\tthis.activate();\n\t\t\tthis.$input.focus(); // focus only when clicked\n\t\t});\n\t}\n\n\tboot() {\n\t\tthis.addTags(this.tagsList);\n\t}\n\n\tactivate() {\n\t\tthis.$placeholder.hide();\n\t\tthis.$inputWrapper.show();\n\t}\n\n\tdeactivate() {\n\t\tthis.$inputWrapper.hide();\n\t\tthis.$placeholder.show();\n\t}\n\n\taddTag(label) {\n\t\tlabel = toTitle(label);\n\t\tif(label && label!== '' && !this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.getTag(label);\n\t\t\tthis.getListElement($tag).insertBefore(this.$inputWrapper);\n\t\t\tthis.tagsList.push(label);\n\t\t\tthis.onTagAdd && this.onTagAdd(label);\n\t\t}\n\t}\n\n\tremoveTag(label) {\n\t\tlabel = frappe.utils.xss_sanitise(label);\n\t\tif(this.tagsList.includes(label)) {\n\t\t\tthis.tagsList.splice(this.tagsList.indexOf(label), 1);\n\t\t\tthis.onTagRemove && this.onTagRemove(label);\n\t\t}\n\t}\n\n\taddTags(labels) {\n\t\tlabels.map(this.addTag.bind(this));\n\t}\n\n\tclearTags() {\n\t\tthis.$ul.find('.frappe-tag').remove();\n\t\tthis.tagsList = [];\n\t}\n\n\tgetListElement($element, className) {\n\t\tlet $li = $(`<li class=\"tags-list-item ${className}\"></li>`);\n\t\t$element.appendTo($li);\n\t\treturn $li;\n\t}\n\n\tgetTag(label) {\n\t\tlet $tag = $(`<div class=\"frappe-tag btn-group\" data-tag-label=\"${label}\">\n\t\t<button class=\"btn btn-default btn-xs toggle-tag\"\n\t\t\ttitle=\"${ __(\"toggle Tag\") }\"\n\t\t\tdata-tag-label=\"${label}\">${label}\n\t\t</button>\n\t\t<button class=\"btn btn-default btn-xs remove-tag\"\n\t\t\ttitle=\"${ __(\"Remove Tag\") }\"\n\t\t\tdata-tag-label=\"${label}\">\n\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t</button></div>`);\n\n\t\tlet $removeTag = $tag.find(\".remove-tag\");\n\n\t\t$removeTag.on(\"click\", () => {\n\t\t\tthis.removeTag($removeTag.attr('data-tag-label'));\n\t\t\t$removeTag.closest('.tags-list-item').remove();\n\t\t});\n\n\t\tif(this.onTagClick) {\n\t\t\tlet $toggle_tag = $tag.find(\".toggle-tag\");\n\t\t\t$toggle_tag.on(\"click\", () => {\n\t\t\t\tthis.onTagClick($toggle_tag.attr('data-tag-label'));\n\t\t\t});\n\t\t}\n\n\t\treturn $tag;\n\t}\n}\n","frappe.ui.TagEditor = Class.extend({\n\tinit: function(opts) {\n\t\t/* docs:\n\t\tArguments\n\n\t\t- parent\n\t\t- user_tags\n\t\t- doctype\n\t\t- docname\n\t\t*/\n\t\t$.extend(this, opts);\n\n\t\tthis.setup_tags();\n\n\t\tif (!this.user_tags) {\n\t\t\tthis.user_tags = \"\";\n\t\t}\n\t\tthis.initialized = true;\n\t\tthis.refresh(this.user_tags);\n\t},\n\tsetup_tags: function() {\n\t\tvar me = this;\n\n\t\t// hidden form, does not have parent\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"tag-line\" style=\"position: relative\">').appendTo(this.parent);\n\t\tif(!this.wrapper.length) return;\n\n\t\tthis.tags = new frappe.ui.Tags({\n\t\t\tparent: this.wrapper,\n\t\t\tplaceholder: __(\"Add a tag ...\"),\n\t\t\tonTagAdd: (tag) => {\n\t\t\t\tif(me.initialized && !me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: 'frappe.desk.tags.add_tag',\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags ? me.user_tags.split(\",\") : [];\n\t\t\t\t\t\t\tuser_tags.push(tag)\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTagRemove: (tag) => {\n\t\t\t\tif(!me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: 'frappe.desk.tags.remove_tag',\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags.split(\",\");\n\t\t\t\t\t\t\tuser_tags.splice(user_tags.indexOf(tag), 1);\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.setup_awesomplete();\n\t\tthis.setup_complete = true;\n\t},\n\tsetup_awesomplete: function() {\n\t\tvar me = this;\n\t\tvar $input = this.wrapper.find(\"input.tags-input\");\n\t\tvar input = $input.get(0);\n\t\tthis.awesomplete = new Awesomplete(input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tlist: []\n\t\t});\n\t\t$input.on(\"awesomplete-open\", function(e){\n\t\t\t$input.attr('state', 'open');\n\t\t});\n\t\t$input.on(\"awesomplete-close\", function(e){\n\t\t\t$input.attr('state', 'closed');\n\t\t});\n\t\t$input.on(\"input\", function(e) {\n\t\t\tvar value = e.target.value;\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\"frappe.desk.tags.get_tags\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\ttxt: value.toLowerCase(),\n\t\t\t\t\tcat_tags: me.list_sidebar ?\n\t\t\t\t\t\tJSON.stringify(me.list_sidebar.get_cat_tags()) : '[]'\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.awesomplete.list = r.message;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t$input.on(\"focus\", function(e) {\n\t\t\tif($input.attr('state') != 'open') {\n\t\t\t\t$input.trigger(\"input\");\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function(tag) {\n\t\treturn {\n\t\t\ttag: tag,\n\t\t\tdt: this.frm.doctype,\n\t\t\tdn: this.frm.docname,\n\t\t}\n\t},\n\trefresh: function(user_tags) {\n\t\tvar me = this;\n\t\tif (!this.initialized || !this.setup_complete || this.refreshing) return;\n\n\t\tme.refreshing = true;\n\t\ttry {\n\t\t\tme.tags.clearTags();\n\t\t\tif(user_tags) {\n\t\t\t\tme.user_tags = user_tags;\n\t\t\t\tme.tags.addTags(user_tags.split(','));\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tme.refreshing = false;\n\t\t\t// wtf bug\n\t\t\tsetTimeout( function() { me.refresh(); }, 100);\n\t\t}\n\t\tme.refreshing = false;\n\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.is_liked = function(doc) {\n\tvar liked = frappe.ui.get_liked_by(doc);\n\treturn liked.indexOf(frappe.session.user)===-1 ? false : true;\n}\n\nfrappe.ui.get_liked_by = function(doc) {\n\tvar liked = doc._liked_by;\n\tif(liked) {\n\t\tliked = JSON.parse(liked);\n\t}\n\n\treturn liked || [];\n}\n\nfrappe.ui.toggle_like = function($btn, doctype, name, callback) {\n\tvar add = $btn.hasClass(\"not-liked\") ? \"Yes\" : \"No\";\n\t// disable click\n\t$btn.css('pointer-events', 'none');\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.like.toggle_like\",\n\t\tquiet: true,\n\t\targs: {\n\t\t\tdoctype: doctype,\n\t\t\tname: name,\n\t\t\tadd: add,\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// renable click\n\t\t\t$btn.css('pointer-events', 'auto');\n\n\t\t\tif(!r.exc) {\n\t\t\t\t// update in all local-buttons\n\t\t\t\tvar action_buttons = $('.like-action[data-name=\"'+ name.replace(/\"/g, '\\\"')\n\t\t\t\t\t+'\"][data-doctype=\"'+ doctype.replace(/\"/g, '\\\"')+'\"]');\n\n\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\taction_buttons.removeClass(\"not-liked text-extra-muted\");\n\t\t\t\t} else {\n\t\t\t\t\taction_buttons.addClass(\"not-liked text-extra-muted\");\n\t\t\t\t}\n\n\t\t\t\t// update in locals (form)\n\t\t\t\tvar doc = locals[doctype] && locals[doctype][name];\n\t\t\t\tif(doc) {\n\t\t\t\t\tvar liked_by = JSON.parse(doc._liked_by || \"[]\"),\n\t\t\t\t\t\tidx = liked_by.indexOf(frappe.session.user);\n\t\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\t\tif(idx===-1)\n\t\t\t\t\t\t\tliked_by.push(frappe.session.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(idx!==-1) {\n\t\t\t\t\t\t\tliked_by = liked_by.slice(0,idx).concat(liked_by.slice(idx+1))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdoc._liked_by = JSON.stringify(liked_by);\n\t\t\t\t}\n\n\t\t\t\tif(callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfrappe.ui.click_toggle_like = function() {\n\tvar $btn = $(this);\n\tvar $count = $btn.siblings(\".likes-count\");\n\tvar not_liked = $btn.hasClass(\"not-liked\");\n\tvar doctype = $btn.attr(\"data-doctype\");\n\tvar name = $btn.attr(\"data-name\");\n\n\tfrappe.ui.toggle_like($btn, doctype, name, function() {\n\t\tif (not_liked) {\n\t\t\t$count.text(cint($count.text()) + 1);\n\t\t} else {\n\t\t\t$count.text(cint($count.text()) - 1);\n\t\t}\n\t});\n\n\treturn false;\n}\n\nfrappe.ui.setup_like_popover = function($parent, selector) {\n\tif (frappe.dom.is_touchscreen()) {\n\t\treturn;\n\t}\n\n\t$parent.on(\"mouseover\", selector, function() {\n\t\tvar $wrapper = $(this);\n\n\t\t$wrapper.popover({\n\t\t\tanimation: true,\n\t\t\tplacement: \"right\",\n\t\t\tcontent: function() {\n\t\t\t\tvar liked_by = $wrapper.attr('data-liked-by');\n\t\t\t\tliked_by = liked_by ? decodeURI(liked_by) : '[]';\n\t\t\t\tliked_by = JSON.parse(liked_by);\n\n\t\t\t\tvar user = frappe.session.user;\n\t\t\t\t// hack\n\t\t\t\tif ($wrapper.find(\".not-liked\").length) {\n\t\t\t\t\tif (liked_by.indexOf(user)!==-1) {\n\t\t\t\t\t\tliked_by.splice(liked_by.indexOf(user), 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (liked_by.indexOf(user)===-1) {\n\t\t\t\t\t\tliked_by.push(user);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!liked_by.length) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t\treturn frappe.render_template(\"liked_by\", {\"liked_by\": liked_by});\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\t\t$wrapper.popover('show');\n\t});\n\n\t$parent.on(\"mouseout\", selector, function() {\n\t\t$(this).popover('destroy');\n\t});\n}\n","frappe.provide('frappe.views');\n\nfrappe.views.BaseList = class BaseList {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t}\n\n\tshow() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.init(),\n\t\t\t() => this.before_refresh(),\n\t\t\t() => this.refresh(),\n\t\t\t() => frappe.route_options = null\n\t\t]);\n\t}\n\n\tinit() {\n\n\t\tif (this.init_promise) return this.init_promise;\n\n\t\tlet tasks = [\n\t\t\tthis.setup_defaults,\n\t\t\tthis.set_stats,\n\t\t\tthis.setup_fields,\n\t\t\t// make view\n\t\t\tthis.setup_page,\n\t\t\tthis.setup_side_bar,\n\t\t\tthis.setup_main_section,\n\t\t\tthis.setup_view,\n\t\t].map(fn => fn.bind(this));\n\n\t\tthis.init_promise = frappe.run_serially(tasks);\n\t\treturn this.init_promise;\n\t}\n\n\tsetup_defaults() {\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.page_title = this.page_title || __(this.doctype);\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tthis.settings = frappe.listview_settings[this.doctype] || {};\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 20;\n\t\tthis.data = [];\n\t\tthis.method = 'frappe.desk.reportview.get';\n\n\t\tthis.can_create = frappe.model.can_create(this.doctype);\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\n\t\tthis.fields = [];\n\t\tthis.filters = [];\n\t\tthis.sort_by = 'modified';\n\t\tthis.sort_order = 'desc';\n\n\t\t// Setup buttons\n\t\tthis.primary_action = null;\n\t\tthis.secondary_action = {\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh()\n\t\t};\n\n\t\tthis.menu_items = [{\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh(),\n\t\t\tclass: 'visible-xs'\n\t\t}];\n\t}\n\n\tsetup_fields() {\n\t\tthis.set_fields();\n\t\tthis.build_fields();\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.meta.title_field\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\t}\n\n\tget_fields_in_list_view() {\n\t\treturn this.meta.fields.filter(df => {\n\t\t\treturn frappe.model.is_value_type(df.fieldtype) && (\n\t\t\t\tdf.in_list_view\n\t\t\t\t&& frappe.perm.has_perm(this.doctype, df.permlevel, 'read')\n\t\t\t) || (\n\t\t\t\tdf.fieldtype === 'Currency'\n\t\t\t\t&& df.options\n\t\t\t\t&& !df.options.includes(':')\n\t\t\t) || (\n\t\t\t\tdf.fieldname === 'status'\n\t\t\t);\n\t\t});\n\t}\n\n\tbuild_fields() {\n\t\t// fill in missing doctype\n\t\tthis.fields = this.fields.map(f => {\n\t\t\tif (typeof f === 'string') {\n\t\t\t\tf = [f, this.doctype];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t\t// remove null or undefined values\n\t\tthis.fields = this.fields.filter(Boolean);\n\t\t//de-duplicate\n\t\tthis.fields = this.fields.uniqBy(f => f[0] + f[1]);\n\t}\n\n\t_add_field(fieldname) {\n\t\tif (!fieldname) return;\n\t\tlet doctype = this.doctype;\n\n\t\tif (typeof fieldname === 'object') {\n\t\t\t// df is passed\n\t\t\tconst df = fieldname;\n\t\t\tfieldname = df.fieldname;\n\t\t\tdoctype = df.parent;\n\t\t}\n\n\t\tconst is_valid_field = frappe.model.std_fields_list.includes(fieldname)\n\t\t\t|| frappe.meta.has_field(doctype, fieldname)\n\t\t\t|| fieldname === '_seen';\n\n\t\tif (!is_valid_field) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fields.push([fieldname, doctype]);\n\t}\n\n\tset_stats() {\n\t\tthis.stats = ['_user_tags'];\n\t\t// add workflow field (as priority)\n\t\tthis.workflow_state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\t\tif (this.workflow_state_fieldname) {\n\t\t\tif (!frappe.workflow.workflows[this.doctype]['override_status']) {\n\t\t\t\tthis._add_field(this.workflow_state_fieldname);\n\t\t\t}\n\t\t\tthis.stats.push(this.workflow_state_fieldname);\n\t\t}\n\t}\n\n\tsetup_page() {\n\t\tthis.page = this.parent.page;\n\t\tthis.$page = $(this.parent);\n\t\tthis.page.page_form.removeClass('row').addClass('flex');\n\t\tthis.setup_page_head();\n\t}\n\n\tsetup_page_head() {\n\t\tthis.set_title();\n\t\tthis.set_menu_items();\n\t\tthis.set_breadcrumbs();\n\t}\n\n\tset_title() {\n\t\tthis.page.set_title(this.page_title);\n\t}\n\n\tset_menu_items() {\n\t\tconst $secondary_action = this.page.set_secondary_action(\n\t\t\tthis.secondary_action.label,\n\t\t\tthis.secondary_action.action,\n\t\t\tthis.secondary_action.icon\n\t\t);\n\t\tif (!this.secondary_action.icon) {\n\t\t\t$secondary_action.addClass('hidden-xs');\n\t\t} else {\n\t\t\t$secondary_action.addClass('visible-xs');\n\t\t}\n\n\t\tthis.menu_items.map(item => {\n\t\t\tif (item.condition && item.condition() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst $item = this.page.add_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item && $item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_breadcrumbs() {\n\t\tfrappe.breadcrumbs.add(this.meta.module, this.doctype);\n\t}\n\n\tsetup_side_bar() {\n\t\tthis.list_sidebar = new frappe.views.ListSidebar({\n\t\t\tdoctype: this.doctype,\n\t\t\tstats: this.stats,\n\t\t\tparent: this.$page.find('.layout-side-section'),\n\t\t\t// set_filter: this.set_filter.bind(this),\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t});\n\t}\n\n\ttoggle_side_bar() {\n\t\tthis.list_sidebar.parent.toggleClass('hide');\n\t\tthis.page.current_view.find('.layout-main-section-wrapper').toggleClass('col-md-10 col-md-12');\n\t}\n\n\tsetup_main_section() {\n\t\treturn frappe.run_serially([\n\t\t\tthis.setup_list_wrapper,\n\t\t\tthis.setup_filter_area,\n\t\t\tthis.setup_sort_selector,\n\t\t\tthis.setup_result_area,\n\t\t\tthis.setup_no_result_area,\n\t\t\tthis.setup_freeze_area,\n\t\t\tthis.setup_paging_area\n\t\t].map(fn => fn.bind(this)));\n\t}\n\n\tsetup_list_wrapper() {\n\t\tthis.$frappe_list = $('<div class=\"frappe-list\">').appendTo(this.page.main);\n\t}\n\n\tsetup_filter_area() {\n\t\tthis.filter_area = new FilterArea(this);\n\n\t\tif (this.filters.length > 0) {\n\t\t\treturn this.filter_area.set(this.filters);\n\t\t}\n\t}\n\n\tsetup_sort_selector() {\n\t\tthis.sort_selector = new frappe.ui.SortSelector({\n\t\t\tparent: this.filter_area.$filter_list_wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\targs: {\n\t\t\t\tsort_by: this.sort_by,\n\t\t\t\tsort_order: this.sort_order\n\t\t\t},\n\t\t\tonchange: this.on_sort_change.bind(this)\n\t\t});\n\t}\n\n\ton_sort_change() {\n\t\tthis.refresh();\n\t}\n\n\tsetup_result_area() {\n\t\tthis.$result = $(`<div class=\"result\">`);\n\t\tthis.$frappe_list.append(this.$result);\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $('<div class=\"freeze\"></div>').hide();\n\t\tthis.$frappe_list.append(this.$freeze);\n\t}\n\n\tget_no_result_message() {\n\t\treturn __('Nothing to show');\n\t}\n\n\tsetup_paging_area() {\n\t\tconst paging_values = [20, 100, 500];\n\t\tthis.$paging_area = $(\n\t\t\t`<div class=\"list-paging-area level\">\n\t\t\t\t<div class=\"level-left\">\n\t\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t\t${paging_values.map(value => `\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-paging\"\n\t\t\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t\t\t${value}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t<button class=\"btn btn-default btn-more btn-sm\">\n\t\t\t\t\t\t${__(\"More\")}...\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t).hide();\n\t\tthis.$frappe_list.append(this.$paging_area);\n\n\t\t// set default paging btn active\n\t\tthis.$paging_area\n\t\t\t.find(`.btn-paging[data-value=\"${this.page_length}\"]`)\n\t\t\t.addClass('btn-info');\n\n\t\tthis.$paging_area.on('click', '.btn-paging, .btn-more', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\n\t\t\tif ($this.is('.btn-paging')) {\n\t\t\t\t// set active button\n\t\t\t\tthis.$paging_area.find('.btn-paging').removeClass('btn-info');\n\t\t\t\t$this.addClass('btn-info');\n\n\t\t\t\tthis.start = 0;\n\t\t\t\tthis.page_length = $this.data().value;\n\t\t\t\tthis.refresh();\n\t\t\t} else if ($this.is('.btn-more')) {\n\t\t\t\tthis.start = this.start + this.page_length;\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_fields() {\n\t\t// convert [fieldname, Doctype] => tabDoctype.fieldname\n\t\treturn this.fields.map(f => frappe.model.get_full_column_name(f[0], f[1]));\n\t}\n\n\tsetup_view() {\n\t\t// for child classes\n\t}\n\n\tget_filters_for_args() {\n\t\t// filters might have a fifth param called hidden,\n\t\t// we don't want to pass that server side\n\t\treturn this.filter_area\n\t\t\t? this.filter_area.get().map(filter => filter.slice(0, 4))\n\t\t\t: [];\n\t}\n\n\tget_args() {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tfields: this.get_fields(),\n\t\t\tfilters: this.get_filters_for_args(),\n\t\t\torder_by: this.sort_selector.get_sql_string(),\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length\n\t\t};\n\t}\n\n\tget_call_args() {\n\t\tconst args = this.get_args();\n\t\treturn {\n\t\t\tmethod: this.method,\n\t\t\targs: args,\n\t\t\tfreeze: this.freeze_on_refresh || false,\n\t\t\tfreeze_message: this.freeze_message || (__('Loading') + '...')\n\t\t};\n\t}\n\n\tbefore_refresh() {\n\t\t// modify args here just before making the request\n\t\t// see list_view.js\n\t}\n\n\trefresh() {\n\t\tthis.freeze(true);\n\t\t// fetch data from server\n\t\treturn frappe.call(this.get_call_args()).then(r => {\n\t\t\t// render\n\t\t\tthis.prepare_data(r);\n\t\t\tthis.toggle_result_area();\n\t\t\tthis.before_render();\n\t\t\tthis.render();\n\t\t\tthis.after_render();\n\t\t\tthis.freeze(false);\n\t\t});\n\t}\n\n\tprepare_data(r) {\n\t\tlet data = r.message || {};\n\t\tdata = !Array.isArray(data) ? frappe.utils.dict(data.keys, data.values) : data;\n\n\t\tif (this.start === 0) {\n\t\t\tthis.data = data;\n\t\t} else {\n\t\t\tthis.data = this.data.concat(data);\n\t\t}\n\n\t\tthis.data = this.data.uniqBy(d => d.name);\n\t}\n\n\tfreeze() {\n\t\t// show a freeze message while data is loading\n\t}\n\n\tbefore_render() {\n\n\t}\n\n\tafter_render() {\n\n\t}\n\n\trender() {\n\t\t// for child classes\n\t}\n\n\ton_filter_change() {\n\t\t// fired when filters are added or removed\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t\tthis.$paging_area.toggle(this.data.length > 0);\n\t\tthis.$no_result.toggle(this.data.length == 0);\n\n\t\tconst show_more = (this.start + this.page_length) <= this.data.length;\n\t\tthis.$paging_area.find('.btn-more')\n\t\t\t.toggle(show_more);\n\t}\n\n\tcall_for_selected_items(method, args = {}) {\n\t\targs.names = this.get_checked_items(true);\n\n\t\tfrappe.call({\n\t\t\tmethod: method,\n\t\t\targs: args,\n\t\t\tfreeze: true,\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nclass FilterArea {\n\tconstructor(list_view) {\n\t\tthis.list_view = list_view;\n\t\tthis.standard_filters_wrapper = this.list_view.page.page_form;\n\t\tthis.$filter_list_wrapper = $('<div class=\"filter-list\">').appendTo(this.list_view.$frappe_list);\n\t\tthis.trigger_refresh = true;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tthis.make_standard_filters();\n\t\tthis.make_filter_list();\n\t}\n\n\tget() {\n\t\tlet filters = this.filter_list.get_filters();\n\t\tlet standard_filters = this.get_standard_filters();\n\n\t\treturn filters\n\t\t\t.concat(standard_filters)\n\t\t\t.uniqBy(JSON.stringify);\n\t}\n\n\tset(filters) {\n\t\t// use to method to set filters without triggering refresh\n\t\tthis.trigger_refresh = false;\n\t\treturn this.add(filters, false)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || Array.isArray(filters) && filters.length === 0)\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === 'string') {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter(f => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(filters);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn non_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n\n\trefresh_list_view() {\n\t\tif (this.trigger_refresh) {\n\t\t\tthis.list_view.start = 0;\n\t\t\tthis.list_view.refresh();\n\t\t\tthis.list_view.on_filter_change();\n\t\t}\n\t}\n\n\texists(f) {\n\t\tlet exists = false;\n\t\t// check in standard filters\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tif (f[2] === '=' && f[1] in fields_dict) {\n\t\t\tconst value = fields_dict[f[1]].get_value();\n\t\t\tif (value) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t}\n\n\t\t// check in filter area\n\t\tif (!exists) {\n\t\t\texists = this.filter_list.filter_exists(f);\n\t\t}\n\n\t\treturn exists;\n\t}\n\n\tset_standard_filter(filters) {\n\t\tif (filters.length === 0) {\n\t\t\treturn {\n\t\t\t\tnon_standard_filters: [],\n\t\t\t\tpromise: Promise.resolve()\n\t\t\t};\n\t\t}\n\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tlet out = filters.reduce((out, filter) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst [dt, fieldname, condition, value] = filter;\n\t\t\tout.promise = out.promise || Promise.resolve();\n\t\t\tout.non_standard_filters = out.non_standard_filters || [];\n\n\t\t\tif (fields_dict[fieldname] && condition === '=') {\n\t\t\t\t// standard filter\n\t\t\t\tout.promise = out.promise.then(\n\t\t\t\t\t() => fields_dict[fieldname].set_value(value)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// filter out non standard filters\n\t\t\t\tout.non_standard_filters.push(filter);\n\t\t\t}\n\t\t\treturn out;\n\t\t}, {});\n\n\t\treturn out;\n\t}\n\n\tremove(fieldname) {\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tif (fieldname in fields_dict) {\n\t\t\tfields_dict[fieldname].set_value('');\n\t\t\treturn;\n\t\t}\n\t\tthis.filter_list.get_filter(fieldname).remove();\n\t}\n\n\tclear(refresh = true) {\n\t\tif (!refresh) {\n\t\t\tthis.trigger_refresh = false;\n\t\t}\n\n\t\tthis.filter_list.clear_filters();\n\n\t\tconst promises = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tconst field = this.list_view.page.fields_dict[key];\n\t\t\tpromises.push(() => field.set_value(''));\n\t\t}\n\t\treturn frappe.run_serially(promises)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tmake_standard_filters() {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'ID',\n\t\t\t\tcondition: 'like',\n\t\t\t\tfieldname: 'name',\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t}\n\t\t];\n\n\t\tif(this.list_view.custom_filter_configs) {\n\t\t\tthis.list_view.custom_filter_configs.forEach(config => {\n\t\t\t\tconfig.onchange = () => this.refresh_list_view();\n\t\t\t});\n\n\t\t\tfields = fields.concat(this.list_view.custom_filter_configs);\n\t\t}\n\n\t\tconst doctype_fields = this.list_view.meta.fields;\n\n\t\tfields = fields.concat(doctype_fields.filter(\n\t\t\tdf => df.in_standard_filter &&\n\t\t\t\tfrappe.model.is_value_type(df.fieldtype)\n\t\t).map(df => {\n\t\t\tlet options = df.options;\n\t\t\tlet condition = '=';\n\t\t\tlet fieldtype = df.fieldtype;\n\t\t\tif (['Text', 'Small Text', 'Text Editor', 'Data'].includes(fieldtype)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tcondition = 'like';\n\t\t\t}\n\t\t\tif (df.fieldtype == \"Select\" && df.options) {\n\t\t\t\toptions = df.options.split(\"\\n\");\n\t\t\t\tif (options.length > 0 && options[0] != \"\") {\n\t\t\t\t\toptions.unshift(\"\");\n\t\t\t\t\toptions = options.join(\"\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tfieldtype: fieldtype,\n\t\t\t\tlabel: __(df.label),\n\t\t\t\toptions: options,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tcondition: condition,\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t};\n\t\t}));\n\n\t\tfields.map(df => this.list_view.page.add_field(df));\n\n\t\t// search icon in name filter\n\t\t$('<span class=\"octicon octicon-search text-muted small\"></span>')\n\t\t\t.appendTo(this.list_view.page.fields_dict.name.$wrapper)\n\t\t\t.css({\n\t\t\t\t'position': 'absolute',\n\t\t\t\t'z-index': '1',\n\t\t\t\t'right': '7px',\n\t\t\t\t'top': '9px',\n\t\t\t\t'font-size': '90%'\n\t\t\t});\n\n\t\tthis.list_view.page.fields_dict.name.$wrapper\n\t\t\t.find('.form-control')\n\t\t\t.css('padding-right', '2em');\n\t}\n\n\tget_standard_filters() {\n\t\tconst filters = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tlet field = fields_dict[key];\n\t\t\tlet value = field.get_value();\n\t\t\tif (value) {\n\t\t\t\tif (field.df.condition === 'like' && !value.includes('%')) {\n\t\t\t\t\tvalue = '%' + value + '%';\n\t\t\t\t}\n\t\t\t\tfilters.push([\n\t\t\t\t\tthis.list_view.doctype,\n\t\t\t\t\tfield.df.fieldname,\n\t\t\t\t\tfield.df.condition || '=',\n\t\t\t\t\tvalue\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tmake_filter_list() {\n\t\tthis.filter_list = new frappe.ui.FilterGroup({\n\t\t\tbase_list: this.list_view,\n\t\t\tparent: this.$filter_list_wrapper,\n\t\t\tdoctype: this.list_view.doctype,\n\t\t\tdefault_filters: [],\n\t\t\ton_change: () => this.refresh_list_view()\n\t\t});\n\t}\n\n\tis_being_edited() {\n\t\t// returns true if user is currently editing filters\n\t\treturn this.filter_list &&\n\t\t\tthis.filter_list.wrapper.find('.filter-box:visible').length > 0;\n\t}\n}\n\n// utility function to validate view modes\nfrappe.views.view_modes = ['List', 'Gantt', 'Kanban', 'Calendar', 'Image', 'Inbox', 'Report'];\nfrappe.views.is_valid = view_mode => frappe.views.view_modes.includes(view_mode);\n","export default class BulkOperations {\n\tconstructor({ doctype }) {\n\t\tif (!doctype) frappe.throw(__('Doctype required'));\n\t\tthis.doctype = doctype;\n\t}\n\n\tprint(docs) {\n\t\tconst print_settings = frappe.model.get_doc(':Print Settings', 'Print Settings');\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst is_submittable = frappe.model.is_submittable(this.doctype);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tconst valid_docs = docs.filter(doc => {\n\t\t\treturn !is_submittable || doc.docstatus === 1 ||\n\t\t\t\t(allow_print_for_cancelled && doc.docstatus == 2) ||\n\t\t\t\t(allow_print_for_draft && doc.docstatus == 0) ||\n\t\t\t\tfrappe.user.has_role('Administrator');\n\t\t}).map(doc => doc.name);\n\n\t\tconst invalid_docs = docs.filter(doc => !valid_docs.includes(doc.name));\n\n\t\tif (invalid_docs.length > 0) {\n\t\t\tfrappe.msgprint(__('You selected Draft or Cancelled documents'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (valid_docs.length > 0) {\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Print Documents'),\n\t\t\t\tfields: [{\n\t\t\t\t\t'fieldtype': 'Check',\n\t\t\t\t\t'label': __('With Letterhead'),\n\t\t\t\t\t'fieldname': 'with_letterhead'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'label': __('Print Format'),\n\t\t\t\t\t'fieldname': 'print_sel',\n\t\t\t\t\toptions: frappe.meta.get_print_formats(this.doctype)\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tdialog.set_primary_action(__('Print'), args => {\n\t\t\t\tif (!args) return;\n\t\t\t\tconst default_print_format = frappe.get_meta(this.doctype).default_print_format;\n\t\t\t\tconst with_letterhead = args.with_letterhead ? 1 : 0;\n\t\t\t\tconst print_format = args.print_sel ? args.print_sel : default_print_format;\n\t\t\t\tconst json_string = JSON.stringify(valid_docs);\n\n\t\t\t\tconst w = window.open('/api/method/frappe.utils.print_format.download_multi_pdf?' +\n\t\t\t\t\t'doctype=' + encodeURIComponent(this.doctype) +\n\t\t\t\t\t'&name=' + encodeURIComponent(json_string) +\n\t\t\t\t\t'&format=' + encodeURIComponent(print_format) +\n\t\t\t\t\t'&no_letterhead=' + (with_letterhead ? '0' : '1'));\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__('Please enable pop-ups'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select atleast 1 record for printing'));\n\t\t}\n\t}\n\n\tdelete(docnames, done = null) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.reportview.delete_items',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\titems: docnames,\n\t\t\t\t\tdoctype: this.doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot delete {0}', [failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound('delete');\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tassign(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tconst assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: this,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add_multiple',\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocname: docnames,\n\t\t\t\tbulk_assign: true,\n\t\t\t\tre_assign: true,\n\t\t\t\tcallback: done\n\t\t\t});\n\t\t\tassign_to.dialog.clear();\n\t\t\tassign_to.dialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select records for assignment'));\n\t\t}\n\t}\n\n\tsubmit_or_cancel(docnames, action='submit', done=null) {\n\t\taction = action.toLowerCase();\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\taction: action,\n\t\t\t\t\tdocnames: docnames\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot {0} {1}', [action, failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound(action);\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tedit(docnames, field_mappings, done) {\n\t\tlet field_options = Object.keys(field_mappings).sort();\n\t\tconst status_regex = /status/i;\n\n\t\tconst default_field = field_options.find(value => status_regex.test(value));\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'options': field_options,\n\t\t\t\t\t'default': default_field,\n\t\t\t\t\t'label': __('Field'),\n\t\t\t\t\t'fieldname': 'field',\n\t\t\t\t\t'reqd': 1,\n\t\t\t\t\t'onchange': () => {\n\t\t\t\t\t\tset_value_field(dialog);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t\t'label': __('Value'),\n\t\t\t\t\t'fieldname': 'value',\n\t\t\t\t\t'reqd': 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: ({ value }) => {\n\t\t\t\tconst fieldname = field_mappings[dialog.get_value('field')].fieldname;\n\t\t\t\tdialog.disable_primary_action();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tdocnames: docnames,\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t[fieldname]: value\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tlet failed = r.message || [];\n\n\t\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\t\tdialog.enable_primary_action();\n\t\t\t\t\t\tfrappe.throw(__('Cannot update {0}', [failed.map(f => f.bold ? f.bold() : f).join(', ')]));\n\t\t\t\t\t}\n\t\t\t\t\tdone();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Update')\n\t\t});\n\n\t\tif (default_field) set_value_field(dialog); // to set `Value` df based on default `Field`\n\n\t\tfunction set_value_field(dialogObj) {\n\t\t\tconst new_df = Object.assign({},\n\t\t\t\tfield_mappings[dialogObj.get_value('field')]);\n\t\t\t/* if the field label has status in it and\n\t\t\tif it has select fieldtype with no default value then\n\t\t\tset a default value from the available option. */\n\t\t\tif(new_df.label.match(status_regex) &&\n\t\t\t\tnew_df.fieldtype === 'Select' && !new_df.default) {\n\t\t\t\tlet options = [];\n\t\t\t\tif(typeof new_df.options===\"string\") {\n\t\t\t\t\toptions = new_df.options.split(\"\\n\");\n\t\t\t\t}\n\t\t\t\t//set second option as default if first option is an empty string\n\t\t\t\tnew_df.default = options[0] || options[1];\n\t\t\t}\n\t\t\tnew_df.label = __('Value');\n\t\t\tnew_df.reqd = 1;\n\t\t\tdelete new_df.depends_on;\n\t\t\tdialogObj.replace_field('value', new_df);\n\t\t}\n\n\t\tdialog.refresh();\n\t\tdialog.show();\n\t}\n}\n","import BulkOperations from \"./bulk_operations\";\n\nfrappe.provide('frappe.views');\n\nfrappe.views.ListView = class ListView extends frappe.views.BaseList {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tconst doctype = route[1];\n\n\t\tif (route.length === 2) {\n\t\t\t// List/{doctype} => List/{doctype}/{last_view} or List\n\t\t\tconst user_settings = frappe.get_user_settings(doctype);\n\t\t\tconst last_view = user_settings.last_view;\n\t\t\tfrappe.set_route('List', doctype, frappe.views.is_valid(last_view) ? last_view : 'List');\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.show();\n\t}\n\n\thas_permissions() {\n\t\tconst can_read = frappe.perm.has_perm(this.doctype, 0, 'read');\n\t\treturn can_read;\n\t}\n\n\tshow() {\n\t\tif (!this.has_permissions()) {\n\t\t\tfrappe.set_route('');\n\t\t\tfrappe.msgprint(__(`Not permitted to view ${this.doctype}`));\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.show();\n\t}\n\n\tget view_name() {\n\t\treturn 'List';\n\t}\n\n\tget view_user_settings() {\n\t\treturn this.user_settings[this.view_name] || {};\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'modified';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\t// set filters from user_settings or list_settings\n\t\tif (this.view_user_settings.filters && this.view_user_settings.filters.length) {\n\t\t\t// Priority 1: user_settings\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\t// build menu items\n\t\tthis.menu_items = this.menu_items.concat(this.get_menu_items());\n\n\t\tthis.actions_menu_items = this.get_actions_menu_items();\n\n\t\tthis.patch_refresh_and_load_lib();\n\t}\n\n\ton_sort_change(sort_by, sort_order) {\n\t\tthis.sort_by = sort_by;\n\t\tthis.sort_order = sort_order;\n\t\tsuper.on_sort_change();\n\t}\n\n\tvalidate_filters(filters) {\n\t\tconst valid_fields = this.meta.fields.map(df => df.fieldname);\n\t\treturn filters\n\t\t\t.filter(f => valid_fields.includes(f[1]))\n\t\t\t.uniqBy(f => f[1]);\n\t}\n\n\tsetup_page() {\n\t\tthis.parent.list_view = this;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_page_head() {\n\t\tsuper.setup_page_head();\n\t\tthis.set_primary_action();\n\t\tthis.set_actions_menu_items();\n\t}\n\n\tset_actions_menu_items() {\n\t\tthis.actions_menu_items.map(item => {\n\t\t\tconst $item = this.page.add_actions_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_restricted_list_indicator_if_applicable() {\n\t\tconst match_rules_list = frappe.perm.get_match_rules(this.doctype);\n\t\tif(match_rules_list.length) {\n\t\t\tthis.restricted_list = $('<button class=\"restricted-list form-group\">Restricted</button>')\n\t\t\t\t.prepend('<span class=\"octicon octicon-lock\"></span>')\n\t\t\t\t.click(() => this.show_restrictions(match_rules_list))\n\t\t\t\t.appendTo(this.page.page_form);\n\t\t}\n\t}\n\n\tshow_restrictions(match_rules_list=[]) {\n\t\tfrappe.msgprint(frappe.render_template('list_view_permission_restrictions', {\n\t\t\tcondition_list: match_rules_list\n\t\t}), 'Restrictions');\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.get_fields_in_list_view(),\n\t\t\t[this.meta.title_field, this.meta.image_field],\n\t\t\t(this.settings.add_fields || []),\n\t\t\tthis.meta.track_seen ? '_seen' : null,\n\t\t\tthis.sort_by,\n\t\t\t'enabled',\n\t\t\t'disabled'\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\n\t\tthis.fields.forEach(f => {\n\t\t\tconst df = frappe.meta.get_docfield(f[1], f[0]);\n\t\t\tif (df && df.fieldtype === 'Currency' && df.options && !df.options.includes(':')) {\n\t\t\t\tthis._add_field(df.options);\n\t\t\t}\n\t\t});\n\t}\n\n\tpatch_refresh_and_load_lib() {\n\t\t// throttle refresh for 1s\n\t\tthis.refresh = this.refresh.bind(this);\n\t\tthis.refresh = frappe.utils.throttle(this.refresh, 1000);\n\t\tthis.load_lib = new Promise(resolve => {\n\t\t\tif (this.required_libs) {\n\t\t\t\tfrappe.require(this.required_libs, resolve);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\t// call refresh every 5 minutes\n\t\tconst interval = 5 * 60 * 1000;\n\t\tsetInterval(() => {\n\t\t\t// don't call if route is different\n\t\t\tif (frappe.get_route_str() === this.page_name) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}, interval);\n\t}\n\n\n\tset_primary_action() {\n\t\tif (this.can_create) {\n\t\t\tthis.page.set_primary_action(__('New'), () => {\n\t\t\t\tif (this.settings.primary_action) {\n\t\t\t\t\tthis.settings.primary_action();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make_new_doc();\n\t\t\t\t}\n\t\t\t}, 'octicon octicon-plus');\n\t\t} else {\n\t\t\tthis.page.clear_primary_action();\n\t\t}\n\t}\n\n\tmake_new_doc() {\n\t\tconst doctype = this.doctype;\n\t\tconst options = {};\n\t\tthis.filter_area.get().forEach(f => {\n\t\t\tif (f[2] === \"=\" && frappe.model.is_non_std_field(f[1])) {\n\t\t\t\toptions[f[1]] = f[3];\n\t\t\t}\n\t\t});\n\t\tfrappe.new_doc(doctype, options);\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_skeleton();\n\t\tthis.setup_events();\n\t\tthis.settings.onload && this.settings.onload(this);\n\t\tthis.show_restricted_list_indicator_if_applicable();\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze =\n\t\t\t$(`<div class=\"freeze flex justify-center align-center text-muted\">${__('Loading')}...</div>`)\n\t\t\t\t.hide();\n\t\tthis.$result.append(this.$freeze);\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\n\t\tconst get_df = frappe.meta.get_docfield.bind(null, this.doctype);\n\n\t\t// 1st column: title_field or name\n\t\tif (this.meta.title_field) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: get_df(this.meta.title_field)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Name'),\n\t\t\t\t\tfieldname: 'name'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 2nd column: Status indicator\n\t\tif (frappe.has_indicator(this.doctype)) {\n\t\t\t// indicator\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Status'\n\t\t\t});\n\t\t}\n\n\t\tconst fields_in_list_view = this.get_fields_in_list_view();\n\t\t// Add rest from in_list_view docfields\n\t\tthis.columns = this.columns.concat(\n\t\t\tfields_in_list_view\n\t\t\t\t.filter(df => {\n\t\t\t\t\tif (frappe.has_indicator(this.doctype) && df.fieldname === 'status') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!df.in_list_view) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn df.fieldname !== this.meta.title_field;\n\t\t\t\t})\n\t\t\t\t.map(df => ({\n\t\t\t\t\ttype: 'Field',\n\t\t\t\t\tdf\n\t\t\t\t}))\n\t\t);\n\n\t\t// limit to 4 columns\n\t\tthis.columns = this.columns.slice(0, 4);\n\t}\n\n\tget_no_result_message() {\n\t\tconst new_button = this.can_create ?\n\t\t\t`<p><button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t${__('Make a new {0}', [__(this.doctype)])}\n\t\t\t</button></p>` : '';\n\n\t\treturn `<div class=\"msg-box no-border\">\n\t\t\t<p>${__('No {0} found', [__(this.doctype)])}</p>\n\t\t\t${new_button}\n\t\t</div>`;\n\t}\n\n\tfreeze() {\n\t\tthis.$result.find('.list-count').html(`<span>${__('Refreshing')}...</span>`);\n\t}\n\n\tget_args() {\n\t\tconst args = super.get_args();\n\n\t\treturn Object.assign(args, {\n\t\t\twith_comment_count: true\n\t\t});\n\t}\n\n\tbefore_refresh() {\n\t\tif (frappe.route_options) {\n\t\t\tthis.filters = this.parse_filters_from_route_options();\n\n\t\t\tif (this.filters.length > 0) {\n\t\t\t\treturn this.filter_area.clear(false)\n\t\t\t\t\t.then(() => this.filter_area.set(this.filters));\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tparse_filters_from_settings() {\n\t\treturn (this.settings.filters || []).map(f => {\n\t\t\tif (f.length === 3) {\n\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_actions_menu_button(\n\t\t\tthis.$result.find('.list-row-check:checked').length > 0\n\t\t);\n\t}\n\n\ttoggle_actions_menu_button(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.page.show_actions_menu();\n\t\t\tthis.page.clear_primary_action();\n\t\t} else {\n\t\t\tthis.page.hide_actions_menu();\n\t\t\tthis.set_primary_action();\n\t\t}\n\t}\n\n\trender_header() {\n\t\tif (this.$result.find('.list-row-head').length === 0) {\n\t\t\t// append header once\n\t\t\tthis.$result.prepend(this.get_header_html());\n\t\t}\n\t}\n\n\trender_skeleton() {\n\t\tconst $row = this.get_list_row_html_skeleton('<div><input type=\"checkbox\" /></div>');\n\t\tthis.$result.append($row);\n\t}\n\n\tbefore_render() {\n\t\tthis.settings.before_render && this.settings.before_render();\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tfilters: this.filter_area.get(),\n\t\t\tsort_by: this.sort_selector.sort_by,\n\t\t\tsort_order: this.sort_selector.sort_order\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.find('.list-row-container').remove();\n\t\tif (this.data.length > 0) {\n\t\t\t// append rows\n\t\t\tthis.$result.append(\n\t\t\t\tthis.data.map(doc => this.get_list_row_html(doc)).join('')\n\t\t\t);\n\t\t}\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\trender_count() {\n\t\tthis.get_count_str()\n\t\t\t.then(str => {\n\t\t\t\tthis.$result.find('.list-count').html(`<span>${str}</span>`);\n\t\t\t});\n\t}\n\n\trender_tags() {\n\t\tconst $list_rows = this.$result.find('.list-row-container');\n\n\t\tthis.data.forEach((d, i) => {\n\t\t\tlet tag_html = $(`<div class='tag-row'>\n\t\t\t\t<div class='list-tag hidden-xs'></div>\n\t\t\t</div>`).appendTo($list_rows.get(i));\n\n\t\t\t// add tags\n\t\t\tlet tag_editor = new frappe.ui.TagEditor({\n\t\t\t\tparent: tag_html.find('.list-tag'),\n\t\t\t\tfrm: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: d.name\n\t\t\t\t},\n\t\t\t\tlist_sidebar: this.list_sidebar,\n\t\t\t\tuser_tags: d._user_tags,\n\t\t\t\ton_change: (user_tags) => {\n\t\t\t\t\td._user_tags = user_tags;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttag_editor.wrapper.on('click', '.tagit-label', (e) => {\n\t\t\t\tconst $this = $(e.currentTarget);\n\t\t\t\tthis.filter_area.add(this.doctype, '_user_tags', '=', $this.text());\n\t\t\t});\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\tconst subject_field = this.columns[0].df;\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"${__(\"Likes\")}\"></i>\n\t\t\t</span>\n\t\t\t<span class=\"level-item\">${__(subject_field.label)}</span>\n\t\t`;\n\t\tconst $columns = this.columns.map(col => {\n\t\t\tlet classes = [\n\t\t\t\t'list-row-col ellipsis',\n\t\t\t\tcol.type == 'Subject' ? 'list-subject level' : 'hidden-xs',\n\t\t\t\tfrappe.model.is_numeric_field(col.df) ? 'text-right' : ''\n\t\t\t].join(' ');\n\n\t\t\treturn `\n\t\t\t\t<div class=\"${classes}\">\n\t\t\t\t\t${col.type === 'Subject' ? subject_html : `\n\t\t\t\t\t<span>${__(col.df && col.df.label || col.type)}</span>`}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn this.get_header_html_skeleton($columns, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_header_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div class=\"level-left list-header-subject\">\n\t\t\t\t\t${left}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-left checkbox-actions\">\n\t\t\t\t\t<div class=\"level list-subject\">\n\t\t\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t\t\t<span class=\"level-item list-header-meta\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t${right}\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tget_left_html(doc) {\n\t\treturn this.columns.map(col => this.get_column_html(col, doc)).join('');\n\t}\n\n\tget_right_html(doc) {\n\t\treturn this.get_meta_html(doc);\n\t}\n\n\tget_list_row_html(doc) {\n\t\treturn this.get_list_row_html_skeleton(this.get_left_html(doc), this.get_right_html(doc));\n\t}\n\n\tget_list_row_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<div class=\"list-row-container\">\n\t\t\t\t<div class=\"level list-row small\">\n\t\t\t\t\t<div class=\"level-left ellipsis\">\n\t\t\t\t\t\t${left}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"level-right text-muted ellipsis\">\n\t\t\t\t\t\t${right}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_column_html(col, doc) {\n\t\tif (col.type === 'Status') {\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col hidden-xs ellipsis\">\n\t\t\t\t\t${this.get_indicator_html(doc)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst df = col.df || {};\n\t\tconst label = df.label;\n\t\tconst fieldname = df.fieldname;\n\t\tconst value = doc[fieldname] || '';\n\n\t\t// listview_setting formatter\n\t\tconst formatters = this.settings.formatters;\n\n\t\tconst format = () => {\n\t\t\tif (formatters && formatters[fieldname]) {\n\t\t\t\treturn formatters[fieldname](value, df, doc);\n\t\t\t} else if (df.fieldtype === 'Code') {\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn frappe.format(value, df, null, doc);\n\t\t\t}\n\t\t};\n\n\t\tconst field_html = () => {\n\t\t\tlet html;\n\t\t\tconst _value = typeof value === 'string' ? frappe.utils.escape_html(value) : value;\n\n\t\t\tif (df.fieldtype === 'Image') {\n\t\t\t\thtml = df.options ?\n\t\t\t\t\t`<img src=\"${doc[df.options]}\" style=\"max-height: 30px; max-width: 100%;\">` :\n\t\t\t\t\t`<div class=\"missing-image small\">\n\t\t\t\t\t\t<span class=\"octicon octicon-circle-slash\"></span>\n\t\t\t\t\t</div>`;\n\t\t\t} else if (df.fieldtype === 'Select') {\n\t\t\t\thtml = `<span class=\"filterable indicator ${frappe.utils.guess_colour(_value)} ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${__(_value)}\n\t\t\t\t</span>`;\n\t\t\t} else if (df.fieldtype === 'Link') {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${_value}\n\t\t\t\t</a>`;\n\t\t\t} else if (df.fieldtype === 'Text Editor') {\n\t\t\t\thtml = `<span class=\"text-muted ellipsis\">\n\t\t\t\t\t${_value}\n\t\t\t\t</span>`;\n\t\t\t} else {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${format()}\n\t\t\t\t</a>`;\n\t\t\t}\n\n\t\t\treturn `<span class=\"ellipsis\"\n\t\t\t\ttitle=\"${__(label) + ': ' + _value}\">\n\t\t\t\t${html}\n\t\t\t</span>`;\n\t\t};\n\n\t\tconst class_map = {\n\t\t\tSubject: 'list-subject level',\n\t\t\tField: 'hidden-xs'\n\t\t};\n\t\tconst css_class = [\n\t\t\t'list-row-col ellipsis',\n\t\t\tclass_map[col.type],\n\t\t\tfrappe.model.is_numeric_field(df) ? 'text-right' : ''\n\t\t].join(' ');\n\n\t\tconst html_map = {\n\t\t\tSubject: this.get_subject_html(doc),\n\t\t\tField: field_html()\n\t\t};\n\t\tconst column_html = html_map[col.type];\n\n\t\treturn `\n\t\t\t<div class=\"${css_class}\">\n\t\t\t\t${column_html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_meta_html(doc) {\n\t\tlet html = '';\n\t\tif (doc[this.meta.title_field || ''] !== doc.name) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs hidden-sm ellipsis\">\n\t\t\t\t\t<a class=\"text-muted ellipsis\" href=\"${this.get_form_link(doc)}\">\n\t\t\t\t\t\t${doc.name}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\tconst modified = comment_when(doc.modified, true);\n\n\t\tconst last_assignee = JSON.parse(doc._assign || '[]').slice(-1)[0];\n\t\tconst assigned_to = last_assignee ?\n\t\t\t`<span class=\"filterable\"\n\t\t\t\tdata-filter=\"_assign,like,%${last_assignee}%\">\n\t\t\t\t${frappe.avatar(last_assignee)}\n\t\t\t</span>` :\n\t\t\t`<span class=\"avatar avatar-small avatar-empty\"></span>`;\n\n\t\tconst comment_count =\n\t\t\t`<span class=\"${!doc._comment_count ? 'text-extra-muted' : ''} comment-count\">\n\t\t\t\t<i class=\"octicon octicon-comment-discussion\"></i>\n\t\t\t\t${doc._comment_count > 99 ? \"99+\" : doc._comment_count}\n\t\t\t</span>`;\n\n\t\thtml += `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${modified}\n\t\t\t\t${assigned_to}\n\t\t\t\t${comment_count}\n\t\t\t</div>\n\t\t\t<div class=\"level-item visible-xs text-right\">\n\t\t\t\t${this.get_indicator_dot(doc)}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tget_count_str() {\n\t\tconst current_count = this.data.length;\n\n\t\treturn frappe.call({\n\t\t\ttype: 'GET',\n\t\t\tmethod: this.method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tfilters: this.get_filters_for_args(),\n\t\t\t\tfields: [`count(${frappe.model.get_full_column_name('name', this.doctype)}) as total_count`],\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tthis.total_count = r.message.values[0][0] || current_count;\n\t\t\tconst str = __('{0} of {1}', [current_count, this.total_count]);\n\t\t\treturn str;\n\t\t});\n\t}\n\n\tget_form_link(doc) {\n\t\tif (this.settings.get_form_link) {\n\t\t\treturn this.settings.get_form_link(doc);\n\t\t}\n\n\t\tconst docname = doc.name.match(/[%'\"]/)\n\t\t\t? encodeURIComponent(doc.name)\n\t\t\t: doc.name;\n\n\t\treturn '#Form/' + this.doctype + '/' + docname;\n\t}\n\n\tget_subject_html(doc) {\n\t\tlet user = frappe.session.user;\n\t\tlet subject_field = this.columns[0].df;\n\t\tlet value = doc[subject_field.fieldname] || doc.name;\n\t\tlet subject = strip_html(value);\n\t\tlet escaped_subject = frappe.utils.escape_html(subject);\n\n\t\tconst liked_by = JSON.parse(doc._liked_by || '[]');\n\t\tlet heart_class = liked_by.includes(user) ?\n\t\t\t'liked-by' : 'text-extra-muted not-liked';\n\n\t\tconst seen = JSON.parse(doc._seen || '[]')\n\t\t\t.includes(user) ? '' : 'bold';\n\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${doc.name}\">\n\t\t\t<span class=\"level-item\" style=\"margin-bottom: 1px;\">\n\t\t\t\t<i class=\"octicon octicon-heart like-action ${heart_class}\"\n\t\t\t\t\tdata-name=\"${doc.name}\" data-doctype=\"${this.doctype}\"\n\t\t\t\t\tdata-liked-by=\"${encodeURI(doc._liked_by) || '[]'}\"\n\t\t\t\t>\n\t\t\t\t</i>\n\t\t\t\t<span class=\"likes-count\">\n\t\t\t\t\t${ liked_by.length > 99 ? __(\"99\") + '+' : __(liked_by.length || '')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"level-item ${seen} ellipsis\" title=\"${escaped_subject}\">\n\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(doc)}\" title=\"${escaped_subject}\">\n\t\t\t\t${subject}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn subject_html;\n\t}\n\n\tget_indicator_html(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (indicator) {\n\t\t\treturn `<span class=\"indicator ${indicator[1]} filterable\"\n\t\t\t\tdata-filter='${indicator[2]}'>\n\t\t\t\t${__(indicator[0])}\n\t\t\t<span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tget_indicator_dot(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (!indicator) return '';\n\t\treturn `<span class='indicator ${indicator[1]}' title='${__(indicator[0])}'></span>`;\n\t}\n\n\tsetup_events() {\n\t\tthis.setup_filterable();\n\t\tthis.setup_list_click();\n\t\tthis.setup_tag_event();\n\t\tthis.setup_new_doc_event();\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t\tthis.setup_realtime_updates();\n\t}\n\n\tsetup_filterable() {\n\t\t// filterable events\n\t\tthis.$result.on('click', '.filterable', e => {\n\t\t\tif (e.metaKey || e.ctrlKey) return;\n\t\t\te.stopPropagation();\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\tconst filters = $this.attr('data-filter').split('|');\n\n\t\t\tconst filters_to_apply = filters.map(f => {\n\t\t\t\tf = f.split(',');\n\t\t\t\tif (f[2] === 'Today') {\n\t\t\t\t\tf[2] = frappe.datetime.get_today();\n\t\t\t\t} else if (f[2] == 'User') {\n\t\t\t\t\tf[2] = frappe.session.user;\n\t\t\t\t}\n\t\t\t\treturn [this.doctype, f[0], f[1], f.slice(2).join(',')];\n\t\t\t});\n\t\t\tthis.filter_area.add(filters_to_apply);\n\t\t});\n\t}\n\n\tsetup_list_click() {\n\t\tthis.$result.on('click', '.list-row', (e) => {\n\t\t\tconst $target = $(e.target);\n\t\t\t// tick checkbox if Ctrl/Meta key is pressed\n\t\t\tif (e.ctrlKey || e.metaKey && !$target.is('a')) {\n\t\t\t\tconst $list_row = $(e.currentTarget);\n\t\t\t\tconst $check = $list_row.find('.list-row-checkbox');\n\t\t\t\t$check.prop('checked', !$check.prop('checked'));\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.on_row_checked();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// don't open form when checkbox, like, filterable are clicked\n\t\t\tif ($target.hasClass('filterable') ||\n\t\t\t\t$target.hasClass('octicon-heart') ||\n\t\t\t\t$target.is(':checkbox') ||\n\t\t\t\t$target.is('a')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// open form\n\t\t\tconst $row = $(e.currentTarget);\n\t\t\tconst link = $row.find('.list-subject a').get(0);\n\t\t\tif (link) {\n\t\t\t\twindow.location.href = link.href;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_check_events() {\n\t\tthis.$result.on('change', 'input[type=checkbox]', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\tif ($target.is('.list-header-subject .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.checkbox-actions .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\t\t\t\t$check.trigger('change');\n\t\t\t} else if ($target.is('.checkbox-actions .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.list-header-subject .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\n\t\t\t\tthis.$result.find('.list-row-checkbox')\n\t\t\t\t\t.prop('checked', $target.prop('checked'));\n\t\t\t}\n\n\t\t\tthis.on_row_checked();\n\t\t});\n\n\t\tthis.$result.on('click', '.list-row-checkbox', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\t// shift select checkboxes\n\t\t\tif (e.shiftKey && this.$checkbox_cursor && !$target.is(this.$checkbox_cursor)) {\n\t\t\t\tconst name_1 = this.$checkbox_cursor.data().name;\n\t\t\t\tconst name_2 = $target.data().name;\n\t\t\t\tconst index_1 = this.data.findIndex(d => d.name === name_1);\n\t\t\t\tconst index_2 = this.data.findIndex(d => d.name === name_2);\n\t\t\t\tlet [min_index, max_index] = [index_1, index_2];\n\n\t\t\t\tif (min_index > max_index) {\n\t\t\t\t\t[min_index, max_index] = [max_index, min_index];\n\t\t\t\t}\n\n\t\t\t\tlet docnames = this.data.slice(min_index + 1, max_index).map(d => d.name);\n\t\t\t\tconst selector = docnames.map(name => `.list-row-checkbox[data-name=\"${name}\"]`).join(',');\n\t\t\t\tthis.$result.find(selector).prop('checked', true);\n\t\t\t}\n\n\t\t\tthis.$checkbox_cursor = $target;\n\t\t});\n\t}\n\n\tsetup_like() {\n\t\tthis.$result.on('click', '.like-action', frappe.ui.click_toggle_like);\n\t\tthis.$result.on('click', '.list-liked-by-me', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\t$this.toggleClass('active');\n\n\t\t\tif ($this.hasClass('active')) {\n\t\t\t\tthis.filter_area.add(this.doctype, '_liked_by', 'like', '%' + frappe.session.user + '%');\n\t\t\t} else {\n\t\t\t\tthis.filter_area.remove('_liked_by');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.setup_like_popover(this.$result, '.liked-by');\n\t}\n\n\tsetup_new_doc_event() {\n\t\tthis.$no_result.find('.btn-new-doc').click(() => this.make_new_doc());\n\t}\n\n\tsetup_tag_event() {\n\t\tthis.list_sidebar.parent.on('click', '.list-tag-preview', () => {\n\t\t\tthis.toggle_tags();\n\t\t});\n\t}\n\n\tsetup_realtime_updates() {\n\t\tfrappe.realtime.on('list_update', data => {\n\t\t\tif (this.filter_area.is_being_edited()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { doctype, name } = data;\n\t\t\tif (doctype !== this.doctype) return;\n\n\t\t\t// filters to get only the doc with this name\n\t\t\tconst call_args = this.get_call_args();\n\t\t\tcall_args.args.filters.push([this.doctype, 'name', '=', name]);\n\t\t\tcall_args.args.start = 0;\n\n\t\t\tfrappe.call(call_args)\n\t\t\t\t.then(({ message }) => {\n\t\t\t\t\tif (!message) return;\n\t\t\t\t\tconst data = frappe.utils.dict(message.keys, message.values);\n\t\t\t\t\tif (!(data && data.length)) {\n\t\t\t\t\t\t// this doc was changed and should not be visible\n\t\t\t\t\t\t// in the listview according to filters applied\n\t\t\t\t\t\t// let's remove it manually\n\t\t\t\t\t\tthis.data = this.data.filter(d => d.name !== name);\n\t\t\t\t\t\tthis.render();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst datum = data[0];\n\t\t\t\t\tconst index = this.data.findIndex(d => d.name === datum.name);\n\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t// append new data\n\t\t\t\t\t\tthis.data.push(datum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update this data in place\n\t\t\t\t\t\tthis.data[index] = datum;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.data.sort((a, b) => {\n\t\t\t\t\t\tconst a_value = a[this.sort_by] || '';\n\t\t\t\t\t\tconst b_value = b[this.sort_by] || '';\n\n\t\t\t\t\t\tlet return_value = 0;\n\t\t\t\t\t\tif (a_value > b_value) {\n\t\t\t\t\t\t\treturn_value = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (b_value > a_value) {\n\t\t\t\t\t\t\treturn_value = -1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.sort_order === 'desc') {\n\t\t\t\t\t\t\treturn_value = -return_value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn return_value;\n\t\t\t\t\t});\n\t\t\t\t\tthis.toggle_result_area();\n\t\t\t\t\tthis.render();\n\t\t\t\t});\n\t\t});\n\t}\n\n\ton_row_checked() {\n\t\tthis.$list_head_subject = this.$list_head_subject || this.$result.find('header .list-header-subject');\n\t\tthis.$checkbox_actions = this.$checkbox_actions || this.$result.find('header .checkbox-actions');\n\n\t\tthis.$checks = this.$result.find('.list-row-checkbox:checked');\n\n\t\tthis.$list_head_subject.toggle(this.$checks.length === 0);\n\t\tthis.$checkbox_actions.toggle(this.$checks.length > 0);\n\n\t\tif (this.$checks.length === 0) {\n\t\t\tthis.$list_head_subject.find('.list-check-all').prop('checked', false);\n\t\t} else {\n\t\t\tthis.$checkbox_actions.find('.list-header-meta').html(\n\t\t\t\t__('{0} items selected', [this.$checks.length])\n\t\t\t);\n\t\t\tthis.$checkbox_actions.show();\n\t\t\tthis.$list_head_subject.hide();\n\t\t}\n\t\tthis.toggle_actions_menu_button(this.$checks.length > 0);\n\t}\n\n\ttoggle_tags() {\n\t\tthis.$result.toggleClass('tags-shown');\n\t}\n\n\tget_checked_items(only_docnames) {\n\t\tconst docnames = Array.from(this.$checks || [])\n\t\t\t.map(check => cstr($(check).data().name));\n\n\t\tif (only_docnames) return docnames;\n\n\t\treturn this.data.filter(d => docnames.includes(d.name));\n\t}\n\n\tsave_view_user_settings(obj) {\n\t\treturn frappe.model.user_settings.save(this.doctype, this.view_name, obj);\n\t}\n\n\ton_update() {\n\n\t}\n\n\tget_share_url() {\n\t\tconst query_params = this.get_filters_for_args().map(filter => {\n\t\t\tfilter[3] = encodeURIComponent(filter[3]);\n\t\t\tif (filter[2] === '=') {\n\t\t\t\treturn `${filter[1]}=${filter[3]}`;\n\t\t\t}\n\t\t\treturn [filter[1], '=', JSON.stringify([filter[2], filter[3]])].join('');\n\t\t}).join('&');\n\n\t\tlet full_url = window.location.href;\n\t\tif (query_params) {\n\t\t\tfull_url += '?' + query_params;\n\t\t}\n\t\treturn full_url;\n\t}\n\n\tshare_url() {\n\t\tconst d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Share URL'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Code',\n\t\t\t\t\tfieldname: 'url',\n\t\t\t\t\tlabel: 'URL',\n\t\t\t\t\tdefault: this.get_share_url(),\n\t\t\t\t\tread_only: 1\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\td.show();\n\t}\n\n\tget_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst items = [];\n\n\t\tif (frappe.model.can_import(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Import'),\n\t\t\t\taction: () => frappe.set_route('List', 'Data Import', {\n\t\t\t\t\treference_doctype: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.model.can_set_user_permissions(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('User Permissions'),\n\t\t\t\taction: () => frappe.set_route('List', 'User Permission', {\n\t\t\t\t\tallow: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user_roles.includes('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Role Permissions Manager'),\n\t\t\t\taction: () => frappe.set_route('permission-manager', {\n\t\t\t\t\tdoctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: __('Customize'),\n\t\t\t\taction: () => {\n\t\t\t\t\tif(this.meta && !this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\t\t\tdoc_type: doctype\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\titems.push({\n\t\t\tlabel: __('Toggle Sidebar'),\n\t\t\taction: () => this.toggle_side_bar(),\n\t\t\tstandard: true\n\t\t});\n\n\t\titems.push({\n\t\t\tlabel: __('Share URL'),\n\t\t\taction: () => this.share_url(),\n\t\t\tstandard: true\n\t\t});\n\n\t\t// add to desktop\n\t\titems.push({\n\t\t\tlabel: __('Add to Desktop'),\n\t\t\taction: () => frappe.add_to_desktop(doctype, doctype),\n\t\t\tstandard: true\n\t\t});\n\n\t\tif (frappe.user.has_role('System Manager') && frappe.boot.developer_mode === 1) {\n\t\t\t// edit doctype\n\t\t\titems.push({\n\t\t\t\tlabel: __('Edit DocType'),\n\t\t\t\taction: () => frappe.set_route('Form', 'DocType', doctype),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tget_actions_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst actions_menu_items = [];\n\t\tconst bulk_operations = new BulkOperations({ doctype: this.doctype });\n\n\t\tconst is_field_editable = (field_doc) => {\n\t\t\treturn field_doc.fieldname && frappe.model.is_value_type(field_doc)\n\t\t\t\t&& field_doc.fieldtype !== 'Read Only' && !field_doc.hidden && !field_doc.read_only;\n\t\t};\n\n\t\tconst has_editable_fields = (doctype) => {\n\t\t\treturn frappe.meta.get_docfields(doctype).some(field_doc => is_field_editable(field_doc));\n\t\t};\n\n\t\tconst has_submit_permission = (doctype) => {\n\t\t\treturn frappe.perm.has_perm(doctype, 0, 'submit');\n\t\t};\n\n\t\t// utility\n\t\tconst bulk_assignment = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Assign To'),\n\t\t\t\taction: () => bulk_operations.assign(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_printing = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: () => bulk_operations.print(this.get_checked_items()),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_delete = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Delete'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true).map(docname => docname.toString());\n\t\t\t\t\tfrappe.confirm(__('Delete {0} items permanently?', [docnames.length]),\n\t\t\t\t\t\t() => bulk_operations.delete(docnames, this.refresh));\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_cancel = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Cancel'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Cancel {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'cancel', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_submit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Submit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Submit {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'submit', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_edit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Edit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tlet field_mappings = {};\n\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach(field_doc => {\n\t\t\t\t\t\tif (is_field_editable(field_doc)) {\n\t\t\t\t\t\t\tfield_mappings[field_doc.label] = Object.assign({}, field_doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\n\t\t\t\t\tbulk_operations.edit(docnames, field_mappings, this.refresh);\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\t// bulk edit\n\t\tif (has_editable_fields(doctype)) {\n\t\t\tactions_menu_items.push(bulk_edit());\n\t\t}\n\n\t\t// bulk assignment\n\t\tactions_menu_items.push(bulk_assignment());\n\n\t\t// bulk printing\n\t\tif (frappe.model.can_print(doctype)) {\n\t\t\tactions_menu_items.push(bulk_printing());\n\t\t}\n\n\t\t// Bulk submit\n\t\tif (frappe.model.is_submittable(doctype) && has_submit_permission(doctype)) {\n\t\t\tactions_menu_items.push(bulk_submit());\n\t\t}\n\n\t\t// Bulk cancel\n\t\tif (frappe.model.can_cancel(doctype)) {\n\t\t\tactions_menu_items.push(bulk_cancel());\n\t\t}\n\n\t\t// bulk delete\n\t\tif (frappe.model.can_delete(doctype)) {\n\t\t\tactions_menu_items.push(bulk_delete());\n\t\t}\n\n\t\treturn actions_menu_items;\n\t}\n\n\tparse_filters_from_route_options() {\n\t\tconst filters = [];\n\n\t\tfor (let field in frappe.route_options) {\n\n\t\t\tlet doctype = null;\n\t\t\tlet value = frappe.route_options[field];\n\n\t\t\tif (typeof value === 'string' && value.startsWith('[') && value.endsWith(']')) {\n\t\t\t\tvalue = JSON.parse(value);\n\t\t\t}\n\n\t\t\t// if `Child DocType.fieldname`\n\t\t\tif (field.includes('.')) {\n\t\t\t\tdoctype = field.split('.')[0];\n\t\t\t\tfield = field.split('.')[1];\n\t\t\t}\n\n\t\t\t// find the table in which the key exists\n\t\t\t// for example the filter could be {\"item_code\": \"X\"}\n\t\t\t// where item_code is in the child table.\n\n\t\t\t// we can search all tables for mapping the doctype\n\t\t\tif (!doctype) {\n\t\t\t\tdoctype = frappe.meta.get_doctype_for_field(this.doctype, field);\n\t\t\t}\n\n\t\t\tif (doctype) {\n\t\t\t\tif ($.isArray(value)) {\n\t\t\t\t\tfilters.push([doctype, field, value[0], value[1]]);\n\t\t\t\t} else {\n\t\t\t\t\tfilters.push([doctype, field, \"=\", value]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tstatic trigger_list_update(data) {\n\t\tconst doctype = data.doctype;\n\t\tif (!doctype) return;\n\t\tfrappe.provide('frappe.views.trees');\n\n\t\t// refresh tree view\n\t\tif (frappe.views.trees[doctype]) {\n\t\t\tfrappe.views.trees[doctype].tree.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\t// refresh list view\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst list_view = frappe.views.list_view[page_name];\n\t\tlist_view && list_view.on_update(data);\n\t}\n};\n\n$(document).on('save', (event, doc) => {\n\tfrappe.views.ListView.trigger_list_update(doc);\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.list_view');\n\nwindow.cur_list = null;\nfrappe.views.ListFactory = class ListFactory extends frappe.views.Factory {\n\tmake (route) {\n\t\tvar me = this;\n\t\tvar doctype = route[1];\n\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tif (locals['DocType'][doctype].issingle) {\n\t\t\t\tfrappe.set_re_route('Form', doctype);\n\t\t\t} else {\n\t\t\t\t// List / Gantt / Kanban / etc\n\t\t\t\t// File is a special view\n\t\t\t\tconst view_name = doctype !== 'File' ? route[2] : 'File';\n\t\t\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\t\t\tif (!view_class) view_class = frappe.views.ListView;\n\n\t\t\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t\t\t// view can have custom routing logic\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.provide('frappe.views.list_view.' + doctype);\n\t\t\t\tconst page_name = frappe.get_route_str();\n\n\t\t\t\tif (!frappe.views.list_view[page_name]) {\n\t\t\t\t\tfrappe.views.list_view[page_name] = new view_class({\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tparent: me.make_page(true, page_name)\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\t}\n\t\t\t\tme.set_cur_list();\n\t\t\t}\n\t\t});\n\t}\n\n\tshow() {\n\t\tif(this.re_route_to_view()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.set_module_breadcrumb();\n\t\tsuper.show();\n\t\tthis.set_cur_list();\n\t\tcur_list && cur_list.show();\n\t}\n\n\tre_route_to_view() {\n\t\tvar route = frappe.get_route();\n\t\tvar doctype = route[1];\n\t\tvar last_route = frappe.route_history.slice(-2)[0];\n\t\tif (route[0] === 'List' && route.length === 2 && frappe.views.list_view[doctype]) {\n\t\t\tif(last_route && last_route[0]==='List' && last_route[1]===doctype) {\n\t\t\t\t// last route same as this route, so going back.\n\t\t\t\t// this happens because #List/Item will redirect to #List/Item/List\n\t\t\t\t// while coming from back button, the last 2 routes will be same, so\n\t\t\t\t// we know user is coming in the reverse direction (via back button)\n\n\t\t\t\t// example:\n\t\t\t\t// Step 1: #List/Item redirects to #List/Item/List\n\t\t\t\t// Step 2: User hits \"back\" comes back to #List/Item\n\t\t\t\t// Step 3: Now we cannot send the user back to #List/Item/List so go back one more step\n\t\t\t\twindow.history.go(-1);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tset_module_breadcrumb() {\n\t\tif (frappe.route_history.length > 1) {\n\t\t\tvar prev_route = frappe.route_history[frappe.route_history.length - 2];\n\t\t\tif (prev_route[0] === 'modules') {\n\t\t\t\tvar doctype = frappe.get_route()[1],\n\t\t\t\t\tmodule = prev_route[1];\n\t\t\t\tif (frappe.module_links[module] && frappe.module_links[module].includes(doctype)) {\n\t\t\t\t\t// save the last page from the breadcrumb was accessed\n\t\t\t\t\tfrappe.breadcrumbs.set_doctype_module(doctype, module);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tset_cur_list() {\n\t\tvar route = frappe.get_route();\n\t\tvar page_name = frappe.get_route_str();\n\t\tcur_list = frappe.views.list_view[page_name];\n\t\tif (cur_list && cur_list.doctype !== route[1]) {\n\t\t\t// changing...\n\t\t\twindow.cur_list = null;\n\t\t}\n\t}\n}\n","frappe.provide('frappe.ui');\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role(['System Manager', 'Administrator']);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html('<li class=\"input-area\"></li>');\n\t\tthis.$input_area = this.wrapper.find('.input-area');\n\t\tthis.$list_filters = this.wrapper.find('.list-filters');\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: __('Save Filter').toUpperCase(),\n\t\t\t\tplaceholder: __('Filter Name'),\n\t\t\t\tinput_class: 'input-xs'\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\t$(this.filter_input.label_area).css('font-size', 10);\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tlabel: __('Is Global')\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1\n\t\t});\n\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters()\n\t\t\t.then(() => {\n\t\t\t\tconst html = this.filters.map(filter => this.filter_template(filter));\n\t\t\t\tthis.wrapper.find('.list-link').remove();\n\t\t\t\tthis.wrapper.append(html);\n\t\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description('');\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<li class=\"list-link\" data-name=\"${filter.name}\">\n\t\t\t<a style=\"max-width: 90%;\">${filter.filter_name}</a>\n\t\t\t<a class=\"text-muted pull-right\"><span class=\"remove octicon octicon-x\"></span></a>\n\t\t</li>`;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on('click', '.list-link', e => {\n\t\t\tconst name = $(e.currentTarget).attr('data-name');\n\t\t\tthis.list_view.filter_area.clear()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on('click', '.list-link .remove', e => {\n\t\t\tconst $li = $(e.currentTarget).closest('.list-link')\n\t\t\tconst name = $li.attr('data-name');\n\t\t\t$li.remove();\n\t\t\tthis.remove_filter(name)\n\t\t\t\t.then(() => this.refresh());\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(frappe.utils.debounce(e => {\n\t\t\tconst value = this.filter_input.get_value();\n\t\t\tconst has_value = Boolean(value);\n\n\t\t\tif (e.which === frappe.ui.keyCode['ENTER']) {\n\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\tthis.filter_input.set_value('');\n\t\t\t\tthis.save_filter(value)\n\t\t\t\t\t.then(() => this.refresh());\n\t\t\t} else {\n\t\t\t\tlet help_text = __('Press Enter to save');\n\n\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\thelp_text = __('Duplicate Filter Name');\n\t\t\t\t}\n\n\t\t\t\tthis.filter_input.set_description(has_value ? help_text : '');\n\n\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 300));\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: 'List Filter',\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? '' : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters())\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc('List Filter', name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find(filter => filter.name === name);\n\t\treturn  JSON.parse(filter.filters || '[]');\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find(f => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\treturn frappe.db.get_list('List Filter', {\n\t\t\tfields: ['name', 'filter_name', 'for_user', 'filters'],\n\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\tor_filters: [['for_user', '=', frappe.session.user], ['for_user', '=', '']]\n\t\t}).then((filters) => {\n\t\t\tthis.filters = filters || [];\n\t\t});\n\t}\n}\n","frappe.provide('frappe.views');\n\nfrappe.views.FileView = class FileView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 2) {\n\t\t\tconst view_user_settings = frappe.get_user_settings('File', 'File');\n\t\t\tfrappe.set_route('List', 'File', view_user_settings.last_folder || frappe.boot.home_folder);\n\t\t\treturn true;\n\t\t}\n\t\treturn redirect_to_home_if_invalid_route();\n\t}\n\n\tget view_name() {\n\t\treturn 'File';\n\t}\n\n\tshow() {\n\t\tif (!redirect_to_home_if_invalid_route()) {\n\t\t\tsuper.show();\n\t\t}\n\t}\n\n\tsetup_view() {\n\t\tthis.render_header();\n\t\tthis.setup_events();\n\t}\n\n\tset_breadcrumbs() {\n\t\tconst route = frappe.get_route();\n\t\troute.splice(-1);\n\t\tconst last_folder = route[route.length - 1];\n\t\tif (last_folder === 'File') return;\n\n\t\tfrappe.breadcrumbs.add({\n\t\t\ttype: 'Custom',\n\t\t\tlabel: __('Home'),\n\t\t\troute: '#List/File/Home'\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = __('File Manager');\n\n\t\tconst route = frappe.get_route();\n\t\tthis.current_folder = route.slice(2).join('/');\n\t\tthis.filters = [['File', 'folder', '=', this.current_folder, true]];\n\t\tthis.order_by = this.view_user_settings.order_by || 'file_name asc';\n\n\t\tthis.menu_items = this.menu_items.concat(this.file_menu_items());\n\t}\n\n\tfile_menu_items() {\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tlabel: __('Home'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.set_route('List', 'File', 'Home');\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Cut'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.cut(this.get_checked_items(), this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'cut-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Paste'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.paste(this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'paste-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('New Folder'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.prompt(__('Name'), (values) => {\n\t\t\t\t\t\tif((values.value.indexOf(\"/\") > -1)) {\n\t\t\t\t\t\t\tfrappe.throw(__(\"Folder name should not include '/' (slash)\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data =  {\n\t\t\t\t\t\t\tfile_name: values.value,\n\t\t\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"frappe.core.doctype.file.file.create_new_folder\",\n\t\t\t\t\t\t\targs: data\n\t\t\t\t\t\t});\n\t\t\t\t\t}, __('Enter folder name'), __('Create'));\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Toggle Grid View'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.views.FileView.grid_view = !frappe.views.FileView.grid_view;\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Import Zip'),\n\t\t\t\taction: () => {\n\t\t\t\t\t// make upload dialog\n\t\t\t\t\tfrappe.ui.get_upload_dialog({\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tfolder: this.current_folder,\n\t\t\t\t\t\t\tfrom_form: 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: (attachment, r) => {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: 'frappe.core.doctype.file.file.unzip_file',\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tname: r.message.name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\t\t\t\t\tfrappe.msgprint(__('Error in uploading files' + r.exc));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\treturn items;\n\t}\n\n\tset_fields() {\n\t\tthis.fields = this.meta.fields\n\t\t\t.filter(df => frappe.model.is_value_type(df.fieldtype) && !df.hidden)\n\t\t\t.map(df => df.fieldname)\n\t\t\t.concat(['name', 'modified', 'creation']);\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\n\t\tthis.data = this.data.map(d => this.prepare_datum(d));\n\n\t\t// Bring folders to the top\n\t\tconst { sort_by } = this.sort_selector;\n\t\tif (sort_by === 'file_name') {\n\t\t\tthis.data.sort((a, b) => {\n\t\t\t\tif (a.is_folder && !b.is_folder) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!a.is_folder &&b.is_folder) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tprepare_datum(d) {\n\t\tlet icon_class = '';\n\t\tif (d.is_folder) {\n\t\t\ticon_class = \"octicon octicon-file-directory\";\n\t\t} else if (frappe.utils.is_image_file(d.file_name)) {\n\t\t\ticon_class = \"octicon octicon-file-media\";\n\t\t} else {\n\t\t\ticon_class = 'octicon octicon-file-text';\n\t\t}\n\n\t\tlet title = d.file_name || d.file_url;\n\t\ttitle = title.slice(0, 60);\n\t\td._title = title;\n\t\td.icon_class = icon_class;\n\n\t\td.subject_html = `\n\t\t\t<i class=\"${icon_class} text-muted\" style=\"width: 16px;\"></i>\n\t\t\t<span>${title}</span>\n\t\t\t${d.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t`;\n\t\treturn d;\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tfrappe.model.user_settings.save('File', 'grid_view', frappe.views.FileView.grid_view);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_folder: this.current_folder,\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.removeClass('file-grid');\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render();\n\t\t}\n\t}\n\n\trender_grid_view() {\n\t\tlet html = '';\n\n\t\thtml = this.data.map(d => {\n\t\t\treturn `\n\t\t\t\t<a href=\"${this.get_route_url(d)}\">\n\t\t\t\t\t<div class=\"file-wrapper padding flex small\">\n\t\t\t\t\t\t<div class=\"file-icon text-muted\">\n\t\t\t\t\t\t\t<span class=\"${d.icon_class} mega-octicon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"file-title ellipsis\">${d._title}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}).join('');\n\t\tthis.$result.addClass('file-grid');\n\t\tthis.$result.html(html);\n\t}\n\n\tget_breadcrumbs_html() {\n\t\tconst route = frappe.get_route();\n\t\tconst folders = route.slice(2);\n\n\t\treturn folders\n\t\t\t.map((folder, i) => {\n\t\t\t\tif (i === folders.length - 1) {\n\t\t\t\t\treturn `<span>${folder}</span>`;\n\t\t\t\t}\n\t\t\t\tconst route = folders.reduce((acc, curr, j) => {\n\t\t\t\t\tif (j <= i) {\n\t\t\t\t\t\tacc += '/' + curr;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, '#List/File');\n\n\t\t\t\treturn `<a href=\"${route}\">${folder}</a>`;\n\t\t\t})\n\t\t\t// only show last 3 breadcrumbs\n\t\t\t.slice(-3)\n\t\t\t.join('&nbsp;/&nbsp;');\n\t}\n\n\tget_header_html() {\n\t\tconst breadcrumbs_html = this.get_breadcrumbs_html();\n\n\t\tlet subject_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t<span class=\"level-item\">${breadcrumbs_html}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Size')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Created')}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_header_html_skeleton(subject_html, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_route_url(file) {\n\t\treturn file.is_folder ? '#List/File/' + file.name : this.get_form_link(file);\n\t}\n\n\tget_left_html(file) {\n\t\tfile = this.prepare_datum(file);\n\t\tconst file_size = frappe.form.formatters.FileSize(file.file_size);\n\t\tconst route_url = this.get_route_url(file);\n\n\t\tlet created_on;\n\t\tconst [date] = file.creation.split(' ');\n\t\tif (date === frappe.datetime.now_date()) {\n\t\t\tcreated_on = comment_when(file.creation);\n\t\t} else {\n\t\t\tcreated_on = frappe.datetime.str_to_user(date);\n\t\t}\n\n\t\treturn `\n\t\t\t<div class=\"list-row-col ellipsis list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${file.name}\">\n\t\t\t\t<span class=\"level-item  ellipsis\" title=\"${file.file_name}\">\n\t\t\t\t\t<a class=\"ellipsis\" href=\"${route_url}\" title=\"${file.file_name}\">\n\t\t\t\t\t\t${file.subject_html}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${file_size}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${created_on}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_right_html(file) {\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${comment_when(file.modified)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tfrappe.ui.get_upload_dialog({\n\t\t\t\"args\": {\n\t\t\t\t\"folder\": this.current_folder,\n\t\t\t\t\"from_form\": 1\n\t\t\t},\n\t\t\tcallback:() => this.refresh()\n\t\t});\n\t}\n\n\tsetup_events() {\n\t\tsuper.setup_events();\n\t\tthis.setup_drag_drop();\n\t}\n\n\tsetup_drag_drop() {\n\t\tthis.$result.on('dragenter dragover', false)\n\t\t\t.on('drop', e => {\n\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tfrappe.upload.make({\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\t\"args\": {\n\t\t\t\t\t\t\"folder\": this.current_folder,\n\t\t\t\t\t\t\"from_form\": 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ton_row_checked() {\n\t\tsuper.on_row_checked();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ttoggle_cut_paste_buttons() {\n\t\t// paste btn\n\t\tconst $paste_btn = this.page.menu_btn_group.find('.paste-menu-button');\n\t\tconst hide = !frappe.file_manager.can_paste ||\n\t\t\tfrappe.file_manager.old_folder === this.current_folder;\n\n\t\tif (hide) {\n\t\t\t$paste_btn.addClass('hide');\n\t\t} else {\n\t\t\t$paste_btn.removeClass('hide');\n\t\t}\n\n\t\t// cut btn\n\t\tconst $cut_btn = this.page.menu_btn_group.find('.cut-menu-button');\n\t\tif (this.$checks && this.$checks.length > 0) {\n\t\t\t$cut_btn.removeClass('hide');\n\t\t} else {\n\t\t\t$cut_btn.addClass('hide');\n\t\t}\n\t}\n};\n\nfrappe.views.FileView.grid_view = frappe.get_user_settings('File').grid_view || false;\n\nfunction redirect_to_home_if_invalid_route() {\n\tconst route = frappe.get_route();\n\tif (route[2] !== 'Home') {\n\t\t// if the user somehow redirects to List/File/List\n\t\t// redirect back to Home\n\t\tfrappe.set_route('List', 'File', 'Home');\n\t\treturn true;\n\t}\n\treturn false;\n}\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.provide('frappe.views');\nfrappe.provide(\"frappe.interaction_settings\");\n\nfrappe.views.InteractionComposer = class InteractionComposer {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: (me.title || me.subject || __(\"New Activity\")),\n\t\t\tno_submit_on_enter: true,\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __(\"Create\"),\n\t\t\tprimary_action: function() {\n\t\t\t\tme.create_action();\n\t\t\t}\n\t\t});\n\n\t\t$(document).on(\"upload_complete\", function(event, attachment) {\n\t\t\tif(me.dialog.display) {\n\t\t\t\tlet wrapper = $(me.dialog.fields_dict.select_attachments.wrapper);\n\n\t\t\t\t// find already checked items\n\t\t\t\tlet checked_items = wrapper.find('[data-file-name]:checked').map(function() {\n\t\t\t\t\treturn $(this).attr(\"data-file-name\");\n\t\t\t\t});\n\n\t\t\t\t// reset attachment list\n\t\t\t\tme.render_attach();\n\n\t\t\t\t// check latest added\n\t\t\t\tchecked_items.push(attachment.name);\n\n\t\t\t\t$.each(checked_items, function(i, filename) {\n\t\t\t\t\twrapper.find('[data-file-name=\"'+ filename +'\"]').prop(\"checked\", true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tme.prepare();\n\t\tme.dialog.show();\n\t}\n\n\tget_fields() {\n\t\tlet me = this;\n\t\tlet interaction_docs = Object.keys(get_doc_mappings());\n\n\t\tlet fields = [\n\t\t\t{label:__(\"Reference\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"interaction_type\", options: interaction_docs,\n\t\t\t\treqd: 1,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tlet values = me.get_values();\n\t\t\t\t\tme.get_fields().forEach(field => {\n\t\t\t\t\t\tif (field.fieldname != \"interaction_type\") {\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"reqd\", 0);\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"hidden\", 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.set_reqd_hidden_fields(values);\n\t\t\t\t\tme.get_event_categories();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{label:__(\"Category\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"category\", options: \"\", hidden: 1},\n\t\t\t{label:__(\"Public\"), fieldtype:\"Check\",\n\t\t\t\tfieldname:\"public\", default: \"1\"},\n\t\t\t{fieldtype: \"Column Break\"},\n\t\t\t{label:__(\"Date\"), fieldtype:\"Datetime\",\n\t\t\t\tfieldname:\"due_date\"},\n\t\t\t{label:__(\"Assigned To\"), fieldtype:\"Link\",\n\t\t\t\tfieldname:\"assigned_to\", options:\"User\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Summary\"), fieldtype:\"Data\",\n\t\t\t\tfieldname:\"summary\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{fieldtype:\"Text Editor\", fieldname:\"description\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Select Attachments\"), fieldtype:\"HTML\",\n\t\t\t\tfieldname:\"select_attachments\"}\n\t\t];\n\n\t\treturn fields;\n\n\t}\n\n\tget_event_categories() {\n\t\tlet me = this;\n\t\tfrappe.model.with_doctype('Event', () => {\n\t\t\tlet categories = frappe.meta.get_docfield(\"Event\", \"event_category\").options.split(\"\\n\");\n\t\t\tme.dialog.get_input(\"category\").empty().add_options(categories);\n\t\t});\n\t}\n\n\tprepare() {\n\t\tthis.setup_attach();\n\t}\n\n\tset_reqd_hidden_fields(values) {\n\t\tlet me = this;\n\t\tif (values&&\"interaction_type\" in values) {\n\t\t\tlet doc_mapping = get_doc_mappings();\n\t\t\tdoc_mapping[values.interaction_type][\"reqd_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'reqd', 1);\n\t\t\t});\n\n\t\t\tdoc_mapping[values.interaction_type][\"hidden_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'hidden', 1);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_attach() {\n\t\tlet fields = this.dialog.fields_dict;\n\t\tlet attach = $(fields.select_attachments.wrapper);\n\n\t\tlet me = this;\n\t\tif (!me.attachments){\n\t\t\tme.attachments = [];\n\t\t}\n\n\t\tlet args = {\n\t\t\targs: {\n\t\t\t\tfrom_form: 1,\n\t\t\t\tfolder:\"Home/Attachments\"\n\t\t\t},\n\t\t\tcallback: function(attachment){\n\t\t\t\tme.attachments.push(attachment);\n\t\t\t},\n\t\t\tmax_width: null,\n\t\t\tmax_height: null\n\t\t};\n\n\t\tif(me.frm) {\n\t\t\targs = {\n\t\t\t\targs: (me.frm.attachments.get_args\n\t\t\t\t\t? me.frm.attachments.get_args()\n\t\t\t\t\t: { from_form: 1,folder:\"Home/Attachments\" }),\n\t\t\t\tcallback: function(attachment, r){\n\t\t\t\t\tme.frm.attachments.attachment_uploaded(attachment, r);\n\t\t\t\t},\n\t\t\t\tmax_width: me.frm.cscript ? me.frm.cscript.attachment_max_width : null,\n\t\t\t\tmax_height: me.frm.cscript ? me.frm.cscript.attachment_max_height : null\n\t\t\t};\n\n\t\t}\n\n\t\t$(\"<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>\"\n\t\t\t+__(\"Select Attachments\")+\"</h6><div class='attach-list'></div>\\\n\t\t\t<p class='add-more-attachments'>\\\n\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> \"\n\t\t\t+__(\"Add Attachment\")+\"</a></p>\").appendTo(attach.empty());\n\t\tattach.find(\".add-more-attachments a\").on('click',this,function() {\n\t\t\tme.upload = frappe.ui.get_upload_dialog(args);\n\t\t});\n\t\tme.render_attach();\n\n\t}\n\n\trender_attach(){\n\t\tlet fields = this.dialog.fields_dict;\n\t\tlet attach = $(fields.select_attachments.wrapper).find(\".attach-list\").empty();\n\n\t\tlet files = [];\n\t\tif (this.attachments && this.attachments.length) {\n\t\t\tfiles = files.concat(this.attachments);\n\t\t}\n\t\tif (cur_frm) {\n\t\t\tfiles = files.concat(cur_frm.get_files());\n\t\t}\n\n\t\tif(files.length) {\n\t\t\t$.each(files, function(i, f) {\n\t\t\t\tif (!f.file_name) return;\n\t\t\t\tf.file_url = frappe.urllib.get_full_url(f.file_url);\n\n\t\t\t\t$(repl('<p class=\"checkbox\">'\n\t\t\t\t\t+\t'<label><span><input type=\"checkbox\" data-file-name=\"%(name)s\"></input></span>'\n\t\t\t\t\t+\t\t'<span class=\"small\">%(file_name)s</span>'\n\t\t\t\t\t+\t' <a href=\"%(file_url)s\" target=\"_blank\" class=\"text-muted small\">'\n\t\t\t\t\t+\t\t'<i class=\"fa fa-share\" style=\"vertical-align: middle; margin-left: 3px;\"></i>'\n\t\t\t\t\t+ '</label></p>', f))\n\t\t\t\t\t.appendTo(attach);\n\t\t\t});\n\t\t}\n\t}\n\n\tcreate_action() {\n\t\tlet me = this;\n\t\tlet btn = me.dialog.get_primary_btn();\n\n\t\tlet form_values = this.get_values();\n\t\tif(!form_values) return;\n\n\t\tlet selected_attachments =\n\t\t\t$.map($(me.dialog.wrapper).find(\"[data-file-name]:checked\"), function(element){\n\t\t\t\treturn $(element).attr(\"data-file-name\");\n\t\t\t});\n\n\t\tme.create_interaction(btn, form_values, selected_attachments);\n\t}\n\n\tget_values() {\n\t\tlet me = this;\n\t\tlet values = this.dialog.get_values(true);\n\t\tif (values) {\n\t\t\tvalues[\"reference_doctype\"] = me.frm.doc.doctype;\n\t\t\tvalues[\"reference_document\"] = me.frm.doc.name;\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tcreate_interaction(btn, form_values, selected_attachments) {\n\t\tlet me = this;\n\t\tme.dialog.hide();\n\n\t\tlet field_map = get_doc_mappings();\n\t\tlet interaction_values = {};\n\t\tObject.keys(form_values).forEach(value => {\n\t\t\tinteraction_values[field_map[form_values.interaction_type][\"field_map\"][value]] = form_values[value];\n\t\t});\n\n\t\tif (\"event_type\" in interaction_values){\n\t\t\tinteraction_values[\"event_type\"] = (form_values.public == 1) ? \"Public\" : \"Private\";\n\t\t}\n\t\tif (interaction_values[\"doctype\"] == \"Event\") {\n\t\t\tinteraction_values[\"event_participants\"] = [{\"reference_doctype\": form_values.reference_doctype,\n\t\t\t\t\"reference_docname\": form_values.reference_document}];\n\t\t}\n\t\tif (!(\"owner\" in interaction_values)){\n\t\t\tinteraction_values[\"owner\"] = frappe.session.user;\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod:\"frappe.client.insert\",\n\t\t\targs: { doc: interaction_values},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"{0} created successfully\", [form_values.interaction_type]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tif (\"assigned_to\" in form_values) {\n\t\t\t\t\t\tme.assign_document(r.message, form_values[\"assigned_to\"]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selected_attachments) {\n\t\t\t\t\t\tme.add_attachments(r.message, selected_attachments);\n\t\t\t\t\t}\n\t\t\t\t\tif (cur_frm) {\n\t\t\t\t\t\t// clear input\n\t\t\t\t\t\tcur_frm.timeline.input && cur_frm.timeline.input.val(\"\");\n\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while creating the document. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tassign_document(doc, assignee) {\n\t\tif (doc.doctype != \"ToDo\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:'frappe.desk.form.assign_to.add',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\tname: doc.name,\n\t\t\t\t\tassign_to: assignee,\n\t\t\t\t\tnotify: 1\n\t\t\t\t},\n\t\t\t\tcallback:function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document has been assigned to {0}\", [assignee]),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document could not be correctly assigned\"),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\tadd_attachments(doc, attachments) {\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.utils.file_manager.add_attachments',\n\t\t\targs: {\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tattachments: JSON.stringify(attachments)\n\t\t\t},\n\t\t\tcallback:function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"The attachments could not be correctly linked to the new document\"),\n\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n};\n\nfunction get_doc_mappings() {\n\tconst doc_map = {\n\t\t\"Event\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"summary\": \"subject\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"category\": \"event_category\",\n\t\t\t\t\"due_date\": \"starts_on\",\n\t\t\t\t\"public\": \"event_type\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"summary\", \"due_date\"],\n\t\t\t\"hidden_fields\": []\n\t\t} ,\n\t\t\"ToDo\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"due_date\": \"date\",\n\t\t\t\t\"reference_doctype\": \"reference_type\",\n\t\t\t\t\"reference_document\": \"reference_name\",\n\t\t\t\t\"assigned_to\": \"owner\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"description\"],\n\t\t\t\"hidden_fields\": [\"public\", \"category\"]\n\t\t}\n\t};\n\n\treturn doc_map;\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport ListFilter from './list_filter';\nfrappe.provide('frappe.views');\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n// set_filter = function called on click\n\nfrappe.views.ListSidebar = class ListSidebar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.get_stats();\n\t\tthis.cat_tags = [];\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_reports();\n\t\tthis.setup_list_filter();\n\t\tthis.setup_assigned_to_me();\n\t\tthis.setup_views();\n\t\tthis.setup_kanban_boards();\n\t\tthis.setup_calendar_view();\n\t\tthis.setup_email_inbox();\n\n\t\tlet limits = frappe.boot.limits;\n\n\t\tif (limits.upgrade_url && limits.expiry && !frappe.flags.upgrade_dismissed) {\n\t\t\tthis.setup_upgrade_box();\n\t\t}\n\t}\n\n\tsetup_views() {\n\t\tvar show_list_link = false;\n\n\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Calendar\"]').removeClass(\"hide\");\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Gantt\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\t\t//show link for kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"]').removeClass('hide');\n\t\tif (this.doctype === \"Communication\" && frappe.boot.email_accounts.length) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Inbox\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (frappe.treeview_settings[this.doctype]) {\n\t\t\tthis.sidebar.find(\".tree-link\").removeClass(\"hide\");\n\t\t}\n\n\t\tthis.current_view = 'List';\n\t\tvar route = frappe.get_route();\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(route[2])) {\n\t\t\tthis.current_view = route[2];\n\n\t\t\tif (this.current_view === 'Kanban') {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === 'Inbox') {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\n\t\t// disable link for current view\n\t\tthis.sidebar.find('.list-link[data-view=\"' + this.current_view + '\"] a')\n\t\t\t.attr('disabled', 'disabled').addClass('disabled');\n\n\t\t//enable link for Kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"] a, .list-link[data-view=\"Inbox\"] a')\n\t\t\t.attr('disabled', null).removeClass('disabled');\n\n\t\t// show image link if image_view\n\t\tif (this.list_view.meta.image_field) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Image\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (show_list_link) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"List\"]').removeClass('hide');\n\t\t}\n\t}\n\n\tsetup_reports() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar added = [];\n\t\tvar dropdown = this.page.sidebar.find('.reports-dropdown');\n\t\tvar divider = false;\n\n\t\tvar add_reports = function(reports) {\n\t\t\t$.each(reports, function(name, r) {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == me.doctype) {\n\t\t\t\t\tvar report_type = r.report_type === 'Report Builder' ?\n\t\t\t\t\t\t`List/${r.ref_doctype}/Report` : 'query-report';\n\n\t\t\t\t\tvar route = r.route || report_type + '/' + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\n\t\t\t\t\t\tif (!divider) {\n\t\t\t\t\t\t\tme.get_divider().appendTo(dropdown);\n\t\t\t\t\t\t\tdivider = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('<li><a href=\"#' + route + '\">' +\n\t\t\t\t\t\t\t__(r.title || r.name) + '</a></li>').appendTo(dropdown);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// Sort reports alphabetically\n\t\tvar reports = Object.values(frappe.boot.user.all_reports).sort((a,b) => a.title.localeCompare(b.title)) || [];\n\n\t\t// from specially tagged reports\n\t\tadd_reports(reports);\n\t}\n\n\tsetup_list_filter() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find('.list-filters'),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view\n\t\t});\n\t}\n\n\tsetup_kanban_boards() {\n\t\tconst $dropdown = this.page.sidebar.find('.kanban-dropdown');\n\t\tfrappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype, $dropdown);\n\t}\n\n\tsetup_calendar_view() {\n\t\tconst doctype = this.doctype;\n\n\t\tfrappe.db.get_list('Calendar View', {\n\t\t\tfilters: {\n\t\t\t\treference_doctype: doctype\n\t\t\t}\n\t\t}).then(result => {\n\t\t\tif (!result) return;\n\t\t\tconst calendar_views = result;\n\t\t\tconst $link_calendar = this.sidebar.find('.list-link[data-view=\"Calendar\"]');\n\n\t\t\tlet default_link = '';\n\t\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\t\t// has standard calendar view\n\t\t\t\tdefault_link = `<li><a href=\"#List/${doctype}/Calendar/Default\">\n\t\t\t\t\t${ __(\"Default\") }</a></li>`;\n\t\t\t}\n\t\t\tconst other_links = calendar_views.map(\n\t\t\t\tcalendar_view => `<li><a href=\"#List/${doctype}/Calendar/${calendar_view.name}\">\n\t\t\t\t\t${ __(calendar_view.name) }</a>\n\t\t\t\t</li>`\n\t\t\t).join('');\n\n\t\t\tconst dropdown_html = `\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class=\"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t\t${ __(\"Calendar\") } <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu calendar-dropdown\" style=\"max-height: 300px; overflow-y: auto;\">\n\t\t\t\t\t\t${default_link}\n\t\t\t\t\t\t${other_links}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t$link_calendar.removeClass('hide');\n\t\t\t$link_calendar.html(dropdown_html);\n\t\t});\n\t}\n\n\tsetup_email_inbox() {\n\t\t// get active email account for the user and add in dropdown\n\t\tif (this.doctype != \"Communication\")\n\t\t\treturn;\n\n\t\tlet $dropdown = this.page.sidebar.find('.email-account-dropdown');\n\t\tlet divider = false;\n\n\t\tif (has_common(frappe.user_roles, [\"System Manager\", \"Administrator\"])) {\n\t\t\t$(`<li class=\"new-email-account\"><a>${__(\"New Email Account\")}</a></li>`)\n\t\t\t\t.appendTo($dropdown);\n\t\t}\n\n\t\tlet accounts = frappe.boot.email_accounts;\n\t\taccounts.forEach((account) => {\n\t\t\tlet email_account = (account.email_id == \"All Accounts\") ? \"All Accounts\" : account.email_account;\n\t\t\tlet route = [\"List\", \"Communication\", \"Inbox\", email_account].join('/');\n\t\t\tif (!divider) {\n\t\t\t\tthis.get_divider().appendTo($dropdown);\n\t\t\t\tdivider = true;\n\t\t\t}\n\t\t\t$(`<li><a href=\"#${route}\">${account.email_id}</a></li>`).appendTo($dropdown);\n\t\t\tif (account.email_id === \"Sent Mail\")\n\t\t\t\tdivider = false;\n\t\t});\n\n\t\t$dropdown.find('.new-email-account').click(function() {\n\t\t\tfrappe.new_doc(\"Email Account\");\n\t\t});\n\t}\n\n\tsetup_assigned_to_me() {\n\t\tthis.page.sidebar.find(\".assigned-to-me a\").on(\"click\", () => {\n\t\t\tthis.list_view.filter_area.add(this.list_view.doctype, \"_assign\", \"like\", `%${frappe.session.user}%`);\n\t\t});\n\t}\n\n\tsetup_upgrade_box() {\n\t\tlet upgrade_list = $(`<ul class=\"list-unstyled sidebar-menu\"></ul>`).appendTo(this.sidebar);\n\n\t\t// Show Renew/Upgrade button,\n\t\t// if account is holding one user free plan or\n\t\t// if account's expiry date within range of 30 days from today's date\n\n\t\tlet upgrade_date = frappe.datetime.add_days(frappe.datetime.get_today(), 30);\n\t\tif (frappe.boot.limits.users === 1 || upgrade_date >= frappe.boot.limits.expiry) {\n\t\t\tlet upgrade_box = $(`<div class=\"border\" style=\"\n\t\t\t\t\tpadding: 0px 10px;\n\t\t\t\t\tborder-radius: 3px;\n\t\t\t\t\">\n\t\t\t\t<a><i class=\"octicon octicon-x pull-right close\" style=\"margin-top: 10px;\"></i></a>\n\t\t\t\t<h5>Go Premium</h5>\n\t\t\t\t<p>Upgrade to a premium plan with more users, storage and priority support.</p>\n\t\t\t\t<button class=\"btn btn-xs btn-default btn-upgrade\" style=\"margin-bottom: 10px;\"> Renew / Upgrade </button>\n\t\t\t\t</div>`).appendTo(upgrade_list);\n\n\t\t\tupgrade_box.find('.btn-upgrade').on('click', () => {\n\t\t\t\tfrappe.set_route('usage-info');\n\t\t\t});\n\n\t\t\tupgrade_box.find('.close').on('click', () => {\n\t\t\t\tupgrade_list.remove();\n\t\t\t\tfrappe.flags.upgrade_dismissed = 1;\n\t\t\t});\n\t\t}\n\t}\n\n\tget_cat_tags() {\n\t\treturn this.cat_tags;\n\t}\n\n\tget_stats() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.reportview.get_sidebar_stats',\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tfilters: me.default_filters || []\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.defined_category = r.message;\n\t\t\t\tif (r.message.defined_cat) {\n\t\t\t\t\tme.defined_category = r.message.defined_cat;\n\t\t\t\t\tme.cats = {};\n\t\t\t\t\t//structure the tag categories\n\t\t\t\t\tfor (var i in me.defined_category) {\n\t\t\t\t\t\tif (me.cats[me.defined_category[i].category] === undefined) {\n\t\t\t\t\t\t\tme.cats[me.defined_category[i].category] = [me.defined_category[i].tag];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.cats[me.defined_category[i].category].push(me.defined_category[i].tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.cat_tags[i] = me.defined_category[i].tag;\n\t\t\t\t\t}\n\t\t\t\t\tme.tempstats = r.message.stats;\n\n\t\t\t\t\t$.each(me.cats, function(i, v) {\n\t\t\t\t\t\tme.render_stat(i, (me.tempstats || {})[\"_user_tags\"], v);\n\t\t\t\t\t});\n\t\t\t\t\tme.render_stat(\"_user_tags\", (me.tempstats || {})[\"_user_tags\"]);\n\t\t\t\t} else {\n\t\t\t\t\t//render normal stats\n\t\t\t\t\tme.render_stat(\"_user_tags\", (r.message.stats || {})[\"_user_tags\"]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trender_stat(field, stat, tags) {\n\t\tvar me = this;\n\t\tvar sum = 0;\n\t\tvar stats = [];\n\t\tvar label = frappe.meta.docfield_map[this.doctype][field] ?\n\t\t\tfrappe.meta.docfield_map[this.doctype][field].label : field;\n\n\t\tstat = (stat || []).sort(function(a, b) {\n\t\t\treturn b[1] - a[1];\n\t\t});\n\t\t$.each(stat, function(i, v) {\n\t\t\tsum = sum + v[1];\n\t\t});\n\n\t\tif (tags) {\n\t\t\tfor (var t in tags) {\n\t\t\t\tvar nfound = -1;\n\t\t\t\tfor (var i in stat) {\n\t\t\t\t\tif (tags[t] === stat[i][0]) {\n\t\t\t\t\t\tstats.push(stat[i]);\n\t\t\t\t\t\tnfound = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nfound < 0) {\n\t\t\t\t\tstats.push([tags[t], 0]);\n\t\t\t\t} else {\n\t\t\t\t\tme.tempstats[\"_user_tags\"].splice(nfound, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfield = \"_user_tags\";\n\t\t} else {\n\t\t\tstats = stat;\n\t\t}\n\t\tvar context = {\n\t\t\tfield: field,\n\t\t\tstat: stats,\n\t\t\tsum: sum,\n\t\t\tlabel: field === '_user_tags' ? (tags ? __(label) : __(\"Tags\")) : __(label),\n\t\t};\n\t\t$(frappe.render_template(\"list_sidebar_stat\", context))\n\t\t\t.on(\"click\", \".stat-link\", function() {\n\t\t\t\tvar fieldname = $(this).attr('data-field');\n\t\t\t\tvar label = $(this).attr('data-label');\n\t\t\t\tvar condition = \"like\";\n\t\t\t\tvar existing = me.list_view.filter_area.filter_list.get_filter(fieldname);\n\t\t\t\tif(existing) {\n\t\t\t\t\texisting.remove();\n\t\t\t\t}\n\t\t\t\tif (label == \"No Tags\") {\n\t\t\t\t\tlabel = \"%,%\";\n\t\t\t\t\tcondition = \"not like\";\n\t\t\t\t}\n\t\t\t\tme.list_view.filter_area.filter_list.add_filter(me.list_view.doctype, fieldname, condition, label)\n\t\t\t\t\t.then(function() {\n\t\t\t\t\t\tme.list_view.refresh();\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.insertBefore(this.sidebar.find(\".close-sidebar-button\"));\n\t}\n\n\tset_fieldtype(df) {\n\n\t\t// scrub\n\t\tif (df.fieldname == \"docstatus\") {\n\t\t\tdf.fieldtype = \"Select\",\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: \"Draft\" },\n\t\t\t\t{ value: 1, label: \"Submitted\" },\n\t\t\t\t{ value: 2, label: \"Cancelled\" },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [{ value: 0, label: 'No' },\n\t\t\t\t{ value: 1, label: 'Yes' }\n\t\t\t];\n\t\t} else if (['Text', 'Small Text', 'Text Editor', 'Code', 'Tag', 'Comments',\n\t\t\t'Dynamic Link', 'Read Only', 'Assign'\n\t\t].indexOf(df.fieldtype) != -1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (df.fieldtype == 'Link' && this.$w.find('.condition').val() != \"=\") {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (df.fieldtype === \"Data\" && (df.options || \"\").toLowerCase() === \"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t}\n\n\treload_stats() {\n\t\tthis.sidebar.find(\".sidebar-stat\").remove();\n\t\tthis.get_stats();\n\t}\n\n\tget_divider() {\n\t\treturn $('<li role=\"separator\" class=\"divider\"></li>');\n\t}\n};\n","frappe.provide('frappe.views');\n\nfrappe.views.GanttView = class GanttView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Gantt';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = this.page_title + ' ' + __('Gantt');\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\tif(this.calendar_settings.order_by) {\n\t\t\tthis.sort_by = this.calendar_settings.order_by;\n\t\t\tthis.sort_order = 'asc';\n\t\t} else {\n\t\t\tthis.sort_by = this.view_user_settings.sort_by || this.calendar_settings.field_map.start;\n\t\t\tthis.sort_order = this.view_user_settings.sort_order || 'asc';\n\t\t}\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.prepare_tasks();\n\t}\n\n\tprepare_tasks() {\n\t\tvar me = this;\n\t\tvar meta = this.meta;\n\t\tvar field_map = this.calendar_settings.field_map;\n\n\t\tthis.tasks = this.data.map(function (item) {\n\t\t\t// set progress\n\t\t\tvar progress = 0;\n\t\t\tif (field_map.progress && $.isFunction(field_map.progress)) {\n\t\t\t\tprogress = field_map.progress(item);\n\t\t\t} else if (field_map.progress) {\n\t\t\t\tprogress = item[field_map.progress];\n\t\t\t}\n\n\t\t\t// title\n\t\t\tvar label;\n\t\t\tif (meta.title_field) {\n\t\t\t\tlabel = $.format(\"{0} ({1})\", [item[meta.title_field], item.name]);\n\t\t\t} else {\n\t\t\t\tlabel = item[field_map.title];\n\t\t\t}\n\n\t\t\tvar r = {\n\t\t\t\tstart: item[field_map.start],\n\t\t\t\tend: item[field_map.end],\n\t\t\t\tname: label,\n\t\t\t\tid: item[field_map.id || 'name'],\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tprogress: progress,\n\t\t\t\tdependencies: item.depends_on_tasks || \"\"\n\t\t\t};\n\n\t\t\tif (item.color && frappe.ui.color.validate_hex(item.color)) {\n\t\t\t\tr['custom_class'] = 'color-' + item.color.substr(1);\n\t\t\t}\n\n\t\t\tif (item.is_milestone) {\n\t\t\t\tr['custom_class'] = 'bar-milestone';\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.load_lib.then(() => {\n\t\t\tthis.render_gantt();\n\t\t});\n\t}\n\n\trender_gantt() {\n\t\tconst me = this;\n\t\tconst gantt_view_mode = this.view_user_settings.gantt_view_mode || 'Day';\n\t\tconst field_map = this.calendar_settings.field_map;\n\t\tconst date_format = 'YYYY-MM-DD';\n\n\t\tthis.$result.empty();\n\n\t\tthis.gantt = new Gantt(this.$result[0], this.tasks, {\n\t\t\tview_mode: gantt_view_mode,\n\t\t\tdate_format: \"YYYY-MM-DD\",\n\t\t\ton_click: task => {\n\t\t\t\tfrappe.set_route('Form', task.doctype, task.id);\n\t\t\t},\n\t\t\ton_date_change: (task, start, end) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t[field_map.start]: moment(start).format(date_format),\n\t\t\t\t\t[field_map.end]: moment(end).format(date_format)\n\t\t\t\t});\n\t\t\t},\n\t\t\ton_progress_change: (task, progress) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tvar progress_fieldname = 'progress';\n\n\t\t\t\tif ($.isFunction(field_map.progress)) {\n\t\t\t\t\tprogress_fieldname = null;\n\t\t\t\t} else if (field_map.progress) {\n\t\t\t\t\tprogress_fieldname = field_map.progress;\n\t\t\t\t}\n\n\t\t\t\tif (progress_fieldname) {\n\t\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t\t[progress_fieldname]: parseInt(progress)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ton_view_change: mode => {\n\t\t\t\t// save view mode\n\t\t\t\tme.save_view_user_settings({\n\t\t\t\t\tgantt_view_mode: mode\n\t\t\t\t});\n\t\t\t},\n\t\t\tcustom_popup_html: task => {\n\t\t\t\tvar item = me.get_item(task.id);\n\n\t\t\t\tvar html =\n\t\t\t\t\t`<h5>${task.name}</h5>\n\t\t\t\t\t<p>${moment(task._start).format('MMM D')} - ${moment(task._end).format('MMM D')}</p>`;\n\n\t\t\t\t// custom html in doctype settings\n\t\t\t\tvar custom = me.settings.gantt_custom_popup_html;\n\t\t\t\tif (custom && $.isFunction(custom)) {\n\t\t\t\t\tvar ganttobj = task;\n\t\t\t\t\thtml = custom(ganttobj, item);\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"details-container\">' + html + '</div>';\n\t\t\t}\n\t\t});\n\t\tthis.setup_view_mode_buttons();\n\t\tthis.set_colors();\n\t}\n\n\tsetup_view_mode_buttons() {\n\t\t// view modes (for translation) __(\"Day\"), __(\"Week\"), __(\"Month\"),\n\t\t//__(\"Half Day\"), __(\"Quarter Day\")\n\n\t\tlet $btn_group = this.$paging_area.find('.gantt-view-mode');\n\t\tif ($btn_group.length > 0) return;\n\n\t\tconst view_modes = this.gantt.options.view_modes || [];\n\t\tconst active_class = view_mode => this.gantt.view_is(view_mode) ? 'btn-info' : '';\n\t\tconst html =\n\t\t\t`<div class=\"btn-group gantt-view-mode\">\n\t\t\t\t${view_modes.map(value => `<button type=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-default btn-sm btn-view-mode ${active_class(value)}\"\n\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t${__(value)}\n\t\t\t\t\t</button>`).join('')}\n\t\t\t</div>`;\n\n\t\tthis.$paging_area.find('.level-left').append(html);\n\n\t\t// change view mode asynchronously\n\t\tconst change_view_mode = (value) => setTimeout(() => this.gantt.change_view_mode(value), 0);\n\n\t\tthis.$paging_area.on('click', '.btn-view-mode', e => {\n\t\t\tconst $btn = $(e.currentTarget);\n\t\t\tthis.$paging_area.find('.btn-view-mode').removeClass('btn-info');\n\t\t\t$btn.addClass('btn-info');\n\n\t\t\tconst value = $btn.data().value;\n\t\t\tchange_view_mode(value);\n\t\t});\n\t}\n\n\tset_colors() {\n\t\tconst classes = this.tasks\n\t\t\t.map(t => t.custom_class)\n\t\t\t.filter(c => c && c.startsWith('color-'));\n\n\t\tlet style = classes.map(c => {\n\t\t\tconst class_name = c.replace('#', '');\n\t\t\tconst bar_color = '#' + c.substr(6);\n\t\t\tconst progress_color = frappe.ui.color.get_contrast_color(bar_color);\n\t\t\treturn `\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar {\n\t\t\t\t\tfill: ${bar_color};\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar-progress {\n\t\t\t\t\tfill: ${progress_color};\n\t\t\t\t}\n\t\t\t`;\n\t\t}).join(\"\");\n\n\t\tstyle = `<style>${style}</style>`;\n\t\tthis.$result.prepend(style);\n\t}\n\n\tget_item(name) {\n\t\treturn this.data.find(item => item.name === name);\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t\"assets/frappe/js/lib/frappe-gantt/frappe-gantt.css\",\n\t\t\t\"assets/frappe/js/lib/frappe-gantt/frappe-gantt.min.js\"\n\t\t];\n\t}\n};\n\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.views.calendar\");\nfrappe.provide(\"frappe.views.calendars\");\n\nfrappe.views.CalendarView = class CalendarView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Calendar'] || {};\n\t\t\troute.push(user_settings.last_calendar_view || 'Default');\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\ttoggle_result_area() {}\n\n\tget view_name() {\n\t\treturn 'Calendar';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = __('{0} Calendar', [this.page_title]);\n\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\tthis.calendar_name = frappe.get_route()[3];\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tthis.save_view_user_settings({\n\t\t\tlast_calendar: this.calendar_name\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.calendar) {\n\t\t\tthis.calendar.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.load_lib\n\t\t\t.then(() => this.get_calendar_preferences())\n\t\t\t.then(options => {\n\t\t\t\tthis.calendar = new frappe.views.Calendar(options);\n\t\t\t});\n\t}\n\n\tget_calendar_preferences() {\n\t\tconst options = {\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.$result,\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t};\n\t\tconst calendar_name = this.calendar_name;\n\n\t\treturn new Promise(resolve => {\n\t\t\tif (calendar_name === 'Default') {\n\t\t\t\tObject.assign(options, frappe.views.calendar[this.doctype]);\n\t\t\t\tresolve(options);\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doc('Calendar View', calendar_name, () => {\n\t\t\t\t\tconst doc = frappe.get_doc('Calendar View', calendar_name);\n\t\t\t\t\tObject.assign(options, {\n\t\t\t\t\t\tfield_map: {\n\t\t\t\t\t\t\tid: \"name\",\n\t\t\t\t\t\t\tstart: doc.start_date_field,\n\t\t\t\t\t\t\tend: doc.end_date_field,\n\t\t\t\t\t\t\ttitle: doc.subject_field\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve(options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.css',\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.js',\n\t\t\t'assets/frappe/js/lib/fullcalendar/locale-all.js'\n\t\t];\n\t}\n};\n\nfrappe.views.Calendar = Class.extend({\n\tinit: function(options) {\n\t\t$.extend(this, options);\n\t\tthis.get_default_options();\n\t},\n\tget_default_options: function() {\n\t\treturn new Promise ((resolve) => {\n\t\t\tlet defaultView = localStorage.getItem('cal_defaultView');\n\t\t\tlet weekends = localStorage.getItem('cal_weekends');\n\t\t\tlet defaults = {\n\t\t\t\t'defaultView': defaultView ? defaultView : \"month\",\n\t\t\t\t'weekends': weekends ? weekends : true\n\t\t\t};\n\t\t\tresolve(defaults);\n\t\t}).then(defaults => {\n\t\t\tthis.make_page();\n\t\t\tthis.setup_options(defaults);\n\t\t\tthis.make();\n\t\t\tthis.setup_view_mode_button(defaults);\n\t\t\tthis.bind();\n\t\t});\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\n\t\t// add links to other calendars\n\t\tme.page.clear_user_actions();\n\t\t$.each(frappe.boot.calendars, function(i, doctype) {\n\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\tme.page.add_menu_item(__(doctype), function() {\n\t\t\t\t\tfrappe.set_route(\"List\", doctype, \"Calendar\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$(this.parent).on(\"show\", function() {\n\t\t\tme.$cal.fullCalendar(\"refetchEvents\");\n\t\t});\n\t},\n\n\tmake: function() {\n\t\tthis.$wrapper = this.parent;\n\t\tthis.$cal = $(\"<div>\").appendTo(this.$wrapper);\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.$wrapper,\n\t\t\t__(\"Select or drag across time slots to create a new event.\"));\n\t\tthis.footnote_area.css({\"border-top\": \"0px\"});\n\n\t\tthis.$cal.fullCalendar(this.cal_options);\n\t\tthis.set_css();\n\t},\n\tsetup_view_mode_button: function(defaults) {\n\t\tvar me = this;\n\t\t$(me.footnote_area).find('.btn-weekend').detach();\n\t\tlet btnTitle = (defaults.weekends) ? __('Hide Weekends') : __('Show Weekends');\n\t\tconst btn = `<button class=\"btn btn-default btn-xs btn-weekend\">${btnTitle}</button>`;\n\t\tme.footnote_area.append(btn);\n\t},\n\tset_localStorage_option: function(option, value) {\n\t\tlocalStorage.removeItem(option);\n\t\tlocalStorage.setItem(option, value);\n\t},\n\tbind: function() {\n\t\tconst me = this;\n\t\tlet btn_group = me.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.on(\"click\", \".btn\", function() {\n\t\t\tlet value = ($(this).hasClass('fc-agendaWeek-button')) ? 'agendaWeek' : (($(this).hasClass('fc-agendaDay-button')) ? 'agendaDay' : 'month');\n\t\t\tme.set_localStorage_option(\"cal_defaultView\", value);\n\t\t});\n\n\t\tme.$wrapper.on(\"click\", \".btn-weekend\", function() {\n\t\t\tme.cal_options.weekends = !me.cal_options.weekends;\n\t\t\tme.$cal.fullCalendar('option', 'weekends', me.cal_options.weekends);\n\t\t\tme.set_localStorage_option(\"cal_weekends\", me.cal_options.weekends);\n\t\t\tme.set_css();\n\t\t\tme.setup_view_mode_button(me.cal_options);\n\t\t});\n\t},\n\tset_css: function() {\n\t\t// flatify buttons\n\t\tthis.$wrapper.find(\"button.fc-state-default\")\n\t\t\t.removeClass(\"fc-state-default\")\n\t\t\t.addClass(\"btn btn-default\");\n\n\t\tthis.$wrapper.find(\".fc-button-group\").addClass(\"btn-group\");\n\n\t\tthis.$wrapper.find('.fc-prev-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-left');\n\t\tthis.$wrapper.find('.fc-next-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-right');\n\n\t\tvar btn_group = this.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.find(\".fc-state-active\").addClass(\"active\");\n\n\t\tbtn_group.find(\".btn\").on(\"click\", function() {\n\t\t\tbtn_group.find(\".btn\").removeClass(\"active\");\n\t\t\t$(this).addClass(\"active\");\n\t\t});\n\t},\n\tfield_map: {\n\t\t\"id\": \"name\",\n\t\t\"start\": \"start\",\n\t\t\"end\": \"end\",\n\t\t\"allDay\": \"all_day\",\n\t},\n\tcolor_map: {\n\t\t\"danger\": \"red\",\n\t\t\"success\": \"green\",\n\t\t\"warning\": \"orange\",\n\t\t\"default\": \"blue\"\n\t},\n\tget_system_datetime: function(date) {\n\t\tdate._offset = (moment(date).tz(frappe.sys_defaults.time_zone)._offset);\n\t\treturn frappe.datetime.convert_to_system_tz(date);\n\t},\n\tsetup_options: function(defaults) {\n\t\tvar me = this;\n\t\tthis.cal_options = {\n\t\t\tlocale: frappe.boot.user.language || \"en\",\n\t\t\theader: {\n\t\t\t\tleft: 'title',\n\t\t\t\tcenter: '',\n\t\t\t\tright: 'prev,today,next month,agendaWeek,agendaDay'\n\t\t\t},\n\t\t\teditable: true,\n\t\t\tselectable: true,\n\t\t\tselectHelper: true,\n\t\t\tforceEventDuration: true,\n\t\t\tdefaultView: defaults.defaultView,\n\t\t\tweekends: defaults.weekends,\n\t\t\tnowIndicator: true,\n\t\t\tevents: function(start, end, timezone, callback) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: me.get_events_method || \"frappe.desk.calendar.get_events\",\n\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\targs: me.get_args(start, end),\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tvar events = r.message || [];\n\t\t\t\t\t\tevents = me.prepare_events(events);\n\t\t\t\t\t\tcallback(events);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\teventRender: function(event, element) {\n\t\t\t\telement.attr('title', event.tooltip);\n\t\t\t},\n\t\t\teventClick: function(event) {\n\t\t\t\t// edit event description or delete\n\t\t\t\tvar doctype = event.doctype || me.doctype;\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\tfrappe.set_route(\"Form\", doctype, event.name);\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\teventResize: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\tselect: function(startDate, endDate, jsEvent, view) {\n\t\t\t\tif (view.name===\"month\" && (endDate - startDate)===86400000) {\n\t\t\t\t\t// detect single day click in month view\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar event = frappe.model.get_new_doc(me.doctype);\n\n\t\t\t\tevent[me.field_map.start] = me.get_system_datetime(startDate);\n\n\t\t\t\tif(me.field_map.end)\n\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(endDate);\n\n\t\t\t\tif(me.field_map.allDay) {\n\t\t\t\t\tvar all_day = (startDate._ambigTime && endDate._ambigTime) ? 1 : 0;\n\n\t\t\t\t\tevent[me.field_map.allDay] = all_day;\n\n\t\t\t\t\tif (all_day)\n\t\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(moment(endDate).subtract(1, \"s\"));\n\t\t\t\t}\n\n\t\t\t\tfrappe.set_route(\"Form\", me.doctype, event.name);\n\t\t\t},\n\t\t\tdayClick: function(date, jsEvent, view) {\n\t\t\t\tif(view.name === 'month') {\n\t\t\t\t\tconst $date_cell = $('td[data-date=' + date.format('YYYY-MM-DD') + \"]\");\n\n\t\t\t\t\tif($date_cell.hasClass('date-clicked')) {\n\t\t\t\t\t\tme.$cal.fullCalendar('changeView', 'agendaDay');\n\t\t\t\t\t\tme.$cal.fullCalendar('gotoDate', date);\n\t\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\n\t\t\t\t\t\t// update \"active view\" btn\n\t\t\t\t\t\tme.$wrapper.find('.fc-month-button').removeClass('active');\n\t\t\t\t\t\tme.$wrapper.find('.fc-agendaDay-button').addClass('active');\n\t\t\t\t\t}\n\n\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\t\t\t\t\t$date_cell.addClass('date-clicked');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tif(this.options) {\n\t\t\t$.extend(this.cal_options, this.options);\n\t\t}\n\t},\n\tget_args: function(start, end) {\n\t\tvar args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tstart: this.get_system_datetime(start),\n\t\t\tend: this.get_system_datetime(end),\n\t\t\tfilters: this.list_view.filter_area.get(),\n\t\t\tfield_map: this.field_map\n\t\t};\n\t\treturn args;\n\t},\n\trefresh: function() {\n\t\tthis.$cal.fullCalendar('refetchEvents');\n\t},\n\tprepare_events: function(events) {\n\t\tvar me = this;\n\n\t\treturn (events || []).map(d => {\n\t\t\td.id = d.name;\n\t\t\td.editable = frappe.model.can_write(d.doctype || me.doctype);\n\n\t\t\t// do not allow submitted/cancelled events to be moved / extended\n\t\t\tif(d.docstatus && d.docstatus > 0) {\n\t\t\t\td.editable = false;\n\t\t\t}\n\n\t\t\t$.each(me.field_map, function(target, source) {\n\t\t\t\td[target] = d[source];\n\t\t\t});\n\n\t\t\tif(!me.field_map.allDay)\n\t\t\t\td.allDay = 1;\n\n\t\t\t// convert to user tz\n\t\t\td.start = frappe.datetime.convert_to_user_tz(d.start);\n\t\t\td.end = frappe.datetime.convert_to_user_tz(d.end);\n\n\t\t\t// show event on single day if start or end date is invalid\n\t\t\tif (!frappe.datetime.validate(d.start) && d.end) {\n\t\t\t\td.start = frappe.datetime.add_days(d.end, -1);\n\t\t\t}\n\n\t\t\tif (d.start && !frappe.datetime.validate(d.end)) {\n\t\t\t\td.end = frappe.datetime.add_days(d.start, 1);\n\t\t\t}\n\n\t\t\tme.fix_end_date_for_event_render(d);\n\t\t\tme.prepare_colors(d);\n\t\t\treturn d;\n\t\t});\n\t},\n\tprepare_colors: function(d) {\n\t\tlet color, color_name;\n\t\tif(this.get_css_class) {\n\t\t\tcolor_name = this.color_map[this.get_css_class(d)];\n\t\t\tcolor_name = frappe.ui.color.validate_hex(color_name) ?\n\t\t\t\tcolor_name : 'blue';\n\t\t\td.backgroundColor = frappe.ui.color.get(color_name, 'extra-light');\n\t\t\td.textColor = frappe.ui.color.get(color_name, 'dark');\n\t\t} else {\n\t\t\tcolor = d.color;\n\t\t\tif (!frappe.ui.color.validate_hex(color) || !color) {\n\t\t\t\tcolor = frappe.ui.color.get('blue', 'extra-light');\n\t\t\t}\n\t\t\td.backgroundColor = color;\n\t\t\td.textColor = frappe.ui.color.get_contrast_color(color);\n\t\t}\n\t\treturn d;\n\t},\n\tupdate_event: function(event, revertFunc) {\n\t\tvar me = this;\n\t\tfrappe.model.remove_from_locals(me.doctype, event.name);\n\t\treturn frappe.call({\n\t\t\tmethod: me.update_event_method || \"frappe.desk.calendar.update_event\",\n\t\t\targs: me.get_update_args(event),\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tfrappe.show_alert(__(\"Unable to update event\"));\n\t\t\t\t\trevertFunc();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function() {\n\t\t\t\trevertFunc();\n\t\t\t}\n\t\t});\n\t},\n\tget_update_args: function(event) {\n\t\tvar me = this;\n\t\tvar args = {\n\t\t\tname: event[this.field_map.id]\n\t\t};\n\n\t\targs[this.field_map.start] = me.get_system_datetime(event.start);\n\n\t\tif(this.field_map.allDay)\n\t\t\targs[this.field_map.allDay] = (event.start._ambigTime && event.end._ambigTime) ? 1 : 0;\n\n\t\tif(this.field_map.end) {\n\t\t\tif (!event.end) {\n\t\t\t\tevent.end = event.start.add(1, \"hour\");\n\t\t\t}\n\n\t\t\targs[this.field_map.end] = me.get_system_datetime(event.end);\n\n\t\t\tif (args[this.field_map.allDay]) {\n\t\t\t\targs[this.field_map.end] = me.get_system_datetime(moment(event.end).subtract(1, \"s\"));\n\t\t\t}\n\t\t}\n\n\t\targs.doctype = event.doctype || this.doctype;\n\n\t\treturn { args: args, field_map: this.field_map };\n\t},\n\n\tfix_end_date_for_event_render: function(event) {\n\t\tif (event.allDay) {\n\t\t\t// We use inclusive end dates. This workaround fixes the rendering of events\n\t\t\tevent.start = event.start ? $.fullCalendar.moment(event.start).stripTime() : null;\n\t\t\tevent.end = event.end ? $.fullCalendar.moment(event.end).add(1, \"day\").stripTime() : null;\n\t\t}\n\t}\n});\n","/**\n * frappe.views.ImageView\n */\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ImageView = class ImageView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Image';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.page_title = this.page_title + ' ' + __('Images');\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = [\n\t\t\t'name',\n\t\t\tthis.meta.title_field,\n\t\t\tthis.meta.image_field\n\t\t];\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.items = this.data.map(d => {\n\t\t\t// absolute url if cordova, else relative\n\t\t\td._image_url = this.get_image_url(d);\n\t\t\treturn d;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.get_attached_images()\n\t\t\t.then(() => {\n\t\t\t\tthis.render_image_view();\n\n\t\t\t\tif (!this.gallery) {\n\t\t\t\t\tthis.setup_gallery();\n\t\t\t\t} else {\n\t\t\t\t\tthis.gallery.prepare_pswp_items(this.items, this.images_map);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\trender_image_view() {\n\t\tvar html = this.items.map(this.item_html.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t<div class=\"image-view-container small\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\titem_html(item) {\n\t\titem._name = encodeURI(item.name);\n\t\tconst encoded_name = item._name;\n\t\tconst title = strip_html(item[this.meta.title_field || 'name']);\n\t\tconst _class = !item._image_url ? 'no-image' : '';\n\t\tconst _html = item._image_url ?\n\t\t\t`<img data-name=\"${encoded_name}\" src=\"${ item._image_url }\" alt=\"${ title }\">` :\n\t\t\t`<span class=\"placeholder-text\">\n\t\t\t\t${ frappe.get_abbr(title) }\n\t\t\t</span>`;\n\n\t\treturn `\n\t\t\t<div class=\"image-view-item\">\n\t\t\t\t<div class=\"image-view-header\">\n\t\t\t\t\t<div class=\"list-row-col list-subject ellipsis level\">\n\t\t\t\t\t\t${this.get_subject_html(item)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-body\">\n\t\t\t\t\t<a  data-name=\"${encoded_name}\"\n\t\t\t\t\t\ttitle=\"${encoded_name}\"\n\t\t\t\t\t\thref=\"${this.get_form_link(item)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"image-field ${_class}\"\n\t\t\t\t\t\t\tdata-name=\"${encoded_name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${_html}\n\t\t\t\t\t\t\t<button class=\"btn btn-default zoom-view\" data-name=\"${encoded_name}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-search-plus\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_image_url(data) {\n\t\tvar url;\n\t\turl = data.image ? data.image : data[this.meta.image_field];\n\n\t\t// absolute url for mobile\n\t\tif (window.cordova && !frappe.utils.is_url(url)) {\n\t\t\turl = frappe.base_url + url;\n\t\t}\n\t\tif (url) {\n\t\t\treturn url;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget_attached_images() {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.core.doctype.file.file.get_attached_images',\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tnames: this.items.map(i => i.name)\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tthis.images_map = Object.assign(this.images_map || {}, r.message);\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level \">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"Likes\"></i>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"level-item\"></span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tsetup_gallery() {\n\t\tvar me = this;\n\t\tthis.gallery = new frappe.views.GalleryView({\n\t\t\tdoctype: this.doctype,\n\t\t\titems: this.items,\n\t\t\twrapper: this.$result,\n\t\t\timages_map: this.images_map\n\t\t});\n\t\tthis.$result.on('click', '.btn.zoom-view', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar name = $(this).data().name;\n\t\t\tname = decodeURIComponent(name);\n\t\t\tme.gallery.show(name);\n\t\t\treturn false;\n\t\t});\n\t}\n};\n\nfrappe.views.GalleryView = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tvar me = this;\n\n\t\tthis.lib_ready = this.load_lib();\n\t\tthis.lib_ready.then(function () {\n\t\t\tme.prepare();\n\t\t});\n\t},\n\tprepare: function () {\n\t\t// keep only one pswp dom element\n\t\tthis.pswp_root = $('body > .pswp');\n\t\tif (this.pswp_root.length === 0) {\n\t\t\tvar pswp = frappe.render_template('photoswipe_dom');\n\t\t\tthis.pswp_root = $(pswp).appendTo('body');\n\t\t}\n\t},\n\tprepare_pswp_items: function (_items, _images_map) {\n\t\tvar me = this;\n\n\t\tif (_items) {\n\t\t\t// passed when more button clicked\n\t\t\tthis.items = this.items.concat(_items);\n\t\t\tthis.images_map = _images_map;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst items = this.items.map(function (i) {\n\t\t\t\tconst query = 'img[data-name=\"' + i._name + '\"]';\n\t\t\t\tlet el = me.wrapper.find(query).get(0);\n\n\t\t\t\tlet width, height;\n\t\t\t\tif (el) {\n\t\t\t\t\twidth = el.naturalWidth;\n\t\t\t\t\theight = el.naturalHeight;\n\t\t\t\t}\n\n\t\t\t\tif (!el) {\n\t\t\t\t\tel = me.wrapper.find('.image-field[data-name=\"' + i._name + '\"]').get(0);\n\t\t\t\t\twidth = el.getBoundingClientRect().width;\n\t\t\t\t\theight = el.getBoundingClientRect().height;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsrc: i._image_url,\n\t\t\t\t\tmsrc: i._image_url,\n\t\t\t\t\tname: i.name,\n\t\t\t\t\tw: width,\n\t\t\t\t\th: height,\n\t\t\t\t\tel: el\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.pswp_items = items;\n\t\t\tresolve();\n\t\t});\n\t},\n\tshow: function (docname) {\n\t\tthis.lib_ready\n\t\t\t.then(() => this.prepare_pswp_items())\n\t\t\t.then(() => this._show(docname));\n\t},\n\t_show: function (docname) {\n\t\tconst me = this;\n\t\tconst items = this.pswp_items;\n\t\tconst item_index = items.findIndex(item => item.name === docname);\n\n\t\tvar options = {\n\t\t\tindex: item_index,\n\t\t\tgetThumbBoundsFn: function (index) {\n\t\t\t\tconst query = 'img[data-name=\"' + items[index]._name + '\"]';\n\t\t\t\tlet thumbnail = me.wrapper.find(query).get(0);\n\n\t\t\t\tif (!thumbnail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n\t\t\t\t\trect = thumbnail.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: rect.left,\n\t\t\t\t\ty: rect.top + pageYScroll,\n\t\t\t\t\tw: rect.width\n\t\t\t\t};\n\t\t\t},\n\t\t\thistory: false,\n\t\t\tshareEl: false,\n\t\t\tshowHideOpacity: true\n\t\t};\n\n\t\t// init\n\t\tthis.pswp = new PhotoSwipe(\n\t\t\tthis.pswp_root.get(0),\n\t\t\tPhotoSwipeUI_Default,\n\t\t\titems,\n\t\t\toptions\n\t\t);\n\t\tthis.browse_images();\n\t\tthis.pswp.init();\n\t},\n\tbrowse_images: function () {\n\t\tconst $more_items = this.pswp_root.find('.pswp__more-items');\n\t\tconst images_map = this.images_map;\n\t\tlet last_hide_timeout = null;\n\n\t\tthis.pswp.listen('afterChange', function () {\n\t\t\tconst images = images_map[this.currItem.name];\n\t\t\tif (!images || images.length === 1) {\n\t\t\t\t$more_items.html('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide_more_items_after_2s();\n\t\t\tconst html = images.map(img_html).join(\"\");\n\t\t\t$more_items.html(html);\n\t\t});\n\n\t\tthis.pswp.listen('beforeChange', hide_more_items);\n\t\tthis.pswp.listen('initialZoomOut', hide_more_items);\n\t\tthis.pswp.listen('destroy', () => {\n\t\t\t$(document).off('mousemove', hide_more_items_after_2s);\n\t\t});\n\n\t\t// Replace current image on click\n\t\t$more_items.on('click', '.pswp__more-item', (e) => {\n\t\t\tconst img_el = e.target;\n\t\t\tconst index = this.pswp.items.findIndex(i => i.name === this.pswp.currItem.name);\n\n\t\t\tthis.pswp.goTo(index);\n\t\t\tthis.pswp.items.splice(index, 1, {\n\t\t\t\tsrc: img_el.src,\n\t\t\t\tw: img_el.naturalWidth,\n\t\t\t\th: img_el.naturalHeight,\n\t\t\t\tname: this.pswp.currItem.name\n\t\t\t});\n\t\t\tthis.pswp.invalidateCurrItems();\n\t\t\tthis.pswp.updateSize(true);\n\t\t});\n\n\t\t// hide more-images 2s after mousemove\n\t\t$(document).on('mousemove', hide_more_items_after_2s);\n\n\t\tfunction hide_more_items_after_2s() {\n\t\t\tclearTimeout(last_hide_timeout);\n\t\t\tshow_more_items();\n\t\t\tlast_hide_timeout = setTimeout(hide_more_items, 2000);\n\t\t}\n\n\t\tfunction show_more_items() {\n\t\t\t$more_items.show();\n\t\t}\n\n\t\tfunction hide_more_items() {\n\t\t\t$more_items.hide();\n\t\t}\n\n\t\tfunction img_html(src) {\n\t\t\treturn `<div class=\"pswp__more-item\">\n\t\t\t\t<img src=\"${src}\">\n\t\t\t</div>`;\n\t\t}\n\t},\n\tload_lib: function () {\n\t\treturn new Promise(resolve => {\n\t\t\tvar asset_dir = 'assets/frappe/js/lib/photoswipe/';\n\t\t\tfrappe.require([\n\t\t\t\tasset_dir + 'photoswipe.css',\n\t\t\t\tasset_dir + 'default-skin.css',\n\t\t\t\tasset_dir + 'photoswipe.js',\n\t\t\t\tasset_dir + 'photoswipe-ui-default.js'\n\t\t\t], resolve);\n\t\t});\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.KanbanView = class KanbanView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Kanban'] || {};\n\t\t\tif (!user_settings.last_kanban_board) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('Missing parameter Kanban Board Name')\n\t\t\t\t});\n\t\t\t\tfrappe.set_route('List', doctype, 'List');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\troute.push(user_settings.last_kanban_board);\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget view_name() {\n\t\treturn 'Kanban';\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.board_name = frappe.get_route()[3];\n\t\tthis.page_title = this.board_name;\n\t\tthis.card_meta = this.get_card_meta();\n\n\t\tthis.menu_items.push({\n\t\t\tlabel: __('Save filters'),\n\t\t\taction: () => {\n\t\t\t\tthis.save_kanban_board_filters();\n\t\t\t}\n\t\t});\n\n\t\treturn this.get_board();\n\t}\n\n\tget_board() {\n\t\treturn frappe.db.get_doc('Kanban Board', this.board_name)\n\t\t\t.then(board => {\n\t\t\t\tthis.board = board;\n\t\t\t\tthis.board.filters_array = JSON.parse(this.board.filters || '[]');\n\t\t\t\tthis.filters = this.board.filters_array;\n\t\t\t});\n\t}\n\n\tbefore_refresh() {\n\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tset_fields() {\n\t\tsuper.set_fields();\n\t\tthis._add_field(this.card_meta.title_field);\n\t}\n\n\tbefore_render() {\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_kanban_board: this.board_name\n\t\t});\n\t}\n\n\ton_filter_change() {\n\t\tif (JSON.stringify(this.board.filters_array) !== JSON.stringify(this.filter_area.get())) {\n\t\t\tthis.page.set_indicator(__('Not Saved'), 'orange');\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\n\tsave_kanban_board_filters() {\n\t\tconst filters = this.filter_area.get();\n\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.save_filters',\n\t\t\targs: {\n\t\t\t\tboard_name: this.board_name,\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tif (r.exc) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('There was an error saving filters')\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'green',\n\t\t\t\tmessage: __('Filters saved')\n\t\t\t});\n\n\t\t\tthis.board.filters_array = filters;\n\t\t\tthis.on_filter_change();\n\t\t});\n\t}\n\n\trender() {\n\t\tconst board_name = this.board_name;\n\t\tif (this.kanban && board_name === this.kanban.board_name) {\n\t\t\tthis.kanban.update(this.data);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kanban = new frappe.views.KanbanBoard({\n\t\t\tdoctype: this.doctype,\n\t\t\tboard: this.board,\n\t\t\tboard_name: board_name,\n\t\t\tcards: this.data,\n\t\t\tcard_meta: this.card_meta,\n\t\t\twrapper: this.$result,\n\t\t\tcur_list: this,\n\t\t\tuser_settings: this.view_user_settings\n\t\t});\n\t}\n\n\tget_card_meta() {\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar doc = frappe.model.get_new_doc(this.doctype);\n\t\tvar title_field = null;\n\t\tvar quick_entry = false;\n\n\t\tif (this.meta.title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, this.meta.title_field);\n\t\t}\n\n\t\tthis.meta.fields.forEach((df) => {\n\t\t\tconst is_valid_field =\n\t\t\t\tin_list(['Data', 'Text', 'Small Text', 'Text Editor'], df.fieldtype)\n\t\t\t\t&& !df.hidden;\n\n\t\t\tif (is_valid_field && !title_field) {\n\t\t\t\t// can be mapped to textarea\n\t\t\t\ttitle_field = df;\n\t\t\t}\n\t\t});\n\n\t\t// quick entry\n\t\tvar mandatory = meta.fields.filter((df) => df.reqd && !doc[df.fieldname]);\n\n\t\tif (mandatory.some(df => df.fieldtype === 'Table') || mandatory.length > 1) {\n\t\t\tquick_entry = true;\n\t\t}\n\n\t\tif (!title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, 'name');\n\t\t}\n\n\t\treturn {\n\t\t\tquick_entry: quick_entry,\n\t\t\ttitle_field: title_field\n\t\t};\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fluxify.min.js',\n\t\t\t'assets/frappe/js/frappe/views/kanban/kanban_board.js'\n\t\t];\n\t}\n};\n\n\nfrappe.views.KanbanView.setup_dropdown_in_sidebar = function(doctype, $dropdown) {\n\t// get kanban boards and append to dropdown\n\tget_kanban_boards()\n\t\t.then((kanban_boards) => {\n\t\t\tif (!kanban_boards) return;\n\n\t\t\t$('<li role=\"separator\" class=\"divider\"></li>').appendTo($dropdown);\n\n\t\t\tkanban_boards.forEach(board => {\n\t\t\t\tconst route = ['List', board.reference_doctype, 'Kanban', board.name].join('/');\n\n\t\t\t\t$(`<li>\n\t\t\t\t\t<a href=\"#${route}\">\n\t\t\t\t\t\t<span>${__(board.name)}</span>\n\t\t\t\t\t${board.private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t\t`).appendTo($dropdown);\n\t\t\t});\n\t\t});\n\n\t$dropdown.on('click', '.new-kanban-board', () => {\n\t\tconst dialog = new_kanban_dialog();\n\t\tdialog.show();\n\t});\n\n\tfunction make_kanban_board(board_name, field_name, project) {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board',\n\t\t\targs: {\n\t\t\t\tdoctype,\n\t\t\t\tboard_name,\n\t\t\t\tfield_name,\n\t\t\t\tproject\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar kb = r.message;\n\t\t\t\tif (kb.filters) {\n\t\t\t\t\tfrappe.provide('frappe.kanban_filters');\n\t\t\t\t\tfrappe.kanban_filters[kb.kanban_board_name] = kb.filters;\n\t\t\t\t}\n\t\t\t\tfrappe.set_route('List', doctype, 'Kanban', kb.kanban_board_name);\n\t\t\t}\n\t\t});\n\t}\n\n\tlet dialog = null;\n\n\tfunction new_kanban_dialog() {\n\t\tif (dialog) return dialog;\n\n\t\tconst fields = get_fields_for_dialog();\n\n\t\tlet primary_action_label = fields.length > 1 ? __('Save') : '';\n\t\tlet primary_action = fields.length > 1 ?\n\t\t\t({ board_name, field_name, project }) => {\n\t\t\t\tmake_kanban_board(board_name, field_name, project)\n\t\t\t\t\t.then(() => dialog.hide(), (err) => frappe.msgprint(err));\n\t\t\t} : null;\n\n\t\tdialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('New Kanban Board'),\n\t\t\tfields,\n\t\t\tprimary_action_label,\n\t\t\tprimary_action\n\t\t});\n\t\treturn dialog;\n\t}\n\n\tfunction get_fields_for_dialog() {\n\n\t\tlet fields = [{\n\t\t\tfieldtype: 'Data',\n\t\t\tfieldname: 'board_name',\n\t\t\tlabel: __('Kanban Board Name'),\n\t\t\treqd: 1,\n\t\t\tdescription: ['Note', 'ToDo'].includes(doctype) ?\n\t\t\t\t__('This Kanban Board will be private') : ''\n\t\t}];\n\n\t\tif (doctype === 'Task') {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tfieldname: 'project',\n\t\t\t\tlabel: __('Project'),\n\t\t\t\toptions: 'Project'\n\t\t\t});\n\t\t}\n\n\t\tconst select_fields =\n\t\t\tfrappe.get_meta(doctype).fields\n\t\t\t\t.filter(df => {\n\t\t\t\t\treturn df.fieldtype === 'Select' &&\n\t\t\t\t\t\tdf.fieldname !== 'kanban_column';\n\t\t\t\t});\n\n\t\tif (select_fields.length > 0) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'field_name',\n\t\t\t\tlabel: __('Columns based on'),\n\t\t\t\toptions: select_fields.map(df => ({label: df.label, value: df.fieldname})),\n\t\t\t\tdefault: select_fields[0],\n\t\t\t\treqd: 1,\n\t\t\t});\n\t\t} else {\n\t\t\tfields = [{\n\t\t\t\tfieldtype: 'HTML',\n\t\t\t\toptions: `\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"text-medium\">\n\t\t\t\t\t\t${__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type \"Select\".')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" href=\"#Form/Customize Form?doc_type=${doctype}\">\n\t\t\t\t\t\t\t${__('Customize Form')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t}];\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tfunction get_kanban_boards() {\n\t\treturn frappe.call('frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards', { doctype })\n\t\t\t.then(r => r.message);\n\t}\n};\n","/**\n * frappe.views.InboxView\n */\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.InboxView = class InboxView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (!route[3] && frappe.boot.email_accounts.length) {\n\t\t\tlet email_account;\n\t\t\tif (frappe.boot.email_accounts[0].email_id == \"All Accounts\") {\n\t\t\t\temail_account = \"All Accounts\";\n\t\t\t} else {\n\t\t\t\temail_account = frappe.boot.email_accounts[0].email_account;\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\", \"Inbox\", email_account);\n\t\t\treturn true;\n\t\t} else if (!route[3] || (route[3] !== \"All Accounts\" && !is_valid(route[3]))) {\n\t\t\tfrappe.msgprint(__('Invalid Email Account'));\n\t\t\twindow.history.back();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\n\t\tfunction is_valid(email_account) {\n\t\t\treturn frappe.boot.email_accounts.find(d => d.email_account === email_account);\n\t\t}\n\t}\n\n\tget view_name() {\n\t\treturn 'Inbox';\n\t}\n\n\tshow() {\n\t\tsuper.show();\n\t\t// save email account in user_settings\n\t\tthis.save_view_user_settings({\n\t\t\tlast_email_account: this.current_email_account\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\t\tthis.email_account = frappe.get_route()[3];\n\t\tthis.page_title = this.email_account;\n\t\tthis.filters = this.get_inbox_filters();\n\t}\n\n\tget is_sent_emails() {\n\t\tconst f = this.filter_area.get()\n\t\t\t.find(filter => filter[1] === 'sent_or_received');\n\t\treturn f && f[3] === 'Sent';\n\t}\n\n\trender() {\n\t\tthis.emails = this.data;\n\t\tthis.render_inbox_view();\n\t}\n\n\trender_inbox_view() {\n\t\tlet html = this.emails.map(this.render_email_row.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t${html}\n\t\t`);\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item\">${__('Subject')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col hidden-xs\">\n\t\t\t\t<span>${this.is_sent_emails ? __(\"To\") : __(\"From\")}</span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\trender_email_row(email) {\n\t\tif (!email.css_seen && email.seen)\n\t\t\temail.css_seen = \"seen\";\n\n\t\tconst columns_html = `\n\t\t\t<div class=\"list-row-col list-subject level ellipsis\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${email.name}\">\n\t\t\t\t<span class=\"level-item\">\n\t\t\t\t\t<a class=\"${ email.seen ? '' : 'bold'} ellipsis\" href=\"${this.get_form_link(email)}\">\n\t\t\t\t\t\t${email.subject}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col hidden-xs\">\n\t\t\t\t<span>${this.is_sent_emails ? email.recipients : email.sender }</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_list_row_html_skeleton(columns_html, this.get_meta_html(email));\n\t}\n\n\tget_meta_html(email) {\n\t\tconst attachment = email.has_attachment ?\n\t\t\t`<span class=\"fa fa-paperclip fa-large\" title=\"${__('Has Attachments')}\"></span>` : '';\n\n\t\tconst form_link = frappe.utils.get_form_link(email.reference_doctype, email.reference_name);\n\t\tconst link = email.reference_doctype && email.reference_doctype !== this.doctype ?\n\t\t\t`<a class=\"text-muted grey\" href=\"${form_link}\"\n\t\t\t\ttitle=\"${__('Linked with {0}', [email.reference_doctype])}\">\n\t\t\t\t<i class=\"fa fa-link fa-large\"></i>\n\t\t\t</a>` : '';\n\n\t\tconst modified = comment_when(email.modified, true);\n\n\t\treturn `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${link}\n\t\t\t\t${attachment}\n\t\t\t\t${modified}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_inbox_filters() {\n\t\tvar email_account = this.email_account;\n\t\tvar default_filters = [\n\t\t\t[\"Communication\", \"communication_type\", \"=\", \"Communication\", true],\n\t\t\t[\"Communication\", \"communication_medium\", \"=\", \"Email\", true],\n\t\t];\n\t\tvar filters = [];\n\t\tif (email_account === \"Sent\") {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Sent\", true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t} else if (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"email_status\", \"=\", email_account, true],\n\t\t\t\t[\"Communication\", \"email_account\", \"in\", frappe.boot.all_accounts, true]\n\t\t\t]);\n\t\t} else {\n\t\t\tvar op = \"=\";\n\t\t\tif (email_account == \"All Accounts\") {\n\t\t\t\top = \"in\";\n\t\t\t\temail_account = frappe.boot.all_accounts;\n\t\t\t}\n\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Received\", true],\n\t\t\t\t[\"Communication\", \"email_account\", op, email_account, true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tget_no_result_message() {\n\t\tvar email_account = this.email_account;\n\t\tvar args;\n\t\tif (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\treturn __(\"No {0} mail\", [email_account]);\n\t\t} else if (!email_account && !frappe.boot.email_accounts.length) {\n\t\t\t// email account is not configured\n\t\t\targs = {\n\t\t\t\tdoctype: \"Email Account\",\n\t\t\t\tmsg: __(\"No Email Account\"),\n\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t};\n\t\t} else {\n\t\t\t// no sent mail\n\t\t\targs = {\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tmsg: __(\"No Emails\"),\n\t\t\t\tlabel: __(\"Compose Email\")\n\t\t\t};\n\t\t}\n\n\t\tconst html = frappe.model.can_create(args.doctype) ?\n\t\t\t`<p>${args.msg}</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t\t${args.label}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t` :\n\t\t\t`<p>${ __(\"No Email Accounts Assigned\") }</p>`;\n\n\t\treturn `\n\t\t\t<div class=\"msg-box no-border\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tif (!this.email_account && !frappe.boot.email_accounts.length) {\n\t\t\tfrappe.route_options = {\n\t\t\t\t'email_id': frappe.session.user_email\n\t\t\t};\n\t\t\tfrappe.new_doc('Email Account');\n\t\t} else {\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: {}\n\t\t\t});\n\t\t}\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.treeview_settings\");\nfrappe.provide('frappe.views.trees');\nwindow.cur_tree = null;\n\nfrappe.views.TreeFactory = class TreeFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tfrappe.model.with_doctype(route[1], function() {\n\t\t\tvar options = {\n\t\t\t\tdoctype: route[1],\n\t\t\t\tmeta: frappe.get_meta(route[1])\n\t\t\t};\n\n\t\t\tif (!frappe.treeview_settings[route[1]] && !frappe.meta.get_docfield(route[1], \"is_group\")) {\n\t\t\t\tfrappe.msgprint(__(\"Tree view not available for {0}\", [route[1]] ));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$.extend(options, frappe.treeview_settings[route[1]] || {});\n\t\t\tfrappe.views.trees[options.doctype] = new frappe.views.TreeView(options);\n\t\t});\n\t}\n}\n\nfrappe.views.TreeView = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\tthis.opts = {};\n\t\tthis.opts.get_tree_root = true;\n\t\tthis.opts.show_expand_all = true;\n\t\t$.extend(this.opts, opts);\n\t\tthis.doctype = opts.doctype;\n\t\tthis.args = {doctype: me.doctype};\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.get_tree_nodes =  me.opts.get_tree_nodes || \"frappe.desk.treeview.get_children\";\n\n\t\tthis.get_permissions();\n\t\tthis.make_page();\n\t\tthis.make_filters();\n\n\t\tif (me.opts.get_tree_root) {\n\t\t\tthis.get_root();\n\t\t}\n\n\t\tthis.onload();\n\t\tthis.set_menu_item();\n\t\tthis.set_primary_action();\n\t},\n\tget_permissions: function(){\n\t\tthis.can_read = frappe.model.can_read(this.doctype);\n\t\tthis.can_create = frappe.boot.user.can_create.indexOf(this.doctype) !== -1 ||\n\t\t\t\t\tfrappe.boot.user.in_create.indexOf(this.doctype) !== -1;\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\t\tthis.can_delete = frappe.model.can_delete(this.doctype);\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\t\tthis.parent = frappe.container.add_page(this.page_name);\n\t\tfrappe.ui.make_app_page({parent:this.parent, single_column:true});\n\n\t\tthis.page = this.parent.page;\n\t\tfrappe.container.change_to(this.page_name);\n\t\tfrappe.breadcrumbs.add(me.opts.breadcrumb || locals.DocType[me.doctype].module);\n\n\t\tthis.set_title();\n\n\t\tthis.page.main.css({\n\t\t\t\"min-height\": \"300px\",\n\t\t\t\"padding-bottom\": \"25px\"\n\t\t});\n\n\t\tif(this.opts.show_expand_all) {\n\t\t\tthis.page.add_inner_button(__('Expand All'), function() {\n\t\t\t\tme.tree.load_children(me.tree.root_node, true);\n\t\t\t});\n\t\t}\n\n\t\tif(this.opts.view_template) {\n\t\t\tvar row = $('<div class=\"row\"><div>').appendTo(this.page.main);\n\t\t\tthis.body = $('<div class=\"col-sm-6 col-xs-12\"></div>').appendTo(row);\n\t\t\tthis.node_view = $('<div class=\"col-sm-6 hidden-xs\"></div>').appendTo(row);\n\t\t} else {\n\t\t\tthis.body = this.page.main;\n\t\t}\n\t},\n\tset_title: function() {\n\t\tthis.page.set_title(this.opts.title || __('{0} Tree', [__(this.doctype)]));\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\t\tthis.opts.onload && this.opts.onload(me);\n\t},\n\tmake_filters: function(){\n\t\tvar me = this;\n\t\tfrappe.treeview_settings.filters = []\n\t\t$.each(this.opts.filters || [], function(i, filter) {\n\t\t\tif(frappe.route_options && frappe.route_options[filter.fieldname]) {\n\t\t\t\tfilter.default = frappe.route_options[filter.fieldname]\n\t\t\t}\n\n\t\t\tif(!filter.disable_onchange) {\n\t\t\t\tfilter.change = function() {\n\t\t\t\t\tfilter.on_change && filter.on_change();\n\t\t\t\t\tvar val = this.get_value();\n\t\t\t\t\tme.args[filter.fieldname] = val;\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tme.root_label = val;\n\t\t\t\t\t\tme.page.set_title(val);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.root_label = me.opts.root_label;\n\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t}\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tme.page.add_field(filter);\n\n\t\t\tif (filter.default) {\n\t\t\t\t$(\"[data-fieldname='\"+filter.fieldname+\"']\").trigger(\"change\");\n\t\t\t}\n\t\t})\n\t},\n\tget_root: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: me.get_tree_nodes,\n\t\t\targs: me.args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.root_label = r.message[0][\"value\"];\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmake_tree: function() {\n\t\t$(this.parent).find(\".tree\").remove();\n\n\t\tthis.tree = new frappe.ui.Tree({\n\t\t\tparent: this.body,\n\t\t\tlabel: this.args[this.opts.root_label] || this.root_label || this.opts.root_label,\n\t\t\texpandable: true,\n\n\t\t\targs: this.args,\n\t\t\tmethod: this.get_tree_nodes,\n\n\t\t\t// array of button props: {label, condition, click, btnClass}\n\t\t\ttoolbar: this.get_toolbar(),\n\n\t\t\tget_label: this.opts.get_label,\n\t\t\ton_render: this.opts.onrender,\n\t\t\ton_click: (node) => { this.select_node(node); },\n\t\t});\n\n\t\tcur_tree = this.tree;\n\t\tthis.post_render();\n\t},\n\n\tpost_render: function() {\n\t\tvar me = this;\n\t\tme.opts.post_render && me.opts.post_render(me);\n\t},\n\n\tselect_node: function(node) {\n\t\tvar me = this;\n\t\tif(this.opts.click) {\n\t\t\tthis.opts.click(node);\n\t\t}\n\t\tif(this.opts.view_template) {\n\t\t\tthis.node_view.empty();\n\t\t\t$(frappe.render_template(me.opts.view_template,\n\t\t\t\t{data:node.data, doctype:me.doctype})).appendTo(this.node_view);\n\t\t}\n\t},\n\tget_toolbar: function() {\n\t\tvar me = this;\n\n\t\tvar toolbar = [\n\t\t\t{\n\t\t\t\tlabel:__(me.can_write? \"Edit\": \"Details\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn !node.is_root && me.can_read;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.set_route(\"Form\", me.doctype, node.label);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Add Child\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn me.can_create && node.expandable && !node.hide_add;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tme.new_node();\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Rename\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\tlet allow_rename = true;\n\t\t\t\t\tif (me.doctype && frappe.get_meta(me.doctype)) {\n\t\t\t\t\t\tif(!frappe.get_meta(me.doctype).allow_rename) allow_rename = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn !node.is_root && me.can_write && allow_rename;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.rename_doc(me.doctype, node.label, function(new_name) {\n\t\t\t\t\t\tnode.$tree_link.find('a').text(new_name);\n\t\t\t\t\t\tnode.label = new_name;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Delete\"),\n\t\t\t\tcondition: function(node) { return !node.is_root && me.can_delete; },\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.delete_doc(me.doctype, node.label, function() {\n\t\t\t\t\t\tnode.parent.remove();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t}\n\t\t]\n\n\t\tif(this.opts.toolbar && this.opts.extend_toolbar) {\n\t\t\ttoolbar = toolbar.filter(btn => {\n\t\t\t\treturn !me.opts.toolbar.find(d => d[\"label\"]==btn[\"label\"]);\n\t\t\t});\n\t\t\treturn toolbar.concat(this.opts.toolbar)\n\t\t} else if (this.opts.toolbar && !this.opts.extend_toolbar) {\n\t\t\treturn this.opts.toolbar\n\t\t} else {\n\t\t\treturn toolbar\n\t\t}\n\t},\n\tnew_node: function() {\n\t\tvar me = this;\n\t\tvar node = me.tree.get_selected_node();\n\n\t\tif(!(node && node.expandable)) {\n\t\t\tfrappe.msgprint(__(\"Select a group node first.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepare_fields();\n\n\t\t// the dialog\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('New {0}',[__(me.doctype)]),\n\t\t\tfields: me.fields\n\t\t});\n\n\t\tvar args = $.extend({}, me.args);\n\t\targs[\"parent_\"+me.doctype.toLowerCase().replace(/ /g,'_')] = me.args[\"parent\"];\n\n\t\td.set_value(\"is_group\", 0);\n\t\td.set_values(args);\n\n\t\t// create\n\t\td.set_primary_action(__(\"Create New\"), function() {\n\t\t\tvar btn = this;\n\t\t\tvar v = d.get_values();\n\t\t\tif(!v) return;\n\n\t\t\tv.parent = node.label;\n\t\t\tv.doctype = me.doctype;\n\n\t\t\tif(node.is_root){\n\t\t\t\tv['is_root'] = node.is_root;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tv['is_root'] = false;\n\t\t\t}\n\n\t\t\td.hide();\n\t\t\tfrappe.dom.freeze(__('Creating {0}', [me.doctype]));\n\n\t\t\t$.extend(args, v)\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: me.opts.add_tree_node || \"frappe.desk.treeview.add_node\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(node.expanded) {\n\t\t\t\t\t\t\tme.tree.toggle_node(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.tree.load_children(node, true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\td.show();\n\t},\n\tprepare_fields: function(){\n\t\tvar me = this;\n\n\t\tthis.fields = [\n\t\t\t{fieldtype:'Check', fieldname:'is_group', label:__('Group Node'),\n\t\t\t\tdescription: __(\"Further nodes can be only created under 'Group' type nodes\")}\n\t\t]\n\n\t\tif (this.opts.fields) {\n\t\t\tthis.fields = this.opts.fields;\n\t\t}\n\n\t\tthis.ignore_fields = this.opts.ignore_fields || [];\n\n\t\tvar mandatory_fields = $.map(me.opts.meta.fields, function(d) {\n\t\t\treturn (d.reqd || d.bold && !d.read_only) ? d : null });\n\n\t\tvar opts_field_names = this.fields.map(function(d) {\n\t\t\treturn d.fieldname\n\t\t})\n\n\t\tmandatory_fields.map(function(d) {\n\t\t\tif($.inArray(d.fieldname, me.ignore_fields) === -1 && $.inArray(d.fieldname, opts_field_names) === -1) {\n\t\t\t\tme.fields.push(d)\n\t\t\t}\n\t\t})\n\t},\n\tprint_tree: function() {\n\t\tif(!frappe.model.can_print(this.doctype)) {\n\t\t\tfrappe.msgprint(__(\"You are not allowed to print this report\"));\n\t\t\treturn false;\n\t\t}\n\t\tvar tree = $(\".tree:visible\").html();\n\t\tvar me = this;\n\t\tfrappe.ui.get_print_settings(false, function(print_settings) {\n\t\t\tvar title =  __(me.docname || me.doctype);\n\t\t\tfrappe.render_tree({title: title, tree: tree, print_settings:print_settings});\n\t\t});\n\t},\n\tset_primary_action: function(){\n\t\tvar me = this;\n\t\tif (!this.opts.disable_add_node && this.can_create) {\n\t\t\tme.page.set_primary_action(__(\"New\"), function() {\n\t\t\t\tme.new_node();\n\t\t\t}, \"octicon octicon-plus\")\n\t\t}\n\t},\n\tset_menu_item: function(){\n\t\tvar me = this;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __('View List'),\n\t\t\t\taction: function() {\n\t\t\t\t\tfrappe.set_route('List', me.doctype);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.print_tree();\n\t\t\t\t}\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Refresh'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (me.opts.menu_items) {\n\t\t\tme.menu_items.push.apply(me.menu_items, me.opts.menu_items)\n\t\t}\n\n\t\t$.each(me.menu_items, function(i, menu_item){\n\t\t\tvar has_perm = true;\n\t\t\tif(menu_item[\"condition\"]) {\n\t\t\t\thas_perm = eval(menu_item[\"condition\"]);\n\t\t\t}\n\n\t\t\tif (has_perm) {\n\t\t\t\tme.page.add_menu_item(menu_item[\"label\"], menu_item[\"action\"]);\n\t\t\t}\n\t\t});\n\n\t\t// last menu item\n\t\tme.page.add_menu_item(__('Add to Desktop'), () => {\n\t\t\tconst label = me.doctype === 'Account' ?\n\t\t\t\t__('Chart of Accounts') :\n\t\t\t\t__(me.doctype);\n\t\t\tfrappe.add_to_desktop(label, me.doctype);\n\t\t});\n\t}\n});\n\n\n\n\n\n\n\n\n"],"names":["frappe","has_indicator","doctype","model","is_submittable","listview_settings","get_indicator","workflow","get_state_fieldname","meta","has_field","doc","__unsaved","__","workflows","without_workflow","settings","workflow_fieldname","value","colour","locals","style","Success","Warning","Danger","Primary","docstatus","has_indicator_for_draft","indicator","status","utils","guess_colour","enabled","disabled","ui","Filter","[object Object]","opts","$","extend","this","undefined","filter_utils","conditions","invalid_condition_map","Date","Datetime","Data","Select","Link","Currency","Color","make","make_select","set_events","setup","filter_edit_area","render_template","appendTo","parent","find","fieldselect","FieldSelect","parent_doctype","filter_fields","select","fieldname","set_field","set_value","on","remove","removeClass","on_change","update_filter_tag","change","field","let","condition","get_condition","fieldtype","includes","add_condition_help","df","const","set_values","is_new","promise","Promise","resolve","addClass","hidden","then","$filter_tag","hide","_filter_value_set","set_filter_button_text","make_tag","original_type","set_condition","Array","isArray","join","trim","cur","k","original_docfield","fields_by_name","console","warn","copy_dict","read_only","is_filter","c","get_default_condition","set_fieldtype","selected_doctype","selected_fieldname","make_field","old_fieldtype","old_text","get_value","hide_invalid_conditions","hide_nested_set_conditions","field_area","empty","get","f","form","make_control","only_input","refresh","wrapper","keydown","e","which","get_selected_value","val","trigger_change","$condition_field","get_filter_tag_element","insertAfter","bind_tag","bind","filter_button","closest","show","toggle","html","get_filter_button_text","get_formatted_value","label","$desc","desc_area","in_list","invalid_conditions","boot","nested_set_doctypes","options","0","1","2","cint","format","only_value","strip","indexOf","startsWith","endsWith","split","map","v","description","reqd","ignore_link_validation","toLowerCase","FilterGroup","filters","append","get_container_template","add_filter","promises","filter","push","ref","run_serially","validate_args","is_new_filter","arguments","length","args","push_new_filter","std_fields_list","throw","bold","filter_exists","_push_new_filter","setup_state","update","update_filters","filter_items","filter_value","exists","f_value","equal","arrays_equal","slice","freeze","Class","init","me","$input","select_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","item","repl","data","originalEvent","text","get_item","i","add_field_option","build_options","clear","parts","each","table_fields","std_filters","std_fields","d","doctype_obj","istable","concat","with_blank","main_table_fields","docfield_list","sort","perm","has_perm","permlevel","report_hide","table_df","child_table_fields","table","no_value_type","Tags","tagsList","onTagAdd","onTagRemove","onTagClick","onChange","placeholder","$wrapper","$ul","$inputWrapper","getListElement","$placeholder","deactivate","keypress","keyCode","tagValue","xss_sanitise","addTag","activate","focus","addTags","toTitle","$tag","getTag","insertBefore","splice","labels","$element","className","$li","$removeTag","removeTag","attr","$toggle_tag","TagEditor","setup_tags","user_tags","initialized","tags","tag","refreshing","call","method","get_args","callback","r","setup_awesomplete","setup_complete","input","target","frm","txt","cat_tags","list_sidebar","JSON","stringify","get_cat_tags","message","trigger","dt","dn","docname","clearTags","setTimeout","is_liked","get_liked_by","session","user","liked","_liked_by","parse","toggle_like","$btn","name","add","hasClass","css","quiet","exc","action_buttons","replace","liked_by","idx","click_toggle_like","$count","siblings","not_liked","setup_like_popover","$parent","selector","dom","is_touchscreen","popover","animation","placement","content","decodeURI","container","provide","views","BaseList","Object","assign","before_refresh","route_options","init_promise","tasks","setup_defaults","set_stats","setup_fields","setup_page","setup_side_bar","setup_main_section","setup_view","fn","page_name","get_route_str","page_title","get_meta","user_settings","get_user_settings","start","page_length","can_create","can_write","fields","sort_by","sort_order","primary_action","secondary_action","action","menu_items","class","set_fields","build_fields","title_field","forEach","_add_field","is_value_type","in_list_view","Boolean","uniqBy","stats","workflow_state_fieldname","page","$page","page_form","setup_page_head","set_title","set_menu_items","set_breadcrumbs","$secondary_action","set_secondary_action","icon","$item","add_menu_item","standard","breadcrumbs","module","ListSidebar","list_view","toggleClass","current_view","setup_list_wrapper","setup_filter_area","setup_sort_selector","setup_result_area","setup_no_result_area","setup_freeze_area","setup_paging_area","$frappe_list","main","filter_area","FilterArea","set","sort_selector","SortSelector","$filter_list_wrapper","onchange","on_sort_change","$result","$no_result","get_no_result_message","$freeze","$paging_area","$this","currentTarget","is","get_full_column_name","get_fields","get_filters_for_args","order_by","get_sql_string","freeze_on_refresh","freeze_message","get_call_args","prepare_data","toggle_result_area","before_render","render","after_render","dict","keys","values","show_more","names","get_checked_items","standard_filters_wrapper","trigger_refresh","make_standard_filters","make_filter_list","filter_list","get_filters","standard_filters","get_standard_filters","from","set_standard_filter","non_standard_filters","add_filters","on_filter_change","fields_dict","reduce","out","get_filter","clear_filters","key","refresh_list_view","custom_filter_configs","config","doctype_fields","in_standard_filter","unshift","add_field","position","z-index","right","top","font-size","base_list","default_filters","view_modes","is_valid","view_mode","BulkOperations","docs","print_settings","get_doc","allow_print_for_draft","allow_print_for_cancelled","valid_docs","has_role","msgprint","dialog","Dialog","title","get_print_formats","set_primary_action","default_print_format","with_letterhead","print_format","print_sel","json_string","window","open","encodeURIComponent","docnames","done","items","failed","_server_messages","play_sound","assign_to","AssignToDialog","obj","bulk_assign","re_assign","field_mappings","field_options","status_regex","default_field","test","default","set_value_field","disable_primary_action","enable_primary_action","primary_action_label","dialogObj","new_df","match","depends_on","replace_field","ListView","route","get_route","last_view","set_route","super","has_permissions","view_name","view_user_settings","saved_filters","validate_filters","get_menu_items","actions_menu_items","get_actions_menu_items","patch_refresh_and_load_lib","valid_fields","set_actions_menu_items","add_actions_menu_item","match_rules_list","get_match_rules","restricted_list","prepend","click","show_restrictions","condition_list","get_fields_in_list_view","image_field","add_fields","track_seen","get_docfield","throttle","load_lib","required_libs","require","setInterval","make_new_doc","clear_primary_action","is_non_std_field","new_doc","setup_columns","render_header","render_skeleton","setup_events","onload","show_restricted_list_indicator_if_applicable","columns","get_df","type","fields_in_list_view","new_button","with_comment_count","parse_filters_from_route_options","toggle_actions_menu_button","show_actions_menu","hide_actions_menu","get_header_html","$row","get_list_row_html_skeleton","save","save_view_user_settings","get_list_row_html","on_row_checked","render_count","render_tags","get_count_str","str","$list_rows","tag_html","_user_tags","subject_field","subject_html","$columns","col","is_numeric_field","get_header_html_skeleton","left","get_column_html","get_meta_html","get_left_html","get_right_html","get_indicator_html","_value","formatters","Subject","Field","get_subject_html","escape_html","get_form_link","modified","comment_when","last_assignee","_assign","avatar","_comment_count","get_indicator_dot","current_count","total_count","subject","strip_html","escaped_subject","heart_class","seen","_seen","encodeURI","setup_filterable","setup_list_click","setup_tag_event","setup_new_doc_event","setup_check_events","setup_like","setup_realtime_updates","metaKey","ctrlKey","stopPropagation","filters_to_apply","datetime","get_today","$target","$check","prop","preventDefault","link","location","href","shiftKey","$checkbox_cursor","name_1","name_2","findIndex","min_index","max_index","toggle_tags","realtime","is_being_edited","call_args","datum","index","a","b","a_value","b_value","return_value","$list_head_subject","$checkbox_actions","$checks","only_docnames","check","cstr","query_params","full_url","get_share_url","can_import","reference_doctype","can_set_user_permissions","allow","user_roles","custom","doc_type","toggle_side_bar","share_url","add_to_desktop","developer_mode","bulk_operations","is_field_editable","field_doc","get_docfields","some","has_editable_fields","edit","can_print","print","has_submit_permission","confirm","submit_or_cancel","can_cancel","can_delete","toString","delete","get_doctype_for_field","trees","tree","on_update","document","event","trigger_list_update","cur_list","ListFactory","Factory","with_doctype","issingle","set_re_route","view_class","load_last_view","change_to","make_page","set_cur_list","re_route_to_view","set_module_breadcrumb","last_route","route_history","history","go","prev_route","module_links","set_doctype_module","ListFilter","can_add_global","$input_area","$list_filters","filter_input","toUpperCase","input_class","render_input","label_area","is_global_input","bind_save_filter","bind_click_filter","bind_remove_filter","get_list_filters","filter_template","set_description","get_filters_values","remove_filter","debounce","has_value","filter_name_exists","save_filter","help_text","filter_name","db","insert","for_user","get_current_filters","delete_doc","get_list","or_filters","redirect_to_home_if_invalid_route","get_doc_mappings","Event","field_map","interaction_type","summary","category","due_date","public","reqd_fields","hidden_fields","ToDo","reference_document","assigned_to","get_stats","sidebar_content","sidebar","setup_reports","setup_list_filter","setup_assigned_to_me","setup_views","setup_kanban_boards","setup_calendar_view","setup_email_inbox","limits","upgrade_url","expiry","flags","upgrade_dismissed","setup_upgrade_box","show_list_link","calendar","email_accounts","treeview_settings","kanban_board","email_account","added","dropdown","divider","add_reports","reports","ref_doctype","report_type","get_divider","all_reports","localeCompare","list_filter","$dropdown","KanbanView","setup_dropdown_in_sidebar","result","calendar_views","$link_calendar","default_link","other_links","calendar_view","dropdown_html","has_common","account","email_id","upgrade_list","upgrade_date","add_days","users","upgrade_box","defined_category","defined_cat","cats","tempstats","render_stat","stat","sum","docfield_map","t","nfound","context","existing","$w","GanttView","calendar_settings","prepare_tasks","progress","isFunction","end","id","dependencies","depends_on_tasks","color","validate_hex","substr","is_milestone","render_gantt","gantt_view_mode","gantt","Gantt","date_format","on_click","task","on_date_change","moment","on_progress_change","progress_fieldname","parseInt","on_view_change","mode","custom_popup_html","_start","_end","gantt_custom_popup_html","setup_view_mode_buttons","set_colors","view_is","change_view_mode","custom_class","class_name","bar_color","get_contrast_color","CalendarView","last_calendar_view","calendar_name","last_calendar","get_calendar_preferences","Calendar","with_doc","start_date_field","end_date_field","get_default_options","defaultView","localStorage","getItem","weekends","defaults","setup_options","setup_view_mode_button","clear_user_actions","calendars","can_read","$cal","fullCalendar","footnote_area","set_footnote","border-top","cal_options","set_css","detach","btn","set_localStorage_option","option","removeItem","setItem","btn_group","allDay","color_map","danger","success","warning","get_system_datetime","date","_offset","tz","sys_defaults","time_zone","convert_to_system_tz","locale","language","header","center","editable","selectable","selectHelper","forceEventDuration","nowIndicator","events","timezone","get_events_method","prepare_events","eventRender","element","tooltip","eventClick","eventDrop","delta","revertFunc","update_event","eventResize","startDate","endDate","jsEvent","view","get_new_doc","all_day","_ambigTime","subtract","dayClick","$date_cell","source","convert_to_user_tz","validate","fix_end_date_for_event_render","prepare_colors","color_name","get_css_class","backgroundColor","textColor","remove_from_locals","update_event_method","get_update_args","show_alert","error","stripTime","ImageView","_image_url","get_image_url","get_attached_images","render_image_view","gallery","prepare_pswp_items","images_map","setup_gallery","item_html","_name","encoded_name","_class","_html","get_abbr","url","image","cordova","is_url","base_url","GalleryView","decodeURIComponent","lib_ready","prepare","pswp_root","pswp","_items","_images_map","width","height","query","el","naturalWidth","naturalHeight","getBoundingClientRect","src","msrc","w","h","pswp_items","_show","getThumbBoundsFn","thumbnail","pageYScroll","pageYOffset","documentElement","scrollTop","rect","x","y","shareEl","showHideOpacity","PhotoSwipe","PhotoSwipeUI_Default","browse_images","$more_items","last_hide_timeout","hide_more_items_after_2s","clearTimeout","hide_more_items","img_html","listen","images","currItem","off","img_el","goTo","invalidateCurrItems","updateSize","asset_dir","last_kanban_board","board_name","card_meta","get_card_meta","save_kanban_board_filters","get_board","board","filters_array","set_indicator","clear_indicator","kanban","KanbanBoard","cards","quick_entry","get_field","mandatory","kanban_boards","private","new_kanban_dialog","select_fields","get_fields_for_dialog","field_name","project","kb","kanban_filters","kanban_board_name","make_kanban_board","err","InboxView","back","last_email_account","current_email_account","get_inbox_filters","is_sent_emails","emails","render_inbox_view","render_email_row","email","css_seen","columns_html","recipients","sender","attachment","has_attachment","form_link","reference_name","all_accounts","op","msg","CommunicationComposer","user_email","FileView","last_folder","home_folder","current_folder","file_menu_items","file_manager","cut","paste","prompt","file_name","folder","grid_view","get_upload_dialog","from_form","prepare_datum","is_folder","icon_class","is_image_file","file_url","_title","is_private","render_grid_view","get_route_url","folders","acc","curr","j","breadcrumbs_html","get_breadcrumbs_html","file","created_on","file_size","FileSize","route_url","creation","now_date","str_to_user","setup_drag_drop","dataTransfer","files","upload","toggle_cut_paste_buttons","$paste_btn","menu_btn_group","can_paste","old_folder","$cut_btn","cur_tree","TreeFactory","TreeView","get_tree_root","show_expand_all","get_tree_nodes","get_permissions","make_filters","get_root","set_menu_item","in_create","add_page","make_app_page","single_column","breadcrumb","DocType","min-height","padding-bottom","add_inner_button","load_children","root_node","view_template","row","body","node_view","disable_onchange","root_label","make_tree","Tree","expandable","toolbar","get_toolbar","get_label","on_render","onrender","node","select_node","post_render","is_root","hide_add","new_node","btnClass","allow_rename","rename_doc","new_name","$tree_link","extend_toolbar","get_selected_node","prepare_fields","get_values","add_tree_node","expanded","toggle_node","always","unfreeze","ignore_fields","mandatory_fields","opts_field_names","inArray","print_tree","get_print_settings","render_tree","disable_add_node","apply","menu_item","eval","InteractionComposer","no_submit_on_enter","create_action","display","select_attachments","checked_items","render_attach","filename","interaction_docs","set_df_property","set_reqd_hidden_fields","get_event_categories","categories","get_input","add_options","setup_attach","doc_mapping","attach","attachments","max_width","max_height","attachment_uploaded","cscript","attachment_max_width","attachment_max_height","cur_frm","get_files","urllib","get_full_url","get_primary_btn","form_values","selected_attachments","create_interaction","interaction_values","reference_docname","assign_document","add_attachments","timeline","reload_doc","assignee","notify"],"mappings":"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"}